<!doctype html><html style="overflow:auto;height:auto;width:auto;"><head><title>scalable_ML_ILT_training</title><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><style>@font-face {
	font-family: Asana;
	src: url("fonts/Asana-Math.otf") format("opentype");
}

@font-face {
	font-family: Asana-Math;
	src: url("fonts/Asana-math-mode.otf") format("opentype");
}

@font-face {
	font-family: Asana-Mathbb;
	src: url("fonts/types-generated/Asana-mathbb.otf") format("opentype");
}

@font-face {
	font-family: Asana-Mathit;
	src: url("fonts/types-generated/Asana-mathit.otf") format("opentype");
}

@font-face {
	font-family: Asana-Mathcal;
	src: url("fonts/types-generated/Asana-mathcal.otf") format("opentype");
}

@font-face {
	font-family: Asana-Mathscr;
	src: url("fonts/types-generated/Asana-mathscr.otf") format("opentype");
}

@font-face {
	font-family: Asana-Mathfrak;
	src: url("fonts/types-generated/Asana-mathfrak.otf") format("opentype");
}

@font-face {
	font-family: Asana-Mathsf;
	src: url("fonts/types-generated/Asana-mathsf.otf") format("opentype");
}

@font-face {
	font-family: Asana-Mathtt;
	src: url("fonts/types-generated/Asana-mathtt.otf") format("opentype");
}

@font-face {
	font-family: Asana-Mathrm;
	src: url("fonts/types-generated/Asana-mathrm.otf") format("opentype");
}

@font-face {
	font-family: 'FontAwesome';
	src: url('fonts/icomoon.eot');
	src: url('fonts/icomoon.eot') format('embedded-opentype'), url('fonts/icomoon.woff') format('woff'), url('fonts/icomoon.ttf') format('truetype'), url('fonts/icomoon.svg') format('svg');
	font-weight: normal;
	font-style: normal;
}

/**
Latin Modern
**/

@font-face {
	font-family: LatinModern;
	src: url("fonts/latinmodern-math.otf") format("opentype");
}

@font-face {
	font-family: LatinModern-Math;
	src: url("fonts/latinmodern-math-mode.otf") format("opentype");
}

@font-face {
	font-family: LatinModern-Mathbb;
	src: url("fonts/types-generated/latinmodern-mathbb.otf") format("opentype");
}

@font-face {
	font-family: LatinModern-Mathit;
	src: url("fonts/types-generated/latinmodern-mathit.otf") format("opentype");
}

@font-face {
	font-family: LatinModern-Mathcal;
	src: url("fonts/types-generated/latinmodern-mathcal.otf") format("opentype");
}

@font-face {
	font-family: LatinModern-Mathscr;
	src: url("fonts/types-generated/latinmodern-mathscr.otf") format("opentype");
}

@font-face {
	font-family: LatinModern-Mathfrak;
	src: url("fonts/types-generated/latinmodern-mathfrak.otf") format("opentype");
}

@font-face {
	font-family: LatinModern-Mathsf;
	src: url("fonts/types-generated/latinmodern-mathsf.otf") format("opentype");
}

@font-face {
	font-family: LatinModern-Mathtt;
	src: url("fonts/types-generated/latinmodern-mathtt.otf") format("opentype");
}

@font-face {
	font-family: LatinModern-Mathrm;
	src: url("fonts/types-generated/latinmodern-mathrm.otf") format("opentype");
}

/***********************************************************/

/**
Thicker Latin Modern
**/

@font-face {
	font-family: ThickerLm;
	src: url("fonts/thickerlm-math.otf") format("opentype");
}

@font-face {
	font-family: ThickerLm-Math;
	src: url("fonts/thickerlm-math-mode.otf") format("opentype");
}

@font-face {
	font-family: ThickerLm-Mathbb;
	src: url("fonts/types-generated/thickerlm-mathbb.otf") format("opentype");
}

@font-face {
	font-family: ThickerLm-Mathit;
	src: url("fonts/types-generated/thickerlm-mathit.otf") format("opentype");
}

@font-face {
	font-family: ThickerLm-Mathcal;
	src: url("fonts/types-generated/thickerlm-mathcal.otf") format("opentype");
}

@font-face {
	font-family: ThickerLm-Mathscr;
	src: url("fonts/types-generated/thickerlm-mathscr.otf") format("opentype");
}

@font-face {
	font-family: ThickerLm-Mathfrak;
	src: url("fonts/types-generated/thickerlm-mathfrak.otf") format("opentype");
}

@font-face {
	font-family: ThickerLm-Mathsf;
	src: url("fonts/types-generated/thickerlm-mathsf.otf") format("opentype");
}

@font-face {
	font-family: ThickerLm-Mathtt;
	src: url("fonts/types-generated/thickerlm-mathtt.otf") format("opentype");
}

@font-face {
	font-family: ThickerLm-Mathrm;
	src: url("fonts/types-generated/thickerlm-mathrm.otf") format("opentype");
}

/***********************************************************/

/* Computer Modern */

@font-face {
	font-family: 'Computer Modern Sans';
	src: url('fonts/others-text-mode/computer-modern/Sans/cmunss.otf') format("opentype");
	font-weight: normal;
	font-style: normal;
}

@font-face {
	font-family: 'Computer Modern Sans';
	src: url('fonts/others-text-mode/computer-modern/Sans/cmunsx.otf') format("opentype");
	font-weight: bold;
	font-style: normal;
}

@font-face {
	font-family: 'Computer Modern Sans';
	src: url('fonts/others-text-mode/computer-modern/Sans/cmunsi.otf') format("opentype");
	font-weight: normal;
	font-style: italic;
}

@font-face {
	font-family: 'Computer Modern Sans';
	src: url('fonts/others-text-mode/computer-modern/Sans/cmunso.otf') format("opentype");
	font-weight: bold;
	font-style: italic;
}

@font-face {
	font-family: 'Computer Modern Serif';
	src: url('fonts/others-text-mode/computer-modern/Serif/cmunrm.otf') format("opentype");
	font-weight: normal;
	font-style: normal;
}

@font-face {
	font-family: 'Computer Modern Serif';
	src: url('fonts/others-text-mode/computer-modern/Serif/cmunbx.otf') format("opentype");
	font-weight: bold;
	font-style: normal;
}

@font-face {
	font-family: 'Computer Modern Serif';
	src: url('fonts/others-text-mode/computer-modern/Serif/cmunti.otf') format("opentype");
	font-weight: normal;
	font-style: italic;
}

@font-face {
	font-family: 'Computer Modern Serif';
	src: url('fonts/others-text-mode/computer-modern/Serif/cmunbi.otf') format("opentype");
	font-weight: bold;
	font-style: italic;
}

@font-face {
	font-family: 'Computer Modern Typewriter';
	src: url('fonts/others-text-mode/computer-modern/Typewriter/cmuntt.otf') format("opentype");
	font-weight: normal;
	font-style: normal;
}

@font-face {
	font-family: 'Computer Modern Typewriter';
	src: url('fonts/others-text-mode/computer-modern/Typewriter/cmuntb.otf') format("opentype");
	font-weight: bold;
	font-style: normal;
}

@font-face {
	font-family: 'Computer Modern Typewriter';
	src: url('fonts/others-text-mode/computer-modern/Typewriter/cmunit.otf') format("opentype");
	font-weight: normal;
	font-style: italic;
}

@font-face {
	font-family: 'Computer Modern Typewriter';
	src: url('fonts/others-text-mode/computer-modern/Typewriter/cmuntx.otf') format("opentype");
	font-weight: bold;
	font-style: italic;
}

/**/

/**
Sans Math + Liberation Font
**/

@font-face {
	font-family: Sans;
	src: url("fonts/Sans-Math.otf") format("opentype");
}

@font-face {
	font-family: Sans-Math;
	src: url("fonts/Sans-Math-mode.otf") format("opentype");
}

@font-face {
	font-family: Sans-Bold;
	src: url("fonts/types-generated/Sans-bold.otf") format("opentype");
	font-weight: bold;
}

@font-face {
	font-family: Sans-Mathbb;
	src: url("fonts/types-generated/Asana-mathbb.otf") format("opentype");
}

@font-face {
	font-family: Sans-Mathit;
	src: url("fonts/types-generated/Sans-mathit.otf") format("opentype");
}

@font-face {
	font-family: Sans-Mathcal;
	src: url("fonts/types-generated/Asana-mathcal.otf") format("opentype");
}

@font-face {
	font-family: Sans-Mathscr;
	src: url("fonts/types-generated/Asana-mathscr.otf") format("opentype");
}

@font-face {
	font-family: Sans-Mathfrak;
	src: url("fonts/types-generated/Asana-mathfrak.otf") format("opentype");
}

@font-face {
	font-family: Sans-Mathsf;
	src: url("fonts/types-generated/Asana-mathsf.otf") format("opentype");
}

@font-face {
	font-family: Sans-Mathtt;
	src: url("fonts/types-generated/Asana-mathtt.otf") format("opentype");
}

@font-face {
	font-family: Sans-Mathrm;
	src: url("fonts/types-generated/Asana-mathrm.otf") format("opentype");
}

@font-face {
	font-family: Sans-Mathbf;
	src: url("fonts/types-generated/Sans-mathbf.otf") format("opentype");
	font-weight: bold;
}

/***********************************************************/</style><style>

compositeblock {
  display: inline-block;
  position: relative;
  text-align: left;
  unicode-bidi: isolate;
}
compositeblock.middle {
  vertical-align: middle;
}
latex-symbol-icon {
  display: inline-block;
  padding: 2px;
  border: 1px solid transparent;
  cursor: pointer;
}
latex-symbol-icon:hover,
latex-symbol-icon.selected {
  background: white;
  border: 1px solid lightgray;
}
inline {
  display: inline-block;
}
base-line-indicator {
  display: inline-block;
  overflow: hidden;
  width: 0px;
  height: inherit;
}

math-type .constant-text > constant-text {
  margin-left: 0.2em;
  margin-right: 0.2em;
}
math-type .constant-text > constant-text.close-left {
  margin-left: 0;
}
math-type .constant-text > constant-text.close-right {
  margin-right: 0;
}



/**different context*/
/**different context*/
math-type ref-tag {
  position: absolute;
  right: 5px;
  top: 50%;
  transform: translate(0, -50%);
  z-index: 8;
  cursor: pointer;
}
math-type ref-tag > label {
  cursor: pointer;
}
math-type ref-tag:hover {
  text-decoration: underline;
}
math-type ref-tag.line-tag {
  transition: background 0.4s;
}
math-type ref-tag.empty-line-tag {
  opacity: 0.5;
  animation: fadein 0.5s;
}
math-type tr.math-row ref-tag {
  left: calc(100% + 20px);
  right: unset;
}
@keyframes fadein {
  0% {
    opacity: 0;
  }
  70% {
    opacity: 0;
  }
  100% {
    opacity: 0.5;
  }
}







.color-picker no-color-select {
  display: block;
  text-align: center;
  /* width: 100%; */
  /* height: 20px; */
  background: white;
  border: 1px solid lightgray;
  margin-bottom: 2px;
  color: gray;
  padding: 2px;
  cursor: default;
  border-radius: 0;
  padding-bottom: 2px;
  margin-bottom: 3px;
  margin-left: -1px;
  margin-right: -1px;
  font-size: 13px;
}
.color-picker no-color-select:hover {
  color: black;
}
.color-picker color-select {
  position: absolute;
  top: 30px;
  left: 0px;
  background: white;
}

/**we use alpha as we have problem with background (without alpha) in Electron version (older Chrome) **/
/* z-index region*/
/**different context*/
/**different context*/
math-type editarea.no-area-container,
math-type editarea.text-mode,
math-type area-container,
math-type .print-as-area-container {
  display: flex;
  flex-direction: column;
  align-items: stretch;
}
math-type editarea.no-area-container > line,
math-type editarea.text-mode > line,
math-type area-container > line,
math-type .print-as-area-container > line {
  min-width: 0.3em;
  position: relative;
  display: block;
  width: 100%;
  align-items: baseline;
  flex-wrap: wrap;
  box-sizing: border-box;
  flex-wrap: nowrap;
  line-height: 1.2;
  white-space: nowrap;
}
math-type editarea.no-area-container > line block,
math-type editarea.text-mode > line block,
math-type area-container > line block,
math-type .print-as-area-container > line block {
  white-space: pre;
}
math-type editarea.no-area-container > line.single-block > blocks > baselineblock,
math-type editarea.text-mode > line.single-block > blocks > baselineblock,
math-type area-container > line.single-block > blocks > baselineblock,
math-type .print-as-area-container > line.single-block > blocks > baselineblock {
  display: none;
}
math-type editarea.no-area-container > line > blocks,
math-type editarea.text-mode > line > blocks,
math-type area-container > line > blocks,
math-type .print-as-area-container > line > blocks {
  /**
            Different between inline and inline-block is about whether Section Text will be wrap in next wrapped line 
            */
  display: inline-block;
  text-align: left;
}
math-type editarea.no-area-container > line.root,
math-type editarea.text-mode > line.root,
math-type area-container > line.root,
math-type .print-as-area-container > line.root,
math-type editarea.no-area-container > line.text-mode,
math-type editarea.text-mode > line.text-mode,
math-type area-container > line.text-mode,
math-type .print-as-area-container > line.text-mode {
  display: block;
  font-style: normal;
}
math-type editarea.no-area-container > line.root > prefix,
math-type editarea.text-mode > line.root > prefix,
math-type area-container > line.root > prefix,
math-type .print-as-area-container > line.root > prefix,
math-type editarea.no-area-container > line.text-mode > prefix,
math-type editarea.text-mode > line.text-mode > prefix,
math-type area-container > line.text-mode > prefix,
math-type .print-as-area-container > line.text-mode > prefix {
  white-space: pre;
  display: inline-block;
  cursor: default;
  text-align: left;
}
math-type editarea.no-area-container > line.root > blocks,
math-type editarea.text-mode > line.root > blocks,
math-type area-container > line.root > blocks,
math-type .print-as-area-container > line.root > blocks,
math-type editarea.no-area-container > line.text-mode > blocks,
math-type editarea.text-mode > line.text-mode > blocks,
math-type area-container > line.text-mode > blocks,
math-type .print-as-area-container > line.text-mode > blocks {
  /** should not wrap here*/
  align-items: baseline;
  box-sizing: border-box;
}
math-type editarea.no-area-container > line.root > blocks > block,
math-type editarea.text-mode > line.root > blocks > block,
math-type area-container > line.root > blocks > block,
math-type .print-as-area-container > line.root > blocks > block,
math-type editarea.no-area-container > line.text-mode > blocks > block,
math-type editarea.text-mode > line.text-mode > blocks > block,
math-type area-container > line.text-mode > blocks > block,
math-type .print-as-area-container > line.text-mode > blocks > block {
  white-space: pre-wrap;
  white-space: break-spaces;
}
math-type editarea.no-area-container > line.root.full-line-block-inside > prefix,
math-type editarea.text-mode > line.root.full-line-block-inside > prefix,
math-type area-container > line.root.full-line-block-inside > prefix,
math-type .print-as-area-container > line.root.full-line-block-inside > prefix,
math-type editarea.no-area-container > line.text-mode.full-line-block-inside > prefix,
math-type editarea.text-mode > line.text-mode.full-line-block-inside > prefix,
math-type area-container > line.text-mode.full-line-block-inside > prefix,
math-type .print-as-area-container > line.text-mode.full-line-block-inside > prefix {
  float: left;
  vertical-align: top;
}
math-type editarea.no-area-container > line.root.full-line-block-inside > blocks,
math-type editarea.text-mode > line.root.full-line-block-inside > blocks,
math-type area-container > line.root.full-line-block-inside > blocks,
math-type .print-as-area-container > line.root.full-line-block-inside > blocks,
math-type editarea.no-area-container > line.text-mode.full-line-block-inside > blocks,
math-type editarea.text-mode > line.text-mode.full-line-block-inside > blocks,
math-type area-container > line.text-mode.full-line-block-inside > blocks,
math-type .print-as-area-container > line.text-mode.full-line-block-inside > blocks {
  display: block;
  width: 100%;
}
math-type editarea.no-area-container > line.root.full-line-block-inside > blocks > baselineblock,
math-type editarea.text-mode > line.root.full-line-block-inside > blocks > baselineblock,
math-type area-container > line.root.full-line-block-inside > blocks > baselineblock,
math-type .print-as-area-container > line.root.full-line-block-inside > blocks > baselineblock,
math-type editarea.no-area-container > line.text-mode.full-line-block-inside > blocks > baselineblock,
math-type editarea.text-mode > line.text-mode.full-line-block-inside > blocks > baselineblock,
math-type area-container > line.text-mode.full-line-block-inside > blocks > baselineblock,
math-type .print-as-area-container > line.text-mode.full-line-block-inside > blocks > baselineblock {
  display: inline-block;
  float: left;
}
math-type editarea.no-area-container > line.root.has-rtl.align-justify,
math-type editarea.text-mode > line.root.has-rtl.align-justify,
math-type area-container > line.root.has-rtl.align-justify,
math-type .print-as-area-container > line.root.has-rtl.align-justify,
math-type editarea.no-area-container > line.text-mode.has-rtl.align-justify,
math-type editarea.text-mode > line.text-mode.has-rtl.align-justify,
math-type area-container > line.text-mode.has-rtl.align-justify,
math-type .print-as-area-container > line.text-mode.has-rtl.align-justify {
  direction: rtl;
}
math-type editarea.no-area-container > line.root.section,
math-type editarea.text-mode > line.root.section,
math-type area-container > line.root.section,
math-type .print-as-area-container > line.root.section,
math-type editarea.no-area-container > line.text-mode.section,
math-type editarea.text-mode > line.text-mode.section,
math-type area-container > line.text-mode.section,
math-type .print-as-area-container > line.text-mode.section {
  text-align: left;
}
math-type editarea.no-area-container > line.root.section > blocks,
math-type editarea.text-mode > line.root.section > blocks,
math-type area-container > line.root.section > blocks,
math-type .print-as-area-container > line.root.section > blocks,
math-type editarea.no-area-container > line.text-mode.section > blocks,
math-type editarea.text-mode > line.text-mode.section > blocks,
math-type area-container > line.text-mode.section > blocks,
math-type .print-as-area-container > line.text-mode.section > blocks {
  /**
                    Different between inline and inline-block is about whether Section Text will be wrap in next wrapped line 
                    */
  display: inline;
}
math-type editarea.no-area-container > line.root.section.has-rtl,
math-type editarea.text-mode > line.root.section.has-rtl,
math-type area-container > line.root.section.has-rtl,
math-type .print-as-area-container > line.root.section.has-rtl,
math-type editarea.no-area-container > line.text-mode.section.has-rtl,
math-type editarea.text-mode > line.text-mode.section.has-rtl,
math-type area-container > line.text-mode.section.has-rtl,
math-type .print-as-area-container > line.text-mode.section.has-rtl {
  direction: rtl;
}
math-type editarea.no-area-container > line.root.section.has-rtl > prefix,
math-type editarea.text-mode > line.root.section.has-rtl > prefix,
math-type area-container > line.root.section.has-rtl > prefix,
math-type .print-as-area-container > line.root.section.has-rtl > prefix,
math-type editarea.no-area-container > line.text-mode.section.has-rtl > prefix,
math-type editarea.text-mode > line.text-mode.section.has-rtl > prefix,
math-type area-container > line.text-mode.section.has-rtl > prefix,
math-type .print-as-area-container > line.text-mode.section.has-rtl > prefix {
  direction: rtl;
  order: 1;
}
math-type editarea.no-area-container > line.root.theorem,
math-type editarea.text-mode > line.root.theorem,
math-type area-container > line.root.theorem,
math-type .print-as-area-container > line.root.theorem,
math-type editarea.no-area-container > line.text-mode.theorem,
math-type editarea.text-mode > line.text-mode.theorem,
math-type area-container > line.text-mode.theorem,
math-type .print-as-area-container > line.text-mode.theorem {
  padding-top: 0.3em;
  padding-bottom: 0.3em;
}
math-type editarea.no-area-container > line > prefix,
math-type editarea.text-mode > line > prefix,
math-type area-container > line > prefix,
math-type .print-as-area-container > line > prefix {
  text-align: right;
}
math-type editarea.no-area-container > line.has-indent,
math-type editarea.text-mode > line.has-indent,
math-type area-container > line.has-indent,
math-type .print-as-area-container > line.has-indent {
  display: flex;
  justify-content: flex-start;
}
math-type editarea.no-area-container > line.has-rtl.has-indent > prefix,
math-type editarea.text-mode > line.has-rtl.has-indent > prefix,
math-type area-container > line.has-rtl.has-indent > prefix,
math-type .print-as-area-container > line.has-rtl.has-indent > prefix {
  direction: rtl;
  order: 1;
}
math-type editarea.no-area-container > line.has-rtl.has-indent.indent-0,
math-type editarea.text-mode > line.has-rtl.has-indent.indent-0,
math-type area-container > line.has-rtl.has-indent.indent-0,
math-type .print-as-area-container > line.has-rtl.has-indent.indent-0 {
  padding-left: 0;
  padding-right: 30px;
}
math-type editarea.no-area-container > line.has-rtl.has-indent.indent-1,
math-type editarea.text-mode > line.has-rtl.has-indent.indent-1,
math-type area-container > line.has-rtl.has-indent.indent-1,
math-type .print-as-area-container > line.has-rtl.has-indent.indent-1 {
  padding-left: 0;
  padding-right: 65px;
}
math-type editarea.no-area-container > line.has-rtl.has-indent.indent-2,
math-type editarea.text-mode > line.has-rtl.has-indent.indent-2,
math-type area-container > line.has-rtl.has-indent.indent-2,
math-type .print-as-area-container > line.has-rtl.has-indent.indent-2 {
  padding-left: 0;
  padding-right: 105px;
}
math-type editarea.no-area-container > line.has-rtl.has-indent.indent-3,
math-type editarea.text-mode > line.has-rtl.has-indent.indent-3,
math-type area-container > line.has-rtl.has-indent.indent-3,
math-type .print-as-area-container > line.has-rtl.has-indent.indent-3 {
  padding-left: 0;
  padding-right: 145px;
}
math-type editarea.no-area-container > line.has-rtl.has-indent.indent-4,
math-type editarea.text-mode > line.has-rtl.has-indent.indent-4,
math-type area-container > line.has-rtl.has-indent.indent-4,
math-type .print-as-area-container > line.has-rtl.has-indent.indent-4 {
  padding-left: 0;
  padding-right: 185px;
}
math-type editarea.no-area-container > line.indent-0,
math-type editarea.text-mode > line.indent-0,
math-type area-container > line.indent-0,
math-type .print-as-area-container > line.indent-0 {
  padding-left: 30px;
}
math-type editarea.no-area-container > line.indent-1,
math-type editarea.text-mode > line.indent-1,
math-type area-container > line.indent-1,
math-type .print-as-area-container > line.indent-1 {
  padding-left: 65px;
}
math-type editarea.no-area-container > line.indent-2,
math-type editarea.text-mode > line.indent-2,
math-type area-container > line.indent-2,
math-type .print-as-area-container > line.indent-2 {
  padding-left: 105px;
}
math-type editarea.no-area-container > line.indent-3,
math-type editarea.text-mode > line.indent-3,
math-type area-container > line.indent-3,
math-type .print-as-area-container > line.indent-3 {
  padding-left: 145px;
}
math-type editarea.no-area-container > line.indent-4,
math-type editarea.text-mode > line.indent-4,
math-type area-container > line.indent-4,
math-type .print-as-area-container > line.indent-4 {
  padding-left: 185px;
}
math-type editarea.no-area-container > line.math-container-selected,
math-type editarea.text-mode > line.math-container-selected,
math-type area-container > line.math-container-selected,
math-type .print-as-area-container > line.math-container-selected {
  outline: 1px solid rgba(93, 92, 92, 0.3);
}
math-type editarea.no-area-container > line.math-container,
math-type editarea.text-mode > line.math-container,
math-type area-container > line.math-container,
math-type .print-as-area-container > line.math-container {
  font-family: 'Asana';
  justify-content: center;
  text-align: center;
  text-align-last: auto;
  display: flex;
}
math-type editarea.no-area-container > line.math-container block,
math-type editarea.text-mode > line.math-container block,
math-type area-container > line.math-container block,
math-type .print-as-area-container > line.math-container block {
  white-space: pre;
}
math-type editarea.no-area-container > line.align-center,
math-type editarea.text-mode > line.align-center,
math-type area-container > line.align-center,
math-type .print-as-area-container > line.align-center {
  text-align: center;
  text-align-last: auto;
}
math-type editarea.no-area-container > line.align-center.has-indent,
math-type editarea.text-mode > line.align-center.has-indent,
math-type area-container > line.align-center.has-indent,
math-type .print-as-area-container > line.align-center.has-indent {
  justify-content: center;
}
math-type editarea.no-area-container > line.align-center.section,
math-type editarea.text-mode > line.align-center.section,
math-type area-container > line.align-center.section,
math-type .print-as-area-container > line.align-center.section {
  text-align: center;
  text-align-last: auto;
}
math-type editarea.no-area-container > line.align-center > blocks,
math-type editarea.text-mode > line.align-center > blocks,
math-type area-container > line.align-center > blocks,
math-type .print-as-area-container > line.align-center > blocks {
  text-align: center;
  text-align-last: auto;
}
math-type editarea.no-area-container > line.align-justify,
math-type editarea.text-mode > line.align-justify,
math-type area-container > line.align-justify,
math-type .print-as-area-container > line.align-justify {
  text-align: justify;
}
math-type editarea.no-area-container > line.align-justify.section,
math-type editarea.text-mode > line.align-justify.section,
math-type area-container > line.align-justify.section,
math-type .print-as-area-container > line.align-justify.section {
  text-align: justify;
}
math-type editarea.no-area-container > line.align-justify > blocks,
math-type editarea.text-mode > line.align-justify > blocks,
math-type area-container > line.align-justify > blocks,
math-type .print-as-area-container > line.align-justify > blocks {
  text-align: justify;
}
math-type editarea.no-area-container > line.align-left,
math-type editarea.text-mode > line.align-left,
math-type area-container > line.align-left,
math-type .print-as-area-container > line.align-left {
  text-align: left;
}
math-type editarea.no-area-container > line.align-left > blocks,
math-type editarea.text-mode > line.align-left > blocks,
math-type area-container > line.align-left > blocks,
math-type .print-as-area-container > line.align-left > blocks {
  text-align: left;
}
math-type editarea.no-area-container > line.align-right,
math-type editarea.text-mode > line.align-right,
math-type area-container > line.align-right,
math-type .print-as-area-container > line.align-right {
  text-align: right;
}
math-type editarea.no-area-container > line.align-right.has-indent,
math-type editarea.text-mode > line.align-right.has-indent,
math-type area-container > line.align-right.has-indent,
math-type .print-as-area-container > line.align-right.has-indent {
  justify-content: flex-end;
}
math-type editarea.no-area-container > line.align-right.section,
math-type editarea.text-mode > line.align-right.section,
math-type area-container > line.align-right.section,
math-type .print-as-area-container > line.align-right.section {
  text-align: right;
}
math-type editarea.no-area-container > line.align-right > blocks,
math-type editarea.text-mode > line.align-right > blocks,
math-type area-container > line.align-right > blocks,
math-type .print-as-area-container > line.align-right > blocks {
  text-align: right;
}
math-type editarea.no-area-container > line > blocks > block,
math-type editarea.text-mode > line > blocks > block,
math-type area-container > line > blocks > block,
math-type .print-as-area-container > line > blocks > block {
  display: inline;
}
math-type editarea.no-area-container,
math-type area-container {
  align-items: initial;
}
math-type editarea.root-editor {
  align-items: initial;
  display: block;
  color: black;
  fill: black;
  stroke: black;
  border-color: black;
}
math-type editarea.root-editor.read-only {
  cursor: default;
}
math-type editarea.root-editor.read-only block {
  cursor: default;
}
math-type editarea.root-editor > area-container {
  display: block;
}
math-type area-container {
  width: 100%;
}
math-type block {
  cursor: text;
}
math-type editarea {
  box-sizing: border-box;
  display: flex;
  overflow-x: visible;
  align-items: center;
  justify-content: center;
  flex-direction: row;
  flex-wrap: nowrap;
}
math-type editarea block {
  cursor: text;
}
math-type editarea.high-order {
  position: relative;
  z-index: 10;
}
math-type editarea.selected {
  outline: 1px solid rgba(93, 92, 92, 0.3);
}
math-type editarea.bordered {
  outline: 1px solid rgba(93, 92, 92, 0.3);
}
math-type editarea.center > area-container > line,
math-type editarea.center > line {
  justify-content: center;
  text-align: center;
  text-align-last: auto;
}
math-type editarea.left > area-container > line,
math-type editarea.left > line {
  justify-content: flex-start;
  text-align: left;
}
math-type editarea.right > area-container > line,
math-type editarea.right > line {
  justify-content: flex-end;
  text-align: right;
}
math-type editarea > area-baseline {
  width: 0;
  overflow: hidden;
  display: inline-block;
  float: left;
}
math-type setting.mt-common-dialog.line-tag-setting {
  transform: translate(0, -100%);
  position: absolute;
  font-family: serif;
  font-size: 11px;
  top: -4px;
  left: -10px;
  outline: none;
}
math-type setting.mt-common-dialog.line-tag-setting i {
  font-style: normal;
  padding: 1px 3px;
}
baselineblock {
  height: 0px;
  display: inline-block;
  width: 0;
  overflow: hidden;
}
baselineblock.inline {
  display: inline;
}
emptyblock {
  white-space: pre;
}
composite {
  display: inline-block;
}
block.Binary {
  padding: 0 0.2em;
}
block.Relation {
  padding: 0 0.3em;
}
block.Punctuation {
  padding-right: 0.2em;
}




check-box-wrapper {
  display: block;
  font-size: 11px;
  color: gray;
  cursor: pointer;
}
check-box-wrapper.disabled {
  color: lightgray;
}
check-box-wrapper.disabled check-box-rect {
  border: 1px solid #e2e1e1;
  color: lightgray;
}
check-box-wrapper.disabled check-box-rect:hover {
  border: 1px solid #e2e1e1;
}
check-box-wrapper.mobile-tablet check-box-rect {
  margin-top: -3px;
  width: 16px;
  height: 15px;
  font-size: 13px;
}
check-box-wrapper.mobile-tablet check-box-rect > i {
  left: 2px;
  top: 1px;
}
check-box-wrapper check-box-rect {
  width: 1.4em;
  height: 1.35em;
  border: 1px solid #c3c2c2;
  position: relative;
  display: inline-flex;
  font-size: 11px;
  color: green;
  background: white;
  justify-content: center;
  align-items: center;
}
check-box-wrapper check-box-rect:hover {
  border: 1px solid gray;
}
check-box-wrapper.unchecked check-box-rect > i {
  visibility: hidden;
}

vcomposed-symbol {
  display: flex;
  width: 100%;
  height: 100%;
  overflow: hidden;
  flex-direction: column;
}
vcomposed-symbol > start {
  display: block;
  float: left;
  overflow: hidden;
  margin-bottom: -0.02em;
}
vcomposed-symbol > middle-center {
  overflow: hidden;
  margin-top: -0.02em;
  margin-bottom: -0.02em;
}
vcomposed-symbol > middle {
  display: block;
  flex-grow: 1;
  position: relative;
  overflow: hidden;
  margin-top: -0.02em;
  margin-bottom: -0.02em;
}
vcomposed-symbol > middle > fixed {
  display: block;
  position: absolute;
  left: 0;
  top: 0;
}
vcomposed-symbol > middle > fixed > inside {
  display: block;
  overflow: hidden;
}
vcomposed-symbol > end {
  margin-top: -0.02em;
  display: block;
  overflow: hidden;
}


.open-brace,
.close-brace {
  padding: 0 0.1em;
  width: 0.5em;
  min-width: 0.5em;
}
.open-brace > start,
.close-brace > start {
  min-height: 0.75em;
  height: 0.75em;
}
.open-brace > middle-center,
.close-brace > middle-center {
  min-height: 0.6em;
  height: 0.6em;
}
.open-brace > end,
.close-brace > end {
  min-height: 0.75em;
  height: 0.75em;
}
.open-bracket,
.close-bracket {
  width: 0.43em;
  min-width: 0.43em;
}
.open-bracket > start,
.close-bracket > start {
  height: 0.5em;
  min-height: 0.5em;
}
.open-bracket > end,
.close-bracket > end {
  height: 0.7em;
  min-height: 0.7em;
}
.open-parenthesis,
.close-parenthesis {
  width: 0.45em;
  min-width: 0.45em;
}
.open-parenthesis > start,
.close-parenthesis > start {
  min-height: 0.85em;
  height: 0.85em;
}
.open-parenthesis > end,
.close-parenthesis > end {
  min-height: 0.8em;
  height: 0.8em;
}
.open-floor,
.close-floor {
  width: 0.45em;
  min-width: 0.45em;
}
.open-floor > end,
.close-floor > end {
  height: 0.35em;
  min-height: 0.35em;
}
.open-ceil,
.close-ceil {
  width: 0.45em;
  min-width: 0.45em;
}
.open-ceil > start,
.close-ceil > start {
  height: 0.5em;
  min-height: 0.5em;
}
.open-vert,
.close-vert {
  width: 0.3em;
  min-width: 0.3em;
}
.open-Vert,
.close-Vert {
  width: 0.5em;
  min-width: 0.5em;
}
.open-uparrow,
.close-uparrow {
  width: 0.45em;
  min-width: 0.45em;
}
.open-uparrow > start,
.close-uparrow > start {
  height: 0.5em;
  min-height: 0.5em;
}
.open-downarrow,
.close-downarrow {
  width: 0.45em;
  min-width: 0.45em;
}
.open-downarrow > end,
.close-downarrow > end {
  height: 0.4em;
  min-height: 0.4em;
}
.open-updownarrow,
.close-updownarrow {
  width: 0.45em;
  min-width: 0.45em;
}
.open-updownarrow > start,
.close-updownarrow > start {
  height: 0.5em;
  min-height: 0.5em;
}
.open-updownarrow > end,
.close-updownarrow > end {
  height: 0.4em;
  min-height: 0.4em;
}
.open-Uparrow,
.close-Uparrow {
  width: 0.7em;
  min-width: 0.7em;
}
.open-Uparrow > start,
.close-Uparrow > start {
  height: 0.5em;
  min-height: 0.5em;
}
.open-Downarrow,
.close-Downarrow {
  width: 0.7em;
  min-width: 0.7em;
}
.open-Downarrow > end,
.close-Downarrow > end {
  height: 0.5em;
  min-height: 0.5em;
}
.open-Updownarrow,
.close-Updownarrow {
  width: 0.6em;
  min-width: 0.6em;
}
.open-Updownarrow > start,
.close-Updownarrow > start {
  height: 0.5em;
  min-height: 0.5em;
}
.open-Updownarrow > end,
.close-Updownarrow > end {
  height: 0.5em;
  min-height: 0.5em;
}

/**we use alpha as we have problem with background (without alpha) in Electron version (older Chrome) **/
/* z-index region*/
/**different context*/
/**different context*/
opensymbolblock,
closesymbolblock,
.middle-vert-symbol {
  display: inline-flex;
  align-items: center;
  position: relative;
  text-align: left;
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}
opensymbolblock.normal,
closesymbolblock.normal,
.middle-vert-symbol.normal {
  margin-top: 0;
  margin-bottom: 0;
}
opensymbolblock > hidden-span,
closesymbolblock > hidden-span,
.middle-vert-symbol > hidden-span {
  visibility: hidden;
  width: 0px;
}
opensymbolblock[type='brace'],
closesymbolblock[type='brace'],
.middle-vert-symbol[type='brace'] {
  margin-left: 0.05em;
  margin-right: 0.05em;
  overflow: visible;
}
opensymbolblock[type='brace'] > svg,
closesymbolblock[type='brace'] > svg,
.middle-vert-symbol[type='brace'] > svg {
  overflow: visible;
  width: 0.5em;
  height: 100%;
}
opensymbolblock[type='parenthesis'] > svg,
closesymbolblock[type='parenthesis'] > svg,
.middle-vert-symbol[type='parenthesis'] > svg {
  width: 0.5em;
  height: 100%;
}
opensymbolblock[type='bracket'] > svg,
closesymbolblock[type='bracket'] > svg,
.middle-vert-symbol[type='bracket'] > svg {
  width: 0.5em;
  height: 100%;
}
opensymbolblock[type='angle'].sm-1 > svg,
closesymbolblock[type='angle'].sm-1 > svg,
.middle-vert-symbol[type='angle'].sm-1 > svg {
  width: 0.3em;
}
opensymbolblock[type='angle'].sm-2 > svg,
closesymbolblock[type='angle'].sm-2 > svg,
.middle-vert-symbol[type='angle'].sm-2 > svg {
  width: 0.45em;
}
opensymbolblock[type='angle'] > svg,
closesymbolblock[type='angle'] > svg,
.middle-vert-symbol[type='angle'] > svg {
  width: 0.6em;
  height: 100%;
}
opensymbolblock[type='slash'] > svg,
closesymbolblock[type='slash'] > svg,
.middle-vert-symbol[type='slash'] > svg {
  width: 0.7em;
  height: 100%;
}
opensymbolblock > bracket-span,
closesymbolblock > bracket-span,
.middle-vert-symbol > bracket-span {
  display: block;
}
opensymbolblock > vcomposed-symbol,
closesymbolblock > vcomposed-symbol,
.middle-vert-symbol > vcomposed-symbol,
opensymbolblock > bracket-span,
closesymbolblock > bracket-span,
.middle-vert-symbol > bracket-span {
  height: 100%;
  width: 100%;
  font-style: normal;
}
opensymbolblock > brace-span,
closesymbolblock > brace-span,
.middle-vert-symbol > brace-span {
  visibility: hidden;
  display: inline-block;
  padding: 0 0.1em;
}
opensymbolblock,
.middle-vert-symbol {
  margin-left: 0.07em;
}
opensymbolblock.normal,
.middle-vert-symbol.normal {
  margin-left: 0;
}
opensymbolblock[type='vert'],
.middle-vert-symbol[type='vert'],
opensymbolblock.middle-vert-symbol,
.middle-vert-symbol.middle-vert-symbol {
  margin-left: 0.05em;
  margin-right: 0.05em;
}
opensymbolblock[type='vert'] > svg,
.middle-vert-symbol[type='vert'] > svg,
opensymbolblock.middle-vert-symbol > svg,
.middle-vert-symbol.middle-vert-symbol > svg {
  width: 0.4em;
  height: 100%;
}
opensymbolblock[type='parenthesis'] > svg,
.middle-vert-symbol[type='parenthesis'] > svg {
  margin-right: -0.1em;
}
closesymbolblock {
  margin-right: 0.07em;
}
closesymbolblock.normal {
  margin-right: 0;
}
closesymbolblock[type='vert'] {
  margin-left: 0.05em;
  margin-right: 0.05em;
}
closesymbolblock[type='vert'] > svg {
  width: 0.4em;
  height: 100%;
}
closesymbolblock[type='parenthesis'] > svg {
  margin-left: -0.1em;
}

opensymbolblock[type=empty] > empty,
closesymbolblock[type=empty] > empty {
  width: 2px;
  height: 100%;
  display: block;
}
opensymbolblock[type=empty] > empty.normal-size,
closesymbolblock[type=empty] > empty.normal-size {
  height: 1em;
}
opensymbolblock[type=empty] > empty.line-selected,
closesymbolblock[type=empty] > empty.line-selected {
  background-color: lightgray;
}

.dirac-bracket-symbol > div > .oangle,
.dirac-bracket-symbol > div > .cangle {
  align-self: stretch;
  width: 0.55em;
  position: relative;
  margin-top: 0.1em;
  margin-bottom: -0.1em;
}
.dirac-bracket-symbol > div > .oangle > svg,
.dirac-bracket-symbol > div > .cangle > svg {
  position: absolute;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
}
.dirac-bracket-symbol > div > .vert {
  align-self: stretch;
  width: 0.25em;
  position: relative;
  margin-top: 0.1em;
  margin-bottom: -0.1em;
}
.dirac-bracket-symbol > div > .vert > svg {
  position: absolute;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
}
.dirac-bracket-symbol > div > editarea.first {
  min-width: 0.3em;
  padding-right: 0.1em;
}
.dirac-bracket-symbol > div > editarea.last {
  min-width: 0.3em;
  padding-left: 0.1em;
}
.dirac-bracket-symbol > div > editarea.middle {
  min-width: 0.3em;
  padding-left: 0.1em;
  padding-right: 0.1em;
}

cancel-symbol > editarea {
  display: inline-flex;
}
cancel-symbol > svg {
  position: absolute;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  overflow: visible;
}

/**we use alpha as we have problem with background (without alpha) in Electron version (older Chrome) **/
/* z-index region*/
/**different context*/
/**different context*/
math-type compositeblock.frac-slashed-symbol.frac-inline {
  font-size: 0.75em;
}
math-type compositeblock.fraction-symbol {
  margin-left: 0.1em;
  margin-right: 0.1em;
  vertical-align: baseline;
}
math-type compositeblock.fraction-symbol.frac-inline {
  font-size: 0.75em;
}
math-type compositeblock.fraction-symbol > .enumerator {
  float: left;
  width: 100%;
  clear: both;
}
math-type compositeblock.fraction-symbol > .denominator {
  margin-top: -5px;
  float: left;
  width: 100%;
}
math-type compositeblock.fraction-symbol > .frac-line {
  clear: both;
  pointer-events: none;
}
math-type compositeblock.fraction-symbol > .frac-line > inline {
  display: inline-block;
  width: 100%;
  vertical-align: 0.25em;
  border-bottom: solid 1px;
}
math-type compositeblock.fraction-symbol > editarea {
  border: 0px;
  min-width: 0.6em;
  text-align: center;
  text-align-last: auto;
}
math-type compositeblock.fraction-symbol > editarea > area-container > line,
math-type compositeblock.fraction-symbol > editarea > line {
  justify-content: center;
  text-align: center;
  text-align-last: auto;
}
math-type compositeblock.fraction-symbol > editarea-line {
  text-align: center;
  text-align-last: auto;
}

.stackrel-icon {
  margin: auto;
  display: flex;
  align-items: center;
  flex-direction: column;
}
.stackrel-icon .square {
  width: 6px;
  height: 6px;
  border-style: solid;
  border-width: 1px;
  border-color: gray;
}
.stackrel-icon .distance {
  margin-top: 3px;
}

/**we use alpha as we have problem with background (without alpha) in Electron version (older Chrome) **/
/* z-index region*/
/**different context*/
/**different context*/
math-type .stackrel-symbol.selected {
  outline: 1px solid rgba(93, 92, 92, 0.3);
}
math-type .stackrel-symbol > .cur-value {
  clear: both;
  display: inline-flex;
  width: 100%;
}
math-type .stackrel-symbol > .top {
  float: left;
  clear: both;
  width: 100%;
  font-size: 0.7em;
}

/**we use alpha as we have problem with background (without alpha) in Electron version (older Chrome) **/
/* z-index region*/
/**different context*/
/**different context*/
math-type .underset-symbol > .center {
  display: inline-flex;
  width: 100%;
}
math-type .underset-symbol > .bottom {
  float: left;
  display: block;
  width: 100%;
  font-size: 0.7em;
}

/**we use alpha as we have problem with background (without alpha) in Electron version (older Chrome) **/
/* z-index region*/
/**different context*/
/**different context*/
math-type .over-under-set-symbol.selected {
  outline: 1px solid rgba(93, 92, 92, 0.3);
}
math-type .over-under-set-symbol > .top {
  display: flex;
  float: left;
  clear: both;
  width: 100%;
}
math-type .over-under-set-symbol > .top > line {
  font-size: 0.7em;
}
math-type .over-under-set-symbol > .middle {
  display: inline-flex;
  width: 100%;
  clear: both;
}
math-type .over-under-set-symbol > .middle.select {
  border-bottom: none;
}
math-type .over-under-set-symbol > .bottom {
  display: flex;
  float: left;
  width: 100%;
}
math-type .over-under-set-symbol > .bottom > line {
  font-size: 0.7em;
}

expandable-component.thickness item-option.thickness-option {
  width: 40px;
  height: 12px;
}
expandable-component.thickness svg {
  stroke: gray;
  stroke-width: 1px;
  fill: none;
}
expandable-component.thickness thickness {
  position: relative;
  display: flex;
  height: 100%;
}
expandable-component.thickness thickness > svg.thickness {
  width: 25px;
  height: 100%;
  position: static;
}
expandable-component.thickness thickness > svg.thickness line {
  stroke: gray;
  stroke-width: 1px;
}
expandable-component.thickness thickness > svg.thickness path {
  fill: #d2cfcf;
  stroke: none;
}



/**we use alpha as we have problem with background (without alpha) in Electron version (older Chrome) **/
/* z-index region*/
/**different context*/
/**different context*/
math-type .textcircled > div > editarea {
  text-align: center;
  text-align-last: auto;
}
math-type .textcircled > div > editarea > area-container > line,
math-type .textcircled > div > editarea > line {
  justify-content: center;
  text-align: center;
  text-align-last: auto;
}

/**we use alpha as we have problem with background (without alpha) in Electron version (older Chrome) **/
/* z-index region*/
/**different context*/
/**different context*/
.math-container-symbol {
  margin-top: 0.3em;
  margin-bottom: 0.3em;
  display: inline-flex;
}
.math-container-symbol.inline {
  margin-top: 0px;
  margin-bottom: 0px;
}
.math-container-symbol.selected {
  background-color: rgba(76, 175, 80, 0.05);
  outline: 1px solid #c1d4c1;
}
.math-container-symbol.display {
  display: block;
}
.math-container-symbol.display.selected {
  background-color: rgba(76, 175, 80, 0.05);
  outline: none;
}
.math-container-symbol.display > editarea {
  width: 100%;
  flex-grow: 1;
  display: block;
  text-align: center;
  text-align-last: auto;
}
.math-container-symbol.display > editarea > area-container > line,
.math-container-symbol.display > editarea > line {
  justify-content: center;
  text-align: center;
  text-align-last: auto;
}
.math-container-symbol.display > editarea > area-container > line {
  padding-top: 8px;
  padding-bottom: 8px;
}

/**we use alpha as we have problem with background (without alpha) in Electron version (older Chrome) **/
/* z-index region*/
/**different context*/
/**different context*/
.math-container-symbol > editarea.multiline {
  display: block;
  flex-grow: 1;
  text-align: center;
  text-align-last: auto;
}
.math-container-symbol > editarea.multiline > area-container > line,
.math-container-symbol > editarea.multiline > line {
  justify-content: center;
  text-align: center;
  text-align-last: auto;
}
.math-container-symbol > editarea.multiline > line:last-child {
  justify-content: flex-end;
  text-align: right;
}
.math-container-symbol > editarea.multiline > line:first-child {
  justify-content: flex-start;
  text-align: left;
}

/**we use alpha as we have problem with background (without alpha) in Electron version (older Chrome) **/
/* z-index region*/
/**different context*/
/**different context*/
math-type .icon-sqrt,
.auto-complete-external-area .icon-sqrt {
  display: flex;
  margin: auto;
  font-size: 12px;
}
math-type .icon-sqrt .square,
.auto-complete-external-area .icon-sqrt .square {
  margin-top: 3px;
  margin-right: -6px;
}
math-type .icon-sqrt .square-expand,
.auto-complete-external-area .icon-sqrt .square-expand {
  background-color: #f7f7f7;
}
math-type .icon-sqrt .align-end,
.auto-complete-external-area .icon-sqrt .align-end {
  margin-top: 8px;
}
math-type .icon-sqrt .line,
.auto-complete-external-area .icon-sqrt .line {
  width: 10px;
  border-top: solid 1px black;
  margin-top: 6px;
}
math-type .icon-sqrt .big-square,
.auto-complete-external-area .icon-sqrt .big-square {
  margin-top: 11px;
  margin-left: -8px;
}
math-type .sqrt-symbol {
  white-space: nowrap;
  align-items: stretch;
  position: relative;
}
math-type .sqrt-symbol > add {
  opacity: 0.5;
  background-color: #f7f7f7;
  border: 1px solid #c3c2c2;
  color: gray;
  display: block;
  position: absolute;
  font-size: 0.6em;
  cursor: pointer;
  margin-left: -0.4em;
  z-index: 999;
  opacity: 0.7;
  left: 50%;
  top: -0.5em;
  left: 0.5em;
}
math-type .sqrt-symbol > add:hover {
  border-color: gray;
  opacity: 1;
}
math-type .sqrt-symbol > add > i {
  display: block;
  height: 1em;
  padding: 0.1em 0.15em;
  padding-bottom: 0;
  width: 0.8em;
}
math-type .sqrt-symbol text {
  fill: black;
}
math-type .sqrt-symbol > sqrt-edit {
  position: relative;
  order: 3;
  display: inline-block;
  align-self: flex-end;
}
math-type .sqrt-symbol > sqrt-edit > sqrt-symbol-line {
  overflow: visible;
  z-index: 1;
  width: 100%;
  height: 100%;
  display: block;
  position: absolute;
  left: 0;
  top: 0;
  pointer-events: none;
}
math-type .sqrt-symbol > sqrt-edit > sqrt-symbol-line > svg {
  overflow: visible;
  width: 100%;
  height: 1em;
}
math-type .sqrt-symbol > sqrt-edit > area-container > line {
  width: 1em;
  position: relative;
}
math-type .sqrt-symbol > sqrt-edit > editarea,
math-type .sqrt-symbol > sqrt-edit > editarea-line {
  z-index: 2;
  display: inline-block;
  min-width: 0.5em;
  margin-left: 1em;
}
math-type .sqrt-symbol > sqrt-top {
  position: relative;
  z-index: 2;
  vertical-align: bottom;
  padding-bottom: 0.95em;
  align-self: flex-end;
  display: inline-block;
}
math-type .sqrt-symbol > sqrt-top.selected {
  outline: 1px solid rgba(93, 92, 92, 0.3);
}
math-type .sqrt-symbol > sqrt-top > editarea {
  font-size: 0.7em;
  border: none 0px;
  min-width: 0.5em;
  display: flex;
  float: right;
  text-align: center;
  text-align-last: auto;
}
math-type .sqrt-symbol > sqrt-top > editarea > line {
  justify-content: center;
  text-align: center;
  text-align-last: auto;
}





/**we use alpha as we have problem with background (without alpha) in Electron version (older Chrome) **/
/* z-index region*/
/**different context*/
/**different context*/
image-viewer {
  width: 100%;
}
image-viewer.inline {
  width: auto;
}
image-viewer .image-content {
  cursor: pointer;
  text-align: left;
}
image-viewer detail list-items-options div {
  border: 1px solid transparent;
  cursor: pointer;
  margin-left: 3px;
  padding: 0 2px 0 2px;
}
image-viewer detail list-items-options div:hover {
  background-color: white;
  border: 1px solid lightgray;
}
image-viewer detail list-items-options div.selected {
  background-color: white;
  border: 1px solid lightgray;
}
image-viewer image-container {
  display: flex;
  flex-direction: column;
}
image-viewer image-container img {
  position: absolute;
}
image-viewer image-container.center {
  align-items: center;
}
image-viewer image-container.left {
  align-items: flex-start;
}
image-viewer image-container.right {
  align-items: flex-end;
}
.resize-box {
  position: absolute;
  width: 8px;
  height: 8px;
  border-width: 1px;
  border-color: gray;
  border-style: solid;
  background-color: white;
  z-index: 999;
}
.resize-box.mobile-tablet {
  width: 16px;
  height: 16px;
}
.resize-box.hide {
  display: none;
}
topleft {
  top: 0;
  left: 0;
  margin-left: -5px;
  margin-top: -5px;
  cursor: nwse-resize;
}
topleft.mobile-tablet {
  margin-left: -8px;
  margin-top: -8px;
}
topright {
  top: 0;
  right: 0;
  margin-right: -5px;
  margin-top: -5px;
  cursor: nesw-resize;
}
topright.mobile-tablet {
  margin-right: -8px;
  margin-top: -8px;
}
topmiddle {
  top: 0;
  left: 50%;
  margin-left: -5px;
  margin-top: -5px;
  cursor: ns-resize;
}
topmiddle.mobile-tablet {
  margin-left: -8px;
  margin-top: -8px;
}
leftmiddle {
  top: 50%;
  left: 0;
  margin-left: -5px;
  margin-top: -5px;
  cursor: ew-resize;
}
leftmiddle.mobile-tablet {
  margin-left: -8px;
  margin-top: -8px;
}
rightmiddle {
  top: 50%;
  right: 0;
  margin-right: -5px;
  margin-top: -5px;
  cursor: ew-resize;
}
rightmiddle.mobile-tablet {
  margin-right: -8px;
  margin-top: -8px;
}
bottomleft {
  bottom: 0;
  left: 0;
  margin-left: -5px;
  margin-bottom: -5px;
  cursor: nesw-resize;
}
bottomleft.mobile-tablet {
  margin-left: -8px;
  margin-bottom: -8px;
}
bottomright {
  bottom: 0;
  right: 0;
  margin-right: -5px;
  margin-bottom: -5px;
  cursor: nwse-resize;
}
bottomright.mobile-tablet {
  margin-right: -8px;
  margin-bottom: -8px;
}
bottommiddle {
  bottom: 0;
  left: 50%;
  margin-left: -5px;
  margin-bottom: -5px;
  cursor: ns-resize;
}
bottommiddle.mobile-tablet {
  margin-left: -8px;
  margin-bottom: -8px;
}
.ghost-viewer {
  outline: 1px dotted gray;
  width: 100%;
  height: 100%;
  display: block;
}

compositeblock.image-container {
  position: relative;
  width: 100%;
  margin-top: 10px;
  margin-bottom: 10px;
}
compositeblock.image-container > image-viewer {
  display: block;
}
compositeblock.image-container.inline {
  width: auto;
  margin-top: 0;
  margin-bottom: 0;
  display: inline-block;
}
.image-caption > line.text-mode:first-child {
  display: inline;
}
.image-caption > line.text-mode:first-child > blocks {
  display: inline;
}
.add-caption {
  opacity: 0.85;
  text-align: "center";
  color: #1155cc;
  cursor: pointer;
  position: absolute;
  bottom: -35px;
  left: 50%;
  transform: translate(-50%, 0);
  z-index: 10;
  font-size: 13px;
  background: white;
  border: 1px solid lightgray;
  padding: 5px;
}
.add-caption:hover {
  opacity: 1;
}

/**we use alpha as we have problem with background (without alpha) in Electron version (older Chrome) **/
/* z-index region*/
/**different context*/
/**different context*/
math-type .power-index-symbol-container {
  margin-right: 0.06em;
  margin-left: 0.03em;
}
math-type .power-index-symbol-container.has-power > .power-value {
  margin-left: 0.04em;
}
math-type .power-index-symbol-container > .power-value,
math-type .pre-script-symbol-container > .power-value {
  /*margin-bottom: -2px;*/
  float: left;
  clear: both;
  text-align: left;
}
math-type .power-index-symbol-container > .power-value.small > line,
math-type .pre-script-symbol-container > .power-value.small > line {
  margin-bottom: -0.35em;
}
math-type .power-index-symbol-container > .power-value > line,
math-type .pre-script-symbol-container > .power-value > line {
  font-size: 0.7em;
}
math-type .power-index-symbol-container > .power-value > area-container > line,
math-type .pre-script-symbol-container > .power-value > area-container > line,
math-type .power-index-symbol-container > .power-value > line,
math-type .pre-script-symbol-container > .power-value > line {
  justify-content: flex-start;
  text-align: left;
}
math-type .power-index-symbol-container > middle-base,
math-type .pre-script-symbol-container > middle-base {
  display: block;
  clear: both;
  height: 1em;
}
math-type .power-index-symbol-container > middle-base > inline,
math-type .pre-script-symbol-container > middle-base > inline {
  display: inline-block;
}
math-type .power-index-symbol-container > .index-value,
math-type .pre-script-symbol-container > .index-value {
  float: left;
  text-align: left;
}
math-type .power-index-symbol-container > .index-value > line,
math-type .pre-script-symbol-container > .index-value > line {
  font-size: 0.7em;
}
math-type .power-index-symbol-container > .index-value > area-container > line,
math-type .pre-script-symbol-container > .index-value > area-container > line,
math-type .power-index-symbol-container > .index-value > line,
math-type .pre-script-symbol-container > .index-value > line {
  justify-content: flex-start;
  text-align: left;
}
math-type .power-index-symbol-container > editarea-block.index-value,
math-type .pre-script-symbol-container > editarea-block.index-value,
math-type .power-index-symbol-container > editarea-line.index-value,
math-type .pre-script-symbol-container > editarea-line.index-value {
  font-size: 0.7em;
}
math-type .power-index-symbol-container > editarea-block.power-value,
math-type .pre-script-symbol-container > editarea-block.power-value,
math-type .power-index-symbol-container > editarea-line.power-value,
math-type .pre-script-symbol-container > editarea-line.power-value {
  font-size: 0.7em;
}
math-type .pre-script-symbol-container > .power-value {
  float: right;
}
math-type .pre-script-symbol-container > .index-value {
  float: right;
}
.icon-power-index-symbol {
  display: flex;
  margin: auto;
  width: 20px;
  padding-bottom: 6px;
}
.icon-power-index-symbol .square-up {
  margin-top: 4px;
}
.icon-power-index-symbol .square-down {
  margin-top: 14px;
  margin-left: -6px;
}
.icon-power-index-symbol .align-end {
  margin-top: 4px;
}
.icon-power-symbol {
  display: flex;
  margin: auto;
  width: 20px;
  padding-bottom: 6px;
}
.icon-power-symbol .square {
  margin-top: 4px;
}
.icon-power-symbol .align-end {
  margin-top: 4px;
}
.icon-index-symbol {
  display: flex;
  margin: auto;
  width: 20px;
  padding-bottom: 6px;
}
.icon-index-symbol .square {
  margin-top: 14px;
  margin-left: 0px;
}
.icon-index-symbol .align-end {
  margin-top: 4px;
}

/**we use alpha as we have problem with background (without alpha) in Electron version (older Chrome) **/
/* z-index region*/
/**different context*/
/**different context*/
.matrix-symbol.matrix-like > matrix > table > tbody > tr > td {
  padding-bottom: 0.1em;
  padding-top: 0.1em;
}
.matrix-symbol.matrix-like > matrix > table > tbody > tr.hline {
  border-top: 1px solid;
}
.matrix-symbol.matrix-like > matrix > table > tbody > tr:last-child.last-hline {
  border-bottom: 1px solid;
}
.matrix-symbol {
  /* must be flex to have vertical center align , unless figure out another way */
  display: inline-flex;
  align-items: center;
}
.matrix-symbol > matrix > table > tbody > tr > td > .sbd {
  position: absolute;
  left: -1px;
  top: -1px;
  right: -1px;
  bottom: -1px;
  pointer-events: none;
  background: none;
}
.matrix-symbol.selected > matrix > table > tbody > tr > td > .sbd {
  border-top: 1px solid rgba(93, 92, 92, 0.15);
  border-left: 1px solid rgba(93, 92, 92, 0.15);
}
.matrix-symbol.selected > matrix > table > tbody > tr > td > .sbd.sbd-lr {
  border-bottom: 1px solid rgba(93, 92, 92, 0.15);
}
.matrix-symbol.selected > matrix > table > tbody > tr > td > .sbd.sbd-lc {
  border-right: 1px solid rgba(93, 92, 92, 0.15);
}
.matrix-symbol > base-line-indicator {
  height: inherit;
  margin-top: -0.18em;
}
.matrix-symbol matrixclosesymbol,
.matrix-symbol matrixopensymbol {
  font-style: normal;
  color: black;
  position: relative;
}
.matrix-symbol matrixclosesymbol > span,
.matrix-symbol matrixopensymbol > span {
  visibility: hidden;
  display: inline-block;
}
.matrix-symbol matrixclosesymbol > svg,
.matrix-symbol matrixopensymbol > svg {
  overflow: visible;
  font-size: 15px;
  width: 100%;
  height: 100%;
  position: absolute;
  top: 0;
  left: 0;
}
.matrix-symbol matrixclosesymbol > svg text,
.matrix-symbol matrixopensymbol > svg text {
  fill: black;
}
.matrix-symbol > matrix.matrix > table > tbody > tr > td {
  padding: 0 0.3em;
}
.matrix-symbol > matrix {
  display: flex;
  position: relative;
  float: left;
  align-items: flex-start;
  break-inside: avoid;
}
.matrix-symbol > matrix > svg {
  width: 0.6em;
  /*init height, willl be changed by inline style*/
  height: 3px;
  overflow: visible;
  align-self: flex-start;
}
.matrix-symbol > matrix > vcomposed-symbol {
  height: inherit;
  align-self: stretch;
}
.matrix-symbol > matrix > table {
  border: 1px solid transparent;
  border-collapse: collapse;
}
.matrix-symbol > matrix > table > tbody > tr {
  box-sizing: border-box;
}
.matrix-symbol > matrix > table > tbody > tr.smaller {
  font-size: 0.75em;
}
.matrix-symbol > matrix > table > tbody > tr > td {
  position: relative;
  border: 1px dotted transparent;
  box-sizing: border-box;
  padding: 0 0.3em;
  vertical-align: baseline;
}
.matrix-symbol > matrix > table > tbody > tr > td > .editor-cell {
  display: inline-block;
  width: 100%;
}
.matrix-symbol > matrix > table > tbody > tr > td.vline {
  border-left: 1px solid;
}
.matrix-symbol > matrix > table > tbody > tr > td:last-child.last-vline {
  border-right: 1px solid;
}
.matrix-symbol > matrix > table > tbody > tr > td > .editor-cell {
  min-width: 0.5em;
  text-align: center;
  text-align-last: auto;
}
.matrix-symbol > matrix > table > tbody > tr > td > .editor-cell > area-container > line,
.matrix-symbol > matrix > table > tbody > tr > td > .editor-cell > line {
  justify-content: center;
  text-align: center;
  text-align-last: auto;
}
.matrix-symbol > matrix.matrix > table {
  margin-left: -0.2em;
  margin-right: -0.2em;
}
.matrix-symbol > matrix.matrix > table > tbody > tr > td > .editor-cell {
  text-align: center;
  text-align-last: auto;
}
.matrix-symbol > matrix.matrix > table > tbody > tr > td > .editor-cell > area-container > line,
.matrix-symbol > matrix.matrix > table > tbody > tr > td > .editor-cell > line {
  justify-content: center;
  text-align: center;
  text-align-last: auto;
}
.matrix-symbol > matrix.array > table > tbody > tr > td > .editor-cell.left {
  text-align: left;
}
.matrix-symbol > matrix.array > table > tbody > tr > td > .editor-cell.left > area-container > line,
.matrix-symbol > matrix.array > table > tbody > tr > td > .editor-cell.left > line {
  justify-content: flex-start;
  text-align: left;
}
.matrix-symbol > matrix.array > table > tbody > tr > td > .editor-cell.center {
  text-align: center;
  text-align-last: auto;
}
.matrix-symbol > matrix.array > table > tbody > tr > td > .editor-cell.center > area-container > line,
.matrix-symbol > matrix.array > table > tbody > tr > td > .editor-cell.center > line {
  justify-content: center;
  text-align: center;
  text-align-last: auto;
}
.matrix-symbol > matrix.array > table > tbody > tr > td > .editor-cell.right {
  text-align: right;
}
.matrix-symbol > matrix.array > table > tbody > tr > td > .editor-cell.right > area-container > line,
.matrix-symbol > matrix.array > table > tbody > tr > td > .editor-cell.right > line {
  justify-content: flex-end;
  text-align: right;
}
.matrix-symbol > matrix.gathered > table > tbody > tr > td:nth-child(2n+3) {
  padding-left: 1em;
}
.matrix-symbol > matrix.gathered line {
  text-align: center;
  text-align-last: auto;
}
.matrix-symbol > matrix.aligned > table > tbody > tr > td {
  padding: 0;
}
.matrix-symbol > matrix.aligned > table > tbody > tr > td:nth-child(2n+3) {
  padding-left: 1em;
}
.matrix-symbol > matrix.aligned > table > tbody > tr > td:nth-child(2n+1) > .editor-cell {
  text-align: right;
}
.matrix-symbol > matrix.aligned > table > tbody > tr > td:nth-child(2n+1) > .editor-cell > area-container > line,
.matrix-symbol > matrix.aligned > table > tbody > tr > td:nth-child(2n+1) > .editor-cell > line {
  justify-content: flex-end;
  text-align: right;
}
.matrix-symbol > matrix.aligned > table > tbody > tr > td:nth-child(2n) > .editor-cell {
  text-align: left;
}
.matrix-symbol > matrix.aligned > table > tbody > tr > td:nth-child(2n) > .editor-cell > area-container > line,
.matrix-symbol > matrix.aligned > table > tbody > tr > td:nth-child(2n) > .editor-cell > line {
  justify-content: flex-start;
  text-align: left;
}
.matrix-symbol > matrix > border-design {
  position: absolute;
  left: 0;
  top: 0;
  right: 0;
  bottom: 0;
  display: block;
  background-color: rgba(255, 255, 255, 0.7);
  z-index: 10;
}
.matrix-symbol > matrix > border-design > border-line {
  cursor: pointer;
  position: absolute;
  /*border:1px solid gray;*/
}
.matrix-symbol > matrix > border-design > border-line > horizontal-line {
  border-top: 1px solid #eceaea;
  display: block;
  position: absolute;
  top: 50%;
  width: 100%;
  height: 1px;
  margin-top: 0;
  left: 0;
}
.matrix-symbol > matrix > border-design > border-line > vertical-line {
  border-left: 1px solid #eceaea;
  display: block;
  position: absolute;
  left: 50%;
  width: 1px;
  height: 100%;
  top: 0;
}
.matrix-symbol > matrix > border-design > border-line > vertical-line.enabled {
  border-top: 1px solid;
}
.matrix-symbol > matrix > border-design > border-line:hover > horizontal-line {
  border-top: 1px solid gray;
}
.matrix-symbol > matrix > border-design > border-line:hover > vertical-line {
  border-left: 1px solid gray;
}
.matrix-symbol > matrix > border-design > border-line.enabled > horizontal-line {
  border-top: 1px solid;
}
.matrix-symbol > matrix > border-design > border-line.enabled > vertical-line {
  border-left: 1px solid;
}
.matrix-symbol > matrix > setting {
  padding: 7px;
  position: absolute;
  top: -6px;
  font-family: "Segoe UI", Arial, Verdana, sans-serif;
  transform: translate(0, -100%);
  left: 0;
}
.matrix-symbol > matrix > setting > main-setting {
  display: flex;
  flex-direction: row;
}
.matrix-symbol > matrix > setting > main-setting styled-select {
  display: block;
  background-color: white;
}
.fa-table.array-settings {
  border: 1px solid lightgray;
  padding: 3px 5px;
  font-size: 14px;
  color: gray;
  cursor: pointer;
  /*margin-left: 5px;*/
}
.fa-table.array-settings:hover {
  color: black;
  background: white;
}
.matrix-icon {
  display: flex;
}
.matrix-icon .square {
  margin-top: 2px;
}
.matrix-icon .display-flex {
  display: flex;
}

/**we use alpha as we have problem with background (without alpha) in Electron version (older Chrome) **/
/* z-index region*/
/**different context*/
/**different context*/
.matrix-symbol.case-symbol > matrix > table > tbody > tr > td,
.matrix-symbol.square-case-symbol > matrix > table > tbody > tr > td {
  padding: 0 0.2em;
}
.matrix-symbol.case-symbol > matrix > table > tbody > tr > td.non-select,
.matrix-symbol.square-case-symbol > matrix > table > tbody > tr > td.non-select {
  user-select: none;
  width: 0.2em;
  padding: 0;
}
.matrix-symbol.case-symbol > matrix > table > tbody > tr > td > .editor-cell,
.matrix-symbol.square-case-symbol > matrix > table > tbody > tr > td > .editor-cell {
  text-align: left;
}
.matrix-symbol.case-symbol > matrix > table > tbody > tr > td > .editor-cell > area-container > line,
.matrix-symbol.square-case-symbol > matrix > table > tbody > tr > td > .editor-cell > area-container > line,
.matrix-symbol.case-symbol > matrix > table > tbody > tr > td > .editor-cell > line,
.matrix-symbol.square-case-symbol > matrix > table > tbody > tr > td > .editor-cell > line {
  justify-content: flex-start;
  text-align: left;
}
.case-icon {
  display: flex;
  font-size: 18px;
  line-height: 18px;
}
.case-icon .square {
  margin-top: 2px;
}
.case-icon .display-flex {
  display: flex;
}

/**we use alpha as we have problem with background (without alpha) in Electron version (older Chrome) **/
/* z-index region*/
/**different context*/
/**different context*/
.matrix-symbol.dr-case-symbol > matrix > table > tbody > tr > td {
  padding: 0 0.2em;
}
.matrix-symbol.dr-case-symbol > matrix > table > tbody > tr > td.selected {
  border: 1px solid #e0e0e0;
}
.matrix-symbol.dr-case-symbol > matrix > table > tbody > tr > td > .editor-cell {
  text-align: left;
}
.matrix-symbol.dr-case-symbol > matrix > table > tbody > tr > td > .editor-cell > area-container > line,
.matrix-symbol.dr-case-symbol > matrix > table > tbody > tr > td > .editor-cell > line {
  justify-content: flex-start;
  text-align: left;
}
.case-icon {
  display: flex;
  font-size: 18px;
  line-height: 18px;
}
.case-icon .square {
  margin-top: 2px;
}
.case-icon .display-flex {
  display: flex;
}

.array-icon .square {
  margin-top: 2px;
}
.array-icon .display-flex {
  display: flex;
}

.matrix-like.binom > .binom > table > tbody > tr > td {
  padding: 0;
}
.matrix-like.binom > .binom > table > tbody > tr > td line {
  text-align: center;
  text-align-last: auto;
}

/**we use alpha as we have problem with background (without alpha) in Electron version (older Chrome) **/
/* z-index region*/
/**different context*/
/**different context*/
.matrix-symbol.align-symbol {
  /*display flex because to make sure it's spend whole line*/
  display: flex;
  justify-content: center;
  margin-top: 10px;
  margin-bottom: 10px;
  width: 100%;
}
.matrix-symbol.align-symbol.selected {
  background-color: rgba(76, 175, 80, 0.05);
}
.matrix-symbol.align-symbol > matrix > setting > main-setting {
  margin-bottom: 0px;
}
.matrix-symbol.align-symbol > matrix > bulb {
  left: 50%;
}
.matrix-symbol.align-symbol > matrix > setting {
  margin-left: 20px;
}
.matrix-symbol.align-symbol > matrix.align {
  width: 100%;
  display: block;
}
.matrix-symbol.align-symbol > matrix > table > tbody > tr > td {
  padding: 0;
  vertical-align: baseline;
  border: 1px solid transparent;
}
.matrix-symbol.align-symbol > matrix > table > tbody > tr > td > .editor-cell {
  /* should align start and area-container level (instead of line level)
                as for lazy rendering, we need to have exact line width */
}
.matrix-symbol.align-symbol > matrix > table > tbody > tr > td > .editor-cell > area-container {
  align-items: flex-start;
}
.matrix-symbol.align-symbol > matrix > table > tbody > tr > td > .editor-cell > area-container > line {
  width: auto;
  text-align: left;
}
.matrix-symbol.align-symbol > matrix > table > tbody > tr > td.align-right > .editor-cell {
  /* should align start and area-container level (instead of line level)
                as for lazy rendering, we need to have exact line width */
}
.matrix-symbol.align-symbol > matrix > table > tbody > tr > td.align-right > .editor-cell > area-container {
  align-items: flex-end;
}
.matrix-symbol.align-symbol > matrix > table > tbody > tr > td.align-right > .editor-cell > area-container > line {
  width: auto;
  text-align: right;
}
.matrix-symbol.align-symbol > matrix > table > tbody > tr > td.non-select {
  border: none;
  user-select: none;
}
.matrix-symbol.align-symbol > matrix > table > tbody > tr > td.expand {
  width: 100%;
}
.matrix-symbol.align-symbol > matrix > table > tbody > tr > td.selected {
  border: 1px solid #e0e0e0;
}
.matrix-symbol.align-symbol > matrix > table > tbody > tr > td > .editor-cell {
  min-width: 1.5em;
}
.matrix-symbol.align-symbol > matrix > table > tbody > tr > td > tupple {
  width: 100%;
  display: flex;
  justify-content: center;
  align-items: baseline;
}

/**we use alpha as we have problem with background (without alpha) in Electron version (older Chrome) **/
/* z-index region*/
/**different context*/
/**different context*/
.matrix-symbol.gather-symbol {
  /*display flex because to make sure it's spend whole line*/
  display: flex;
  justify-content: center;
  margin-top: 10px;
  margin-bottom: 10px;
  width: 100%;
}
.matrix-symbol.gather-symbol.selected {
  background-color: rgba(76, 175, 80, 0.05);
}
.matrix-symbol.gather-symbol > matrix.gather {
  width: 100%;
  display: block;
}
.matrix-symbol.gather-symbol > matrix > setting > main-setting {
  margin-bottom: 0px;
}
.matrix-symbol.gather-symbol > matrix > bulb {
  left: -1em;
}
.matrix-symbol.gather-symbol > matrix > setting {
  margin-left: 20px;
}
.matrix-symbol.gather-symbol > matrix > table > tbody > tr > td {
  padding: 0;
  vertical-align: baseline;
  border: 1px solid transparent;
  text-align: center;
  text-align-last: auto;
}
.matrix-symbol.gather-symbol > matrix > table > tbody > tr > td.non-select {
  user-select: none;
  width: 1.5em;
  border: none;
}
.matrix-symbol.gather-symbol > matrix > table > tbody > tr > td.expand {
  width: 100%;
}
.matrix-symbol.gather-symbol > matrix > table > tbody > tr > td.selected {
  border: 1px solid #e0e0e0;
}
.matrix-symbol.gather-symbol > matrix > table > tbody > tr > td line {
  text-align: center;
  text-align-last: auto;
}
.matrix-symbol.gather-symbol > matrix > table > tbody > tr > td > .editor-cell {
  min-width: 1.5em;
  /* should align start and area-container level (instead of line level)
                as for lazy rendering, we need to have exact line width */
}
.matrix-symbol.gather-symbol > matrix > table > tbody > tr > td > .editor-cell > area-container {
  align-items: center;
}
.matrix-symbol.gather-symbol > matrix > table > tbody > tr > td > .editor-cell > area-container > line {
  width: auto;
}
.matrix-symbol.gather-symbol > matrix > table > tbody > tr > td > tupple {
  width: 100%;
  display: flex;
  justify-content: center;
  align-items: baseline;
}

math-type compositeblock.table-symbol {
  width: 100%;
  display: flex;
}
math-type compositeblock.table-symbol.cap-above {
  flex-direction: column;
}
math-type .matrix-symbol > matrix.table {
  width: 100%;
  flex-direction: column;
  align-items: stretch;
}
math-type .matrix-symbol > matrix.table > table {
  table-layout: fixed;
  border: unset;
  width: 100%;
}
math-type .matrix-symbol > matrix.table > table > tbody > tr > td {
  vertical-align: top;
  padding: 0;
  position: relative;
}
math-type .cell-border-box {
  position: absolute;
  left: -1px;
  top: -1px;
  width: 100%;
  height: 100%;
}
.table-caption > line.text-mode:first-child {
  display: inline;
}
.table-caption > line.text-mode:first-child > blocks {
  display: inline;
}

editarea.lttb.text-mode > line.text-mode > blocks {
  text-align: inherit;
}



math-type compositeblock.table-of-content {
  display: block;
  width: 100%;
}
math-type compositeblock.table-of-content > toc-wrapper {
  position: relative;
  width: 100%;
  display: block;
  cursor: default;
}
math-type compositeblock.table-of-content > toc-wrapper .toc-setting-icons {
  display: none;
  position: absolute;
  left: -65px;
  width: 70px;
  top: -20px;
  bottom: 0;
  font-size: 1em;
  z-index: 999;
  padding-top: 20px;
}
math-type compositeblock.table-of-content > toc-wrapper .toc-setting-icons > .icon-refresh,
math-type compositeblock.table-of-content > toc-wrapper .toc-setting-icons > .icon-settings {
  border: 1px solid #c3c2c2;
  padding: 0.3em;
  padding-top: 0.1em;
  line-height: 1.2;
  padding-bottom: 0;
  cursor: pointer;
  background-color: #f7f7f7;
  color: gray;
  width: 12px;
  display: inline-block;
  margin-left: 5px;
}
math-type compositeblock.table-of-content > toc-wrapper:hover .toc-setting-icons {
  display: block;
}
math-type compositeblock.table-of-content > toc-wrapper > editarea.toc-ea.text-mode {
  width: 100%;
  cursor: default;
  display: block;
}
math-type compositeblock.table-of-content > toc-wrapper > editarea.toc-ea.text-mode > line.text-mode {
  display: block;
  width: auto;
  cursor: default;
  padding-left: 1em;
  padding-right: 15px;
  font-style: unset;
}
math-type compositeblock.table-of-content > toc-wrapper > editarea.toc-ea.text-mode > line.text-mode > a > blocks,
math-type compositeblock.table-of-content > toc-wrapper > editarea.toc-ea.text-mode > line.text-mode > blocks {
  display: block;
}
math-type compositeblock.table-of-content > toc-wrapper > editarea.toc-ea.text-mode > line.text-mode > a > prefix,
math-type compositeblock.table-of-content > toc-wrapper > editarea.toc-ea.text-mode > line.text-mode > prefix {
  display: none;
}
math-type compositeblock.table-of-content > toc-wrapper > editarea.toc-ea.text-mode > line.text-mode.has-rtl {
  padding-left: 15px;
  padding-right: 1em;
}
math-type compositeblock.table-of-content > toc-wrapper > editarea.toc-ea.text-mode > line.text-mode.has-rtl > a > blocks,
math-type compositeblock.table-of-content > toc-wrapper > editarea.toc-ea.text-mode > line.text-mode.has-rtl > blocks {
  text-align: right;
}
math-type compositeblock.table-of-content > toc-wrapper > editarea.toc-ea.text-mode > line.text-mode.has-rtl a > blocks > compositeblock.toc-page-number-symbol,
math-type compositeblock.table-of-content > toc-wrapper > editarea.toc-ea.text-mode > line.text-mode.has-rtl > blocks > compositeblock.toc-page-number-symbol {
  float: left;
  padding-left: 0;
  margin-right: 0;
  margin-left: 0;
  padding-right: 0.5em;
}
math-type compositeblock.table-of-content > toc-wrapper > editarea.toc-ea.text-mode > line.text-mode > block,
math-type compositeblock.table-of-content > toc-wrapper > editarea.toc-ea.text-mode > line.text-mode > a > block,
math-type compositeblock.table-of-content > toc-wrapper > editarea.toc-ea.text-mode > line.text-mode > blocks > block,
math-type compositeblock.table-of-content > toc-wrapper > editarea.toc-ea.text-mode > line.text-mode a > blocks > block {
  white-space: pre-wrap;
  white-space: break-spaces;
  cursor: pointer;
  font-style: unset;
}
math-type compositeblock.table-of-content > toc-wrapper > editarea.toc-ea.text-mode > line.text-mode > a > blocks > compositeblock.toc-page-number-symbol,
math-type compositeblock.table-of-content > toc-wrapper > editarea.toc-ea.text-mode > line.text-mode > blocks > compositeblock.toc-page-number-symbol {
  float: right;
  padding-left: 0.5em;
  margin-right: 0;
}

.icon-integral-symbol {
  margin: auto 4px auto auto;
  display: flex;
  flex-direction: row-reverse;
  font-size: 12px;
}
.icon-integral-symbol .square-up {
  border-width: 1px;
  margin-top: 0px;
}
.icon-integral-symbol .square-down {
  border-width: 1px;
  margin-top: 21px;
  margin-left: -10px;
}
.icon-integral-symbol .align-end {
  margin-top: 6px;
}

/**we use alpha as we have problem with background (without alpha) in Electron version (older Chrome) **/
/* z-index region*/
/**different context*/
/**different context*/
math-type .limit-type {
  position: relative;
}
math-type .limit-type > add {
  opacity: 0.5;
  background-color: #f7f7f7;
  border: 1px solid #c3c2c2;
  color: gray;
  display: block;
  position: absolute;
  font-size: 0.6em;
  cursor: pointer;
  margin-left: -0.4em;
  z-index: 999;
  opacity: 0.7;
  top: -0.5em;
  left: 50%;
  top: -1.4em;
  left: 0.6em;
  align-items: flex-start;
}
math-type .limit-type > add:hover {
  border-color: gray;
  opacity: 1;
}
math-type .limit-type > add > i {
  display: block;
  height: 1em;
  padding: 0.1em 0.15em;
  padding-bottom: 0;
  width: 0.8em;
}
math-type .limit-type > .to,
math-type .limit-type > .from {
  float: left;
  clear: both;
}
math-type .limit-type > .to > line,
math-type .limit-type > .from > line,
math-type .limit-type > .to > editarea > line,
math-type .limit-type > .from > editarea > line {
  font-size: 0.7em;
}
math-type .limit-type > editarea-line,
math-type .limit-type > editarea-block {
  font-size: 0.7em;
}
math-type .limit-type > symbol {
  display: block;
  clear: both;
  pointer-events: none;
}
math-type .limit-type > symbol > span {
  white-space: nowrap;
  pointer-events: none;
}
math-type .limit-type > setting {
  background-color: #f7f7f7;
  border: 1px solid #c3c2c2;
  color: gray;
  opacity: 0.5;
  opacity: 1;
  position: absolute;
  left: 50%;
  top: -2em;
  font-size: 0.6em;
  margin-left: -0.6em;
  padding: 0 0.2em;
  cursor: pointer;
}
math-type .limit-type > setting:hover {
  border-color: gray;
  opacity: 1;
}
math-type .limit-type > setting:hover {
  border: 1px solid gray;
}
math-type .limit-type > setting > i {
  transform: rotate(-60deg);
}
math-type .limit-type.limit-kind > setting > i {
  transform: rotate(45deg);
}
math-type .limit-type.limit-kind > symbol {
  text-align: center;
  text-align-last: auto;
}
math-type .limit-type.limit-kind > .from,
math-type .limit-type.limit-kind > .to {
  width: 100%;
  text-align: center;
  text-align-last: auto;
}
math-type .limit-type.limit-kind > .from > line,
math-type .limit-type.limit-kind > .to > line {
  justify-content: center;
  text-align: center;
  text-align-last: auto;
}
math-type .limit-type.limit-kind > empty.from {
  height: 0;
  margin-top: -0.75em;
}
math-type .limit-type.limit-kind > empty.from > editarea.selected > line,
math-type .limit-type.limit-kind > empty.from > editarea-block.selected,
math-type .limit-type.limit-kind > empty.from > editarea-line.selected {
  background-color: white;
  text-align: center;
  text-align-last: auto;
}
math-type .limit-type.limit-kind > empty.to {
  height: 0;
  text-align: center;
  text-align-last: auto;
}
math-type .limit-type.limit-kind > empty.to > editarea.selected > line,
math-type .limit-type.limit-kind > empty.to > editarea-block.selected,
math-type .limit-type.limit-kind > empty.to > editarea-line.selected {
  background-color: white;
  text-align: center;
  text-align-last: auto;
}
math-type .integral-like-symbol.inline > symbol {
  font-size: 1em;
}
math-type .integral-like-symbol.int-ml {
  margin-left: -0.5em;
}
math-type .integral-like-symbol.oint-ml {
  margin-left: -0.3em;
}
math-type .integral-like-symbol > symbol {
  font-size: 1.5em;
}
math-type .integral-like-symbol > symbol > span {
  line-height: 1.4em;
}

/**we use alpha as we have problem with background (without alpha) in Electron version (older Chrome) **/
/* z-index region*/
/**different context*/
/**different context*/
math-type .limit-type.lim-like-symbol {
  margin-left: 0.2em;
  margin-right: 0.2em;
}
math-type .limit-type.lim-like-symbol.close-left {
  margin-left: 0;
}
math-type .limit-type.lim-like-symbol.close-right {
  margin-right: 0;
}
math-type .limit-type.lim-like-symbol.limit-kind > empty.from > editarea {
  margin-top: -0.4em;
}
math-type .lim-like-symbol > add {
  left: 50%;
  top: -1em;
}
math-type .lim-like-symbol > symbol.inf {
  text-decoration: underline;
}
math-type .lim-like-symbol > symbol.sup {
  text-decoration: overline;
}
math-type .lim-like-symbol.non-limit-kind > editarea.from,
math-type .lim-like-symbol.non-limit-kind > editarea.to {
  margin-left: 1.47em;
}
math-type .lim-like-symbol.non-limit-kind > editarea.from.from-lim,
math-type .lim-like-symbol.non-limit-kind > editarea.to.to-lim {
  margin-left: 1.5435em;
}
math-type .lim-like-symbol.non-limit-kind > editarea.from.from-liminf,
math-type .lim-like-symbol.non-limit-kind > editarea.to.to-liminf {
  margin-left: 3.15em;
}
math-type .lim-like-symbol.non-limit-kind > editarea.from.from-limsup,
math-type .lim-like-symbol.non-limit-kind > editarea.to.to-limsup {
  margin-left: 3.528em;
}
math-type .lim-like-symbol.non-limit-kind > editarea.from.from-sup,
math-type .lim-like-symbol.non-limit-kind > editarea.to.to-sup {
  margin-left: 1.6905em;
}
math-type .lim-like-symbol.non-limit-kind > editarea.from.from-varlimsup,
math-type .lim-like-symbol.non-limit-kind > editarea.to.to-varlimsup {
  margin-left: 1.5435em;
}
math-type .lim-like-symbol.non-limit-kind > editarea-block.from,
math-type .lim-like-symbol.non-limit-kind > editarea-block.to {
  margin-left: 2.072em;
}
math-type .lim-like-symbol.non-limit-kind > editarea-block.from.from-lim,
math-type .lim-like-symbol.non-limit-kind > editarea-block.to.to-lim {
  margin-left: 2.1756em;
}
math-type .lim-like-symbol.non-limit-kind > editarea-block.from.from-liminf,
math-type .lim-like-symbol.non-limit-kind > editarea-block.to.to-liminf {
  margin-left: 4.44em;
}
math-type .lim-like-symbol.non-limit-kind > editarea-block.from.from-limsup,
math-type .lim-like-symbol.non-limit-kind > editarea-block.to.to-limsup {
  margin-left: 4.9728em;
}
math-type .lim-like-symbol.non-limit-kind > editarea-block.from.from-sup,
math-type .lim-like-symbol.non-limit-kind > editarea-block.to.to-sup {
  margin-left: 2.3828em;
}
math-type .lim-like-symbol.non-limit-kind > editarea-block.from.from-varlimsup,
math-type .lim-like-symbol.non-limit-kind > editarea-block.to.to-varlimsup {
  margin-left: 2.1756em;
}



/**we use alpha as we have problem with background (without alpha) in Electron version (older Chrome) **/
/* z-index region*/
/**different context*/
/**different context*/
math-type .limit-type.summation-like-symbol.limit-kind > empty.from {
  margin-top: -0.3em;
}
math-type .limit-type.summation-like-symbol.limit-kind > empty.from > editarea,
math-type .limit-type.summation-like-symbol.limit-kind > empty.from > editarea-block {
  margin-top: -0.2em;
}
math-type .summation-like-symbol.inline > add {
  top: -1.1em;
}
math-type .summation-like-symbol.inline > symbol {
  font-size: 1em;
}
math-type .summation-like-symbol.inline > symbol > span {
  vertical-align: 0.15em;
}
math-type .summation-like-symbol {
  padding-right: 0.15em;
}
math-type .summation-like-symbol > symbol {
  font-size: 1.5em;
}
math-type .summation-like-symbol > symbol > span {
  vertical-align: 0.1em;
  line-height: 1.4em;
}
math-type .summation-like-symbol > add {
  top: -1.5em;
}
math-type .summation-like-symbol > .custom-symbol {
  font-weight: bold;
}

hcomposed-symbol {
  display: flex;
  width: 100%;
  height: 100%;
  overflow: hidden;
}
hcomposed-symbol > start {
  display: block;
  float: left;
  overflow: hidden;
}
hcomposed-symbol > middle {
  display: block;
  flex-grow: 1;
  white-space: nowrap;
  position: relative;
  overflow: hidden;
}
hcomposed-symbol > middle > fixed {
  display: block;
  position: absolute;
  left: 0;
  top: 0;
}
hcomposed-symbol > middle > fixed > inside {
  display: inline-block;
  overflow: hidden;
}
hcomposed-symbol > end {
  display: block;
  overflow: hidden;
}

/**we use alpha as we have problem with background (without alpha) in Electron version (older Chrome) **/
/* z-index region*/
/**different context*/
/**different context*/
math-type .arrow-like-symbol {
  padding: 0 0.2em;
}
math-type .arrow-like-symbol > arrow-like-simple > add {
  opacity: 0.5;
  background-color: #f7f7f7;
  border: 1px solid #c3c2c2;
  color: gray;
  display: block;
  position: absolute;
  font-size: 0.6em;
  cursor: pointer;
  margin-left: -0.4em;
  z-index: 999;
  opacity: 0.7;
  top: -0.5em;
  left: 50%;
  left: 0.8em;
  top: -0.7em;
}
math-type .arrow-like-symbol > arrow-like-simple > add:hover {
  border-color: gray;
  opacity: 1;
}
math-type .arrow-like-symbol > arrow-like-simple > add > i {
  display: block;
  height: 1em;
  padding: 0.1em 0.15em;
  padding-bottom: 0;
  width: 0.8em;
}
math-type .arrow-like-symbol > middle {
  display: block;
  text-align: center;
  text-align-last: auto;
  clear: both;
  width: 100%;
  position: relative;
}
math-type .arrow-like-symbol > middle > inside {
  display: inline-block;
  height: 0.55em;
  width: 100%;
}
math-type .arrow-like-symbol > middle > inside > hcomposed-symbol {
  position: absolute;
  top: 0.4em;
  left: 0;
}
math-type .arrow-like-symbol > editarea.sright-1 {
  padding-left: 0.55em;
  padding-right: 0.25em;
}
math-type .arrow-like-symbol > editarea.sleft-1 {
  padding-left: 0.25em;
  padding-right: 0.55em;
}
math-type .arrow-like-symbol > editarea.small-margin {
  padding-left: 0.4em;
  padding-right: 0.4em;
}
math-type .arrow-like-symbol > editarea.large-padding {
  margin: 0 1.3em;
}
math-type .arrow-like-symbol > editarea > line {
  font-size: 0.7em;
}
math-type .arrow-like-symbol > .top {
  float: left;
  width: 100%;
  clear: both;
  margin-bottom: -0.5em;
  z-index: 1;
  position: relative;
}
math-type .arrow-like-symbol > .top.space-1,
math-type .arrow-like-symbol > .top.up-space-1-lower-space-2 {
  margin-bottom: -0.4em;
}
math-type .arrow-like-symbol > .bottom {
  margin-top: -0.45em;
  float: left;
  width: 100%;
}
math-type .arrow-like-symbol > .bottom.space-1,
math-type .arrow-like-symbol > .bottom.lower-space-1 {
  margin-top: -0.35em;
}
math-type .arrow-like-symbol > .bottom.space-2,
math-type .arrow-like-symbol > .bottom.up-space-1-lower-space-2 {
  margin-top: -0.25em;
}

.over-icon {
  margin: auto;
  width: 12px;
  font-size: 13px;
}

/**we use alpha as we have problem with background (without alpha) in Electron version (older Chrome) **/
/* z-index region*/
/**different context*/
/**different context*/
math-type .over-arrow-symbol > arrow-symbol {
  display: block;
  margin-right: -0.05em;
  position: relative;
}
math-type .over-arrow-symbol > arrow-symbol > hcomposed-symbol {
  position: absolute;
}
math-type .over-arrow-symbol > arrow-symbol > arrow-wrapper {
  margin-right: -0.2em;
}
math-type .over-arrow-symbol > editarea {
  display: inline-flex;
  text-align: center;
  text-align-last: auto;
}
math-type .over-arrow-symbol > editarea > area-container > line,
math-type .over-arrow-symbol > editarea > line {
  justify-content: center;
  text-align: center;
  text-align-last: auto;
}
math-type .over-arrow-symbol > editarea-block {
  min-width: 0.5em;
  text-align: center;
  text-align-last: auto;
  display: inline-block;
}

/**we use alpha as we have problem with background (without alpha) in Electron version (older Chrome) **/
/* z-index region*/
/**different context*/
/**different context*/
math-type .over-line-symbol {
  margin-left: 0.05em;
  margin-right: 0.05em;
}
math-type .over-line-symbol > editarea {
  display: inline-flex;
  min-width: 0.5em;
}
math-type .over-line-symbol > editarea-line {
  min-width: 0.5em;
  display: inline-block;
  text-align: center;
  text-align-last: auto;
}
math-type .over-line-symbol > line-border {
  display: block;
  position: relative;
}
math-type .over-line-symbol > line-border > hcomposed-symbol {
  position: absolute;
}
math-type .over-line-symbol > line-border > svg {
  position: absolute;
  width: 100%;
  height: 100%;
}

brace-top-wrapper {
  display: flex;
  flex-direction: row;
  height: 100%;
  font-family: Asana-Math, Asana;
}
brace-top-wrapper > middle-wrapper {
  flex-grow: 1;
  position: relative;
  overflow: hidden;
}
brace-top-wrapper > middle-wrapper > fixed {
  display: block;
  position: absolute;
  left: 0;
  top: 0;
}
brace-top-wrapper > middle-wrapper > fixed > middle-inside {
  overflow: hidden;
}
brace-top-wrapper first,
brace-top-wrapper middle,
brace-top-wrapper last {
  overflow: hidden;
  position: relative;
}
brace-top-wrapper first {
  min-width: 0.7em;
  width: 0.7em;
}
brace-top-wrapper > middle {
  min-width: 0.6em;
  width: 0.6em;
}
brace-top-wrapper > last {
  min-width: 0.7em;
  width: 0.7em;
}
bracket-top-wrapper {
  display: flex;
  flex-direction: column;
  width: 100%;
  font-family: Asana-Math, Asana;
}
bracket-top-wrapper > first,
bracket-top-wrapper middle,
bracket-top-wrapper last {
  overflow: hidden;
  position: relative;
}
bracket-top-wrapper > first {
  height: 0.5em;
  min-height: 0.5em;
}
bracket-top-wrapper middle-wrapper {
  flex-grow: 1;
  position: relative;
  overflow: hidden;
}
bracket-top-wrapper middle-wrapper > fixed {
  overflow: hidden;
  position: absolute;
  left: 0;
  top: 0;
}
bracket-top-wrapper middle-wrapper > fixed > middle {
  display: block;
  overflow: hidden;
}
bracket-top-wrapper > last {
  height: 0.65em;
  min-height: 0.65em;
}
parenthesis-top-wrapper {
  display: flex;
  flex-direction: column;
  width: 100%;
  font-family: Asana-Math, Asana;
}
parenthesis-top-wrapper > first,
parenthesis-top-wrapper middle,
parenthesis-top-wrapper last {
  overflow: hidden;
  position: relative;
  height: 1em;
  min-height: 1em;
}
parenthesis-top-wrapper > first {
  min-height: 0.9em;
  height: 0.9em;
}
parenthesis-top-wrapper middle-wrapper {
  flex-grow: 1;
  position: relative;
  overflow: hidden;
}
parenthesis-top-wrapper middle-wrapper > fixed {
  position: absolute;
  top: 0;
  left: 0;
}
parenthesis-top-wrapper middle-wrapper > fixed > middle {
  display: block;
  overflow: hidden;
}
parenthesis-top-wrapper > last {
  min-height: 1em;
  height: 1em;
}

/**we use alpha as we have problem with background (without alpha) in Electron version (older Chrome) **/
/* z-index region*/
/**different context*/
/**different context*/
math-type .over-brace-symbol {
  position: relative;
}
math-type .over-brace-symbol > add {
  opacity: 0.5;
  background-color: #f7f7f7;
  border: 1px solid #c3c2c2;
  color: gray;
  display: block;
  position: absolute;
  font-size: 0.6em;
  cursor: pointer;
  margin-left: -0.4em;
  z-index: 999;
  opacity: 0.7;
  top: -0.5em;
  left: 50%;
  top: -1.5em;
  margin-left: -0.6em;
}
math-type .over-brace-symbol > add:hover {
  border-color: gray;
  opacity: 1;
}
math-type .over-brace-symbol > add > i {
  display: block;
  height: 1em;
  padding: 0.1em 0.15em;
  padding-bottom: 0;
  width: 0.8em;
}
math-type .over-brace-symbol > top-brace {
  pointer-events: none;
  display: block;
  min-width: 1.1em;
  position: relative;
  clear: both;
  margin-bottom: -0.1em;
  font-style: normal;
  font-weight: normal;
}
math-type .over-brace-symbol > top-brace > brace-top-wrapper {
  position: absolute;
  top: 0;
  left: 0;
  left: 50%;
  transform: translate(-50%, 0);
}
math-type .over-brace-symbol > editarea {
  display: inline-flex;
  width: 100%;
  align-self: center;
  clear: both;
}
math-type .over-brace-symbol > editarea.overValue {
  font-size: 0.7em;
  float: left;
  width: 100%;
  margin-bottom: 0.1em;
}

.icon-hat {
  margin: auto;
  width: 12px;
  font-size: 12px;
}
.icon-hat .square {
  margin-top: -3px;
}

.under-arc-symbol {
  display: inline-block;
}
.under-arc-symbol > editarea {
  display: inline-flex;
}
.under-arc-symbol > symbol {
  display: block;
  width: 100%;
  position: relative;
}
.under-arc-symbol > symbol > svg {
  position: absolute;
  left: 0;
  top: 0;
  display: block;
  width: 100%;
  height: 100%;
}

/**we use alpha as we have problem with background (without alpha) in Electron version (older Chrome) **/
/* z-index region*/
/**different context*/
/**different context*/
math-type .under-line-symbol > editarea {
  display: inline-flex;
}
math-type .under-line-symbol > line-border {
  display: block;
  position: relative;
  float: left;
  width: 100%;
}
math-type .under-line-symbol > line-border > svg {
  position: absolute;
  width: 100%;
  height: 100%;
}

/**we use alpha as we have problem with background (without alpha) in Electron version (older Chrome) **/
/* z-index region*/
/**different context*/
/**different context*/
math-type compositeblock.under-brace-symbol {
  display: inline-flex;
  flex-flow: column;
  position: relative;
}
math-type compositeblock.under-brace-symbol > add {
  opacity: 0.5;
  background-color: #f7f7f7;
  border: 1px solid #c3c2c2;
  color: gray;
  display: block;
  position: absolute;
  font-size: 0.6em;
  cursor: pointer;
  margin-left: -0.4em;
  z-index: 999;
  opacity: 0.7;
  top: -0.5em;
  left: 50%;
  top: 3em;
}
math-type compositeblock.under-brace-symbol > add:hover {
  border-color: gray;
  opacity: 1;
}
math-type compositeblock.under-brace-symbol > add > i {
  display: block;
  height: 1em;
  padding: 0.1em 0.15em;
  padding-bottom: 0;
  width: 0.8em;
}
math-type compositeblock.under-brace-symbol > bottom-brace {
  pointer-events: none;
  display: block;
  position: relative;
  min-width: 1.3em;
  font-style: normal;
  font-weight: normal;
}
math-type compositeblock.under-brace-symbol > bottom-brace > brace-top-wrapper {
  position: absolute;
  top: 0;
  left: 0;
  left: 50%;
  transform: translate(-50%, 0);
}
math-type compositeblock.under-brace-symbol > editarea {
  margin-left: 0.15em;
  margin-right: 0.15em;
  align-self: center;
}
math-type compositeblock.under-brace-symbol > editarea.underValue {
  font-size: 0.7em;
}
.under-brace-icon {
  width: 12px;
  margin: auto;
  font-size: 12px;
}
.under-brace-icon .brace-wrapper {
  margin-top: -14px;
}


math-type .operator-name > editarea {
  margin-left: 0.2em;
  margin-right: 0.2em;
  display: inline-flex;
}
math-type .operator-name > editarea.close-left {
  margin-left: 0;
}
math-type .operator-name > editarea.close-right {
  margin-right: 0;
}

.math-group > editarea {
  float: left;
}
.group-icon .rectangle {
  width: 23px;
  height: 12px;
  border-style: solid;
  border-width: 1px;
  text-align: center;
  border-color: gray;
  font-family: fantasy;
  color: black;
  padding-top: 1px;
  font-size: 9px;
  line-height: 14px;
  vertical-align: middle;
  margin: auto;
}

/**we use alpha as we have problem with background (without alpha) in Electron version (older Chrome) **/
/* z-index region*/
/**different context*/
/**different context*/
math-type compositeblock.over-symbol {
  position: relative;
}
math-type compositeblock.over-symbol > symbol {
  font-family: Asana-Math, Asana, Arial;
  height: 8em;
  display: block;
  text-align: center;
  text-align-last: auto;
  position: relative;
}
math-type compositeblock.over-symbol > symbol > inner {
  display: block;
  position: absolute;
  text-align: center;
  text-align-last: auto;
  width: 100%;
  height: 100%;
  left: 0;
  top: 0;
}
math-type compositeblock.over-symbol > symbol.dot > inner.left-sign,
math-type compositeblock.over-symbol > symbol.ring > inner.left-sign {
  transform: translate(-0.07em, 0);
}
math-type compositeblock.over-symbol > symbol.dot > inner.right-sign,
math-type compositeblock.over-symbol > symbol.ring > inner.right-sign {
  transform: translate(0.2em, 0);
}
math-type compositeblock.over-symbol > symbol.dot > inner,
math-type compositeblock.over-symbol > symbol.ring > inner {
  transform: translate(0.05em, 0);
}
math-type compositeblock.over-symbol > symbol.small-hat > inner.left-sign,
math-type compositeblock.over-symbol > symbol.small-tilde > inner.left-sign {
  transform: translate(-0.04em, 0);
}
math-type compositeblock.over-symbol > symbol.small-hat > inner.right-sign,
math-type compositeblock.over-symbol > symbol.small-tilde > inner.right-sign {
  transform: translate(0.15em, 0);
}
math-type compositeblock.over-symbol > symbol.small-hat > inner.ignore-shift,
math-type compositeblock.over-symbol > symbol.small-tilde > inner.ignore-shift {
  transform: translate(0, 0);
}
math-type compositeblock.over-symbol > symbol.small-hat > inner,
math-type compositeblock.over-symbol > symbol.small-tilde > inner {
  transform: translate(0.05em, 0);
}
math-type compositeblock.over-symbol > symbol.acute > inner.left-sign {
  transform: translate(-0.04em, 0);
}
math-type compositeblock.over-symbol > symbol.acute > inner.right-sign {
  transform: translate(0.25em, 0);
}
math-type compositeblock.over-symbol > symbol.acute > inner {
  transform: translate(0.1em, 0);
}
math-type compositeblock.over-symbol > symbol.grave,
math-type compositeblock.over-symbol > symbol.breve,
math-type compositeblock.over-symbol > symbol.acute {
  font-family: 'Times New Roman', Times, serif;
}
math-type compositeblock.over-symbol > symbol.grave > inner.left-sign,
math-type compositeblock.over-symbol > symbol.breve > inner.left-sign,
math-type compositeblock.over-symbol > symbol.check > inner.left-sign {
  transform: translate(-0.07em, 0);
}
math-type compositeblock.over-symbol > symbol.grave > inner.right-sign,
math-type compositeblock.over-symbol > symbol.breve > inner.right-sign,
math-type compositeblock.over-symbol > symbol.check > inner.right-sign {
  transform: translate(0.17em, 0);
}
math-type compositeblock.over-symbol > symbol.ddddot {
  min-width: 0.9em;
}
math-type compositeblock.over-symbol > symbol.dddot {
  min-width: 0.7em;
}

.math-xx > editarea {
  float: left;
}

math-type .big-delimiter-symbol {
  display: inline-flex;
  align-items: center;
  position: relative;
  margin: 0.1em 0;
}
math-type .big-delimiter-symbol big-delimiter.big-open {
  margin-left: 0.09em;
}
math-type .big-delimiter-symbol big-delimiter.big-close {
  margin-right: 0.07em;
}
math-type .big-delimiter-symbol > base-line-indicator {
  height: inherit;
}
math-type .big-delimiter-symbol > big-delimiter > svg {
  height: 100%;
  width: 100%;
}
math-type .big-delimiter-symbol > big-delimiter > bulb {
  left: -10px;
}
math-type .big-delimiter-symbol > big-delimiter > setting {
  width: 158px;
  display: flex;
  position: absolute;
  left: 0;
  top: -40px;
}
math-type .big-delimiter-symbol > big-delimiter > setting > .select-box-container {
  margin-right: 4px;
}
math-type .big-delimiter-symbol > big-delimiter > setting > .select-box-container:last-child {
  margin-right: 0px;
}

select-buttons {
  font-size: 13px;
  color: gray;
  display: block;
}
select-buttons > sb-item {
  display: inline-block;
  padding: 2px 2px;
  cursor: pointer;
  border: 1px solid transparent;
  /*box-sizing: border-box;*/
}
select-buttons > sb-item.selected {
  background-color: white;
  border: 1px solid lightgray;
}
select-buttons > sb-item:hover {
  border: 1px solid lightgray;
}
select-buttons > sb-item.disabled {
  opacity: 0.3;
  cursor: default;
  border: 1px solid transparent;
}
select-buttons > sb-item.disabled:hover {
  background-color: inherit;
  border: 1px solid transparent;
}

tabs-container tab-item {
  color: gray;
}
tabs-container tab-item:hover {
  color: black;
}

expandable-component.button-action {
  cursor: pointer;
  color: gray;
  fill: gray;
}
expandable-component.button-action:hover,
expandable-component.button-action.selected {
  color: black;
  fill: black;
}
expandable-component.button-action:hover label-display,
expandable-component.button-action.selected label-display {
  border: 1px solid #e2e0e0;
}
expandable-component.button-action label-display {
  font-size: 12px;
  padding-top: 5px;
  display: flex;
  border: 1px solid transparent;
  padding-left: 2px;
  padding-right: 2px;
  margin-top: 0px;
  padding-bottom: 4px;
  cursor: pointer;
}
expandable-component.button-action label-display > i {
  padding-left: 5px;
  padding-top: 1px;
}
expandable-component.button-action label-item-container > label-item:hover {
  background-color: #bfe4bd;
}
expandable-component.button-action label-item-container > label-item.ignore-select {
  background-color: inherit;
  cursor: default;
}
expandable-component.button-action.button-style label-display {
  background: white;
  border: 1px solid lightgray;
}
expandable-component.button-action.button-style:hover,
expandable-component.button-action.button-style.selected {
  color: gray;
}
expandable-component.button-action.button-style:hover label-display,
expandable-component.button-action.button-style.selected label-display {
  background: #f7f6f6;
}

g.group-box-move {
  opacity: 0.2;
}
g.group-box-move:hover {
  opacity: 0.8;
}




.math-diagram .intersections-group {
  stroke-width: 2px;
  stroke: black;
  fill: transparent;
  cursor: move;
}

/**we use alpha as we have problem with background (without alpha) in Electron version (older Chrome) **/
/* z-index region*/
/**different context*/
/**different context*/
math-type compositeblock.math-diagram > math-diagram {
  background: white;
}
math-type compositeblock.math-diagram {
  cursor: default;
  width: 100%;
  /** display block as if inline block, it will be disapear in some cases*/
  display: block;
}
math-type compositeblock.math-diagram .connection-point {
  cursor: crosshair;
}
math-type compositeblock.math-diagram .connection-point g {
  fill-opacity: 0.6;
}
math-type compositeblock.math-diagram .connection-point:hover g {
  fill-opacity: 1;
}
math-type compositeblock.math-diagram .text-diagram-editor editarea.text-mode.non-wrap > line.text-mode {
  font-size: unset;
}
math-type compositeblock.math-diagram .text-diagram-editor editarea.text-mode.non-wrap > line.text-mode > block {
  white-space: pre;
}
math-type compositeblock.math-diagram .text-diagram-editor editarea.text-mode.non-wrap > line.text-mode > blocks > block {
  white-space: pre;
}
math-type compositeblock.math-diagram > math-diagram {
  border: 1px solid transparent;
}
math-type compositeblock.math-diagram > math-diagram > clip-region > zoom-region {
  display: block;
  width: 100%;
  height: 100%;
}
math-type compositeblock.math-diagram > math-diagram > clip-region > zoom-region > svg {
  position: absolute;
  width: 100%;
  height: 100%;
  left: 0;
  top: 0;
}
math-type compositeblock.math-diagram .add-label {
  fill: gray;
}
math-type compositeblock.math-diagram .add-label:hover {
  fill: black;
}
math-type compositeblock.math-diagram .diagram-editor {
  margin: 0 2px;
}
math-type compositeblock.math-diagram .control-point-guide {
  stroke: lightgray;
  stroke-width: 0.5px;
  pointer-events: none;
}
math-type compositeblock.math-diagram .connection-group {
  stroke: black;
  fill: none;
}
math-type compositeblock.math-diagram .arrow-line {
  cursor: move;
}
math-type compositeblock.math-diagram .mobile-tablet .shape .transparent,
math-type compositeblock.math-diagram .mobile-tablet .composite-shape .transparent {
  stroke-width: 10px;
}
math-type compositeblock.math-diagram .shape,
math-type compositeblock.math-diagram .composite-shape {
  stroke-width: 1px;
  fill: none;
  cursor: move;
}
math-type compositeblock.math-diagram .shape .transparent,
math-type compositeblock.math-diagram .composite-shape .transparent {
  pointer-events: visiblePainted;
  stroke-width: 6px;
  stroke: transparent;
  stroke-dasharray: none;
  fill: none;
}
math-type compositeblock.math-diagram .mobile-tablet .connection.transparent,
math-type compositeblock.math-diagram .mobile-tablet .connection.transparent > line,
math-type compositeblock.math-diagram .mobile-tablet .connection.transparent > path {
  stroke-width: 10px;
}
math-type compositeblock.math-diagram .connection {
  stroke-width: 1px;
  fill: none;
  cursor: move;
}
math-type compositeblock.math-diagram .connection.transparent,
math-type compositeblock.math-diagram .connection.transparent > line,
math-type compositeblock.math-diagram .connection.transparent > path {
  pointer-events: visiblePainted;
  stroke-width: 6px;
  stroke: transparent;
  stroke-dasharray: none;
  fill: none;
}
math-type compositeblock.math-diagram .frame {
  stroke-width: 1px;
  fill: transparent;
}
math-type math-diagram {
  display: block;
  position: relative;
  width: 100%;
  height: 300px;
}
math-type math-diagram position-container {
  position: absolute;
  width: 1px;
  height: 1px;
  display: block;
}
math-type math-diagram dg-editor-container {
  position: absolute;
  min-width: 0.85em;
  border-collapse: border-box;
}
math-type math-diagram coverlayer {
  position: absolute;
  background: transparent;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  z-index: 2;
  cursor: move;
}
math-type math-diagram connection-point {
  position: absolute;
  display: block;
  height: 6px;
  width: 6px;
  background: lightgray;
  border: 1px solid gray;
  bottom: -10px;
  left: 50%;
  margin-left: -3px;
  cursor: e-resize;
}
math-type .diagram-caption > line.text-mode:first-child {
  display: inline;
}
math-type .diagram-caption > line.text-mode:first-child > blocks {
  display: inline;
}


.plot-input-style-settings {
  opacity: 0.5;
}
.plot-input-style-settings:hover {
  opacity: 1;
}

.psa-cn .ps-hint {
  opacity: 0;
  transition: opacity 0.3s linear;
}
.psa-cn:hover .ps-hint {
  opacity: 0.6;
}

.role-toolbar-wrapper.dg-full-view tool-bar too-bar-container {
  justify-content: start;
  width: auto;
  min-width: 0;
}
.role-toolbar-wrapper.dg-full-view diagram-settings {
  width: auto;
}

.dg-items-bar-container item {
  display: inline-block;
  padding: 3px;
  fill: gray;
  stroke: gray;
}
.dg-items-bar-container item,
.dg-items-bar-container item-option {
  border: 1px transparent solid;
}
.dg-items-bar-container item:hover,
.dg-items-bar-container item-option:hover {
  border: 1px #c4c1c1 solid;
  background: white;
}

/**we use alpha as we have problem with background (without alpha) in Electron version (older Chrome) **/
/* z-index region*/
/**different context*/
/**different context*/
math-type compositeblock.theorem {
  display: block;
}
math-type compositeblock.theorem.selected {
  outline: 1px solid rgba(93, 92, 92, 0.3);
}
math-type theorem-name {
  min-width: 20px;
  display: inline;
}
math-type theorem-name > line.text-mode:first-child {
  display: inline;
}
math-type editarea.text-mode.edit-theorem-content {
  min-width: 100px;
  display: inline;
  font-style: italic;
}
math-type editarea.text-mode.edit-theorem-content > line.text-mode:first-child {
  display: inline;
}
math-type editarea.text-mode.edit-theorem-content > line.text-mode:first-child > blocks {
  display: inline;
}
math-type editarea.text-mode.edit-theorem-content > line.text-mode > block {
  font-style: italic;
}
math-type editarea.text-mode.edit-theorem-content > line.text-mode > blocks > block {
  font-style: italic;
}
math-type editarea.text-mode.edit-theorem-content.normal > line.text-mode > block {
  font-style: normal;
}
math-type editarea.text-mode.edit-theorem-content.normal > line.text-mode > blocks > block {
  font-style: normal;
}
math-type editarea.text-mode.edit-theorem-content .qed-symbol {
  line-height: 1em;
}
.deletable {
  cursor: pointer;
}
.deletable:hover {
  color: red;
}

.regular-checkbox:hover {
  background-color: #f3f2f2;
}

@media print {
  code[class*="language-"],
  pre[class*="language-"] {
    text-shadow: none !important;
  }
}
math-type .code-section prefix.code-line-number {
  color: #a9a7a7;
  width: 2.5em;
  display: inline-block;
  flex-shrink: 0;
}
math-type .code-section prefix.code-line-number.prefix-l10 {
  width: 1.5em;
}
math-type .code-section prefix.code-line-number.prefix-l100 {
  width: 2em;
}
math-type .code-section .code-line-blocks-container {
  white-space: pre-wrap;
  white-space: break-spaces;
}
math-type .code-section .code-line-blocks-container block.token {
  white-space: pre-wrap;
  white-space: break-spaces;
}
math-type .code-section line.text-mode.code-section-line {
  display: flex;
  flex-direction: row;
  line-height: 1.5;
}

/**
 * prism.js default theme for JavaScript, CSS and HTML
 * Based on dabblet (http://dabblet.com)
 * @author Lea Verou
 */
.code-section.theme-default editarea {
  color: black;
}
.code-section.theme-default .token.comment,
.code-section.theme-default .token.prolog,
.code-section.theme-default .token.doctype,
.code-section.theme-default .token.cdata {
  color: slategray;
}
.code-section.theme-default .token.punctuation {
  color: #999;
}
.code-section.theme-default .namespace {
  opacity: 0.7;
}
.code-section.theme-default .token.property,
.code-section.theme-default .token.tag,
.code-section.theme-default .token.boolean,
.code-section.theme-default .token.number,
.code-section.theme-default .token.constant,
.code-section.theme-default .token.symbol,
.code-section.theme-default .token.deleted {
  color: #905;
}
.code-section.theme-default .token.selector,
.code-section.theme-default .token.attr-name,
.code-section.theme-default .token.string,
.code-section.theme-default .token.char,
.code-section.theme-default .token.builtin,
.code-section.theme-default .token.inserted {
  color: #690;
}
.code-section.theme-default .token.operator,
.code-section.theme-default .token.entity,
.code-section.theme-default .token.url,
.code-section.theme-default .language-css .token.string,
.code-section.theme-default .style .token.string {
  color: #9a6e3a;
}
.code-section.theme-default .token.atrule,
.code-section.theme-default .token.attr-value,
.code-section.theme-default .token.keyword {
  color: #07a;
}
.code-section.theme-default .token.function,
.code-section.theme-default .token.class-name {
  color: #DD4A68;
}
.code-section.theme-default .token.regex,
.code-section.theme-default .token.important,
.code-section.theme-default .token.important1,
.code-section.theme-default .token.variable {
  color: #e90;
}
.code-section.theme-default .token.important,
.code-section.theme-default .token.bold,
.code-section.theme-default .token.bold1 {
  font-weight: bold;
}
.code-section.theme-default .token.italic,
.code-section.theme-default .token.italic1 {
  font-style: italic;
}
.code-section.theme-default .token.entity {
  cursor: help;
}

/**
 * prism.js default theme for JavaScript, CSS and HTML
 * Based on dabblet (http://dabblet.com)
 * @author Lea Verou
 */
.code-section.theme-tomorrow-night {
  /**
 * prism.js tomorrow night eighties for JavaScript, CoffeeScript, CSS and HTML
 * Based on https://github.com/chriskempson/tomorrow-theme
 * @author Rose Pritchard
 */
}
.code-section.theme-tomorrow-night editarea {
  caret-color: #ccc;
}
.code-section.theme-tomorrow-night editarea {
  color: #ccc;
}
.code-section.theme-tomorrow-night .token.comment,
.code-section.theme-tomorrow-night .token.block-comment,
.code-section.theme-tomorrow-night .token.prolog,
.code-section.theme-tomorrow-night .token.doctype,
.code-section.theme-tomorrow-night .token.cdata {
  color: #999;
}
.code-section.theme-tomorrow-night .token.punctuation {
  color: #ccc;
}
.code-section.theme-tomorrow-night .token.tag,
.code-section.theme-tomorrow-night .token.attr-name,
.code-section.theme-tomorrow-night .token.namespace,
.code-section.theme-tomorrow-night .token.deleted {
  color: #e2777a;
}
.code-section.theme-tomorrow-night .token.function-name {
  color: #6196cc;
}
.code-section.theme-tomorrow-night .token.boolean,
.code-section.theme-tomorrow-night .token.number,
.code-section.theme-tomorrow-night .token.function {
  color: #f08d49;
}
.code-section.theme-tomorrow-night .token.property,
.code-section.theme-tomorrow-night .token.class-name,
.code-section.theme-tomorrow-night .token.constant,
.code-section.theme-tomorrow-night .token.symbol {
  color: #f8c555;
}
.code-section.theme-tomorrow-night .token.selector,
.code-section.theme-tomorrow-night .token.important,
.code-section.theme-tomorrow-night .token.important1,
.code-section.theme-tomorrow-night .token.atrule,
.code-section.theme-tomorrow-night .token.keyword,
.code-section.theme-tomorrow-night .token.builtin {
  color: #cc99cd;
}
.code-section.theme-tomorrow-night .token.string,
.code-section.theme-tomorrow-night .token.char,
.code-section.theme-tomorrow-night .token.attr-value,
.code-section.theme-tomorrow-night .token.regex,
.code-section.theme-tomorrow-night .token.variable {
  color: #7ec699;
}
.code-section.theme-tomorrow-night .token.operator,
.code-section.theme-tomorrow-night .token.entity,
.code-section.theme-tomorrow-night .token.url {
  color: #67cdcc;
}
.code-section.theme-tomorrow-night .token.important,
.code-section.theme-tomorrow-night .token.bold,
.code-section.theme-tomorrow-night .token.bold1 {
  font-weight: bold;
}
.code-section.theme-tomorrow-night .token.italic,
.code-section.theme-tomorrow-night .token.italic1 {
  font-style: italic;
}
.code-section.theme-tomorrow-night .token.entity {
  cursor: help;
}
.code-section.theme-tomorrow-night .token.inserted {
  color: green;
}

editor-container > math-type.dark-mode {
  background: #1e1e1e;
}
math-type.dark-mode {
  background: #1e1e1e;
}
math-type.dark-mode.math-type-for-print {
  -webkit-print-color-adjust: exact;
}
math-type.dark-mode editarea.root-editor {
  color: #e0e0e0;
  fill: #e0e0e0;
  stroke: #e0e0e0;
  border-color: #e0e0e0;
}
math-type.dark-mode editarea.root-editor {
  background: #1e1e1e;
}
math-type.dark-mode .math-container-symbol.selected,
math-type.dark-mode .math-container-symbol.display.selected {
  background-color: #2a352a;
}
math-type.dark-mode .matrix-symbol.gather-symbol.selected {
  background-color: #2a352a;
}
math-type.dark-mode .matrix-symbol.gather-symbol > matrix > table > tbody > tr > td.selected {
  border: 1px solid #525252;
}
math-type.dark-mode .matrix-symbol.align-symbol.selected {
  background-color: #2a352a;
}
math-type.dark-mode .matrix-symbol.align-symbol > matrix > table > tbody > tr > td.selected {
  border: 1px solid #525252;
}
math-type.dark-mode .matrix-symbol.matrix-like.selected {
  background-color: #2a352a;
}
math-type.dark-mode .matrix-symbol.matrix-like > matrix > table > tbody > tr.selected:not(.hline) {
  border-top: 1px solid #525252;
}
math-type.dark-mode .matrix-symbol.matrix-like > matrix > table > tbody > tr:last-child.selected {
  border-bottom: 1px solid #525252;
}
math-type.dark-mode .matrix-symbol > matrix > table > tbody > tr > td.selected:not(.vline) {
  border-left: 1px solid #525252;
}
math-type.dark-mode .matrix-symbol > matrix > table > tbody > tr > td:last-child.selected {
  border-right: 1px solid #525252;
}
math-type.dark-mode .matrix-symbol.case-symbol > matrix > table > tbody > tr > td.selected {
  border: 1px solid #525252;
}
math-type.dark-mode selection-wrapper > selection {
  background-color: rgba(33, 150, 243, 0.25);
}
math-type.dark-mode selection-wrapper.inactive > selection {
  background-color: rgba(255, 255, 255, 0.27);
}
math-type.dark-mode editarea.selected {
  outline: 1px solid rgba(177, 174, 174, 0.3);
}
math-type.dark-mode compositeblock.math-diagram > math-diagram {
  background: #1e1e1e;
}
container-layer.dark-mode editor-container {
  background: #1e1e1e;
}

/**we use alpha as we have problem with background (without alpha) in Electron version (older Chrome) **/
/* z-index region*/
/**different context*/
/**different context*/
editor-container > math-type {
  background: white;
  outline: 1px solid lightgray;
}
math-type {
  display: block;
  position: relative;
  padding: 20px;
  color: black;
  padding-top: 15px;
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -khtml-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  outline: none;
  cursor: text;
  text-align: initial;
}
math-type .rcnt {
  color: white;
  font-size: 12px;
  position: -webkit-sticky;
  position: sticky;
  top: 0;
  bottom: 0;
  display: flex;
  flex-direction: row;
}
math-type > .mt-sa {
  position: absolute;
  top: 0;
  left: -100px;
  right: -100px;
  bottom: -400px;
  -webkit-user-select: none;
  -khtml-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  pointer-events: none;
}
math-type.math-only compositeblock.math-container-symbol {
  width: 100%;
}
math-type.math-only compositeblock.math-container-symbol.selected {
  outline: none;
  background: none;
}
math-type.math-only compositeblock.math-container-symbol > editarea {
  width: 100%;
}
math-type.math-only compositeblock.math-container-symbol > editarea > line {
  justify-content: flex-start;
}
math-type > input:not([type]),
math-type input[type="text"] {
  width: 50px;
}
math-type composition-indicator {
  display: block;
  position: absolute;
  height: 2px;
  min-width: 2px;
  border-bottom: 2px solid gray;
  left: 0;
  top: 0;
}
math-type .focus-element {
  outline: none;
  overflow: hidden;
  width: 0px;
  height: 0px;
  top: 0px;
  left: 0px;
  display: block;
  position: absolute;
  font-size: 40px;
}
.scroll-without-scrollbar {
  scrollbar-width: none;
  /* Firefox */
  -ms-overflow-style: none;
  /* IE 10+ */
}
.scroll-without-scrollbar::-webkit-scrollbar {
  width: 0;
  height: 0;
  display: none;
}
#root,
.main-container {
  width: 100%;
  color: #212121;
}
.sub-text-cursor,
.text-cursor {
  position: absolute;
  color: green;
  /*font-size: 1.2em;*/
  pointer-events: none;
  border-left: 2px solid green;
  display: block;
  top: 0px;
  left: 0px;
  z-index: 10;
}
.sub-text-cursor {
  opacity: 0.4;
}
math-edit-container {
  display: block;
  outline: none;
  position: relative;
  font-family: 'Asana';
}
.root-editor {
  min-height: 500px;
  box-sizing: border-box;
}
.root-editor.restricted-view {
  min-height: unset;
}
.root-editor.test-view {
  min-height: 100px;
}
.menu {
  color: #ffffff;
  text-transform: uppercase;
  text-decoration: none;
  font-family: "HelveticaNeue-Medium", sans-serif;
  font-size: 14px;
  display: inline-block;
  transform: scale(1, 1.5);
  -webkit-transform: scale(1, 1.5);
  /* Safari and Chrome */
  -moz-transform: scale(1, 1.5);
  /* Firefox */
  -ms-transform: scale(1, 1.5);
  /* IE 9+ */
  -o-transform: scale(1, 1.5);
  /* Opera */
}
.setting-group-options {
  font-size: 13px;
  color: gray;
  fill: gray;
}
.setting-group-options > i,
.setting-group-options > svg.icon {
  padding: 3px;
  cursor: pointer;
  border: 1px solid transparent;
  /*box-sizing: border-box;*/
}
.setting-group-options > i.selected,
.setting-group-options > svg.icon.selected {
  background-color: white;
  border: 1px solid lightgray;
}
.setting-group-options > i:hover,
.setting-group-options > svg.icon:hover {
  border: 1px solid lightgray;
}
.setting-group-options > i.disabled,
.setting-group-options > svg.icon.disabled {
  opacity: 0.3;
}
.setting-group-options > i.disabled:hover,
.setting-group-options > svg.icon.disabled:hover {
  background-color: inherit;
  border: 1px solid transparent;
}
math-type .math-text,
math-type .normal-text,
math-type .raw-latex {
  font-family: arial, verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif;
}
math-type .math-text editarea.text-mode > line.text-mode > blocks > block,
math-type .normal-text editarea.text-mode > line.text-mode > blocks > block,
math-type .raw-latex editarea.text-mode > line.text-mode > blocks > block {
  white-space: nowrap;
}
.mt-common-dialog {
  box-shadow: 1px 1px 1px 0px #e0dddd;
  background-color: #f7f7f7;
  border: 1px lightgray solid;
  z-index: 14;
  padding: 6px;
  cursor: default;
  font-family: "Segoe UI", Arial, Verdana, sans-serif;
}
disabled-layer {
  display: block;
  position: absolute;
  left: 0;
  top: 1px;
  right: 0;
  bottom: 2px;
  background: rgba(247, 247, 247, 0.66);
  /** consider export button z-index when change this one*/
  z-index: 500;
}
math-type tag-container tag-select-wrapper {
  position: absolute;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
}
math-type tag-container tag-box-select {
  position: absolute;
  display: block;
  background-color: green;
  opacity: 0;
  cursor: pointer;
  z-index: 15;
}
math-type tag-container tag-box-select:hover {
  opacity: 0.2;
}
math-type tag-container tag-box-gap {
  position: absolute;
  display: block;
  background-color: white;
  opacity: 0.9;
  z-index: 15;
}
.setting-popup-zindex {
  z-index: 11;
}
svg.selectable {
  cursor: pointer;
  border: 1px solid transparent;
}
svg.selectable.selected {
  background: white;
  border: solid 1px lightgray;
}
svg.selectable:hover {
  border: solid 1px lightgray;
}


@media print {
  @page {
    margin: 0;
  }
  /**
    Convert Preview into main print area
    */
  .math-type-doc,
  .docs-container,
  .modal-dialog-root-container,
  instructions-container {
    display: none !important;
  }
  .print-preview-container {
    position: static !important;
    display: block !important;
    visibility: visible !important;
    width: auto !important;
    height: auto !important;
    z-index: 99999 !important;
  }
  .print-container {
    position: static !important;
    overflow: hidden;
  }
  .print-preview-controls-container {
    display: none !important;
  }
  .math-type-no-print {
    display: none !important;
  }
  area-container.print-page-level {
    margin-left: 0 !important;
    margin-top: 0 !important;
    margin-right: 0 !important;
    margin-bottom: 0 !important;
    border: none !important;
    border-left: none !important;
    border-top: none !important;
    border-right: none !important;
    border-bottom: none !important;
    break-inside: avoid !important;
  }
  .area-container-border {
    border: none !important;
    border-left: none !important;
    border-top: none !important;
    border-right: none !important;
    border-bottom: none !important;
    display: none !important;
  }
  #print-container {
    background-color: transparent !important;
  }
  #print-container > math-type {
    background-color: transparent !important;
  }
  #print-container > math-type > math-edit-container > editarea {
    background-color: transparent !important;
  }
  /*-----------------------------*/
  header,
  .export-bar-container {
    display: none !important;
  }
  math-type {
    padding: 0 !important;
  }
  .print-remove-background {
    background-color: transparent !important;
  }
  document-info-bar {
    display: none !important;
  }
  document-sidebar-container {
    display: none !important;
  }
  body {
    position: relative !important;
  }
  page,
  #root,
  body,
  html {
    height: 100% !important;
    width: 100% !important;
    position: relative !important;
    background: white !important;
    overflow: visible !important;
  }
}
.print-background.math-type-for-print {
  -webkit-print-color-adjust: exact;
}
@media print {
  outline: none !important;
  .npm__react-simple-code-editor__textarea {
    display: none !important;
  }
  math-diagram {
    border: none !important;
  }
  .no-border-on-print {
    border: none !important;
  }
  .setting-select {
    display: none !important;
  }
  .no-print,
  ref-tag.empty-line-tag,
  .text-cursor,
  .sub-text-cursor,
  selection-wrapper,
  message-box-container,
  connection-controls,
  .control-point-guide,
  tool-bar,
  items-bar,
  document-sidebar,
  resize-bar,
  diagram-expander,
  warning-error-region,
  loading-layer,
  resizing-info,
  toc-refresh {
    display: none !important;
  }
  .no-print-outline {
    outline: none !important;
  }
  .selected {
    background: unset !important;
  }
  .math-container-symbol.selected {
    background: unset !important;
  }
  .matrix-symbol.align-symbol {
    background: unset !important;
  }
  .matrix-symbol.gather-symbol {
    background: unset !important;
  }
  tr.selected,
  td.selected {
    border: unset !important;
  }
  tr.selected.hline {
    border-top: 1px solid black !important;
  }
  tr.selected.last-hline {
    border-bottom: 1px solid black !important;
  }
  td.selected.vline {
    border-left: 1px solid black !important;
  }
  td.selected.last-vline {
    border-right: 1px solid black !important;
  }
  .selected {
    outline: unset !important;
  }
  container-layer {
    margin: 0 !important;
    padding: 0 !important;
    background: transparent !important;
    height: initial !important;
    overflow: visible !important;
  }
  editor-container {
    border: none !important;
    margin: 0 !important;
    padding: 0 !important;
    background: transparent !important;
    width: 100% !important;
  }
  content-area {
    padding: 0px !important;
    margin: 0;
    background: transparent !important;
  }
  vcomposed-symbol.non-safari > start {
    margin-bottom: -0.05em !important;
  }
  vcomposed-symbol.non-safari > middle-center {
    margin-top: -0.05em;
    margin-bottom: -0.05em !important;
  }
  vcomposed-symbol.non-safari > middle {
    margin-top: -0.05em;
    margin-bottom: -0.05em !important;
  }
  vcomposed-symbol.non-safari > end {
    margin-top: -0.05em !important;
  }
}
.math-type-for-print {
  outline: none !important;
}
.math-type-for-print .npm__react-simple-code-editor__textarea {
  display: none !important;
}
.math-type-for-print math-diagram {
  border: none !important;
}
.math-type-for-print .no-border-on-print {
  border: none !important;
}
.math-type-for-print .setting-select {
  display: none !important;
}
.math-type-for-print .no-print,
.math-type-for-print ref-tag.empty-line-tag,
.math-type-for-print .text-cursor,
.math-type-for-print .sub-text-cursor,
.math-type-for-print selection-wrapper,
.math-type-for-print message-box-container,
.math-type-for-print connection-controls,
.math-type-for-print .control-point-guide,
.math-type-for-print tool-bar,
.math-type-for-print items-bar,
.math-type-for-print document-sidebar,
.math-type-for-print resize-bar,
.math-type-for-print diagram-expander,
.math-type-for-print warning-error-region,
.math-type-for-print loading-layer,
.math-type-for-print resizing-info,
.math-type-for-print toc-refresh {
  display: none !important;
}
.math-type-for-print .no-print-outline {
  outline: none !important;
}
.math-type-for-print .selected {
  background: unset !important;
}
.math-type-for-print .math-container-symbol.selected {
  background: unset !important;
}
.math-type-for-print .matrix-symbol.align-symbol {
  background: unset !important;
}
.math-type-for-print .matrix-symbol.gather-symbol {
  background: unset !important;
}
.math-type-for-print tr.selected,
.math-type-for-print td.selected {
  border: unset !important;
}
.math-type-for-print tr.selected.hline {
  border-top: 1px solid black !important;
}
.math-type-for-print tr.selected.last-hline {
  border-bottom: 1px solid black !important;
}
.math-type-for-print td.selected.vline {
  border-left: 1px solid black !important;
}
.math-type-for-print td.selected.last-vline {
  border-right: 1px solid black !important;
}
.math-type-for-print .selected {
  outline: unset !important;
}
.math-type-for-print container-layer {
  margin: 0 !important;
  padding: 0 !important;
  background: transparent !important;
  height: initial !important;
  overflow: visible !important;
}
.math-type-for-print editor-container {
  border: none !important;
  margin: 0 !important;
  padding: 0 !important;
  background: transparent !important;
  width: 100% !important;
}
.math-type-for-print content-area {
  padding: 0px !important;
  margin: 0;
  background: transparent !important;
}
.math-type-for-print vcomposed-symbol.non-safari > start {
  margin-bottom: -0.05em !important;
}
.math-type-for-print vcomposed-symbol.non-safari > middle-center {
  margin-top: -0.05em;
  margin-bottom: -0.05em !important;
}
.math-type-for-print vcomposed-symbol.non-safari > middle {
  margin-top: -0.05em;
  margin-bottom: -0.05em !important;
}
.math-type-for-print vcomposed-symbol.non-safari > end {
  margin-top: -0.05em !important;
}
.justify-single-line {
  display: inline-block;
  text-align-last: justify;
  width: 100%;
}
.rtl-on-line-level {
  direction: rtl;
}

math-type modal-dialog.import-latex math-type editarea.root-editor {
  min-height: 100px;
}

/**we use alpha as we have problem with background (without alpha) in Electron version (older Chrome) **/
/* z-index region*/
/**different context*/
/**different context*/
math-type .mobile-keys-support-region {
  position: fixed;
  top: 84px;
  left: 45px;
  color: gray;
  z-index: 11609;
  opacity: 0.9;
  display: flex;
  width: auto;
  z-index: 600;
  cursor: pointer;
}
math-type .mobile-keys-support-region.is-android {
  top: unset;
  bottom: 4px;
  left: 17px;
}
math-type .mobile-keys-support-region.select-only {
  top: 40px;
  left: 25px;
}
math-type .mobile-keys-support-region.select-only .btn-suggestion-box-mobile {
  display: none;
}



.special-symbol-dialog__special-char {
  display: inline-block;
  width: 24px;
  height: 24px;
  line-height: 24px;
  border-bottom: 1px solid #ddd;
  border-right: 1px solid #ddd;
  text-align: center;
  cursor: pointer;
  outline: none;
}
.special-symbol-dialog__special-char:hover {
  background: #bfe4bd;
}

/**we use alpha as we have problem with background (without alpha) in Electron version (older Chrome) **/
/* z-index region*/
/**different context*/
/**different context*/
context-menu-container {
  position: fixed;
  left: 100px;
  top: 300px;
  z-index: 13;
  box-shadow: 2px 2px 3px 0px #c3c3c3;
  border: 1px solid lightgray;
  width: 200px;
  background: white;
  cursor: default;
  outline: none;
  font-family: "Segoe UI", Arial, Verdana, sans-serif;
}
context-menu-container ct-item {
  display: block;
  padding: 6px 9px;
  font-size: 13px;
  color: gray;
}
context-menu-container ct-item.disabled {
  color: lightgray;
}
context-menu-container ct-item:hover {
  background: #eae9e9;
}
context-menu-container ct-item.hidden {
  display: none;
}
context-menu-container ct-icon {
  width: 20px;
  display: inline-block;
}
context-menu-container ct-separator {
  width: 100%;
  display: block;
  height: 1px;
  margin-top: 2px;
  margin-bottom: 2px;
  border-top: 1px solid lightgray;
}

/* Collection default theme */
/* Grid default theme */
/* Table default theme */









/* List default theme */



math-type .symbol-container,
.auto-complete-external-area .symbol-container {
  display: flex;
  flex-direction: row;
  min-height: 25px;
  padding-left: 4px;
  padding-right: 12px;
  align-items: center;
  cursor: pointer;
}
math-type .symbol-container.selected,
.auto-complete-external-area .symbol-container.selected {
  background-color: #bfe4bd;
}
math-type .symbol-friendly-name,
.auto-complete-external-area .symbol-friendly-name {
  flex-grow: 1;
  font-family: Asana;
  /*padding-top: 6px;*/
}
math-type .symbol-icon,
.auto-complete-external-area .symbol-icon {
  /*padding-top: 6px;*/
  margin-right: 15px;
  min-width: 20px;
  text-align: center;
}
math-type .short-cut,
.auto-complete-external-area .short-cut {
  text-align: center;
  color: gray;
  /*vertical-align: middle;*/
  /*line-height: 20px;*/
  margin: 0 2px 0 2px;
  font-size: 12px;
  display: flex;
  align-items: center;
}
math-type .short-cut span,
.auto-complete-external-area .short-cut span {
  font-size: 10px;
}
math-type .hidden,
.auto-complete-external-area .hidden {
  display: none;
}







/**different context*/
/**different context*/
selection-wrapper {
  display: block;
  position: absolute;
  left: 0;
  top: 0;
  user-select: none;
  pointer-events: none;
  z-index: 9;
}
selection-wrapper > selection {
  display: block;
  position: absolute;
  background-color: rgba(0, 126, 255, 0.15);
  user-select: none;
  width: 100px;
  height: 100px;
  transform-origin: 0 0;
}
selection-wrapper.inactive > selection {
  background-color: rgba(58, 57, 57, 0.13);
}

region-highlight-container {
  user-select: none;
  pointer-events: none;
  display: block;
  position: absolute;
  width: 0px;
  height: 0px;
  top: 0;
  left: 0;
  border: 1px solid lightgoldenrodyellow;
  opacity: 0.2;
}
region-highlight-container > rhc-all > rh-rect {
  display: block;
  position: absolute;
  background: orange;
}
region-highlight-container > rh-selected-rect {
  display: block;
  position: absolute;
  background: red;
}

.math-template-btb.btn-normal {
  background: transparent;
  margin-left: 0;
  font-size: 12px;
  border: none;
}
.math-template-btb.btn-normal:hover {
  background: white;
}
.math-template-name-item:hover {
  background: #f7f7f7;
}

.math-template-tree .tree-node-name {
  white-space: nowrap;
}
.math-template-tree .tree-node-name:hover {
  background: #f7f7f7;
}

math-type compositeblock.bib-bibliography {
  width: 100%;
  display: block;
}
math-type compositeblock.bib-cite {
  display: inline;
  white-space: break-spaces;
}
math-type compositeblock.bib-cite > editarea.text-mode {
  display: inline;
}
math-type compositeblock.bib-cite > editarea.text-mode > line.text-mode {
  display: inline;
}
math-type compositeblock.bib-cite > editarea.text-mode > line.text-mode > blocks {
  display: inline;
}
.csl-context {
  white-space: pre-wrap;
}
.csl-context.csl-cite div {
  display: inline;
}
.csl-context div.csl-left-margin {
  float: left;
}
.csl-context div.csl-block {
  font-weight: bold;
}
.csl-context div.csl-right-inline {
  margin-left: 2.5em;
}
.csl-context div.csl-indent {
  margin-top: 0.5em;
  margin-left: 2em;
  padding-bottom: 0.2em;
  padding-left: 0.5em;
  border-left: 5px solid #ccc;
}

.caption-ref-select .role-item:hover {
  background: #edf9ec;
}

.footnote-mt-container {
  position: relative;
}
.footnote-mt-container .more-option-box {
  position: absolute;
  left: -25px;
  top: 0;
  width: 30px;
  bottom: 0;
  display: none;
}
.footnote-mt-container .more-option-box > div {
  background: #f7f7f7;
  border: 1px solid #d6d3d3;
  padding: 0 0.2em;
  cursor: pointer;
  color: gray;
  display: inline-block;
}
.footnote-mt-container.hover-select:hover .more-option-box {
  display: block;
}
.mt-doc-fn > math-edit-container > editarea > area-container > line > first-line-prefix {
  padding-right: 0.3em;
}
.mt-doc-fn > math-edit-container > editarea > area-container > line.has-rtl {
  direction: rtl;
}
.mt-doc-fn > math-edit-container > editarea > area-container > line.has-rtl > first-line-prefix {
  padding-left: 0.3em;
}
.blocks-inline > math-edit-container > editarea > area-container > line > blocks {
  display: inline;
}

.lang-name:hover {
  background: #f7f7f7;
}
.lang-name.selected {
  background: #e1e8f5;
}
.custom-lange-area input::placeholder,
.custom-lange-area textarea::placeholder {
  color: lightgray;
}

.page-print-item {
  position: relative;
}
.page-print-item:hover .page-print-item-hover {
  display: block;
}
.page-print-item-hover {
  display: none;
  position: absolute;
  top: 100%;
  left: 50%;
  transform: translateX(-50%);
  margin-top: 10px;
  background: #f7f6f6;
  z-index: 10;
  padding: 5px;
  font-size: 0.8em;
  white-space: nowrap;
  color: gray;
  border: 1px solid lightgray;
}

.settings-show-hide {
  background: rgba(255, 255, 255, 0.61);
}
.settings-show-hide:hover {
  background: white;
}
.group-symbol-collapsed {
  display: block;
  border: 1px dotted lightgray;
  padding-top: 0.1em;
  padding-bottom: 0.1em;
}
.role-math-mode-group.math-mode-group-expanded .settings-show-hide,
.role-text-mode-group-inline.text-mode-group-inline-expanded .settings-show-hide {
  display: none;
}
.role-math-mode-group.math-mode-group-expanded:hover,
.role-text-mode-group-inline.text-mode-group-inline-expanded:hover {
  outline: 1px solid lightgray;
}
.role-math-mode-group.math-mode-group-expanded:hover .settings-show-hide,
.role-text-mode-group-inline.text-mode-group-inline-expanded:hover .settings-show-hide {
  display: flex;
}

math-type compositeblock.text-super-script-symbol,
math-type compositeblock.text-sub-script-symbol {
  display: inline;
}
math-type compositeblock.text-super-script-symbol > editarea.text-mode,
math-type compositeblock.text-sub-script-symbol > editarea.text-mode {
  display: inline;
}
math-type compositeblock.text-super-script-symbol > editarea.text-mode > line.text-mode,
math-type compositeblock.text-sub-script-symbol > editarea.text-mode > line.text-mode {
  display: inline;
}
math-type compositeblock.text-super-script-symbol > editarea.text-mode > line.text-mode > blocks,
math-type compositeblock.text-sub-script-symbol > editarea.text-mode > line.text-mode > blocks {
  display: inline;
}
math-type .text-super-script-symbol {
  vertical-align: super;
}
math-type .text-sub-script-symbol {
  vertical-align: sub;
}

compositeblock.section-ref {
  display: inline;
}
compositeblock.section-ref > .section-ref-border {
  display: inline;
  white-space: pre-wrap;
}
compositeblock.section-ref > div {
  display: inline;
}



icon-dropdown-items icon-dropdown-item:hover {
  background: #eae9e9;
}
icon-dropdown ii-icon {
  fill: gray;
}
icon-dropdown:hover {
  color: #4e4d4d;
}
icon-dropdown:hover ii-icon {
  fill: #4e4d4d;
}

resizable-container {
  display: block;
  position: relative;
  min-height: 0;
  flex-shrink: 0;
}





a.fce {
  cursor: pointer;
}
a.fce:hover svg {
  fill: #2d4373;
}
a.fce svg {
  fill: #3b5998;
}
a.fce i {
  text-align: center;
  color: white;
}
a.gg {
  cursor: pointer;
}
a.gg:hover svg {
  fill: #c23321;
}
a.gg svg {
  fill: #dd4b39;
}
a.gg i {
  text-align: center;
  color: white;
}
a.twr {
  cursor: pointer;
}
a.twr:hover svg {
  fill: #2795e9;
}
a.twr svg {
  fill: #55acee;
}
a.twr i {
  text-align: center;
  color: white;
}
a.gh {
  cursor: pointer;
}
a.gh:hover svg {
  fill: #2b2b2b;
}
a.gh svg {
  fill: #444;
}
a.gh i {
  text-align: center;
  color: white;
}





modal-dialog.swift.document-name modal-container.mt-common-dialog {
  width: 500px;
  max-width: 95vw;
}
modal-dialog.swift.document-name document-name {
  width: 100%;
  display: flex;
  flex-direction: column;
}
modal-dialog.swift.document-name document-name label {
  display: block;
  font-size: 13px;
}
modal-dialog.swift.document-name document-name textarea {
  width: auto;
  display: block;
  margin: 5px 0px;
  height: 39px;
  outline: none;
  border: 1px solid lightgray;
  resize: vertical;
}

.dock-tab-content {
  flex: 1;
  min-height: 0;
  min-width: 0;
  display: none;
}
.dock-tab-content.active {
  display: flex;
}

quick-start editarea.root-editor {
  min-height: 100px;
}
quick-start > qs-math-type-container > math-type:hover {
  border: 1px solid gray;
}
quick-start > qs-math-type-container > math-type tool-bar {
  display: none;
}
quick-start > qs-math-type-container > math-type items-bar {
  display: none;
  left: -60px;
  top: 0px;
  box-shadow: 0px 1px 2px 0px #4c4949;
}





/**we use alpha as we have problem with background (without alpha) in Electron version (older Chrome) **/
/* z-index region*/
/**Context Level 1*/
/**both Level 1 and 2 Context */
/**Context Level 2 inside docsContainerZIndex*/
document-info-container document-info-bar {
  display: block;
  position: absolute;
  right: 15px;
  bottom: 5px;
  background: #f7f7f7;
  box-shadow: 1px 1px 1px 0px #e0dddd;
  border: 1px lightgray solid;
  font-size: 12px;
  padding: 0px;
  color: gray;
  opacity: 0.8;
  z-index: 4;
}
document-info-container document-info-bar:hover {
  opacity: 1;
}
document-info-container modal-container button.ok.btn-primary {
  display: none;
}
.Popover-body {
  font-size: 12px;
  padding: 10px;
  background: #4CAF50;
  box-shadow: #888686 1px 1px 1px 1px;
  color: white;
  max-width: 250px;
}
.Popover-tip {
  fill: #4CAF50;
}

/**Context Level 1*/
/**both Level 1 and 2 Context */
/**Context Level 2 inside docsContainerZIndex*/
.doc-toolbar-container {
  position: relative;
  background: #f7f7f7;
  top: 0;
  left: 0;
  width: 100%;
  border: 1px lightgray solid;
  margin-left: -2px;
  z-index: 6;
}
.doc-toolbar-container > tool-bar {
  position: relative;
  top: 0;
  left: 0;
  display: block;
  padding-left: 0px;
  min-width: 770px;
  width: 770px;
  margin: auto;
  background: transparent;
  box-shadow: none;
  border: none;
  height: 35px;
}











/**Context Level 1*/
/**both Level 1 and 2 Context */
/**Context Level 2 inside docsContainerZIndex*/


</style><style>/* @font-face {
  font-family: 'FontAwesome';
  src: format('woff'), url('fonts/icomoon.svg?erlpdm#icomoon') format('svg');
  font-weight: normal;
  font-style: normal;
} */

[class^="fa-"], [class*=" fa-"] {
  /* use !important to prevent issues with browser extensions that change fonts */
  /* font-family: 'FontAwesome' !important;
  speak: none;
  font-style: normal;
  font-weight: normal;
  font-variant: normal;
  text-transform: none; */
  /* line-height: 1; */
  /* Better Font Rendering =========== */
  /* -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale; */
  display: inline-block;
  font: normal normal normal 14px/1 FontAwesome;
  font-size: inherit;
  text-rendering: auto;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

.fa-plus:before {
  content: "\f067";
}
.fa-user:before {
  content: "\f007";
}
.fa-check:before {
  content: "\f00c";
}
.fa-close:before {
  content: "\f00d";
}
.fa-remove:before {
  content: "\f00d";
}
.fa-times:before {
  content: "\f00d";
}
.fa-search-plus:before {
  content: "\f00e";
}
.fa-search-minus:before {
  content: "\f010";
}
.fa-cog:before {
  content: "\f013";
}
.fa-gear:before {
  content: "\f013";
}
.fa-trash-o:before {
  content: "\f014";
}
.fa-file-o:before {
  content: "\f016";
}
.fa-refresh:before {
  content: "\f021";
}
.fa-font:before {
  content: "\f031";
}
.fa-bold:before {
  content: "\f032";
}
.fa-italic:before {
  content: "\f033";
}
.fa-align-left:before {
  content: "\f036";
}
.fa-align-center:before {
  content: "\f037";
}
.fa-align-right:before {
  content: "\f038";
}
.fa-dedent:before {
  content: "\f03b";
}
.fa-outdent:before {
  content: "\f03b";
}
.fa-indent:before {
  content: "\f03c";
}
.fa-image:before {
  content: "\f03e";
}
.fa-photo:before {
  content: "\f03e";
}
.fa-picture-o:before {
  content: "\f03e";
}
.fa-pencil:before {
  content: "\f040";
}
.fa-edit:before {
  content: "\f044";
}
.fa-pencil-square-o:before {
  content: "\f044";
}
.fa-share-square-o:before {
  content: "\f045";
}
.fa-arrows:before {
  content: "\f047";
}
.fa-chevron-left:before {
  content: "\f053";
}
.fa-chevron-right:before {
  content: "\f054";
}
.fa-times-circle:before {
  content: "\f057";
}
.fa-info-circle:before {
  content: "\f05a";
}
.fa-arrow-left:before {
  content: "\f060";
}
.fa-arrow-right:before {
  content: "\f061";
}
.fa-arrow-up:before {
  content: "\f062";
}
.fa-arrow-down:before {
  content: "\f063";
}
.fa-mail-forward:before {
  content: "\f064";
}
.fa-share:before {
  content: "\f064";
}
.fa-exclamation-circle:before {
  content: "\f06a";
}
.fa-exclamation-triangle:before {
  content: "\f071";
}
.fa-warning:before {
  content: "\f071";
}
.fa-chevron-up:before {
  content: "\f077";
}
.fa-chevron-down:before {
  content: "\f078";
}
.fa-folder:before {
  content: "\f07b";
}
.fa-folder-open:before {
  content: "\f07c";
}
.fa-twitter:before {
  content: "\f099";
}
.fa-twr:before {
  content: "\f099";
}
.fa-facebook:before {
  content: "\f09a";
}
.fa-fce:before {
  content: "\f09a";
}
.fa-facebook-f:before {
  content: "\f09a";
}
.fa-github:before {
  content: "\f09b";
}
.fa-gh:before {
  content: "\f09b";
}
.fa-cut:before {
  content: "\f0c4";
}
.fa-scissors:before {
  content: "\f0c4";
}
.fa-copy:before {
  content: "\f0c5";
}
.fa-files-o:before {
  content: "\f0c5";
}
.fa-bars:before {
  content: "\f0c9";
}
.fa-navicon:before {
  content: "\f0c9";
}
.fa-reorder:before {
  content: "\f0c9";
}
.fa-list-ul:before {
  content: "\f0ca";
}
.fa-list-ol:before {
  content: "\f0cb";
}
.fa-strikethrough:before {
  content: "\f0cc";
}
.fa-underline:before {
  content: "\f0cd";
}
.fa-table:before {
  content: "\f0ce";
}
.fa-magic:before {
  content: "\f0d0";
}
.fa-caret-down:before {
  content: "\f0d7";
}
.fa-caret-right:before {
  content: "\f0da";
}
.fa-sort-desc:before {
  content: "\f0dd";
}
.fa-sort-down:before {
  content: "\f0dd";
}
.fa-clipboard:before {
  content: "\f0ea";
}
.fa-paste:before {
  content: "\f0ea";
}
.fa-angle-double-left:before {
  content: "\f100";
}
.fa-angle-double-right:before {
  content: "\f101";
}
.fa-angle-double-up:before {
  content: "\f102";
}
.fa-angle-double-down:before {
  content: "\f103";
}
.fa-circle:before {
  content: "\f111";
}
.fa-mail-reply:before {
  content: "\f112";
}
.fa-reply:before {
  content: "\f112";
}
.fa-exclamation:before {
  content: "\f12a";
}
.fa-eraser:before {
  content: "\f12d";
}
.fa-ellipsis-h:before {
  content: "\f141";
}
.fa-ellipsis-v:before {
  content: "\f142";
}
.fa-file:before {
  content: "\f15b";
}
.fa-file-text:before {
  content: "\f15c";
}
.fa-google:before {
  content: "\f1a0";
}
.fa-gg:before {
  content: "\f1a0";
}
.fa-trash:before {
  content: "\f1f8";
}
.fa-i-cursor:before {
  content: "\f246";
}
.fa-hand-paper-o:before {
  content: "\f256";
}
.fa-hand-stop-o:before {
  content: "\f256";
}
</style><style>.MathJax_Hover_Frame {border-radius: .25em; -webkit-border-radius: .25em; -moz-border-radius: .25em; -khtml-border-radius: .25em; box-shadow: 0px 0px 15px #83A; -webkit-box-shadow: 0px 0px 15px #83A; -moz-box-shadow: 0px 0px 15px #83A; -khtml-box-shadow: 0px 0px 15px #83A; border: 1px solid #A6D ! important; display: inline-block; position: absolute}
.MathJax_Menu_Button .MathJax_Hover_Arrow {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 4px; -webkit-border-radius: 4px; -moz-border-radius: 4px; -khtml-border-radius: 4px; font-family: 'Courier New',Courier; font-size: 9px; color: #F0F0F0}
.MathJax_Menu_Button .MathJax_Hover_Arrow span {display: block; background-color: #AAA; border: 1px solid; border-radius: 3px; line-height: 0; padding: 4px}
.MathJax_Hover_Arrow:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_Hover_Arrow:hover span {background-color: #CCC!important}
</style><style>#MathJax_About {position: fixed; left: 50%; width: auto; text-align: center; border: 3px outset; padding: 1em 2em; background-color: #DDDDDD; color: black; cursor: default; font-family: message-box; font-size: 120%; font-style: normal; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 15px; -webkit-border-radius: 15px; -moz-border-radius: 15px; -khtml-border-radius: 15px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_About.MathJax_MousePost {outline: none}
.MathJax_Menu {position: absolute; background-color: white; color: black; width: auto; padding: 5px 0px; border: 1px solid #CCCCCC; margin: 0; cursor: default; font: menu; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 5px; -webkit-border-radius: 5px; -moz-border-radius: 5px; -khtml-border-radius: 5px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
.MathJax_MenuItem {padding: 1px 2em; background: transparent}
.MathJax_MenuArrow {position: absolute; right: .5em; padding-top: .25em; color: #666666; font-size: .75em}
.MathJax_MenuActive .MathJax_MenuArrow {color: white}
.MathJax_MenuArrow.RTL {left: .5em; right: auto}
.MathJax_MenuCheck {position: absolute; left: .7em}
.MathJax_MenuCheck.RTL {right: .7em; left: auto}
.MathJax_MenuRadioCheck {position: absolute; left: .7em}
.MathJax_MenuRadioCheck.RTL {right: .7em; left: auto}
.MathJax_MenuLabel {padding: 1px 2em 3px 1.33em; font-style: italic}
.MathJax_MenuRule {border-top: 1px solid #DDDDDD; margin: 4px 3px}
.MathJax_MenuDisabled {color: GrayText}
.MathJax_MenuActive {background-color: #606872; color: white}
.MathJax_MenuDisabled:focus, .MathJax_MenuLabel:focus {background-color: #E8E8E8}
.MathJax_ContextMenu:focus {outline: none}
.MathJax_ContextMenu .MathJax_MenuItem:focus {outline: none}
#MathJax_AboutClose {top: .2em; right: .2em}
.MathJax_Menu .MathJax_MenuClose {top: -10px; left: -10px}
.MathJax_MenuClose {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; font-family: 'Courier New',Courier; font-size: 24px; color: #F0F0F0}
.MathJax_MenuClose span {display: block; background-color: #AAA; border: 1.5px solid; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; line-height: 0; padding: 8px 0 6px}
.MathJax_MenuClose:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_MenuClose:hover span {background-color: #CCC!important}
.MathJax_MenuClose:hover:focus {outline: none}
</style><style>.MathJax_Preview .MJXf-math {color: inherit!important}
</style><style>.MJX_Assistive_MathML {position: absolute!important; top: 0; left: 0; clip: rect(1px, 1px, 1px, 1px); padding: 1px 0 0 0!important; border: 0!important; height: 1px!important; width: 1px!important; overflow: hidden!important; display: block!important; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none}
.MJX_Assistive_MathML.MJX_Assistive_MathML_Block {width: 100%!important}
</style><style>#MathJax_Zoom {position: absolute; background-color: #F0F0F0; overflow: auto; display: block; z-index: 301; padding: .5em; border: 1px solid black; margin: 0; font-weight: normal; font-style: normal; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; -webkit-box-sizing: content-box; -moz-box-sizing: content-box; box-sizing: content-box; box-shadow: 5px 5px 15px #AAAAAA; -webkit-box-shadow: 5px 5px 15px #AAAAAA; -moz-box-shadow: 5px 5px 15px #AAAAAA; -khtml-box-shadow: 5px 5px 15px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_ZoomOverlay {position: absolute; left: 0; top: 0; z-index: 300; display: inline-block; width: 100%; height: 100%; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
#MathJax_ZoomFrame {position: relative; display: inline-block; height: 0; width: 0}
#MathJax_ZoomEventTrap {position: absolute; left: 0; top: 0; z-index: 302; display: inline-block; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
</style><style>.MathJax_Preview {color: #888}
#MathJax_Message {position: fixed; left: 1em; bottom: 1.5em; background-color: #E6E6E6; border: 1px solid #959595; margin: 0px; padding: 2px 8px; z-index: 102; color: black; font-size: 80%; width: auto; white-space: nowrap}
#MathJax_MSIE_Frame {position: absolute; top: 0; left: 0; width: 0px; z-index: 101; border: 0px; margin: 0px; padding: 0px}
.MathJax_Error {color: #CC0000; font-style: italic}
</style><style>.MJXp-script {font-size: .8em}
.MJXp-right {-webkit-transform-origin: right; -moz-transform-origin: right; -ms-transform-origin: right; -o-transform-origin: right; transform-origin: right}
.MJXp-bold {font-weight: bold}
.MJXp-italic {font-style: italic}
.MJXp-scr {font-family: MathJax_Script,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-frak {font-family: MathJax_Fraktur,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-sf {font-family: MathJax_SansSerif,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-cal {font-family: MathJax_Caligraphic,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-mono {font-family: MathJax_Typewriter,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-largeop {font-size: 150%}
.MJXp-largeop.MJXp-int {vertical-align: -.2em}
.MJXp-math {display: inline-block; line-height: 1.2; text-indent: 0; font-family: 'Times New Roman',Times,STIXGeneral,serif; white-space: nowrap; border-collapse: collapse}
.MJXp-display {display: block; text-align: center; margin: 1em 0}
.MJXp-math span {display: inline-block}
.MJXp-box {display: block!important; text-align: center}
.MJXp-box:after {content: " "}
.MJXp-rule {display: block!important; margin-top: .1em}
.MJXp-char {display: block!important}
.MJXp-mo {margin: 0 .15em}
.MJXp-mfrac {margin: 0 .125em; vertical-align: .25em}
.MJXp-denom {display: inline-table!important; width: 100%}
.MJXp-denom > * {display: table-row!important}
.MJXp-surd {vertical-align: top}
.MJXp-surd > * {display: block!important}
.MJXp-script-box > *  {display: table!important; height: 50%}
.MJXp-script-box > * > * {display: table-cell!important; vertical-align: top}
.MJXp-script-box > *:last-child > * {vertical-align: bottom}
.MJXp-script-box > * > * > * {display: block!important}
.MJXp-mphantom {visibility: hidden}
.MJXp-munderover {display: inline-table!important}
.MJXp-over {display: inline-block!important; text-align: center}
.MJXp-over > * {display: block!important}
.MJXp-munderover > * {display: table-row!important}
.MJXp-mtable {vertical-align: .25em; margin: 0 .125em}
.MJXp-mtable > * {display: inline-table!important; vertical-align: middle}
.MJXp-mtr {display: table-row!important}
.MJXp-mtd {display: table-cell!important; text-align: center; padding: .5em 0 0 .5em}
.MJXp-mtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-mlabeledtr {display: table-row!important}
.MJXp-mlabeledtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mlabeledtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MJXp-scale0 {-webkit-transform: scaleX(.0); -moz-transform: scaleX(.0); -ms-transform: scaleX(.0); -o-transform: scaleX(.0); transform: scaleX(.0)}
.MJXp-scale1 {-webkit-transform: scaleX(.1); -moz-transform: scaleX(.1); -ms-transform: scaleX(.1); -o-transform: scaleX(.1); transform: scaleX(.1)}
.MJXp-scale2 {-webkit-transform: scaleX(.2); -moz-transform: scaleX(.2); -ms-transform: scaleX(.2); -o-transform: scaleX(.2); transform: scaleX(.2)}
.MJXp-scale3 {-webkit-transform: scaleX(.3); -moz-transform: scaleX(.3); -ms-transform: scaleX(.3); -o-transform: scaleX(.3); transform: scaleX(.3)}
.MJXp-scale4 {-webkit-transform: scaleX(.4); -moz-transform: scaleX(.4); -ms-transform: scaleX(.4); -o-transform: scaleX(.4); transform: scaleX(.4)}
.MJXp-scale5 {-webkit-transform: scaleX(.5); -moz-transform: scaleX(.5); -ms-transform: scaleX(.5); -o-transform: scaleX(.5); transform: scaleX(.5)}
.MJXp-scale6 {-webkit-transform: scaleX(.6); -moz-transform: scaleX(.6); -ms-transform: scaleX(.6); -o-transform: scaleX(.6); transform: scaleX(.6)}
.MJXp-scale7 {-webkit-transform: scaleX(.7); -moz-transform: scaleX(.7); -ms-transform: scaleX(.7); -o-transform: scaleX(.7); transform: scaleX(.7)}
.MJXp-scale8 {-webkit-transform: scaleX(.8); -moz-transform: scaleX(.8); -ms-transform: scaleX(.8); -o-transform: scaleX(.8); transform: scaleX(.8)}
.MJXp-scale9 {-webkit-transform: scaleX(.9); -moz-transform: scaleX(.9); -ms-transform: scaleX(.9); -o-transform: scaleX(.9); transform: scaleX(.9)}
.MathJax_PHTML .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style></head><body style="overflow:auto;background:rgb(255, 255, 255);width:auto;height:auto;"><editor-container style="display:block;margin:auto;width:816px;"><math-type style="user-select:text;" class=" math-type-for-print "><math-edit-container><editarea class="root-editor" style="font-family: &quot;Computer Modern Sans&quot;, serif; font-size: 17px;"><area-baseline aria-hidden="true">a</area-baseline><area-container><line class="root text-mode align-center" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif; font-size: 1.73em; font-weight: bold;">Scalable Machine Learning with Apache Spark</block></blocks></line><line class="root text-mode align-center" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif; font-size: 1.2em; font-weight: bold;">(Training Note)</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="anchor-tag inline" style="font-family: &quot;Computer Modern Serif&quot;, serif; font-weight: bold;"><div data-id="n0.3295185310066928" class="anchor-tag-border no-border-on-print" id="n0.3295185310066928"><span>Table of Content</span></div></compositeblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="table-of-content inline"><toc-wrapper><editarea class="edit-area toc-ea no-area-container text-mode"><line class="text-mode toc-s1" style="line-height: 1.4; cursor: pointer;"><a href="#n0.32394602563310526" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.32394602563310526" style="display: inline-block; white-space: pre;">1. </span></compositeblock><block>Introductory Topics</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 568.008px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L568.0078125,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s2" style="line-height: 1.4; padding-left: 3em; cursor: pointer;"><a href="#n0.9875309350640267" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.9875309350640267" style="display: inline-block; white-space: pre;">1.1. </span></compositeblock><block>Spark Overview</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 548.914px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L548.9140625,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s3" style="line-height: 1.4; padding-left: 6em; cursor: pointer;"><a href="#n0.7679301753098555" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.7679301753098555" style="display: inline-block; white-space: pre;">1.1.1. </span></compositeblock><block>What's New in Spark 3.0?</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 408.305px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L408.3046875,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s2" style="line-height: 1.4; padding-left: 3em; cursor: pointer;"><a href="#n0.19640624819082064" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.19640624819082064" style="display: inline-block; white-space: pre;">1.2. </span></compositeblock><block>Delta Lake Overview</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 512.344px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L512.34375,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s3" style="line-height: 1.4; padding-left: 6em; cursor: pointer;"><a href="#n0.7915410359715356" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.7915410359715356" style="display: inline-block; white-space: pre;">1.2.1. </span></compositeblock><block>Why Delta Lake?</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 472.195px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L472.1953125,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s3" style="line-height: 1.4; padding-left: 6em; cursor: pointer;"><a href="#n0.5483799207410378" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.5483799207410378" style="display: inline-block; white-space: pre;">1.2.2. </span></compositeblock><block>Create and Query a Delta Table</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 367.492px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L367.4921875,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s3" style="line-height: 1.4; padding-left: 6em; cursor: pointer;"><a href="#n0.6053393077097358" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.6053393077097358" style="display: inline-block; white-space: pre;">1.2.3. </span></compositeblock><block>Understanding the Transaction Log</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 344.508px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L344.5078125,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s3" style="line-height: 1.4; padding-left: 6em; cursor: pointer;"><a href="#n0.6473984775981556" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.6473984775981556" style="display: inline-block; white-space: pre;">1.2.4. </span></compositeblock><block>Delta Time Travel</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 465.406px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L465.40625,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s3" style="line-height: 1.4; padding-left: 6em; cursor: pointer;"><a href="#n0.33027284560716663" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.33027284560716663" style="display: inline-block; white-space: pre;">1.2.5. </span></compositeblock><block>Cleanup Log Files</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 468.758px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L468.7578125,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s1" style="line-height: 1.4; cursor: pointer;"><a href="#n0.8846477497634795" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.8846477497634795" style="display: inline-block; white-space: pre;">2. </span></compositeblock><block>Data Cleansing</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 598.93px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L598.9296875,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s2" style="line-height: 1.4; padding-left: 3em; cursor: pointer;"><a href="#n0.9322585438794182" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.9322585438794182" style="display: inline-block; white-space: pre;">2.1. </span></compositeblock><block>Fixing Data Types</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 529.094px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L529.09375,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s2" style="line-height: 1.4; padding-left: 3em; cursor: pointer;"><a href="#n0.1961401916604102" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.1961401916604102" style="display: inline-block; white-space: pre;">2.2. </span></compositeblock><block>Summary Statistics</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 522.461px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L522.4609375,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s2" style="line-height: 1.4; padding-left: 3em; cursor: pointer;"><a href="#n0.09723349389069558" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.09723349389069558" style="display: inline-block; white-space: pre;">2.3. </span></compositeblock><block>Explore Data with Data Profile</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 438.547px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L438.546875,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s2" style="line-height: 1.4; padding-left: 3em; cursor: pointer;"><a href="#n0.06842844464381392" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.06842844464381392" style="display: inline-block; white-space: pre;">2.4. </span></compositeblock><block>Getting Rid of Extreme Values</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 442.234px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L442.234375,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s2" style="line-height: 1.4; padding-left: 3em; cursor: pointer;"><a href="#n0.6731058422357645" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.6731058422357645" style="display: inline-block; white-space: pre;">2.5. </span></compositeblock><block>Handling Null Values</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 509.984px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L509.984375,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s2" style="line-height: 1.4; padding-left: 3em; cursor: pointer;"><a href="#n0.13436957246799186" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.13436957246799186" style="display: inline-block; white-space: pre;">2.6. </span></compositeblock><block>Transformers and Estimators</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 455.5px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L455.5,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s1" style="line-height: 1.4; cursor: pointer;"><a href="#n0.6219727211720694" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.6219727211720694" style="display: inline-block; white-space: pre;">3. </span></compositeblock><block>Linear Regression</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 583.07px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L583.0703125,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s2" style="line-height: 1.4; padding-left: 3em; cursor: pointer;"><a href="#n0.20424649910908288" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.20424649910908288" style="display: inline-block; white-space: pre;">3.1. </span></compositeblock><block>Implementation - Predicting Rental Price</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 367.203px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L367.203125,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s3" style="line-height: 1.4; padding-left: 6em; cursor: pointer;"><a href="#n0.1343993664945069" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.1343993664945069" style="display: inline-block; white-space: pre;">3.1.1. </span></compositeblock><block>Vector Assembler</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 471.938px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L471.9375,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s2" style="line-height: 1.4; padding-left: 3em; cursor: pointer;"><a href="#n0.24644948505509645" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.24644948505509645" style="display: inline-block; white-space: pre;">3.2. </span></compositeblock><block>Improve the Model Performance</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 431.117px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L431.1171875,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s3" style="line-height: 1.4; padding-left: 6em; cursor: pointer;"><a href="#n0.39202210320737896" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.39202210320737896" style="display: inline-block; white-space: pre;">3.2.1. </span></compositeblock><block>Categorical Variables</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 447.117px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L447.1171875,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s1" style="line-height: 1.4; cursor: pointer;"><a href="#n0.16214072272500357" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.16214072272500357" style="display: inline-block; white-space: pre;">4. </span></compositeblock><block>MLflow</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 653.766px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L653.765625,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s2" style="line-height: 1.4; padding-left: 3em; cursor: pointer;"><a href="#n0.02344361203428158" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.02344361203428158" style="display: inline-block; white-space: pre;">4.1. </span></compositeblock><block>MLflow Tracking</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 539.547px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L539.546875,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s3" style="line-height: 1.4; padding-left: 6em; cursor: pointer;"><a href="#n0.25874653523012436" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.25874653523012436" style="display: inline-block; white-space: pre;">4.1.1. </span></compositeblock><block>Querying Past Runs Programmatically</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 323.375px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L323.375,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s3" style="line-height: 1.4; padding-left: 6em; cursor: pointer;"><a href="#n0.9652764508646992" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.9652764508646992" style="display: inline-block; white-space: pre;">4.1.2. </span></compositeblock><block>View Past Runs Using MLflow UI</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 357.234px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L357.234375,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s2" style="line-height: 1.4; padding-left: 3em; cursor: pointer;"><a href="#n0.5258652318920827" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.5258652318920827" style="display: inline-block; white-space: pre;">4.2. </span></compositeblock><block>MLflow Model Registry</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 493.578px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L493.578125,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s3" style="line-height: 1.4; padding-left: 6em; cursor: pointer;"><a href="#n0.4947416407927985" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.4947416407927985" style="display: inline-block; white-space: pre;">4.2.1. </span></compositeblock><block>Registering a Model</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 452.961px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L452.9609375,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s3" style="line-height: 1.4; padding-left: 6em; cursor: pointer;"><a href="#n0.6582749301500999" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.6582749301500999" style="display: inline-block; white-space: pre;">4.2.2. </span></compositeblock><block>Deploying a Model</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 461.531px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L461.53125,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s3" style="line-height: 1.4; padding-left: 6em; cursor: pointer;"><a href="#n0.7004408749430593" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.7004408749430593" style="display: inline-block; white-space: pre;">4.2.3. </span></compositeblock><block>Deploying a New Model Version</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 366.93px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L366.9296875,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s1" style="line-height: 1.4; cursor: pointer;"><a href="#n0.8606550370686419" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.8606550370686419" style="display: inline-block; white-space: pre;">5. </span></compositeblock><block>Non-linear Models</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 577.234px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L577.234375,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s2" style="line-height: 1.4; padding-left: 3em; cursor: pointer;"><a href="#n0.06710605972204298" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.06710605972204298" style="display: inline-block; white-space: pre;">5.1. </span></compositeblock><block>Decision Trees</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 556.852px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L556.8515625,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s3" style="line-height: 1.4; padding-left: 6em; cursor: pointer;"><a href="#n0.7265001738807313" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.7265001738807313" style="display: inline-block; white-space: pre;">5.1.1. </span></compositeblock><block>How to Handle Categorical Features?</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 330.211px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L330.2109375,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s3" style="line-height: 1.4; padding-left: 6em; cursor: pointer;"><a href="#n0.050971711797828334" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.050971711797828334" style="display: inline-block; white-space: pre;">5.1.2. </span></compositeblock><block>maxBins</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 534.953px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L534.953125,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s3" style="line-height: 1.4; padding-left: 6em; cursor: pointer;"><a href="#n0.24010656036608014" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.24010656036608014" style="display: inline-block; white-space: pre;">5.1.3. </span></compositeblock><block>Feature Importance</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 456.789px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L456.7890625,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s3" style="line-height: 1.4; padding-left: 6em; cursor: pointer;"><a href="#n0.42322203690377225" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.42322203690377225" style="display: inline-block; white-space: pre;">5.1.4. </span></compositeblock><block>Scale Invariant</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 490.742px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L490.7421875,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s3" style="line-height: 1.4; padding-left: 6em; cursor: pointer;"><a href="#n0.3886454780939601" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.3886454780939601" style="display: inline-block; white-space: pre;">5.1.5. </span></compositeblock><block>Prediction</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 523.039px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L523.0390625,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s3" style="line-height: 1.4; padding-left: 6em; cursor: pointer;"><a href="#n0.5406297241081" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.5406297241081" style="display: inline-block; white-space: pre;">5.1.6. </span></compositeblock><block>Pitfall</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 552.617px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L552.6171875,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s2" style="line-height: 1.4; padding-left: 3em; cursor: pointer;"><a href="#n0.8681313485843198" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.8681313485843198" style="display: inline-block; white-space: pre;">5.2. </span></compositeblock><block>Random Forests and Hyperparameter Tuning</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 339.969px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L339.96875,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s3" style="line-height: 1.4; padding-left: 6em; cursor: pointer;"><a href="#n0.7379932207959412" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.7379932207959412" style="display: inline-block; white-space: pre;">5.2.1. </span></compositeblock><block>ParamGrid</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 519.602px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L519.6015625,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s3" style="line-height: 1.4; padding-left: 6em; cursor: pointer;"><a href="#n0.9782031911049784" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.9782031911049784" style="display: inline-block; white-space: pre;">5.2.2. </span></compositeblock><block>Cross Validation</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 479.703px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L479.703125,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s1" style="line-height: 1.4; cursor: pointer;"><a href="#n0.5499876245011357" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.5499876245011357" style="display: inline-block; white-space: pre;">6. </span></compositeblock><block>Hyperopt</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 640.68px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L640.6796875,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s2" style="line-height: 1.4; padding-left: 3em; cursor: pointer;"><a href="#n0.37270013453753537" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.37270013453753537" style="display: inline-block; white-space: pre;">6.1. </span></compositeblock><block>Define Objective Function</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 474.453px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L474.453125,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s2" style="line-height: 1.4; padding-left: 3em; cursor: pointer;"><a href="#n0.8023239447206147" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.8023239447206147" style="display: inline-block; white-space: pre;">6.2. </span></compositeblock><block>Define Search Space</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 514.484px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L514.484375,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s1" style="line-height: 1.4; cursor: pointer;"><a href="#n0.8812980031176083" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.8812980031176083" style="display: inline-block; white-space: pre;">7. </span></compositeblock><block>AutoML</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 647.75px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L647.75,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s2" style="line-height: 1.4; padding-left: 3em; cursor: pointer;"><a href="#n0.8258081530904544" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.8258081530904544" style="display: inline-block; white-space: pre;">7.1. </span></compositeblock><block>Implementation</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 549.133px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L549.1328125,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s3" style="line-height: 1.4; padding-left: 6em; cursor: pointer;"><a href="#n0.49806182713381264" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.49806182713381264" style="display: inline-block; white-space: pre;">7.1.1. </span></compositeblock><block>Use the Best Model for Inference</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 360.328px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L360.328125,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s2" style="line-height: 1.4; padding-left: 3em; cursor: pointer;"><a href="#n0.16392541670988847" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.16392541670988847" style="display: inline-block; white-space: pre;">7.2. </span></compositeblock><block>AutoML UI</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 578.461px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L578.4609375,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s1" style="line-height: 1.4; cursor: pointer;"><a href="#n0.6174527870243469" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.6174527870243469" style="display: inline-block; white-space: pre;">8. </span></compositeblock><block>Feature Store</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 610.797px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L610.796875,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s2" style="line-height: 1.4; padding-left: 3em; cursor: pointer;"><a href="#n0.1595811249540351" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.1595811249540351" style="display: inline-block; white-space: pre;">8.1. </span></compositeblock><block>Create a Feature Table</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 496.266px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L496.265625,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s2" style="line-height: 1.4; padding-left: 3em; cursor: pointer;"><a href="#n0.7469505054988943" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.7469505054988943" style="display: inline-block; white-space: pre;">8.2. </span></compositeblock><block>Feature Table UI</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 539.75px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L539.75,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s2" style="line-height: 1.4; padding-left: 3em; cursor: pointer;"><a href="#n0.9482869717199411" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.9482869717199411" style="display: inline-block; white-space: pre;">8.3. </span></compositeblock><block>Train a Model with Feature Store</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 420.938px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L420.9375,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s2" style="line-height: 1.4; padding-left: 3em; cursor: pointer;"><a href="#n0.7569051069523867" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.7569051069523867" style="display: inline-block; white-space: pre;">8.4. </span></compositeblock><block>Feature Score Batch Scoring</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 456.688px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L456.6875,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s2" style="line-height: 1.4; padding-left: 3em; cursor: pointer;"><a href="#n0.9938986595418651" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.9938986595418651" style="display: inline-block; white-space: pre;">8.5. </span></compositeblock><block>Overwrite Feature Table</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 487.273px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L487.2734375,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s2" style="line-height: 1.4; padding-left: 3em; cursor: pointer;"><a href="#n0.8630205650666423" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.8630205650666423" style="display: inline-block; white-space: pre;">8.6. </span></compositeblock><block>Retrain a New Model with New Features</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 368.812px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L368.8125,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s1" style="line-height: 1.4; cursor: pointer;"><a href="#n0.2938160235336882" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.2938160235336882" style="display: inline-block; white-space: pre;">9. </span></compositeblock><block>XGBoost</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 642.938px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L642.9375,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s1" style="line-height: 1.4; cursor: pointer;"><a href="#n0.32622856639062836" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.32622856639062836" style="display: inline-block; white-space: pre;">10. </span></compositeblock><block>Inference with Pandas UDFs</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 496.57px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L496.5703125,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s2" style="line-height: 1.4; padding-left: 3em; cursor: pointer;"><a href="#n0.9064685869917974" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.9064685869917974" style="display: inline-block; white-space: pre;">10.1. </span></compositeblock><block>Pandas/Vectorized UDFs</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 472.531px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L472.53125,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s2" style="line-height: 1.4; padding-left: 3em; cursor: pointer;"><a href="#n0.49891190197894164" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.49891190197894164" style="display: inline-block; white-space: pre;">10.2. </span></compositeblock><block>Pandas Scalar Iterator UDF</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 454.406px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L454.40625,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s2" style="line-height: 1.4; padding-left: 3em; cursor: pointer;"><a href="#n0.7147469101865547" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.7147469101865547" style="display: inline-block; white-space: pre;">10.3. </span></compositeblock><block>Pandas Function API</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 500.023px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L500.0234375,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s1" style="line-height: 1.4; cursor: pointer;"><a href="#n0.29592542497501384" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.29592542497501384" style="display: inline-block; white-space: pre;">11. </span></compositeblock><block>Training with Pandas Function API</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 447px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L447,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s2" style="line-height: 1.4; padding-left: 3em; cursor: pointer;"><a href="#n0.6101866036306911" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.6101866036306911" style="display: inline-block; white-space: pre;">11.1. </span></compositeblock><block>Define a Pandas Function</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 467.859px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L467.859375,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s2" style="line-height: 1.4; padding-left: 3em; cursor: pointer;"><a href="#n0.4607309788794005" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.4607309788794005" style="display: inline-block; white-space: pre;">11.2. </span></compositeblock><block>Apply the Pandas Function</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 458px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L458,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s2" style="line-height: 1.4; padding-left: 3em; cursor: pointer;"><a href="#n0.3419847298048786" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.3419847298048786" style="display: inline-block; white-space: pre;">11.3. </span></compositeblock><block>Serving Multiple Models from a Registered Model</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 296.992px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L296.9921875,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s1" style="line-height: 1.4; cursor: pointer;"><a href="#n0.12932700338377678" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.12932700338377678" style="display: inline-block; white-space: pre;">12. </span></compositeblock><block>Pandas API on Spark</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 546.078px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L546.078125,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s2" style="line-height: 1.4; padding-left: 3em; cursor: pointer;"><a href="#n0.1503399325895336" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.1503399325895336" style="display: inline-block; white-space: pre;">12.1. </span></compositeblock><block>InternalFrame</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 552.633px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L552.6328125,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s2" style="line-height: 1.4; padding-left: 3em; cursor: pointer;"><a href="#n0.8935380965465236" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.8935380965465236" style="display: inline-block; white-space: pre;">12.2. </span></compositeblock><block>Implementation</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 540.633px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L540.6328125,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s3" style="line-height: 1.4; padding-left: 6em; cursor: pointer;"><a href="#n0.626673019207862" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.626673019207862" style="display: inline-block; white-space: pre;">12.2.1. </span></compositeblock><block>Read in the Dataset</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 443.938px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L443.9375,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s3" style="line-height: 1.4; padding-left: 6em; cursor: pointer;"><a href="#n0.5477364769986266" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.5477364769986266" style="display: inline-block; white-space: pre;">12.2.2. </span></compositeblock><block>Define Index Type</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 457.57px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L457.5703125,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s3" style="line-height: 1.4; padding-left: 6em; cursor: pointer;"><a href="#n0.1647361214812031" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.1647361214812031" style="display: inline-block; white-space: pre;">12.2.3. </span></compositeblock><block>Converting to Pandas API on Spark</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 331.82px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L331.8203125,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s3" style="line-height: 1.4; padding-left: 6em; cursor: pointer;"><a href="#n0.734074228269088" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.734074228269088" style="display: inline-block; white-space: pre;">12.2.4. </span></compositeblock><block>Value Counts</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 491.977px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L491.9765625,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s2" style="line-height: 1.4; padding-left: 3em; cursor: pointer;"><a href="#n0.47869481636335265" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.47869481636335265" style="display: inline-block; white-space: pre;">12.3. </span></compositeblock><block>Visualization</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 560.844px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L560.84375,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s2" style="line-height: 1.4; padding-left: 3em; cursor: pointer;"><a href="#n0.5017897271583482" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.5017897271583482" style="display: inline-block; white-space: pre;">12.4. </span></compositeblock><block>SQL on pandas API on Spark DataFrames</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 349.555px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L349.5546875,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s2" style="line-height: 1.4; padding-left: 3em; cursor: pointer;"><a href="#n0.31813733043989934" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.31813733043989934" style="display: inline-block; white-space: pre;">12.5. </span></compositeblock><block>Interesting Facts</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 533.102px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L533.1015625,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s1" style="line-height: 1.4; cursor: pointer;"><a href="#n0.6021845524409584" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.6021845524409584" style="display: inline-block; white-space: pre;">13. </span></compositeblock><block>Extras</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 653.5px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L653.5,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s2" style="line-height: 1.4; padding-left: 3em; cursor: pointer;"><a href="#n0.7677651259876315" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.7677651259876315" style="display: inline-block; white-space: pre;">13.1. </span></compositeblock><block>MLlib Deployment Options</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 458.742px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L458.7421875,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s2" style="line-height: 1.4; padding-left: 3em; cursor: pointer;"><a href="#n0.36613668523710596" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.36613668523710596" style="display: inline-block; white-space: pre;">13.2. </span></compositeblock><block>Bamboolib</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 574.227px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L574.2265625,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s2" style="line-height: 1.4; padding-left: 3em; cursor: pointer;"><a href="#n0.08821809163448902" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.08821809163448902" style="display: inline-block; white-space: pre;">13.3. </span></compositeblock><block>Logistic Regression Lab</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 484.094px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L484.09375,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s2" style="line-height: 1.4; padding-left: 3em; cursor: pointer;"><a href="#n0.027357693111814463" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.027357693111814463" style="display: inline-block; white-space: pre;">13.4. </span></compositeblock><block>Databricks Best Practices</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 468.539px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L468.5390625,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line><line class="text-mode toc-s2" style="line-height: 1.4; padding-left: 3em; cursor: pointer;"><a href="#n0.7245649733940489" style="color: inherit; text-decoration: inherit;"><prefix style="cursor: pointer;"></prefix><blocks style="cursor: pointer;"><baselineblock class="inline"></baselineblock><compositeblock class="prefix-block inline"><span data-line-id="n0.7245649733940489" style="display: inline-block; white-space: pre;">13.5. </span></compositeblock><block>K-Means Clustering</block><compositeblock dir="ltr" class="toc-underline-placeholder-symbol inline" style="width: 20px; overflow: visible;"><svg data-reactroot="" style="width: 510.797px; height: 5px; overflow: visible; display: inline-block;"><path d="M 5,5 L510.796875,5" stroke-dasharray="1 2" fill="none"></path></svg></compositeblock><compositeblock dir="ltr" class="toc-page-number-symbol inline"><span> </span></compositeblock></blocks></a></line></editarea></toc-wrapper></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="inline" style="display: block;"><div style="vertical-align: baseline;"><div style="display: inline-block; height: 0px; border-bottom: 1px solid; width: 100%;"></div></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode section sindent-0" data-line-id="n0.32394602563310526" style="font-size: 1.2em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.32394602563310526" role="heading" aria-level="1"><prefix style="text-align: left; padding-right: 0.5em;">1. </prefix><blocks><baselineblock class="inline"></baselineblock><block>Introductory Topics</block></blocks></line><line class="root text-mode section sindent-1" data-line-id="n0.9875309350640267" style="font-size: 1.1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.9875309350640267" role="heading" aria-level="2"><prefix style="text-align: left; padding-right: 0.25em;">1.1. </prefix><blocks><baselineblock class="inline"></baselineblock><block>Spark Overview</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Apache Spark is founded as a research prooject at UC Berkeley in 2009.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>It's an open-source unified data analytics engine for big data.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>It has built-in APIs in SQL, Python, Scala, R, and Java.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Spark is a lazy-evaluation engine, i.e., it would only execute if some particular </block><block style="font-weight: bold; font-style: italic;">actions</block><block> are called, e.g., </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(79, 167, 176);"> </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(79, 167, 176); background-color: rgba(155, 155, 155, 0.2);">.count()</block><block>, </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(79, 167, 176); background-color: rgba(155, 155, 155, 0.2);">.show()</block><block>, etc.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>It's a distributed computing engine. A </block><block style="font-weight: bold; color: rgb(255, 64, 0);">Spark Cluster</block><block> is composed of a </block><block style="font-weight: bold; color: rgb(255, 64, 0);">Driver</block><block> node and a bunch of </block><block style="font-weight: bold; color: rgb(255, 64, 0);">Worker</block><block> nodes.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 685px; height: 438.63px; position: relative;"><img src="image-resources/5d653ebd-bca3-450a-ab59-89d5613904a7.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 695.25px; height: 305.56px; position: relative;"><img src="image-resources/16c48333-de1f-4b8a-b395-f62fe6edd8f6.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 700.5px; height: 367.15px; position: relative;"><img src="image-resources/f24c6ba1-87a7-4416-b154-83fd1cd1d42b.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div data-caption-block-id="n0.02795667360577414" class="role-image-caption-container role-caption-container" style="display: flex; align-items: center; justify-content: center; margin-top: 10px;" id="n0.02795667360577414"><span class="no-print-outline" style="outline: none; position: relative; text-align: center;"><span class="role-image-caption-prefix" style="padding-right: 0.3em; font-weight: bold;"><span class="role-image-caption-name">Figure</span><span class="role-image-caption-number"><!-- react-text: 25621 --> <!-- /react-text --><!-- react-text: 25622 -->1<!-- /react-text --></span><span>:</span></span><editarea class="image-caption text-mode" style="min-width: 50px; display: inline;"><line class="text-mode align-center" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><block>More on this </block><block class="role-hyper-link" data-hyper-link-url="https://www.databricks.com/blog/2016/07/14/a-tale-of-three-apache-spark-apis-rdds-dataframes-and-datasets.html" style="text-decoration: underline; color: rgb(17, 85, 204);"><a href="https://www.databricks.com/blog/2016/07/14/a-tale-of-three-apache-spark-apis-rdds-dataframes-and-datasets.html" target="_blank" style="color: inherit; text-decoration: inherit;">here</a></block></blocks></line></editarea></span></div></compositeblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 708px; height: 341.09px; position: relative;"><img src="image-resources/cbfe6b95-6e5f-46aa-ad1f-11eb90a854df.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 711.5px; height: 274.35px; position: relative;"><img src="image-resources/e4e3e33e-54ab-45db-bb7b-7e9b7f473563.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 716.5px; height: 334.69px; position: relative;"><img src="image-resources/6a751c69-ab3e-44d1-88e7-6f7abdd709a8.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold;">How can I access a DataFrame in SQL?</block><block>  </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(74, 74, 74);">df.</block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(169, 142, 14);">createOrReplaceTempView</block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(63, 131, 219);">(</block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(231, 55, 61);">"df_temp"</block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(63, 131, 219);">)</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold;">For repeated access</block><block>  </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(74, 74, 74);">df.</block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(169, 142, 14);">cache</block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(63, 131, 219);">()</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold;">Get the number of partitions</block><block>  </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(74, 74, 74);">df.rdd.</block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(169, 142, 14);">getNumPartitions</block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(63, 131, 219);">()</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; background-color: rgb(255, 254, 0);">Note:</block><block> When you pull data back to driver (e.g., call </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(169, 142, 14);">.collect</block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(63, 131, 219);">()</block><block>, </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(169, 142, 14);">.toPandas</block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(63, 131, 219);">()</block><block>, etc.), you'll need to be careful of how much data you're bringing back. Otherwise, you might get OOM exceptions.</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>A </block><block style="text-decoration: underline;">best practice</block><block> is explicitly limit the number of records, unless you know your data set is small, before called </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(169, 142, 14);">.collect</block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(63, 131, 219);">() </block><block>or </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(169, 142, 14);">.toPandas</block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(63, 131, 219);">()</block><block>.</block></blocks></line><line class="root text-mode indent-2 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="3"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;">* </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(74, 74, 74);">df.</block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(169, 142, 14);">limit</block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(63, 131, 219);">(</block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(78, 166, 78);">10</block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(63, 131, 219);">)</block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(169, 142, 14);">.toPandas</block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(63, 131, 219);">()</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">[</block><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><compositeblock dir="ltr" class="anchor-tag-ref inline" style="font-family: &quot;Computer Modern Serif&quot;, serif;"><a href="#n0.3295185310066928" style="color: inherit; text-decoration: inherit;">Back To Top</a></compositeblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">]</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode section sindent-2" data-line-id="n0.7679301753098555" style="font-size: 1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.7679301753098555" role="heading" aria-level="3"><prefix style="text-align: left; padding-right: 0em;">1.1.1. </prefix><blocks><baselineblock class="inline"></baselineblock><block>What's New in Spark 3.0?</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Video: </block><block class="role-hyper-link" data-hyper-link-url="https://www.youtube.com/watch?v=l6SuXvhorDY&amp;feature=emb_logo" style="text-decoration: underline; color: rgb(17, 85, 204);"><a href="https://www.youtube.com/watch?v=l6SuXvhorDY&amp;feature=emb_logo" target="_blank" style="color: inherit; text-decoration: inherit;">Deep Dive into the New Features of Apache Spark 3.0</a></block><block>.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block class="role-hyper-link" data-hyper-link-url="https://spark.apache.org/docs/3.5.0/" style="text-decoration: underline; color: rgb(17, 85, 204);"><a href="https://spark.apache.org/docs/3.5.0/" target="_blank" style="color: inherit; text-decoration: inherit;">Spark 3.5. documentation</a></block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="color: rgb(255, 64, 0); font-weight: bold; flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block class="role-hyper-link" data-hyper-link-url="https://www.youtube.com/watch?v=jzrEc4r90N8&amp;feature=emb_logo" style="text-decoration: underline; font-weight: bold; color: rgb(255, 64, 0);"><a href="https://www.youtube.com/watch?v=jzrEc4r90N8&amp;feature=emb_logo" target="_blank" style="color: inherit; text-decoration: inherit;">Adaptive Query Execution</a></block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Dynamic query optimization that happens in the middle of your query based on runtime statistics.</block></blocks></line><line class="root text-mode indent-2 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="3"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;">* </prefix><blocks><baselineblock class="inline"></baselineblock><block>Dynamically coalesce shuffle partitions</block></blocks></line><line class="root text-mode indent-2 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="3"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;">* </prefix><blocks><baselineblock class="inline"></baselineblock><block>Dynamically switch join strategies</block></blocks></line><line class="root text-mode indent-2 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="3"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;">* </prefix><blocks><baselineblock class="inline"></baselineblock><block>Dynamically optimize skew joins</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Enable it with: </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(79, 167, 176); background-color: rgba(155, 155, 155, 0.2);">spark.sql.adaptive.enabled=true</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="color: rgb(255, 64, 0); font-weight: bold; flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; color: rgb(255, 64, 0);">Dynamic Partition Pruning (DPP)</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Avoid partition scanning based on the query results of the other query fragments</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="color: rgb(255, 64, 0); font-weight: bold; flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; color: rgb(255, 64, 0);">Join Hints</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="color: rgb(255, 64, 0); font-weight: bold; flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block class="role-hyper-link" data-hyper-link-url="https://www.youtube.com/watch?v=UZl0pHG-2HA&amp;feature=emb_logo" style="text-decoration: underline; font-weight: bold; color: rgb(255, 64, 0);"><a href="https://www.youtube.com/watch?v=UZl0pHG-2HA&amp;feature=emb_logo" target="_blank" style="color: inherit; text-decoration: inherit;">Improved Pandas UDFs</a></block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Type Hints</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Iterators</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Pandas Function API (mapInPandas, applyInPandas, etc)</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>And many more! See the </block><block class="role-hyper-link" data-hyper-link-url="https://spark.apache.org/docs/3.0.0-preview/migration-guide.html" style="text-decoration: underline; color: rgb(17, 85, 204);"><a href="https://spark.apache.org/docs/3.0.0-preview/migration-guide.html" target="_blank" style="color: inherit; text-decoration: inherit;">migration guide</a></block><block> and resources linked above.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">[</block><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><compositeblock dir="ltr" class="anchor-tag-ref inline" style="font-family: &quot;Computer Modern Serif&quot;, serif;"><a href="#n0.3295185310066928" style="color: inherit; text-decoration: inherit;">Back To Top</a></compositeblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">]</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode section sindent-1" data-line-id="n0.19640624819082064" style="font-size: 1.1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.19640624819082064" role="heading" aria-level="2"><prefix style="text-align: left; padding-right: 0.25em;">1.2. </prefix><blocks><baselineblock class="inline"></baselineblock><block>Delta Lake Overview</block></blocks></line><line class="root text-mode section sindent-2" data-line-id="n0.7915410359715356" style="font-size: 1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.7915410359715356" role="heading" aria-level="3"><prefix style="text-align: left; padding-right: 0em;">1.2.1. </prefix><blocks><baselineblock class="inline"></baselineblock><block>Why Delta Lake?</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>At a glance, </block><block style="font-weight: bold;">Delta Lake</block><block> is an </block><block style="text-decoration: underline;">open-source storage layer</block><block> that brings both </block><block style="text-decoration: underline;">reliability</block><block> and </block><block style="text-decoration: underline;">performance</block><block> to data lakes. </block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold;">Delta Lake</block><block> provides: </block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="color: rgb(0, 0, 0); font-weight: bold; flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; color: rgb(255, 64, 0);">ACID transactions, </block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="color: rgb(0, 0, 0); font-weight: bold; flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; color: rgb(255, 64, 0);">Scalable metadata handling</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="color: rgb(0, 0, 0); font-weight: bold; flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; color: rgb(255, 64, 0);">Unifies streaming and batch data processing</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold;">Delta Lake</block><block> </block><block style="text-decoration: underline;">runs on top of your existing data lake</block><block> and is fully compatible with Apache Spark APIs. More information </block><block class="role-hyper-link" data-hyper-link-url="https://docs.databricks.com/delta/delta-intro.html" style="text-decoration: underline; color: rgb(17, 85, 204);"><a href="https://docs.databricks.com/delta/delta-intro.html" target="_blank" style="color: inherit; text-decoration: inherit;">here</a></block><block>.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 684.392px; height: 319.64px; position: relative;"><img src="image-resources/4980bc59-6606-436d-911c-0b114b7e5369.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 550.4px; height: 304.84px; position: relative;"><img src="image-resources/5d60d758-4968-4a56-afa2-dc0224cf6e5e.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode section sindent-2" data-line-id="n0.5483799207410378" style="font-size: 1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.5483799207410378" role="heading" aria-level="3"><prefix style="text-align: left; padding-right: 0em;">1.2.2. </prefix><blocks><baselineblock class="inline"></baselineblock><block>Create and Query a Delta Table</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># First, read the dataset as a Spark DataFrame</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">file_path </block><block class="operator token">=</block><block class=" token"> </block><block class="string-interpolation string token">f"</block><block class="string-interpolation interpolation punctuation token">{</block><block class="string-interpolation interpolation token">DA</block><block class="string-interpolation interpolation punctuation token">.</block><block class="string-interpolation interpolation token">paths</block><block class="string-interpolation interpolation punctuation token">.</block><block class="string-interpolation interpolation token">datasets</block><block class="string-interpolation interpolation punctuation token">}</block><block class="string-interpolation string token">/airbnb/sf-listings/sf-listings-2019-03-06-clean.parquet/"</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">airbnb_df </block><block class="operator token">=</block><block class=" token"> spark</block><block class="punctuation token">.</block><block class=" token">read</block><block class="punctuation token">.</block><block class="builtin token">format</block><block class="punctuation token">(</block><block class="string token">"parquet"</block><block class="punctuation token">)</block><block class="punctuation token">.</block><block class=" token">load</block><block class="punctuation token">(</block><block class=" token">file_path</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Converting Spark DataFrame to Delta Table</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">dbutils</block><block class="punctuation token">.</block><block class=" token">fs</block><block class="punctuation token">.</block><block class=" token">rm</block><block class="punctuation token">(</block><block class=" token">DA</block><block class="punctuation token">.</block><block class=" token">paths</block><block class="punctuation token">.</block><block class=" token">working_dir</block><block class="punctuation token">,</block><block class=" token"> </block><block class="boolean token">True</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">airbnb_df</block><block class="punctuation token">.</block><block class=" token">write</block><block class="punctuation token">.</block><block class="builtin token">format</block><block class="punctuation token">(</block><block class="string token">"delta"</block><block class="punctuation token">)</block><block class="punctuation token">.</block><block class=" token">mode</block><block class="punctuation token">(</block><block class="string token">"overwrite"</block><block class="punctuation token">)</block><block class="punctuation token">.</block><block class=" token">save</block><block class="punctuation token">(</block><block class=" token">DA</block><block class="punctuation token">.</block><block class=" token">paths</block><block class="punctuation token">.</block><block class=" token">working_dir</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># A Delta directory can also be registered as a table in the metastore.</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">spark</block><block class="punctuation token">.</block><block class=" token">sql</block><block class="punctuation token">(</block><block class="string-interpolation string token">f"CREATE DATABASE IF NOT EXISTS </block><block class="string-interpolation interpolation punctuation token">{</block><block class="string-interpolation interpolation token">DA</block><block class="string-interpolation interpolation punctuation token">.</block><block class="string-interpolation interpolation token">schema_name</block><block class="string-interpolation interpolation punctuation token">}</block><block class="string-interpolation string token">"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">spark</block><block class="punctuation token">.</block><block class=" token">sql</block><block class="punctuation token">(</block><block class="string-interpolation string token">f"USE </block><block class="string-interpolation interpolation punctuation token">{</block><block class="string-interpolation interpolation token">DA</block><block class="string-interpolation interpolation punctuation token">.</block><block class="string-interpolation interpolation token">schema_name</block><block class="string-interpolation interpolation punctuation token">}</block><block class="string-interpolation string token">"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">airbnb_df</block><block class="punctuation token">.</block><block class=" token">write</block><block class="punctuation token">.</block><block class="builtin token">format</block><block class="punctuation token">(</block><block class="string token">"delta"</block><block class="punctuation token">)</block><block class="punctuation token">.</block><block class=" token">mode</block><block class="punctuation token">(</block><block class="string token">"overwrite"</block><block class="punctuation token">)</block><block class="punctuation token">.</block><block class=" token">saveAsTable</block><block class="punctuation token">(</block><block class="string token">"delta_review"</block><block class="punctuation token">)</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; background-color: rgb(255, 254, 0);">Delta supports partitioning.</block><block> </block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Partitioning puts data with the same value for the partitioned column </block><block style="text-decoration: underline;">into its own directory</block><block>.</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Operations with a filter on the partitioned column will only read directories that match the filter. </block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>This optimization is called </block><block style="font-weight: bold; color: rgb(255, 64, 0);">partition pruning</block><block>. </block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="text-decoration: underline;">Choose partition columns based in the patterns in your data.</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="punctuation token">(</block><block class=" token">airbnb_df</block><block class="punctuation token">.</block><block class=" token">write</block><block class="punctuation token">.</block><block class="builtin token">format</block><block class="punctuation token">(</block><block class="string token">"delta"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">          </block><block class="punctuation token">.</block><block class=" token">mode</block><block class="punctuation token">(</block><block class="string token">"overwrite"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">          </block><block class="punctuation token">.</block><block class=" token">partitionBy</block><block class="punctuation token">(</block><block class="string token">"neighbourhood_cleansed"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">          </block><block class="punctuation token">.</block><block class=" token">option</block><block class="punctuation token">(</block><block class="string token">"overwriteSchema"</block><block class="punctuation token">,</block><block class=" token"> </block><block class="string token">"true"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">          </block><block class="punctuation token">.</block><block class=" token">save</block><block class="punctuation token">(</block><block class=" token">DA</block><block class="punctuation token">.</block><block class=" token">paths</block><block class="punctuation token">.</block><block class=" token">working_dir</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="punctuation token">)</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode section sindent-2" data-line-id="n0.6053393077097358" style="font-size: 1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.6053393077097358" role="heading" aria-level="3"><prefix style="text-align: left; padding-right: 0em;">1.2.3. </prefix><blocks><baselineblock class="inline"></baselineblock><block>Understanding the Transaction Log</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>The </block><block style="font-weight: bold; color: rgb(255, 64, 0);">transaction log</block><block> is key to understanding </block><block class="role-hyper-link" data-hyper-link-url="https://www.databricks.com/resources/ebook/delta-lake-running-oreilly?itm_data=unpackingtransaction-blog-oreillyupandrunning" style="text-decoration: underline; color: rgb(17, 85, 204);"><a href="https://www.databricks.com/resources/ebook/delta-lake-running-oreilly?itm_data=unpackingtransaction-blog-oreillyupandrunning" target="_blank" style="color: inherit; text-decoration: inherit;">Delta Lake</a></block><block> because it is the common thread that runs through many of its most important features, including ACID transactions, scalable metadata handling, time travel, and more.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>The </block><block style="font-weight: bold; color: rgb(255, 64, 0);">Delta Lake transaction log</block><block> (also known as the </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(79, 167, 176); background-color: rgba(155, 155, 155, 0.2);">DeltaLog</block><block>) is an </block><block style="text-decoration: underline;">ordered record of every transaction that has ever been performed on a Delta Lake table since its inception</block><block>.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="font-weight: bold; flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold;">What Is the Transaction Log Used For?</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="font-weight: bold; flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Single source of truth</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="font-weight: bold; flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>The implementation of atomicity on Delta Lake</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="font-weight: bold; flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>To learn more about the inner workings of transaction logs  </block><block class="role-hyper-link" data-hyper-link-url="https://www.databricks.com/blog/2019/08/21/diving-into-delta-lake-unpacking-the-transaction-log.html" style="text-decoration: underline; color: rgb(17, 85, 204);"><a href="https://www.databricks.com/blog/2019/08/21/diving-into-delta-lake-unpacking-the-transaction-log.html" target="_blank" style="color: inherit; text-decoration: inherit;">see this page</a></block><block>.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 440px; height: 242px; position: relative;"><img src="image-resources/1f95af50-5325-4b87-a228-f10d32dba500.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>When a user creates a Delta Lake table, that tables </block><block style="font-style: italic;">transaction log</block><block> is </block><block style="text-decoration: underline;">automatically created</block><block> in the </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(79, 167, 176); background-color: rgba(155, 155, 155, 0.2);">_delta_log</block><block> subdirectory. </block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>As s/he makes changes to that table, those changes are recorded as ordered, atomic commits in the transaction log. </block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Each commit is written out as a JSON file, starting with </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(74, 74, 74); background-color: rgba(155, 155, 155, 0.2);">000000.json</block><block>. </block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Additional changes to the table generate more JSON files.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">display</block><block class="punctuation token">(</block><block class=" token">dbutils</block><block class="punctuation token">.</block><block class=" token">fs</block><block class="punctuation token">.</block><block class=" token">ls</block><block class="punctuation token">(</block><block class=" token">DA</block><block class="punctuation token">.</block><block class=" token">paths</block><block class="punctuation token">.</block><block class=" token">working_dir</block><block class="punctuation token">)</block><block class="punctuation token">)</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 727.595px; height: 212.6px; position: relative;"><img src="image-resources/0096262b-e8bc-4579-ae8d-5c5000ebe526.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">display</block><block class="punctuation token">(</block><block class=" token">dbutils</block><block class="punctuation token">.</block><block class=" token">fs</block><block class="punctuation token">.</block><block class=" token">ls</block><block class="punctuation token">(</block><block class="string-interpolation string token">f"</block><block class="string-interpolation interpolation punctuation token">{</block><block class="string-interpolation interpolation token">DA</block><block class="string-interpolation interpolation punctuation token">.</block><block class="string-interpolation interpolation token">paths</block><block class="string-interpolation interpolation punctuation token">.</block><block class="string-interpolation interpolation token">working_dir</block><block class="string-interpolation interpolation punctuation token">}</block><block class="string-interpolation string token">/_delta_log/"</block><block class="punctuation token">)</block><block class="punctuation token">)</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 724.992px; height: 243.93px; position: relative;"><img src="image-resources/3c756661-1c4b-4828-ba63-84b278a60e94.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>The </block><block class="role-hyper-link" data-hyper-link-url="https://docs.databricks.com/delta/delta-utility.html" style="text-decoration: underline; color: rgb(17, 85, 204);"><a href="https://docs.databricks.com/delta/delta-utility.html" target="_blank" style="color: inherit; text-decoration: inherit;">four columns</a></block><block> each represent a different part of the very first commit to the Delta Table where the table was created.</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>The </block><block style="font-weight: bold;">add</block><block> column has statistics about the DataFrame as a whole and individual columns.</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>The </block><block style="font-weight: bold;">commitInfo</block><block> column has useful information about what the operation was (</block><block style="font-weight: bold;">WRITE</block><block> or </block><block style="font-weight: bold;">READ</block><block>) and who executed the operation.</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>The </block><block style="font-weight: bold;">metaData</block><block> column contains information about the column schema.</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>The </block><block style="font-weight: bold;">protocol</block><block> version contains information about the minimum Delta version necessary to either write or read to this Delta Table.</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">display</block><block class="punctuation token">(</block><block class=" token">spark</block><block class="punctuation token">.</block><block class=" token">read</block><block class="punctuation token">.</block><block class=" token">json</block><block class="punctuation token">(</block><block class="string-interpolation string token">f"</block><block class="string-interpolation interpolation punctuation token">{</block><block class="string-interpolation interpolation token">DA</block><block class="string-interpolation interpolation punctuation token">.</block><block class="string-interpolation interpolation token">paths</block><block class="string-interpolation interpolation punctuation token">.</block><block class="string-interpolation interpolation token">working_dir</block><block class="string-interpolation interpolation punctuation token">}</block><block class="string-interpolation string token">/_delta_log/00000000000000000000.json"</block><block class="punctuation token">)</block><block class="punctuation token">)</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 730.792px; height: 127.53px; position: relative;"><img src="image-resources/493347ee-9c06-4d5a-8bd5-b62c12bd90f3.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Let's take a look at the files inside one of the Neighborhood partitions. The file inside corresponds to the partition commit (file 01) in the </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(79, 167, 176); background-color: rgba(155, 155, 155, 0.2);">_delta_log</block><block> directory.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">display</block><block class="punctuation token">(</block><block class=" token">dbutils</block><block class="punctuation token">.</block><block class=" token">fs</block><block class="punctuation token">.</block><block class=" token">ls</block><block class="punctuation token">(</block><block class="string-interpolation string token">f"</block><block class="string-interpolation interpolation punctuation token">{</block><block class="string-interpolation interpolation token">DA</block><block class="string-interpolation interpolation punctuation token">.</block><block class="string-interpolation interpolation token">paths</block><block class="string-interpolation interpolation punctuation token">.</block><block class="string-interpolation interpolation token">working_dir</block><block class="string-interpolation interpolation punctuation token">}</block><block class="string-interpolation string token">/neighbourhood_cleansed=Bayview/"</block><block class="punctuation token">)</block><block class="punctuation token">)</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 670.997px; height: 85.44px; position: relative;"><img src="image-resources/d090bea2-0cbd-4c35-b553-fa7837722f49.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="font-weight: bold; flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold;">Usual operations on Delta tables:</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Reading data from Delta table</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">df </block><block class="operator token">=</block><block class=" token"> spark</block><block class="punctuation token">.</block><block class=" token">read</block><block class="punctuation token">.</block><block class="builtin token">format</block><block class="punctuation token">(</block><block class="string token">"delta"</block><block class="punctuation token">)</block><block class="punctuation token">.</block><block class=" token">load</block><block class="punctuation token">(</block><block class=" token">DA</block><block class="punctuation token">.</block><block class=" token">paths</block><block class="punctuation token">.</block><block class=" token">working_dir</block><block class="punctuation token">)</block><block class=" token"> </block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Updating Delta table</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">df_update </block><block class="operator token">=</block><block class=" token"> airbnb_df</block><block class="punctuation token">.</block><block class="builtin token">filter</block><block class="punctuation token">(</block><block class=" token">airbnb_df</block><block class="punctuation token">[</block><block class="string token">"host_is_superhost"</block><block class="punctuation token">]</block><block class=" token"> </block><block class="operator token">==</block><block class=" token"> </block><block class="string token">"t"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">df_update</block><block class="punctuation token">.</block><block class=" token">write</block><block class="punctuation token">.</block><block class="builtin token">format</block><block class="punctuation token">(</block><block class="string token">"delta"</block><block class="punctuation token">)</block><block class="punctuation token">.</block><block class=" token">mode</block><block class="punctuation token">(</block><block class="string token">"overwrite"</block><block class="punctuation token">)</block><block class="punctuation token">.</block><block class=" token">save</block><block class="punctuation token">(</block><block class=" token">DA</block><block class="punctuation token">.</block><block class=" token">paths</block><block class="punctuation token">.</block><block class=" token">working_dir</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Look at the files in the Bayview partition post-update. Remember, the different files in this directory are snapshots of your DataFrame corresponding to different commits.</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">display</block><block class="punctuation token">(</block><block class=" token">dbutils</block><block class="punctuation token">.</block><block class=" token">fs</block><block class="punctuation token">.</block><block class=" token">ls</block><block class="punctuation token">(</block><block class="string-interpolation string token">f"</block><block class="string-interpolation interpolation punctuation token">{</block><block class="string-interpolation interpolation token">DA</block><block class="string-interpolation interpolation punctuation token">.</block><block class="string-interpolation interpolation token">paths</block><block class="string-interpolation interpolation punctuation token">.</block><block class="string-interpolation interpolation token">working_dir</block><block class="string-interpolation interpolation punctuation token">}</block><block class="string-interpolation string token">/neighbourhood_cleansed=Bayview/"</block><block class="punctuation token">)</block><block class="punctuation token">)</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 677.286px; height: 79.24px; position: relative;"><img src="image-resources/846f109f-874c-46ee-9b94-b06999883778.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">[</block><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><compositeblock dir="ltr" class="anchor-tag-ref inline" style="font-family: &quot;Computer Modern Serif&quot;, serif;"><a href="#n0.3295185310066928" style="color: inherit; text-decoration: inherit;">Back To Top</a></compositeblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">]</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode section sindent-2" data-line-id="n0.6473984775981556" style="font-size: 1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.6473984775981556" role="heading" aria-level="3"><prefix style="text-align: left; padding-right: 0em;">1.2.4. </prefix><blocks><baselineblock class="inline"></baselineblock><block>Delta Time Travel</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>You can access a previous version of your Delta Table using </block><block class="role-hyper-link" data-hyper-link-url="https://databricks.com/blog/2019/02/04/introducing-delta-time-travel-for-large-scale-data-lakes.html" style="text-decoration: underline; color: rgb(17, 85, 204);"><a href="https://databricks.com/blog/2019/02/04/introducing-delta-time-travel-for-large-scale-data-lakes.html" target="_blank" style="color: inherit; text-decoration: inherit;">Delta Time Travel</a></block><block>. </block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Use the following code to access your version history. </block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="background-color: rgb(255, 254, 0);">Delta Lake will keep a 30 day version history by default</block><block>, though </block><block style="text-decoration: underline;">it can maintain that history for longer if needed</block><block>.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="operator token">%</block><block class=" token">sql</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="constant token">DROP</block><block class=" token"> </block><block class="constant token">TABLE</block><block class=" token"> </block><block class="constant token">IF</block><block class=" token"> </block><block class="constant token">EXISTS</block><block class=" token"> train_delta</block><block class="punctuation token">;</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="constant token">CREATE</block><block class=" token"> </block><block class="constant token">TABLE</block><block class=" token"> train_delta </block><block class="constant token">USING</block><block class=" token"> </block><block class="constant token">DELTA</block><block class=" token"> </block><block class="constant token">LOCATION</block><block class=" token"> </block><block class="string token">'${DA.paths.working_dir}'</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="operator token">%</block><block class=" token">sql</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="constant token">DESCRIBE</block><block class=" token"> </block><block class="constant token">HISTORY</block><block class=" token"> train_delta</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Using the </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(79, 167, 176); background-color: rgba(155, 155, 155, 0.2);">versionAsOf</block><block> option allows you to easily access previous versions of our Delta Table.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">df </block><block class="operator token">=</block><block class=" token"> spark</block><block class="punctuation token">.</block><block class=" token">read</block><block class="punctuation token">.</block><block class="builtin token">format</block><block class="punctuation token">(</block><block class="string token">"delta"</block><block class="punctuation token">)</block><block class="punctuation token">.</block><block class=" token">option</block><block class="punctuation token">(</block><block class="string token">"versionAsOf"</block><block class="punctuation token">,</block><block class=" token"> </block><block class="number token">0</block><block class="punctuation token">)</block><block class="punctuation token">.</block><block class=" token">load</block><block class="punctuation token">(</block><block class=" token">DA</block><block class="punctuation token">.</block><block class=" token">paths</block><block class="punctuation token">.</block><block class=" token">working_dir</block><block class="punctuation token">)</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>You can also access older versions using a </block><block style="font-weight: bold;">timestamp</block><block>.</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Replace the timestamp string with the information from your version history. </block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold;">Note</block><block> that you can use a date without the time information if necessary.</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Use your own timestamp </block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># time_stamp_string = "FILL_IN"</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># OR programatically get the first verion's timestamp value</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">time_stamp_string </block><block class="operator token">=</block><block class=" token"> </block><block class="builtin token">str</block><block class="punctuation token">(</block><block class=" token">spark</block><block class="punctuation token">.</block><block class=" token">sql</block><block class="punctuation token">(</block><block class="string token">"DESCRIBE HISTORY train_delta"</block><block class="punctuation token">)</block><block class="punctuation token">.</block><block class=" token">collect</block><block class="punctuation token">(</block><block class="punctuation token">)</block><block class="punctuation token">[</block><block class="operator token">-</block><block class="number token">1</block><block class="punctuation token">]</block><block class="punctuation token">[</block><block class="string token">"timestamp"</block><block class="punctuation token">]</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">df </block><block class="operator token">=</block><block class=" token"> spark</block><block class="punctuation token">.</block><block class=" token">read</block><block class="punctuation token">.</block><block class="builtin token">format</block><block class="punctuation token">(</block><block class="string token">"delta"</block><block class="punctuation token">)</block><block class="punctuation token">.</block><block class=" token">option</block><block class="punctuation token">(</block><block class="string token">"timestampAsOf"</block><block class="punctuation token">,</block><block class=" token"> time_stamp_string</block><block class="punctuation token">)</block><block class="punctuation token">.</block><block class=" token">load</block><block class="punctuation token">(</block><block class=" token">DA</block><block class="punctuation token">.</block><block class=" token">paths</block><block class="punctuation token">.</block><block class=" token">working_dir</block><block class="punctuation token">)</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode section sindent-2" data-line-id="n0.33027284560716663" style="font-size: 1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.33027284560716663" role="heading" aria-level="3"><prefix style="text-align: left; padding-right: 0em;">1.2.5. </prefix><blocks><baselineblock class="inline"></baselineblock><block>Cleanup Log Files</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>We can clean up our directory using </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(79, 167, 176); background-color: rgba(155, 155, 155, 0.2);">VACUUM</block><block>. </block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; color: rgb(255, 64, 0);">Vacuum</block><block> accepts a retention period in hours as an input.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold;">Uh-oh, our code doesn't run!</block><block> </block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="text-decoration: underline;">By default</block><block>, to prevent accidentally vacuuming recent commits, </block><block style="text-decoration: underline;">Delta Lake will not let users vacuum a period under 7 days or 168 hours</block><block>. </block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="text-decoration: underline;">Once vacuumed, you cannot return to a prior commit through time travel</block><block>, </block><block style="text-decoration: underline;">only your most recent Delta Table will be saved</block><block>.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Try changing the vacuum parameter to different values.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># from delta.tables import DeltaTable</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># delta_table = DeltaTable.forPath(spark, DA.paths.working_dir)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># delta_table.vacuum(0)</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>We can workaround this by setting a spark configuration that will bypass the default retention period check.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> delta</block><block class="punctuation token">.</block><block class=" token">tables </block><block class="keyword token">import</block><block class=" token"> DeltaTable</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">spark</block><block class="punctuation token">.</block><block class=" token">conf</block><block class="punctuation token">.</block><block class="builtin token">set</block><block class="punctuation token">(</block><block class="string token">"spark.databricks.delta.retentionDurationCheck.enabled"</block><block class="punctuation token">,</block><block class=" token"> </block><block class="string token">"false"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">delta_table </block><block class="operator token">=</block><block class=" token"> DeltaTable</block><block class="punctuation token">.</block><block class=" token">forPath</block><block class="punctuation token">(</block><block class=" token">spark</block><block class="punctuation token">,</block><block class=" token"> DA</block><block class="punctuation token">.</block><block class=" token">paths</block><block class="punctuation token">.</block><block class=" token">working_dir</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">delta_table</block><block class="punctuation token">.</block><block class=" token">vacuum</block><block class="punctuation token">(</block><block class="number token">0</block><block class="punctuation token">)</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">[</block><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><compositeblock dir="ltr" class="anchor-tag-ref inline" style="font-family: &quot;Computer Modern Serif&quot;, serif;"><a href="#n0.3295185310066928" style="color: inherit; text-decoration: inherit;">Back To Top</a></compositeblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">]</block></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="inline" style="display: block;"><div style="vertical-align: baseline;"><div style="display: inline-block; height: 0px; border-bottom: 1px solid; width: 100%;"></div></div></compositeblock></blocks></line><line class="root text-mode section sindent-0" data-line-id="n0.8846477497634795" style="font-size: 1.2em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.8846477497634795" role="heading" aria-level="1"><prefix style="text-align: left; padding-right: 0.5em;">2. </prefix><blocks><baselineblock class="inline"></baselineblock><block>Data Cleansing</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>First, read the data:</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">file_path </block><block class="operator token">=</block><block class=" token"> </block><block class="string-interpolation string token">f"</block><block class="string-interpolation interpolation punctuation token">{</block><block class="string-interpolation interpolation token">DA</block><block class="string-interpolation interpolation punctuation token">.</block><block class="string-interpolation interpolation token">paths</block><block class="string-interpolation interpolation punctuation token">.</block><block class="string-interpolation interpolation token">datasets</block><block class="string-interpolation interpolation punctuation token">}</block><block class="string-interpolation string token">/airbnb/sf-listings/sf-listings-2019-03-06.csv"</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">raw_df </block><block class="operator token">=</block><block class=" token"> spark</block><block class="punctuation token">.</block><block class=" token">read</block><block class="punctuation token">.</block><block class=" token">csv</block><block class="punctuation token">(</block><block class=" token">file_path</block><block class="punctuation token">,</block><block class=" token"> header</block><block class="operator token">=</block><block class="string token">"true"</block><block class="punctuation token">,</block><block class=" token"> inferSchema</block><block class="operator token">=</block><block class="string token">"true"</block><block class="punctuation token">,</block><block class=" token"> multiLine</block><block class="operator token">=</block><block class="string token">"true"</block><block class="punctuation token">,</block><block class=" token"> escape</block><block class="operator token">=</block><block class="string token">'"'</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">display</block><block class="punctuation token">(</block><block class=" token">raw_df</block><block class="punctuation token">)</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode section sindent-1" data-line-id="n0.9322585438794182" style="font-size: 1.1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.9322585438794182" role="heading" aria-level="2"><prefix style="text-align: left; padding-right: 0.25em;">2.1. </prefix><blocks><baselineblock class="inline"></baselineblock><block>Fixing Data Types</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Let's transform the "price" column from string to numeric.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> pyspark</block><block class="punctuation token">.</block><block class=" token">sql</block><block class="punctuation token">.</block><block class=" token">functions </block><block class="keyword token">import</block><block class=" token"> col</block><block class="punctuation token">,</block><block class=" token"> translate</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">fixed_price_df </block><block class="operator token">=</block><block class=" token"> base_df</block><block class="punctuation token">.</block><block class=" token">withColumn</block><block class="punctuation token">(</block><block class="string token">"price"</block><block class="punctuation token">,</block><block class=" token"> translate</block><block class="punctuation token">(</block><block class=" token">col</block><block class="punctuation token">(</block><block class="string token">"price"</block><block class="punctuation token">)</block><block class="punctuation token">,</block><block class=" token"> </block><block class="string token">"$,"</block><block class="punctuation token">,</block><block class=" token"> </block><block class="string token">""</block><block class="punctuation token">)</block><block class="punctuation token">.</block><block class=" token">cast</block><block class="punctuation token">(</block><block class="string token">"double"</block><block class="punctuation token">)</block><block class="punctuation token">)</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode section sindent-1" data-line-id="n0.1961401916604102" style="font-size: 1.1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.1961401916604102" role="heading" aria-level="2"><prefix style="text-align: left; padding-right: 0.25em;">2.2. </prefix><blocks><baselineblock class="inline"></baselineblock><block>Summary Statistics</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Two options here:</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(79, 167, 176); background-color: rgba(155, 155, 155, 0.2);">describe</block><block>  count, mean, stddev, min, max</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(79, 167, 176); background-color: rgba(155, 155, 155, 0.2);">summary</block><block>  </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(79, 167, 176); background-color: rgba(155, 155, 155, 0.2);">describe</block><block> + interquartile range (IQR)</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">display</block><block class="punctuation token">(</block><block class=" token">fixed_price_df</block><block class="punctuation token">.</block><block class=" token">describe</block><block class="punctuation token">(</block><block class="punctuation token">)</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">display</block><block class="punctuation token">(</block><block class=" token">fixed_price_df</block><block class="punctuation token">.</block><block class=" token">summary</block><block class="punctuation token">(</block><block class="punctuation token">)</block><block class="punctuation token">)</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 691.997px; height: 121.81px; position: relative;"><img src="image-resources/2d5ed45f-75aa-4b6e-ac70-3d9adf7e823f.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div data-caption-block-id="n0.6524371039608854" class="role-image-caption-container role-caption-container" style="display: flex; align-items: center; justify-content: center; margin-top: 10px;" id="n0.6524371039608854"><span class="no-print-outline" style="outline: none; position: relative; text-align: center;"><span class="role-image-caption-prefix" style="padding-right: 0.3em; font-weight: bold;"><span class="role-image-caption-name">Figure</span><span class="role-image-caption-number"><!-- react-text: 27099 --> <!-- /react-text --><!-- react-text: 27100 -->2<!-- /react-text --></span><span>:</span></span><editarea class="image-caption text-mode" style="min-width: 50px; display: inline;"><line class="text-mode align-center" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(79, 167, 176); background-color: rgba(155, 155, 155, 0.2);">describe</block></blocks></line></editarea></span></div></compositeblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 699.984px; height: 164.63px; position: relative;"><img src="image-resources/3be8da2e-7925-470b-b784-c7625ca223f7.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div data-caption-block-id="n0.5492244539495017" class="role-image-caption-container role-caption-container" style="display: flex; align-items: center; justify-content: center; margin-top: 10px;" id="n0.5492244539495017"><span class="no-print-outline" style="outline: none; position: relative; text-align: center;"><span class="role-image-caption-prefix" style="padding-right: 0.3em; font-weight: bold;"><span class="role-image-caption-name">Figure</span><span class="role-image-caption-number"><!-- react-text: 27129 --> <!-- /react-text --><!-- react-text: 27130 -->3<!-- /react-text --></span><span>:</span></span><editarea class="image-caption text-mode" style="min-width: 50px; display: inline;"><line class="text-mode align-center" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(79, 167, 176); background-color: rgba(155, 155, 155, 0.2);">summary</block></blocks></line></editarea></span></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">[</block><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><compositeblock dir="ltr" class="anchor-tag-ref inline" style="font-family: &quot;Computer Modern Serif&quot;, serif;"><a href="#n0.3295185310066928" style="color: inherit; text-decoration: inherit;">Back To Top</a></compositeblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">]</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode section sindent-1" data-line-id="n0.09723349389069558" style="font-size: 1.1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.09723349389069558" role="heading" aria-level="2"><prefix style="text-align: left; padding-right: 0.25em;">2.3. </prefix><blocks><baselineblock class="inline"></baselineblock><block>Explore Data with Data Profile</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>The </block><block style="font-weight: bold; color: rgb(255, 64, 0);">Data Profile</block><block> feature in Databricks notebooks offers valuable insights and benefits for data analysis and exploration. </block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>By leveraging </block><block style="font-style: italic;">Data Profile</block><block>, users gain a comprehensive overview of their dataset's characteristics, statistics, and data quality metrics. </block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>This feature enables data scientists and analysts to understand the data distribution, identify missing values, detect outliers, and explore descriptive statistics efficiently.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>There are two ways of viewing Data Profiler. The first option is the UI.</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>After using display function to show a data frame, click </block><block style="font-weight: bold;">+</block><block> icon next to the Table in the header.</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Click Data Profile.</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>This functionality is also available through the</block><block style="font-weight: bold;"> dbutils API</block><block> in Python, Scala, and R, using the </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(79, 167, 176); background-color: rgba(155, 155, 155, 0.2);">dbutils.data.summarize(df)</block><block> command. </block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>We can also use </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(79, 167, 176); background-color: rgba(155, 155, 155, 0.2);">dbutils.data.summarize(df)</block><block> to display Data Profile UI.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; background-color: rgb(255, 254, 0);">Note:</block><block> This features will profile the </block><block style="text-decoration: underline;">entire data set</block><block> in the data frame or SQL query results, not just the portion displayed in the table.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; background-color: rgb(255, 254, 0);">Note:</block><block> Running data profile is going to cache some intermediary data. Be careful not to run it on very large datasets. </block><block style="text-decoration: underline;">It's just caching the intermediary results though, not the entire data</block><block>.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">dbutils</block><block class="punctuation token">.</block><block class=" token">data</block><block class="punctuation token">.</block><block class=" token">summarize</block><block class="punctuation token">(</block><block class=" token">fixed_price_df</block><block class="punctuation token">)</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 688.189px; height: 515.83px; position: relative;"><img src="image-resources/d02ffb0d-ab5b-4689-b017-7c449c74c4e6.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">[</block><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><compositeblock dir="ltr" class="anchor-tag-ref inline" style="font-family: &quot;Computer Modern Serif&quot;, serif;"><a href="#n0.3295185310066928" style="color: inherit; text-decoration: inherit;">Back To Top</a></compositeblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">]</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode section sindent-1" data-line-id="n0.06842844464381392" style="font-size: 1.1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.06842844464381392" role="heading" aria-level="2"><prefix style="text-align: left; padding-right: 0.25em;">2.4. </prefix><blocks><baselineblock class="inline"></baselineblock><block>Getting Rid of Extreme Values</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>There's always a possibility that some columns in our data have some extreme values.</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; background-color: rgb(255, 254, 0);">Note:</block><block> Deciding on what an extreme value should be is domain-specific. </block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>For example, in this example data, the house prices could include the price of some super-expensive homes.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode section sindent-1" data-line-id="n0.6731058422357645" style="font-size: 1.1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.6731058422357645" role="heading" aria-level="2"><prefix style="text-align: left; padding-right: 0.25em;">2.5. </prefix><blocks><baselineblock class="inline"></baselineblock><block>Handling Null Values</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>There are a lot of different ways to handle null values. </block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="text-decoration: underline;">Sometimes, null can actually be a key indicator of the thing you are trying to predict</block><block> (e.g. if you don't fill in certain portions of a form, probability of it getting approved decreases).</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="font-weight: bold; flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; background-color: rgb(255, 254, 0);">Some ways to handle nulls:</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Drop any records that contain nulls</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="font-weight: bold; flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold;">Numeric:</block></blocks></line><line class="root text-mode indent-2 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="3"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;">* </prefix><blocks><baselineblock class="inline"></baselineblock><block>Replace them with mean/median/zero/etc.</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="font-weight: bold; flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold;">Categorical:</block></blocks></line><line class="root text-mode indent-2 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="3"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;">* </prefix><blocks><baselineblock class="inline"></baselineblock><block style="text-decoration: underline;">Replace them with the mode</block></blocks></line><line class="root text-mode indent-2 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="3"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;">* </prefix><blocks><baselineblock class="inline"></baselineblock><block>Create a special category for null</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; background-color: rgb(255, 254, 0);">Use techniques like </block><block style="font-weight: bold; color: rgb(255, 64, 0); background-color: rgb(255, 254, 0);">ALS (Alternating Least Squares)</block><block> which are designed to impute missing values.</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; background-color: rgb(255, 254, 0);">Note:</block><block> If you do ANY imputation techniques for categorical/numerical features, you MUST include an additional field specifying that field was imputed.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; background-color: rgb(255, 254, 0);">Note:</block><block> </block><block style="font-weight: bold; color: rgb(255, 64, 0);">SparkML's Imputer</block><block> (shown below) does not support imputation for categorical features.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="font-weight: bold; flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold;">Impute  Cast to Double</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Imputing in the context of data means replacing missing values with something intentional, such as replacing nulls with an average/mean value. </block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; color: rgb(255, 64, 0);">SparkML's Imputer</block><block> requires all fields to be of type double. Let's cast all integer fields to double.</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> pyspark</block><block class="punctuation token">.</block><block class=" token">sql</block><block class="punctuation token">.</block><block class=" token">functions </block><block class="keyword token">import</block><block class=" token"> col</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> pyspark</block><block class="punctuation token">.</block><block class=" token">sql</block><block class="punctuation token">.</block><block class=" token">types </block><block class="keyword token">import</block><block class=" token"> IntegerType</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">integer_columns </block><block class="operator token">=</block><block class=" token"> </block><block class="punctuation token">[</block><block class=" token">x</block><block class="punctuation token">.</block><block class=" token">name </block><block class="keyword token">for</block><block class=" token"> x </block><block class="keyword token">in</block><block class=" token"> min_nights_df</block><block class="punctuation token">.</block><block class=" token">schema</block><block class="punctuation token">.</block><block class=" token">fields </block><block class="keyword token">if</block><block class=" token"> x</block><block class="punctuation token">.</block><block class=" token">dataType </block><block class="operator token">==</block><block class=" token"> IntegerType</block><block class="punctuation token">(</block><block class="punctuation token">)</block><block class="punctuation token">]</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">doubles_df </block><block class="operator token">=</block><block class=" token"> min_nights_df</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">for</block><block class=" token"> c </block><block class="keyword token">in</block><block class=" token"> integer_columns</block><block class="punctuation token">:</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    doubles_df </block><block class="operator token">=</block><block class=" token"> doubles_df</block><block class="punctuation token">.</block><block class=" token">withColumn</block><block class="punctuation token">(</block><block class=" token">c</block><block class="punctuation token">,</block><block class=" token"> col</block><block class="punctuation token">(</block><block class=" token">c</block><block class="punctuation token">)</block><block class="punctuation token">.</block><block class=" token">cast</block><block class="punctuation token">(</block><block class="string token">"double"</block><block class="punctuation token">)</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">columns </block><block class="operator token">=</block><block class=" token"> </block><block class="string token">"\n - "</block><block class="punctuation token">.</block><block class=" token">join</block><block class="punctuation token">(</block><block class=" token">integer_columns</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">print</block><block class="punctuation token">(</block><block class="string-interpolation string token">f"Columns converted from Integer to Double:\n - </block><block class="string-interpolation interpolation punctuation token">{</block><block class="string-interpolation interpolation token">columns</block><block class="string-interpolation interpolation punctuation token">}</block><block class="string-interpolation string token">"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Columns converted from Integer to Double:</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token">#  - host_total_listings_count</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token">#  - accommodates</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token">#  - bedrooms</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token">#  - beds</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token">#  - minimum_nights</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token">#  - number_of_reviews</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token">#  - review_scores_rating</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token">#  - review_scores_accuracy</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token">#  - review_scores_cleanliness</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token">#  - review_scores_checkin</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token">#  - review_scores_communication</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token">#  - review_scores_location</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token">#  - review_scores_value</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># ------------</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Add a dummy column to denote the presence of null values before imputing (i.e. 1.0 = Yes, 0.0 = No).</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> pyspark</block><block class="punctuation token">.</block><block class=" token">sql</block><block class="punctuation token">.</block><block class=" token">functions </block><block class="keyword token">import</block><block class=" token"> when</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">impute_cols </block><block class="operator token">=</block><block class=" token"> </block><block class="punctuation token">[</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block><block class="string token">"bedrooms"</block><block class="punctuation token">,</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block><block class="string token">"bathrooms"</block><block class="punctuation token">,</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block><block class="string token">"beds"</block><block class="punctuation token">,</block><block class=" token"> </block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block><block class="string token">"review_scores_rating"</block><block class="punctuation token">,</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block><block class="string token">"review_scores_accuracy"</block><block class="punctuation token">,</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block><block class="string token">"review_scores_cleanliness"</block><block class="punctuation token">,</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block><block class="string token">"review_scores_checkin"</block><block class="punctuation token">,</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block><block class="string token">"review_scores_communication"</block><block class="punctuation token">,</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block><block class="string token">"review_scores_location"</block><block class="punctuation token">,</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block><block class="string token">"review_scores_value"</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="punctuation token">]</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">for</block><block class=" token"> c </block><block class="keyword token">in</block><block class=" token"> impute_cols</block><block class="punctuation token">:</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    doubles_df </block><block class="operator token">=</block><block class=" token"> doubles_df</block><block class="punctuation token">.</block><block class=" token">withColumn</block><block class="punctuation token">(</block><block class=" token">c </block><block class="operator token">+</block><block class=" token"> </block><block class="string token">"_na"</block><block class="punctuation token">,</block><block class=" token"> when</block><block class="punctuation token">(</block><block class=" token">col</block><block class="punctuation token">(</block><block class=" token">c</block><block class="punctuation token">)</block><block class="punctuation token">.</block><block class=" token">isNull</block><block class="punctuation token">(</block><block class="punctuation token">)</block><block class="punctuation token">,</block><block class=" token"> </block><block class="number token">1.0</block><block class="punctuation token">)</block><block class="punctuation token">.</block><block class=" token">otherwise</block><block class="punctuation token">(</block><block class="number token">0.0</block><block class="punctuation token">)</block><block class="punctuation token">)</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">[</block><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><compositeblock dir="ltr" class="anchor-tag-ref inline" style="font-family: &quot;Computer Modern Serif&quot;, serif;"><a href="#n0.3295185310066928" style="color: inherit; text-decoration: inherit;">Back To Top</a></compositeblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">]</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode section sindent-1" data-line-id="n0.13436957246799186" style="font-size: 1.1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.13436957246799186" role="heading" aria-level="2"><prefix style="text-align: left; padding-right: 0.25em;">2.6. </prefix><blocks><baselineblock class="inline"></baselineblock><block>Transformers and Estimators</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Spark ML standardizes APIs for machine learning algorithms to make it easier to combine multiple algorithms into a single pipeline, or workflow. </block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Let's cover two key concepts introduced by the Spark ML API: </block><block style="font-weight: bold; color: rgb(255, 64, 0);">transformers</block><block> and </block><block style="font-weight: bold; color: rgb(255, 64, 0);">estimators</block><block>.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; color: rgb(255, 64, 0);">Transformer</block><block>  Transforms one DataFrame into another DataFrame. </block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>It accepts a DataFrame as input, and returns a new DataFrame with one or more columns appended to it. </block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Transformers </block><block style="text-decoration: underline;">do not learn any parameters from your data and simply apply rule-based transformations</block><block>. </block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>It has a </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(79, 167, 176); background-color: rgba(155, 155, 155, 0.2);">.transform()</block><block> method.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; color: rgb(255, 64, 0);">Estimator</block><block>  An algorithm which can be fit on a DataFrame to produce a Transformer. E.g., a learning algorithm is an Estimator which trains on a DataFrame and produces a model. </block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>It has a </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(79, 167, 176); background-color: rgba(155, 155, 155, 0.2);">.fit()</block><block> method because it learns (or "fits") parameters from your DataFrame.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> pyspark</block><block class="punctuation token">.</block><block class=" token">ml</block><block class="punctuation token">.</block><block class=" token">feature </block><block class="keyword token">import</block><block class=" token"> Imputer</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">imputer </block><block class="operator token">=</block><block class=" token"> Imputer</block><block class="punctuation token">(</block><block class=" token">strategy</block><block class="operator token">=</block><block class="string token">"median"</block><block class="punctuation token">,</block><block class=" token"> inputCols</block><block class="operator token">=</block><block class=" token">impute_cols</block><block class="punctuation token">,</block><block class=" token"> outputCols</block><block class="operator token">=</block><block class=" token">impute_cols</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">imputer_model </block><block class="operator token">=</block><block class=" token"> imputer</block><block class="punctuation token">.</block><block class=" token">fit</block><block class="punctuation token">(</block><block class=" token">doubles_df</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">imputed_df </block><block class="operator token">=</block><block class=" token"> imputer_model</block><block class="punctuation token">.</block><block class=" token">transform</block><block class="punctuation token">(</block><block class=" token">doubles_df</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Now, let's save the cleansed data</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">imputed_df</block><block class="punctuation token">.</block><block class=" token">write</block><block class="punctuation token">.</block><block class="builtin token">format</block><block class="punctuation token">(</block><block class="string token">"delta"</block><block class="punctuation token">)</block><block class="punctuation token">.</block><block class=" token">mode</block><block class="punctuation token">(</block><block class="string token">"overwrite"</block><block class="punctuation token">)</block><block class="punctuation token">.</block><block class=" token">save</block><block class="punctuation token">(</block><block class="string-interpolation string token">f"</block><block class="string-interpolation interpolation punctuation token">{</block><block class="string-interpolation interpolation token">DA</block><block class="string-interpolation interpolation punctuation token">.</block><block class="string-interpolation interpolation token">paths</block><block class="string-interpolation interpolation punctuation token">.</block><block class="string-interpolation interpolation token">working_dir</block><block class="string-interpolation interpolation punctuation token">}</block><block class="string-interpolation string token">/imputed_results"</block><block class="punctuation token">)</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">[</block><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><compositeblock dir="ltr" class="anchor-tag-ref inline" style="font-family: &quot;Computer Modern Serif&quot;, serif;"><a href="#n0.3295185310066928" style="color: inherit; text-decoration: inherit;">Back To Top</a></compositeblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">]</block></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="inline" style="display: block;"><div style="vertical-align: baseline;"><div style="display: inline-block; height: 0px; border-bottom: 1px solid; width: 100%;"></div></div></compositeblock></blocks></line><line class="root text-mode section sindent-0" data-line-id="n0.6219727211720694" style="font-size: 1.2em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.6219727211720694" role="heading" aria-level="1"><prefix style="text-align: left; padding-right: 0.5em;">3. </prefix><blocks><baselineblock class="inline"></baselineblock><block>Linear Regression</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Linear regression assumptions:</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; color: rgb(255, 64, 0);">Linearity</block><block>  Linear relationship between </block><compositeblock dir="ltr" class="math-container-symbol role-mathmode-area inline" style="font-size: 17px;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mstyle displaystyle=&quot;true&quot;><mi>X</mi></mstyle></math>"><editarea class="math-mode-font lazyable no-area-container" style="font-family: LatinModern-Math, LatinModern, Asana-Math, Asana;" aria-hidden="true"><line class="" style="line-height: 1.2;"><baselineblock></baselineblock><block class="Normal">X</block></line></editarea><span role="presentation" style="width:100%;position:absolute;top:0;left:0;clip:rect(1px, 1px, 1px, 1px);height:1px;padding:1px 0 0 0!important;overflow:hidden;user-select:none;"><math xmlns="http://www.w3.org/1998/Math/MathML"><mstyle displaystyle="true"><mi>X</mi></mstyle></math></span></compositeblock><block> and the mean of </block><compositeblock dir="ltr" class="math-container-symbol role-mathmode-area inline" style="font-size: 17px;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mstyle displaystyle=&quot;true&quot;><mi>Y</mi></mstyle></math>"><editarea class="math-mode-font lazyable no-area-container" style="font-family: LatinModern-Math, LatinModern, Asana-Math, Asana;" aria-hidden="true"><line class="" style="line-height: 1.2;"><baselineblock></baselineblock><block class="Normal">Y</block></line></editarea><span role="presentation" style="width:100%;position:absolute;top:0;left:0;clip:rect(1px, 1px, 1px, 1px);height:1px;padding:1px 0 0 0!important;overflow:hidden;user-select:none;"><math xmlns="http://www.w3.org/1998/Math/MathML"><mstyle displaystyle="true"><mi>Y</mi></mstyle></math></span></compositeblock><block> .</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; color: rgb(255, 64, 0);">Independence</block><block>  Observations are independent from one another  i.e., little or no autocorrelation.</block></blocks></line><line class="root text-mode indent-2 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="3"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;">* </prefix><blocks><baselineblock class="inline"></baselineblock><block>You can plot ACF plot of residuals to check the autocorrelation in data.</block></blocks></line><line class="root text-mode indent-2 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="3"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;">* </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 300px; height: 205.93px; position: relative;"><img src="image-resources/c64888b1-be98-4c39-95f4-18dbff8d8300.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-2 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="3"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;">* </prefix><blocks><baselineblock class="inline"></baselineblock><block>Alternatively, you can use </block><block style="font-weight: bold; color: rgb(255, 64, 0);">Durbin-Watson (DW) Test</block><block>.</block></blocks></line><line class="root text-mode indent-2 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="3"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;">* </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="math-container-symbol role-mathmode-area display" style="font-size: 17px;" data-mathml="<math display=&quot;block&quot; xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><munderover><mo largeop=&quot;true&quot; movablelimit=&quot;true&quot;></mo><mrow><mi>t</mi><mo form=&quot;infix&quot;>=</mo><mn>2</mn></mrow><mi>T</mi></munderover><mo fence=&quot;true&quot;>(</mo><mo fence=&quot;true&quot; stretchy=&quot;false&quot;>(</mo><msub><mi>e</mi><mi>t</mi></msub><mo form=&quot;infix&quot;>-</mo><msub><mi>e</mi><mrow><mi>t</mi><mo form=&quot;infix&quot;>-</mo><mn>1</mn></mrow></msub><msup><mo fence=&quot;true&quot; stretchy=&quot;false&quot;>)</mo><mn>2</mn></msup><mo fence=&quot;true&quot;>)</mo><mo form=&quot;infix&quot;>/</mo><munderover><mo largeop=&quot;true&quot; movablelimit=&quot;true&quot;></mo><mrow><mi>t</mi><mo form=&quot;infix&quot;>=</mo><mn>1</mn></mrow><mi>T</mi></munderover><msubsup><mi>e</mi><mi>t</mi><mn>2</mn></msubsup></math>"><editarea class="math-mode-font lazy lazyable no-area-container" style="font-family: LatinModern-Math, LatinModern, Asana-Math, Asana;" aria-hidden="true"><line class="taggable" style="line-height: 1.2;"><baselineblock></baselineblock><compositeblock dir="ltr" class="summation-like-symbol limit-type limit-kind"><editarea class="from no-area-container" style="margin-bottom: -0.411765em;"><line class="" style="margin-bottom: -0.168067em; line-height: 1.2;"><baselineblock></baselineblock><block>T</block></line></editarea><symbol class="" style="font-family: LatinModern-Math, LatinModern, Asana-Math, Asana; font-style: normal; font-weight: normal;"><span></span></symbol><editarea class="to to-summation no-area-container" style="margin-top: 0.176471em;"><line class="" style="line-height: 1.2;"><baselineblock></baselineblock><block>t=2</block></line></editarea></compositeblock><opensymbolblock class="" type="parenthesis" style="height: 1.58824em;"><hidden-span style="margin-top: 0.0588235em; align-self: flex-start;">(</hidden-span><svg style="width: 0.5em;"><path d=" M 7.13 1.90 c 0.00 -0.11 -0.13 -0.20 -0.27 -0.20 c -0.06 0.00 -0.11 0.02 -0.15 0.04 c -3.42 1.89 -5.39 7.06 -5.39 11.67 v 0.09 h 1.45 v -0.09 c 0.00 -4.41 1.15 -9.54 4.40 -11.36 c 0.08 -0.03 0.11 -0.08 0.11 -0.15 z   M 1.28 13.50 v 0.00 h 1.45 v 0.00 z" stroke="none"></path><path d=" M 7.13 25.10 c 0.00 0.11 -0.13 0.20 -0.27 0.20 c -0.06 0.00 -0.11 -0.02 -0.15 -0.04 c -3.42 -1.89 -5.39 -7.06 -5.39 -11.67 v -0.09 h 1.45 v 0.09 c 0.00 4.41 1.15 9.54 4.40 11.36 c 0.08 0.03 0.11 0.08 0.11 0.15 z" stroke="none"></path></svg></opensymbolblock><opensymbolblock class="normal" type="parenthesis"><bracket-span>(</bracket-span></opensymbolblock><block class="Normal">e</block><compositeblock dir="ltr" class="power-index-symbol-container"><middle-base><inline></inline></middle-base><editarea-block class="index-value" style="line-height: 1.2; margin-top: -0.747899em;">t</editarea-block></compositeblock><block class="Binary">-</block><block class="Normal">e</block><compositeblock dir="ltr" class="power-index-symbol-container"><middle-base><inline></inline></middle-base><editarea-line class=" index-value" style="line-height: 1.2; margin-top: -0.747899em;"><baselineblock></baselineblock><block>t-1</block></editarea-line></compositeblock><closesymbolblock class="normal" type="parenthesis"><bracket-span>)</bracket-span></closesymbolblock><compositeblock dir="ltr" class="power-index-symbol-container has-power"><editarea-block class="power-value" style="line-height: 1.2; margin-bottom: -1.06571em;">2</editarea-block><middle-base><inline></inline></middle-base></compositeblock><closesymbolblock class="" type="parenthesis" style="height: 1.58824em;"><hidden-span style="margin-top: 0.0588235em; align-self: flex-start;">)</hidden-span><svg style="width: 0.5em;"><path d=" M 1.32 1.90 c 0.00 -0.11 0.13 -0.20 0.27 -0.20 c 0.06 0.00 0.11 0.02 0.15 0.04 c 3.42 1.89 5.39 7.06 5.39 11.67 v 0.09 h -1.45 v -0.09 c 0.00 -4.41 -1.15 -9.54 -4.40 -11.36 c -0.08 -0.03 -0.11 -0.08 -0.11 -0.15 z  M 7.17 13.50 v 0.00 h -1.45 v 0.00 z" stroke="none"></path><path d=" M 1.32 25.10 c 0.00 0.11 0.13 0.20 0.27 0.20 c 0.06 0.00 0.11 -0.02 0.15 -0.04 c 3.42 -1.89 5.39 -7.06 5.39 -11.67 v -0.09 h -1.45 v 0.09 c 0.00 4.41 -1.15 9.54 -4.40 11.36 c -0.08 0.03 -0.11 0.08 -0.11 0.15 z" stroke="none"></path></svg></closesymbolblock><block class="Binary">/</block><compositeblock dir="ltr" class="summation-like-symbol limit-type limit-kind"><editarea class="from no-area-container" style="margin-bottom: -0.411765em;"><line class="" style="margin-bottom: -0.168067em; line-height: 1.2;"><baselineblock></baselineblock><block>T</block></line></editarea><symbol class="" style="font-family: LatinModern-Math, LatinModern, Asana-Math, Asana; font-style: normal; font-weight: normal;"><span></span></symbol><editarea class="to to-summation no-area-container" style="margin-top: 0.176471em;"><line class="" style="line-height: 1.2;"><baselineblock></baselineblock><block>t=1</block></line></editarea></compositeblock><block class="Normal">e</block><compositeblock dir="ltr" class="power-index-symbol-container has-power"><editarea-block class="power-value" style="line-height: 1.2; margin-top: 0em; margin-bottom: -1.05378em;">2</editarea-block><middle-base><inline></inline></middle-base><editarea-block class="index-value" style="line-height: 1.2; margin-top: -0.693024em; margin-bottom: 0em;">t</editarea-block></compositeblock></line></editarea><span role="presentation" style="width:100%;position:absolute;top:0;left:0;clip:rect(1px, 1px, 1px, 1px);height:1px;padding:1px 0 0 0!important;overflow:hidden;user-select:none;"><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><munderover><mo largeop="true" movablelimit="true"></mo><mrow><mi>t</mi><mo form="infix">=</mo><mn>2</mn></mrow><mi>T</mi></munderover><mo fence="true">(</mo><mo fence="true" stretchy="false">(</mo><msub><mi>e</mi><mi>t</mi></msub><mo form="infix">-</mo><msub><mi>e</mi><mrow><mi>t</mi><mo form="infix">-</mo><mn>1</mn></mrow></msub><msup><mo fence="true" stretchy="false">)</mo><mn>2</mn></msup><mo fence="true">)</mo><mo form="infix">/</mo><munderover><mo largeop="true" movablelimit="true"></mo><mrow><mi>t</mi><mo form="infix">=</mo><mn>1</mn></mrow><mi>T</mi></munderover><msubsup><mi>e</mi><mi>t</mi><mn>2</mn></msubsup></math></span></compositeblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; color: rgb(255, 64, 0);">Normality</block><block>  </block><compositeblock dir="ltr" class="math-container-symbol role-mathmode-area inline" style="font-size: 17px;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mstyle displaystyle=&quot;true&quot;><mi>Y</mi></mstyle></math>"><editarea class="math-mode-font lazyable no-area-container" style="font-family: LatinModern-Math, LatinModern, Asana-Math, Asana;" aria-hidden="true"><line class="" style="line-height: 1.2;"><baselineblock></baselineblock><block class="Normal">Y</block></line></editarea><span role="presentation" style="width:100%;position:absolute;top:0;left:0;clip:rect(1px, 1px, 1px, 1px);height:1px;padding:1px 0 0 0!important;overflow:hidden;user-select:none;"><math xmlns="http://www.w3.org/1998/Math/MathML"><mstyle displaystyle="true"><mi>Y</mi></mstyle></math></span></compositeblock><block> is normally distributed for any fixed observation.</block></blocks></line><line class="root text-mode indent-2 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="3"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;">* </prefix><blocks><baselineblock class="inline"></baselineblock><block>To check the normality use the </block><block style="font-weight: bold;">q-q plot</block><block> we can infer if the data comes from a normal distribution.</block></blocks></line><line class="root text-mode indent-2 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="3"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;">* </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 559.2px; height: 279.16px; position: relative;"><img src="image-resources/a359672c-d10f-47b9-ab69-88f1af3f0920.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; color: rgb(255, 64, 0);">Homoscedasticity</block><block>  The variance of the residuals is the same for any feature.</block></blocks></line><line class="root text-mode indent-2 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="3"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;">* </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold;">Homoscedasticity</block><block> describes a situation in which the error term ( the noise or random disturbance in the relationship between the independent and the target) is the same across all values of the independent variables. </block></blocks></line><line class="root text-mode indent-2 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="3"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;">* </prefix><blocks><baselineblock class="inline"></baselineblock><block>A scatter plot of residual values vs predicted values is a good way to check for homoscedasticity.</block></blocks></line><line class="root text-mode indent-2 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="3"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;">* </prefix><blocks><baselineblock class="inline"></baselineblock><block>If the variance of the residual is symmetrically distributed across the residual line then data is said to be homoscedastic.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 668.4px; height: 192.9px; position: relative;"><img src="image-resources/d9b4cbd7-40b5-4672-9821-791a14706f13.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div data-caption-block-id="n0.8499936068504568" class="role-image-caption-container role-caption-container" style="display: flex; align-items: center; justify-content: center; margin-top: 10px;" id="n0.8499936068504568"><span class="no-print-outline" style="outline: none; position: relative; text-align: center;"><span class="role-image-caption-prefix" style="padding-right: 0.3em; font-weight: bold;"><span class="role-image-caption-name">Figure</span><span class="role-image-caption-number"><!-- react-text: 28066 --> <!-- /react-text --><!-- react-text: 28067 -->4<!-- /react-text --></span><span>:</span></span><editarea class="image-caption text-mode" style="min-width: 50px; display: inline;"><line class="text-mode align-center" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><block class="role-hyper-link" data-hyper-link-url="https://www.fireblazeaischool.in/blogs/assumptions-of-linear-regression/" style="text-decoration: underline; color: rgb(17, 85, 204);"><a href="https://www.fireblazeaischool.in/blogs/assumptions-of-linear-regression/" target="_blank" style="color: inherit; text-decoration: inherit;">Source</a></block></blocks></line></editarea></span></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 639.389px; height: 427.53px; position: relative;"><img src="image-resources/7304fd35-ab19-4d2f-9d06-e9d88467118d.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 635.592px; height: 170.59px; position: relative;"><img src="image-resources/3c03e12f-db20-4df6-b790-8c6d5f753890.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="font-weight: bold; flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold;">Spark Machine Learning Libraries</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="color: rgb(255, 64, 0); font-weight: bold; flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; color: rgb(255, 64, 0);">MLlib</block></blocks></line><line class="root text-mode indent-2 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="3"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;">* </prefix><blocks><baselineblock class="inline"></baselineblock><block>Original ML API for Spark</block></blocks></line><line class="root text-mode indent-2 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="3"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;">* </prefix><blocks><baselineblock class="inline"></baselineblock><block>Based on RDDs</block></blocks></line><line class="root text-mode indent-2 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="3"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;">* </prefix><blocks><baselineblock class="inline"></baselineblock><block>Maintenance mode</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="color: rgb(255, 64, 0); font-weight: bold; flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; color: rgb(255, 64, 0);">Spark ML</block></blocks></line><line class="root text-mode indent-2 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="3"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;">* </prefix><blocks><baselineblock class="inline"></baselineblock><block>Newer ML API for Spark</block></blocks></line><line class="root text-mode indent-2 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="3"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;">* </prefix><blocks><baselineblock class="inline"></baselineblock><block>Based on DataFrames</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">[</block><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><compositeblock dir="ltr" class="anchor-tag-ref inline" style="font-family: &quot;Computer Modern Serif&quot;, serif;"><a href="#n0.3295185310066928" style="color: inherit; text-decoration: inherit;">Back To Top</a></compositeblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">]</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode section sindent-1" data-line-id="n0.20424649910908288" style="font-size: 1.1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.20424649910908288" role="heading" aria-level="2"><prefix style="text-align: left; padding-right: 0.25em;">3.1. </prefix><blocks><baselineblock class="inline"></baselineblock><block>Implementation - Predicting Rental Price</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>We'll use the Airbnb data to predict rental prices in San Francisco.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>We're going to use Vector Assembler from Spark to create our feature vectors.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode section sindent-2" data-line-id="n0.1343993664945069" style="font-size: 1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.1343993664945069" role="heading" aria-level="3"><prefix style="text-align: left; padding-right: 0em;">3.1.1. </prefix><blocks><baselineblock class="inline"></baselineblock><block>Vector Assembler</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>The linear regression estimator (</block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(79, 167, 176); background-color: rgba(155, 155, 155, 0.2);">.fit()</block><block>) expects a column of </block><block style="font-weight: bold;">Vector</block><block> type as input.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>VectorAssembler is an example of a </block><block style="font-weight: bold;">transformer</block><block>. </block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Transformers take in a DataFrame, and return a new DataFrame with one or more columns appended to it. </block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>They do not learn from your data, but apply rule based transformations.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>More on this </block><block class="role-hyper-link" data-hyper-link-url="https://spark.apache.org/docs/latest/ml-features.html#vectorassembler" style="text-decoration: underline; color: rgb(17, 85, 204);"><a href="https://spark.apache.org/docs/latest/ml-features.html#vectorassembler" target="_blank" style="color: inherit; text-decoration: inherit;">here</a></block><block>.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Read the data</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">file_path </block><block class="operator token">=</block><block class=" token"> </block><block class="string-interpolation string token">f"</block><block class="string-interpolation interpolation punctuation token">{</block><block class="string-interpolation interpolation token">DA</block><block class="string-interpolation interpolation punctuation token">.</block><block class="string-interpolation interpolation token">paths</block><block class="string-interpolation interpolation punctuation token">.</block><block class="string-interpolation interpolation token">datasets</block><block class="string-interpolation interpolation punctuation token">}</block><block class="string-interpolation string token">/airbnb/sf-listings/sf-listings-2019-03-06-clean.delta/"</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">airbnb_df </block><block class="operator token">=</block><block class=" token"> spark</block><block class="punctuation token">.</block><block class=" token">read</block><block class="punctuation token">.</block><block class="builtin token">format</block><block class="punctuation token">(</block><block class="string token">"delta"</block><block class="punctuation token">)</block><block class="punctuation token">.</block><block class=" token">load</block><block class="punctuation token">(</block><block class=" token">file_path</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Train and test data split</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># It's necessary to set the seed number. What happens if I change my cluster configuration?</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">train_df</block><block class="punctuation token">,</block><block class=" token"> test_df </block><block class="operator token">=</block><block class=" token"> airbnb_df</block><block class="punctuation token">.</block><block class=" token">randomSplit</block><block class="punctuation token">(</block><block class="punctuation token">[</block><block class="number token">.8</block><block class="punctuation token">,</block><block class=" token"> </block><block class="number token">.2</block><block class="punctuation token">]</block><block class="punctuation token">,</block><block class=" token"> seed</block><block class="operator token">=</block><block class="number token">42</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Change the number of partitions (to simulate a different cluster configuration).</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Let's check if we get the same number of data points in our training set.</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">train_repartition_df</block><block class="punctuation token">,</block><block class=" token"> test_repartition_df </block><block class="operator token">=</block><block class=" token"> </block><block class="punctuation token">(</block><block class=" token">airbnb_df</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">                                             </block><block class="punctuation token">.</block><block class=" token">repartition</block><block class="punctuation token">(</block><block class="number token">24</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">                                             </block><block class="punctuation token">.</block><block class=" token">randomSplit</block><block class="punctuation token">(</block><block class="punctuation token">[</block><block class="number token">.8</block><block class="punctuation token">,</block><block class=" token"> </block><block class="number token">.2</block><block class="punctuation token">]</block><block class="punctuation token">,</block><block class=" token"> seed</block><block class="operator token">=</block><block class="number token">42</block><block class="punctuation token">)</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># A simple regression model</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> pyspark</block><block class="punctuation token">.</block><block class=" token">ml</block><block class="punctuation token">.</block><block class=" token">regression </block><block class="keyword token">import</block><block class=" token"> LinearRegression</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> pyspark</block><block class="punctuation token">.</block><block class=" token">ml</block><block class="punctuation token">.</block><block class=" token">feature </block><block class="keyword token">import</block><block class=" token"> VectorAssembler</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">vec_assembler </block><block class="operator token">=</block><block class=" token"> VectorAssembler</block><block class="punctuation token">(</block><block class=" token">inputCols</block><block class="operator token">=</block><block class="punctuation token">[</block><block class="string token">"bedrooms"</block><block class="punctuation token">]</block><block class="punctuation token">,</block><block class=" token"> outputCol</block><block class="operator token">=</block><block class="string token">"features"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">vec_train_df </block><block class="operator token">=</block><block class=" token"> vec_assembler</block><block class="punctuation token">.</block><block class=" token">transform</block><block class="punctuation token">(</block><block class=" token">train_df</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">lr </block><block class="operator token">=</block><block class=" token"> LinearRegression</block><block class="punctuation token">(</block><block class=" token">featuresCol</block><block class="operator token">=</block><block class="string token">"features"</block><block class="punctuation token">,</block><block class=" token"> labelCol</block><block class="operator token">=</block><block class="string token">"price"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">lr_model </block><block class="operator token">=</block><block class=" token"> lr</block><block class="punctuation token">.</block><block class=" token">fit</block><block class="punctuation token">(</block><block class=" token">vec_train_df</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Inspect the model</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">m </block><block class="operator token">=</block><block class=" token"> lr_model</block><block class="punctuation token">.</block><block class=" token">coefficients</block><block class="punctuation token">[</block><block class="number token">0</block><block class="punctuation token">]</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">b </block><block class="operator token">=</block><block class=" token"> lr_model</block><block class="punctuation token">.</block><block class=" token">intercept</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">print</block><block class="punctuation token">(</block><block class="string-interpolation string token">f"The formula for the linear regression line is y = </block><block class="string-interpolation interpolation punctuation token">{</block><block class="string-interpolation interpolation token">m</block><block class="string-interpolation interpolation punctuation token">:</block><block class="string-interpolation interpolation format-spec token">.2f</block><block class="string-interpolation interpolation punctuation token">}</block><block class="string-interpolation string token">x + </block><block class="string-interpolation interpolation punctuation token">{</block><block class="string-interpolation interpolation token">b</block><block class="string-interpolation interpolation punctuation token">:</block><block class="string-interpolation interpolation format-spec token">.2f</block><block class="string-interpolation interpolation punctuation token">}</block><block class="string-interpolation string token">"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># The formula for the linear regression line is y = 123.54x + 50.09</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Predict</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">vec_test_df </block><block class="operator token">=</block><block class=" token"> vec_assembler</block><block class="punctuation token">.</block><block class=" token">transform</block><block class="punctuation token">(</block><block class=" token">test_df</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">pred_df </block><block class="operator token">=</block><block class=" token"> lr_model</block><block class="punctuation token">.</block><block class=" token">transform</block><block class="punctuation token">(</block><block class=" token">vec_test_df</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">pred_df</block><block class="punctuation token">.</block><block class=" token">select</block><block class="punctuation token">(</block><block class="string token">"bedrooms"</block><block class="punctuation token">,</block><block class=" token"> </block><block class="string token">"features"</block><block class="punctuation token">,</block><block class=" token"> </block><block class="string token">"price"</block><block class="punctuation token">,</block><block class=" token"> </block><block class="string token">"prediction"</block><block class="punctuation token">)</block><block class="punctuation token">.</block><block class=" token">show</block><block class="punctuation token">(</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># +--------+--------+-----+------------------+</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># |bedrooms|features|price|        prediction|</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># +--------+--------+-----+------------------+</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># |     1.0|   [1.0]| 86.0|173.63467134146967|</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># |     1.0|   [1.0]|190.0|173.63467134146967|</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># |     1.0|   [1.0]|100.0|173.63467134146967|</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># |     2.0|   [2.0]|325.0| 297.1745644790371|</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># |     1.0|   [1.0]|200.0|173.63467134146967|</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># |     1.0|   [1.0]|200.0|173.63467134146967|</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># |     0.0|   [0.0]| 80.0|50.094778203902216|</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># |     1.0|   [1.0]|160.0|173.63467134146967|</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># |     0.0|   [0.0]|132.0|50.094778203902216|</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># |     1.0|   [1.0]|100.0|173.63467134146967|</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># |     1.0|   [1.0]|165.0|173.63467134146967|</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># |     1.0|   [1.0]| 90.0|173.63467134146967|</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># |     1.0|   [1.0]| 73.0|173.63467134146967|</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># |     0.0|   [0.0]|119.0|50.094778203902216|</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># |     1.0|   [1.0]| 80.0|173.63467134146967|</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># |     1.0|   [1.0]| 84.0|173.63467134146967|</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># |     1.0|   [1.0]|119.0|173.63467134146967|</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Evaluate the model</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> pyspark</block><block class="punctuation token">.</block><block class=" token">ml</block><block class="punctuation token">.</block><block class=" token">evaluation </block><block class="keyword token">import</block><block class=" token"> RegressionEvaluator</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">regression_evaluator </block><block class="operator token">=</block><block class=" token"> RegressionEvaluator</block><block class="punctuation token">(</block><block class=" token">predictionCol</block><block class="operator token">=</block><block class="string token">"prediction"</block><block class="punctuation token">,</block><block class=" token"> labelCol</block><block class="operator token">=</block><block class="string token">"price"</block><block class="punctuation token">,</block><block class=" token"> metricName</block><block class="operator token">=</block><block class="string token">"rmse"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">rmse </block><block class="operator token">=</block><block class=" token"> regression_evaluator</block><block class="punctuation token">.</block><block class=" token">evaluate</block><block class="punctuation token">(</block><block class=" token">pred_df</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">print</block><block class="punctuation token">(</block><block class="string-interpolation string token">f"RMSE is </block><block class="string-interpolation interpolation punctuation token">{</block><block class="string-interpolation interpolation token">rmse</block><block class="string-interpolation interpolation punctuation token">}</block><block class="string-interpolation string token">"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># RMSE is 149.54529126695462</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">[</block><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><compositeblock dir="ltr" class="anchor-tag-ref inline" style="font-family: &quot;Computer Modern Serif&quot;, serif;"><a href="#n0.3295185310066928" style="color: inherit; text-decoration: inherit;">Back To Top</a></compositeblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">]</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode section sindent-1" data-line-id="n0.24644948505509645" style="font-size: 1.1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.24644948505509645" role="heading" aria-level="2"><prefix style="text-align: left; padding-right: 0.25em;">3.2. </prefix><blocks><baselineblock class="inline"></baselineblock><block>Improve the Model Performance</block></blocks></line><line class="root text-mode section sindent-2" data-line-id="n0.39202210320737896" style="font-size: 1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.39202210320737896" role="heading" aria-level="3"><prefix style="text-align: left; padding-right: 0em;">3.2.1. </prefix><blocks><baselineblock class="inline"></baselineblock><block>Categorical Variables</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>There are a few ways to handle categorical features:</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Assign them a numeric value</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Create "dummy" variables  a.k.a. </block><block style="font-weight: bold; color: rgb(255, 64, 0);">One-Hot Encoding</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Generate Embeddings  </block><block style="background-color: rgb(255, 254, 0);">mainly used for textual data</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="font-weight: bold; flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold;">One-Hot Encoder</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Spark doesn't have a dummies function, and </block><block style="text-decoration: underline;">OHE is a two-step process</block><block>. </block></blocks></line><line class="root text-mode indent-2 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="3"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;">* </prefix><blocks><baselineblock class="inline"></baselineblock><block>First, we need to use </block><block class="role-hyper-link" data-hyper-link-url="https://spark.apache.org/docs/latest/api/python/reference/api/pyspark.ml.feature.StringIndexer.html?highlight=stringindexer#pyspark.ml.feature.StringIndexer" style="text-decoration: underline; color: rgb(17, 85, 204);"><a href="https://spark.apache.org/docs/latest/api/python/reference/api/pyspark.ml.feature.StringIndexer.html?highlight=stringindexer#pyspark.ml.feature.StringIndexer" target="_blank" style="color: inherit; text-decoration: inherit;">StringIndexer</a></block><block> to map a string column of labels to an ML column of label indices.</block></blocks></line><line class="root text-mode indent-2 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="3"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;">* </prefix><blocks><baselineblock class="inline"></baselineblock><block>Then, we can apply the </block><block class="role-hyper-link" data-hyper-link-url="https://spark.apache.org/docs/latest/api/python/reference/api/pyspark.ml.feature.OneHotEncoder.html?highlight=onehotencoder#pyspark.ml.feature.OneHotEncoder" style="text-decoration: underline; color: rgb(17, 85, 204);"><a href="https://spark.apache.org/docs/latest/api/python/reference/api/pyspark.ml.feature.OneHotEncoder.html?highlight=onehotencoder#pyspark.ml.feature.OneHotEncoder" target="_blank" style="color: inherit; text-decoration: inherit;">OneHotEncoder</a></block><block> to the output of the StringIndexer.</block></blocks></line><line class="root text-mode indent-2 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="3"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;">* </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> pyspark</block><block class="punctuation token">.</block><block class=" token">ml</block><block class="punctuation token">.</block><block class=" token">feature </block><block class="keyword token">import</block><block class=" token"> OneHotEncoder</block><block class="punctuation token">,</block><block class=" token"> StringIndexer</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">categorical_cols </block><block class="operator token">=</block><block class=" token"> </block><block class="punctuation token">[</block><block class=" token">field </block><block class="keyword token">for</block><block class=" token"> </block><block class="punctuation token">(</block><block class=" token">field</block><block class="punctuation token">,</block><block class=" token"> dataType</block><block class="punctuation token">)</block><block class=" token"> </block><block class="keyword token">in</block><block class=" token"> train_df</block><block class="punctuation token">.</block><block class=" token">dtypes </block><block class="keyword token">if</block><block class=" token"> dataType </block><block class="operator token">==</block><block class=" token"> </block><block class="string token">"string"</block><block class="punctuation token">]</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">index_output_cols </block><block class="operator token">=</block><block class=" token"> </block><block class="punctuation token">[</block><block class=" token">x </block><block class="operator token">+</block><block class=" token"> </block><block class="string token">"Index"</block><block class=" token"> </block><block class="keyword token">for</block><block class=" token"> x </block><block class="keyword token">in</block><block class=" token"> categorical_cols</block><block class="punctuation token">]</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">ohe_output_cols </block><block class="operator token">=</block><block class=" token"> </block><block class="punctuation token">[</block><block class=" token">x </block><block class="operator token">+</block><block class=" token"> </block><block class="string token">"OHE"</block><block class=" token"> </block><block class="keyword token">for</block><block class=" token"> x </block><block class="keyword token">in</block><block class=" token"> categorical_cols</block><block class="punctuation token">]</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">string_indexer </block><block class="operator token">=</block><block class=" token"> StringIndexer</block><block class="punctuation token">(</block><block class=" token">inputCols</block><block class="operator token">=</block><block class=" token">categorical_cols</block><block class="punctuation token">,</block><block class=" token"> outputCols</block><block class="operator token">=</block><block class=" token">index_output_cols</block><block class="punctuation token">,</block><block class=" token"> handleInvalid</block><block class="operator token">=</block><block class="string token">"skip"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">ohe_encoder </block><block class="operator token">=</block><block class=" token"> OneHotEncoder</block><block class="punctuation token">(</block><block class=" token">inputCols</block><block class="operator token">=</block><block class=" token">index_output_cols</block><block class="punctuation token">,</block><block class=" token"> outputCols</block><block class="operator token">=</block><block class=" token">ohe_output_cols</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># -----------</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> pyspark</block><block class="punctuation token">.</block><block class=" token">ml</block><block class="punctuation token">.</block><block class=" token">feature </block><block class="keyword token">import</block><block class=" token"> VectorAssembler</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">numeric_cols </block><block class="operator token">=</block><block class=" token"> </block><block class="punctuation token">[</block><block class=" token">field </block><block class="keyword token">for</block><block class=" token"> </block><block class="punctuation token">(</block><block class=" token">field</block><block class="punctuation token">,</block><block class=" token"> dataType</block><block class="punctuation token">)</block><block class=" token"> </block><block class="keyword token">in</block><block class=" token"> train_df</block><block class="punctuation token">.</block><block class=" token">dtypes </block><block class="keyword token">if</block><block class=" token"> </block><block class="punctuation token">(</block><block class="punctuation token">(</block><block class=" token">dataType </block><block class="operator token">==</block><block class=" token"> </block><block class="string token">"double"</block><block class="punctuation token">)</block><block class=" token"> </block><block class="operator token">&amp;</block><block class=" token"> </block><block class="punctuation token">(</block><block class=" token">field </block><block class="operator token">!=</block><block class=" token"> </block><block class="string token">"price"</block><block class="punctuation token">)</block><block class="punctuation token">)</block><block class="punctuation token">]</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">assembler_inputs </block><block class="operator token">=</block><block class=" token"> ohe_output_cols </block><block class="operator token">+</block><block class=" token"> numeric_cols</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">vec_assembler </block><block class="operator token">=</block><block class=" token"> VectorAssembler</block><block class="punctuation token">(</block><block class=" token">inputCols</block><block class="operator token">=</block><block class=" token">assembler_inputs</block><block class="punctuation token">,</block><block class=" token"> outputCol</block><block class="operator token">=</block><block class="string token">"features"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># -----------</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> pyspark</block><block class="punctuation token">.</block><block class=" token">ml</block><block class="punctuation token">.</block><block class=" token">regression </block><block class="keyword token">import</block><block class=" token"> LinearRegression</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">lr </block><block class="operator token">=</block><block class=" token"> LinearRegression</block><block class="punctuation token">(</block><block class=" token">labelCol</block><block class="operator token">=</block><block class="string token">"price"</block><block class="punctuation token">,</block><block class=" token"> featuresCol</block><block class="operator token">=</block><block class="string token">"features"</block><block class="punctuation token">)</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>We're going to put all these stages in a </block><block style="font-weight: bold; color: rgb(255, 64, 0);">Pipeline</block><block>.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>A </block><block class="role-hyper-link" data-hyper-link-url="https://spark.apache.org/docs/latest/api/python/reference/api/pyspark.ml.Pipeline.html?highlight=pipeline#pyspark.ml.Pipeline" style="text-decoration: underline; font-weight: bold; color: rgb(17, 85, 204);"><a href="https://spark.apache.org/docs/latest/api/python/reference/api/pyspark.ml.Pipeline.html?highlight=pipeline#pyspark.ml.Pipeline" target="_blank" style="color: inherit; text-decoration: inherit;">Pipeline</a></block><block> is a way of organizing all of our transformers and estimators.</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>This way, we don't have to worry about remembering the same ordering of transformations to apply to our test dataset.</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> pyspark</block><block class="punctuation token">.</block><block class=" token">ml </block><block class="keyword token">import</block><block class=" token"> Pipeline</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">stages </block><block class="operator token">=</block><block class=" token"> </block><block class="punctuation token">[</block><block class=" token">string_indexer</block><block class="punctuation token">,</block><block class=" token"> ohe_encoder</block><block class="punctuation token">,</block><block class=" token"> vec_assembler</block><block class="punctuation token">,</block><block class=" token"> lr</block><block class="punctuation token">]</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">pipeline </block><block class="operator token">=</block><block class=" token"> Pipeline</block><block class="punctuation token">(</block><block class=" token">stages</block><block class="operator token">=</block><block class=" token">stages</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">pipeline_model </block><block class="operator token">=</block><block class=" token"> pipeline</block><block class="punctuation token">.</block><block class=" token">fit</block><block class="punctuation token">(</block><block class=" token">train_df</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># We can save our models to persistent storage (e.g. DBFS) in case our cluster goes down so we don't have to recompute our results.</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">pipeline_model</block><block class="punctuation token">.</block><block class=" token">write</block><block class="punctuation token">(</block><block class="punctuation token">)</block><block class="punctuation token">.</block><block class=" token">overwrite</block><block class="punctuation token">(</block><block class="punctuation token">)</block><block class="punctuation token">.</block><block class=" token">save</block><block class="punctuation token">(</block><block class=" token">DA</block><block class="punctuation token">.</block><block class=" token">paths</block><block class="punctuation token">.</block><block class=" token">working_dir</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Load the saved model</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Note: When you load in models, you need to know the type of model you are loading back in. For this reason, we recommend you always put your transformers/estimators into a Pipeline, so you can always load the generic PipelineModel back in.</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> pyspark</block><block class="punctuation token">.</block><block class=" token">ml </block><block class="keyword token">import</block><block class=" token"> PipelineModel</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">saved_pipeline_model </block><block class="operator token">=</block><block class=" token"> PipelineModel</block><block class="punctuation token">.</block><block class=" token">load</block><block class="punctuation token">(</block><block class=" token">DA</block><block class="punctuation token">.</block><block class=" token">paths</block><block class="punctuation token">.</block><block class=" token">working_dir</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Predict</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">pred_df </block><block class="operator token">=</block><block class=" token"> saved_pipeline_model</block><block class="punctuation token">.</block><block class=" token">transform</block><block class="punctuation token">(</block><block class=" token">test_df</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">display</block><block class="punctuation token">(</block><block class=" token">pred_df</block><block class="punctuation token">.</block><block class=" token">select</block><block class="punctuation token">(</block><block class="string token">"features"</block><block class="punctuation token">,</block><block class=" token"> </block><block class="string token">"price"</block><block class="punctuation token">,</block><block class=" token"> </block><block class="string token">"prediction"</block><block class="punctuation token">)</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># +--------------------+-----+------------------+</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># |            features|price|        prediction|</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># +--------------------+-----+------------------+</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># |(99,[0,3,6,12,43,...| 86.0| 42.87569095191793|</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># |(99,[0,3,6,11,45,...|190.0|207.79857051348517|</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># |(99,[0,3,6,28,42,...|100.0| 66.44237123080529|</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># |(99,[0,3,6,19,43,...|325.0|310.55147643214514|</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># |(99,[0,3,6,17,43,...|200.0| 14.25784629349073|</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># |(99,[0,3,6,14,42,...|200.0| 159.0941630804955|</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># |(99,[0,3,6,24,43,...| 80.0|-19.64792436422431|</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># |(99,[0,3,6,23,42,...|160.0|161.33811082075044|</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># |(99,[0,3,6,9,42,6...|132.0|112.37330010167352|</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># |(99,[0,3,6,9,44,6...|100.0| 215.7629068979477|</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># |(99,[0,3,6,9,45,6...|165.0|196.11129860923393|</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># |(99,[0,3,6,37,43,...| 90.0| 52.21644740317788|</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># |(99,[0,3,6,33,42,...| 73.0| 36.60153688950595|</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># |(99,[0,3,6,7,42,6...|119.0| 121.3226976055521|</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># |(99,[0,3,6,30,43,...| 80.0|62.285560607011575|</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># |(99,[0,3,6,23,42,...| 84.0|263.08656705308385|</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># |(99,[0,3,6,16,42,...|119.0| 168.0405324674648|</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Evaluate the model</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> pyspark</block><block class="punctuation token">.</block><block class=" token">ml</block><block class="punctuation token">.</block><block class=" token">evaluation </block><block class="keyword token">import</block><block class=" token"> RegressionEvaluator</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">regression_evaluator </block><block class="operator token">=</block><block class=" token"> RegressionEvaluator</block><block class="punctuation token">(</block><block class=" token">predictionCol</block><block class="operator token">=</block><block class="string token">"prediction"</block><block class="punctuation token">,</block><block class=" token"> labelCol</block><block class="operator token">=</block><block class="string token">"price"</block><block class="punctuation token">,</block><block class=" token"> metricName</block><block class="operator token">=</block><block class="string token">"rmse"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">rmse </block><block class="operator token">=</block><block class=" token"> regression_evaluator</block><block class="punctuation token">.</block><block class=" token">evaluate</block><block class="punctuation token">(</block><block class=" token">pred_df</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">r2 </block><block class="operator token">=</block><block class=" token"> regression_evaluator</block><block class="punctuation token">.</block><block class=" token">setMetricName</block><block class="punctuation token">(</block><block class="string token">"r2"</block><block class="punctuation token">)</block><block class="punctuation token">.</block><block class=" token">evaluate</block><block class="punctuation token">(</block><block class=" token">pred_df</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">print</block><block class="punctuation token">(</block><block class="string-interpolation string token">f"RMSE is </block><block class="string-interpolation interpolation punctuation token">{</block><block class="string-interpolation interpolation token">rmse</block><block class="string-interpolation interpolation punctuation token">}</block><block class="string-interpolation string token">"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">print</block><block class="punctuation token">(</block><block class="string-interpolation string token">f"R2 is </block><block class="string-interpolation interpolation punctuation token">{</block><block class="string-interpolation interpolation token">r2</block><block class="string-interpolation interpolation punctuation token">}</block><block class="string-interpolation string token">"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># RMSE is 133.4629525945939</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># R2 is 0.4416148762122888</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">[</block><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><compositeblock dir="ltr" class="anchor-tag-ref inline" style="font-family: &quot;Computer Modern Serif&quot;, serif;"><a href="#n0.3295185310066928" style="color: inherit; text-decoration: inherit;">Back To Top</a></compositeblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">]</block></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="inline" style="display: block;"><div style="vertical-align: baseline;"><div style="display: inline-block; height: 0px; border-bottom: 1px solid; width: 100%;"></div></div></compositeblock></blocks></line><line class="root text-mode section sindent-0" data-line-id="n0.16214072272500357" style="font-size: 1.2em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.16214072272500357" role="heading" aria-level="1"><prefix style="text-align: left; padding-right: 0.5em;">4. </prefix><blocks><baselineblock class="inline"></baselineblock><block>MLflow</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Open-source platform for ML lifecycle</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Operationalizing machine learning</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Developed by Databricks</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Pre-installed on the Databricks Runtime for ML</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="font-weight: bold; flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold;">Core ML Issues</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Keeping track of experiments or model development</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Reproducing code</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Comparing models</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Standardization of packaging and deploying models</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="font-weight: bold; flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; background-color: rgb(255, 254, 0);"> MLflow addresses these issues.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 696.4px; height: 305.9px; position: relative;"><img src="image-resources/8b2d4585-a2de-439c-823e-7ef6252626cc.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 697.284px; height: 351.02px; position: relative;"><img src="image-resources/1d6fe7c9-be03-4622-83ac-9f750728ccc6.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 703.239px; height: 291.57px; position: relative;"><img src="image-resources/2c909150-c94b-4762-a44b-7f8cc45d9f12.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 707.989px; height: 321.2px; position: relative;"><img src="image-resources/4aa16921-c8a0-48f3-ae09-8355b2026e7d.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">[</block><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><compositeblock dir="ltr" class="anchor-tag-ref inline" style="font-family: &quot;Computer Modern Serif&quot;, serif;"><a href="#n0.3295185310066928" style="color: inherit; text-decoration: inherit;">Back To Top</a></compositeblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">]</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode section sindent-1" data-line-id="n0.02344361203428158" style="font-size: 1.1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.02344361203428158" role="heading" aria-level="2"><prefix style="text-align: left; padding-right: 0.25em;">4.1. </prefix><blocks><baselineblock class="inline"></baselineblock><block>MLflow Tracking</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block class="role-hyper-link" data-hyper-link-url="https://mlflow.org/docs/latest/concepts.html" style="text-decoration: underline; color: rgb(17, 85, 204);"><a href="https://mlflow.org/docs/latest/concepts.html" target="_blank" style="color: inherit; text-decoration: inherit;">MLflow</a></block><block> seeks to address these three core issues:</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Its difficult to keep track of experiments.</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Its difficult to reproduce code.</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Theres no standard way to package and deploy models.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; color: rgb(255, 64, 0);">MLflow Tracking</block><block> is a </block><block style="text-decoration: underline;">logging API</block><block> specific for machine learning and </block><block style="text-decoration: underline;">agnostic to libraries and environments</block><block> that do the training. </block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="background-color: rgb(255, 254, 0);">It is organized around the concept of </block><block style="font-weight: bold; background-color: rgb(255, 254, 0);">runs</block><block>, which are executions of data science code. </block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; background-color: rgb(255, 254, 0);">Runs</block><block style="background-color: rgb(255, 254, 0);"> are aggregated into </block><block style="font-weight: bold; background-color: rgb(255, 254, 0);">experiments</block><block> where many runs can be a part of a given experiment and an MLflow server can host many experiments.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>You can use </block><block class="role-hyper-link" data-hyper-link-url="https://mlflow.org/docs/latest/python_api/mlflow.html#mlflow.set_experiment" style="text-decoration: underline; font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(79, 167, 176); background-color: rgba(155, 155, 155, 0.2);"><a href="https://mlflow.org/docs/latest/python_api/mlflow.html#mlflow.set_experiment" target="_blank" style="color: inherit; text-decoration: inherit;">mlflow.set_experiment()</a></block><block> to set an experiment, but if you do not specify an experiment, it will automatically be scoped to this notebook.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold;">Track Runs</block><block>  Each run can record the following information:</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; color: rgb(255, 64, 0);">Parameters:</block><block> Key-value pairs of input parameters such as the number of trees in a random forest model</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; color: rgb(255, 64, 0);">Metrics:</block><block> Evaluation metrics such as RMSE or Area Under the ROC Curve</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; color: rgb(255, 64, 0);">Artifacts:</block><block> Arbitrary output files in any format. This can include images, pickled models, and data files</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; color: rgb(255, 64, 0);">Source:</block><block> The code that originally ran the experiment.</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; background-color: rgb(255, 254, 0);">Note:</block><block> For Spark models, MLflow can only log PipelineModels.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Read the data</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">file_path </block><block class="operator token">=</block><block class=" token"> </block><block class="string-interpolation string token">f"</block><block class="string-interpolation interpolation punctuation token">{</block><block class="string-interpolation interpolation token">DA</block><block class="string-interpolation interpolation punctuation token">.</block><block class="string-interpolation interpolation token">paths</block><block class="string-interpolation interpolation punctuation token">.</block><block class="string-interpolation interpolation token">datasets</block><block class="string-interpolation interpolation punctuation token">}</block><block class="string-interpolation string token">/airbnb/sf-listings/sf-listings-2019-03-06-clean.delta/"</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">airbnb_df </block><block class="operator token">=</block><block class=" token"> spark</block><block class="punctuation token">.</block><block class=" token">read</block><block class="punctuation token">.</block><block class="builtin token">format</block><block class="punctuation token">(</block><block class="string token">"delta"</block><block class="punctuation token">)</block><block class="punctuation token">.</block><block class=" token">load</block><block class="punctuation token">(</block><block class=" token">file_path</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">train_df</block><block class="punctuation token">,</block><block class=" token"> test_df </block><block class="operator token">=</block><block class=" token"> airbnb_df</block><block class="punctuation token">.</block><block class=" token">randomSplit</block><block class="punctuation token">(</block><block class="punctuation token">[</block><block class="number token">.8</block><block class="punctuation token">,</block><block class=" token"> </block><block class="number token">.2</block><block class="punctuation token">]</block><block class="punctuation token">,</block><block class=" token"> seed</block><block class="operator token">=</block><block class="number token">42</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">print</block><block class="punctuation token">(</block><block class=" token">train_df</block><block class="punctuation token">.</block><block class=" token">cache</block><block class="punctuation token">(</block><block class="punctuation token">)</block><block class="punctuation token">.</block><block class=" token">count</block><block class="punctuation token">(</block><block class="punctuation token">)</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Setting up an MLflow experiment</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">import</block><block class=" token"> mlflow</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">import</block><block class=" token"> mlflow</block><block class="punctuation token">.</block><block class=" token">spark</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> pyspark</block><block class="punctuation token">.</block><block class=" token">ml</block><block class="punctuation token">.</block><block class=" token">regression </block><block class="keyword token">import</block><block class=" token"> LinearRegression</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> pyspark</block><block class="punctuation token">.</block><block class=" token">ml</block><block class="punctuation token">.</block><block class=" token">feature </block><block class="keyword token">import</block><block class=" token"> VectorAssembler</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> pyspark</block><block class="punctuation token">.</block><block class=" token">ml </block><block class="keyword token">import</block><block class=" token"> Pipeline</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> pyspark</block><block class="punctuation token">.</block><block class=" token">ml</block><block class="punctuation token">.</block><block class=" token">evaluation </block><block class="keyword token">import</block><block class=" token"> RegressionEvaluator</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">with</block><block class=" token"> mlflow</block><block class="punctuation token">.</block><block class=" token">start_run</block><block class="punctuation token">(</block><block class=" token">run_name</block><block class="operator token">=</block><block class="string token">"LR-Single-Feature"</block><block class="punctuation token">)</block><block class=" token"> </block><block class="keyword token">as</block><block class=" token"> run</block><block class="punctuation token">:</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block><block class="comment token"># Define pipeline</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    vec_assembler </block><block class="operator token">=</block><block class=" token"> VectorAssembler</block><block class="punctuation token">(</block><block class=" token">inputCols</block><block class="operator token">=</block><block class="punctuation token">[</block><block class="string token">"bedrooms"</block><block class="punctuation token">]</block><block class="punctuation token">,</block><block class=" token"> outputCol</block><block class="operator token">=</block><block class="string token">"features"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    lr </block><block class="operator token">=</block><block class=" token"> LinearRegression</block><block class="punctuation token">(</block><block class=" token">featuresCol</block><block class="operator token">=</block><block class="string token">"features"</block><block class="punctuation token">,</block><block class=" token"> labelCol</block><block class="operator token">=</block><block class="string token">"price"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    pipeline </block><block class="operator token">=</block><block class=" token"> Pipeline</block><block class="punctuation token">(</block><block class=" token">stages</block><block class="operator token">=</block><block class="punctuation token">[</block><block class=" token">vec_assembler</block><block class="punctuation token">,</block><block class=" token"> lr</block><block class="punctuation token">]</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    pipeline_model </block><block class="operator token">=</block><block class=" token"> pipeline</block><block class="punctuation token">.</block><block class=" token">fit</block><block class="punctuation token">(</block><block class=" token">train_df</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block><block class="comment token"># Log parameters</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    mlflow</block><block class="punctuation token">.</block><block class=" token">log_param</block><block class="punctuation token">(</block><block class="string token">"label"</block><block class="punctuation token">,</block><block class=" token"> </block><block class="string token">"price"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    mlflow</block><block class="punctuation token">.</block><block class=" token">log_param</block><block class="punctuation token">(</block><block class="string token">"features"</block><block class="punctuation token">,</block><block class=" token"> </block><block class="string token">"bedrooms"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block><block class="comment token"># Log model</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    mlflow</block><block class="punctuation token">.</block><block class=" token">spark</block><block class="punctuation token">.</block><block class=" token">log_model</block><block class="punctuation token">(</block><block class=" token">pipeline_model</block><block class="punctuation token">,</block><block class=" token"> </block><block class="string token">"model"</block><block class="punctuation token">,</block><block class=" token"> input_example</block><block class="operator token">=</block><block class=" token">train_df</block><block class="punctuation token">.</block><block class=" token">limit</block><block class="punctuation token">(</block><block class="number token">5</block><block class="punctuation token">)</block><block class="punctuation token">.</block><block class=" token">toPandas</block><block class="punctuation token">(</block><block class="punctuation token">)</block><block class="punctuation token">)</block><block class=" token"> </block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block><block class="comment token"># Evaluate predictions</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    pred_df </block><block class="operator token">=</block><block class=" token"> pipeline_model</block><block class="punctuation token">.</block><block class=" token">transform</block><block class="punctuation token">(</block><block class=" token">test_df</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    regression_evaluator </block><block class="operator token">=</block><block class=" token"> RegressionEvaluator</block><block class="punctuation token">(</block><block class=" token">predictionCol</block><block class="operator token">=</block><block class="string token">"prediction"</block><block class="punctuation token">,</block><block class=" token"> labelCol</block><block class="operator token">=</block><block class="string token">"price"</block><block class="punctuation token">,</block><block class=" token"> metricName</block><block class="operator token">=</block><block class="string token">"rmse"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    rmse </block><block class="operator token">=</block><block class=" token"> regression_evaluator</block><block class="punctuation token">.</block><block class=" token">evaluate</block><block class="punctuation token">(</block><block class=" token">pred_df</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block><block class="comment token"># Log metrics</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    mlflow</block><block class="punctuation token">.</block><block class=" token">log_metric</block><block class="punctuation token">(</block><block class="string token">"rmse"</block><block class="punctuation token">,</block><block class=" token"> rmse</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Adding another model to the experiment</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> pyspark</block><block class="punctuation token">.</block><block class=" token">ml</block><block class="punctuation token">.</block><block class=" token">feature </block><block class="keyword token">import</block><block class=" token"> RFormula</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">with</block><block class=" token"> mlflow</block><block class="punctuation token">.</block><block class=" token">start_run</block><block class="punctuation token">(</block><block class=" token">run_name</block><block class="operator token">=</block><block class="string token">"LR-All-Features"</block><block class="punctuation token">)</block><block class=" token"> </block><block class="keyword token">as</block><block class=" token"> run</block><block class="punctuation token">:</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block><block class="comment token"># Create pipeline</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    r_formula </block><block class="operator token">=</block><block class=" token"> RFormula</block><block class="punctuation token">(</block><block class=" token">formula</block><block class="operator token">=</block><block class="string token">"price ~ ."</block><block class="punctuation token">,</block><block class=" token"> featuresCol</block><block class="operator token">=</block><block class="string token">"features"</block><block class="punctuation token">,</block><block class=" token"> labelCol</block><block class="operator token">=</block><block class="string token">"price"</block><block class="punctuation token">,</block><block class=" token"> handleInvalid</block><block class="operator token">=</block><block class="string token">"skip"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    lr </block><block class="operator token">=</block><block class=" token"> LinearRegression</block><block class="punctuation token">(</block><block class=" token">labelCol</block><block class="operator token">=</block><block class="string token">"price"</block><block class="punctuation token">,</block><block class=" token"> featuresCol</block><block class="operator token">=</block><block class="string token">"features"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    pipeline </block><block class="operator token">=</block><block class=" token"> Pipeline</block><block class="punctuation token">(</block><block class=" token">stages</block><block class="operator token">=</block><block class="punctuation token">[</block><block class=" token">r_formula</block><block class="punctuation token">,</block><block class=" token"> lr</block><block class="punctuation token">]</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    pipeline_model </block><block class="operator token">=</block><block class=" token"> pipeline</block><block class="punctuation token">.</block><block class=" token">fit</block><block class="punctuation token">(</block><block class=" token">train_df</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block><block class="comment token"># Log pipeline</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    mlflow</block><block class="punctuation token">.</block><block class=" token">spark</block><block class="punctuation token">.</block><block class=" token">log_model</block><block class="punctuation token">(</block><block class=" token">pipeline_model</block><block class="punctuation token">,</block><block class=" token"> </block><block class="string token">"model"</block><block class="punctuation token">,</block><block class=" token"> input_example</block><block class="operator token">=</block><block class=" token">train_df</block><block class="punctuation token">.</block><block class=" token">limit</block><block class="punctuation token">(</block><block class="number token">5</block><block class="punctuation token">)</block><block class="punctuation token">.</block><block class=" token">toPandas</block><block class="punctuation token">(</block><block class="punctuation token">)</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block><block class="comment token"># Log parameter</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    mlflow</block><block class="punctuation token">.</block><block class=" token">log_param</block><block class="punctuation token">(</block><block class="string token">"label"</block><block class="punctuation token">,</block><block class=" token"> </block><block class="string token">"price"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    mlflow</block><block class="punctuation token">.</block><block class=" token">log_param</block><block class="punctuation token">(</block><block class="string token">"features"</block><block class="punctuation token">,</block><block class=" token"> </block><block class="string token">"all_features"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block><block class="comment token"># Create predictions and metrics</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    pred_df </block><block class="operator token">=</block><block class=" token"> pipeline_model</block><block class="punctuation token">.</block><block class=" token">transform</block><block class="punctuation token">(</block><block class=" token">test_df</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    regression_evaluator </block><block class="operator token">=</block><block class=" token"> RegressionEvaluator</block><block class="punctuation token">(</block><block class=" token">labelCol</block><block class="operator token">=</block><block class="string token">"price"</block><block class="punctuation token">,</block><block class=" token"> predictionCol</block><block class="operator token">=</block><block class="string token">"prediction"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    rmse </block><block class="operator token">=</block><block class=" token"> regression_evaluator</block><block class="punctuation token">.</block><block class=" token">setMetricName</block><block class="punctuation token">(</block><block class="string token">"rmse"</block><block class="punctuation token">)</block><block class="punctuation token">.</block><block class=" token">evaluate</block><block class="punctuation token">(</block><block class=" token">pred_df</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    r2 </block><block class="operator token">=</block><block class=" token"> regression_evaluator</block><block class="punctuation token">.</block><block class=" token">setMetricName</block><block class="punctuation token">(</block><block class="string token">"r2"</block><block class="punctuation token">)</block><block class="punctuation token">.</block><block class=" token">evaluate</block><block class="punctuation token">(</block><block class=" token">pred_df</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block><block class="comment token"># Log both metrics</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    mlflow</block><block class="punctuation token">.</block><block class=" token">log_metric</block><block class="punctuation token">(</block><block class="string token">"rmse"</block><block class="punctuation token">,</block><block class=" token"> rmse</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    mlflow</block><block class="punctuation token">.</block><block class=" token">log_metric</block><block class="punctuation token">(</block><block class="string token">"r2"</block><block class="punctuation token">,</block><block class=" token"> r2</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Adding yet another model to the experiment</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> pyspark</block><block class="punctuation token">.</block><block class=" token">sql</block><block class="punctuation token">.</block><block class=" token">functions </block><block class="keyword token">import</block><block class=" token"> col</block><block class="punctuation token">,</block><block class=" token"> log</block><block class="punctuation token">,</block><block class=" token"> exp</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">import</block><block class=" token"> matplotlib</block><block class="punctuation token">.</block><block class=" token">pyplot </block><block class="keyword token">as</block><block class=" token"> plt</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">with</block><block class=" token"> mlflow</block><block class="punctuation token">.</block><block class=" token">start_run</block><block class="punctuation token">(</block><block class=" token">run_name</block><block class="operator token">=</block><block class="string token">"LR-Log-Price"</block><block class="punctuation token">)</block><block class=" token"> </block><block class="keyword token">as</block><block class=" token"> run</block><block class="punctuation token">:</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block><block class="comment token"># Take log of price</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    log_train_df </block><block class="operator token">=</block><block class=" token"> train_df</block><block class="punctuation token">.</block><block class=" token">withColumn</block><block class="punctuation token">(</block><block class="string token">"log_price"</block><block class="punctuation token">,</block><block class=" token"> log</block><block class="punctuation token">(</block><block class=" token">col</block><block class="punctuation token">(</block><block class="string token">"price"</block><block class="punctuation token">)</block><block class="punctuation token">)</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    log_test_df </block><block class="operator token">=</block><block class=" token"> test_df</block><block class="punctuation token">.</block><block class=" token">withColumn</block><block class="punctuation token">(</block><block class="string token">"log_price"</block><block class="punctuation token">,</block><block class=" token"> log</block><block class="punctuation token">(</block><block class=" token">col</block><block class="punctuation token">(</block><block class="string token">"price"</block><block class="punctuation token">)</block><block class="punctuation token">)</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block><block class="comment token"># Log parameter</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    mlflow</block><block class="punctuation token">.</block><block class=" token">log_param</block><block class="punctuation token">(</block><block class="string token">"label"</block><block class="punctuation token">,</block><block class=" token"> </block><block class="string token">"log_price"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    mlflow</block><block class="punctuation token">.</block><block class=" token">log_param</block><block class="punctuation token">(</block><block class="string token">"features"</block><block class="punctuation token">,</block><block class=" token"> </block><block class="string token">"all_features"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block><block class="comment token"># Create pipeline</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    r_formula </block><block class="operator token">=</block><block class=" token"> RFormula</block><block class="punctuation token">(</block><block class=" token">formula</block><block class="operator token">=</block><block class="string token">"log_price ~ . - price"</block><block class="punctuation token">,</block><block class=" token"> featuresCol</block><block class="operator token">=</block><block class="string token">"features"</block><block class="punctuation token">,</block><block class=" token"> labelCol</block><block class="operator token">=</block><block class="string token">"log_price"</block><block class="punctuation token">,</block><block class=" token"> handleInvalid</block><block class="operator token">=</block><block class="string token">"skip"</block><block class="punctuation token">)</block><block class=" token">  </block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    lr </block><block class="operator token">=</block><block class=" token"> LinearRegression</block><block class="punctuation token">(</block><block class=" token">labelCol</block><block class="operator token">=</block><block class="string token">"log_price"</block><block class="punctuation token">,</block><block class=" token"> predictionCol</block><block class="operator token">=</block><block class="string token">"log_prediction"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    pipeline </block><block class="operator token">=</block><block class=" token"> Pipeline</block><block class="punctuation token">(</block><block class=" token">stages</block><block class="operator token">=</block><block class="punctuation token">[</block><block class=" token">r_formula</block><block class="punctuation token">,</block><block class=" token"> lr</block><block class="punctuation token">]</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    pipeline_model </block><block class="operator token">=</block><block class=" token"> pipeline</block><block class="punctuation token">.</block><block class=" token">fit</block><block class="punctuation token">(</block><block class=" token">log_train_df</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block><block class="comment token"># Log model</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    mlflow</block><block class="punctuation token">.</block><block class=" token">spark</block><block class="punctuation token">.</block><block class=" token">log_model</block><block class="punctuation token">(</block><block class=" token">pipeline_model</block><block class="punctuation token">,</block><block class=" token"> </block><block class="string token">"log-model"</block><block class="punctuation token">,</block><block class=" token"> input_example</block><block class="operator token">=</block><block class=" token">log_train_df</block><block class="punctuation token">.</block><block class=" token">limit</block><block class="punctuation token">(</block><block class="number token">5</block><block class="punctuation token">)</block><block class="punctuation token">.</block><block class=" token">toPandas</block><block class="punctuation token">(</block><block class="punctuation token">)</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block><block class="comment token"># Make predictions</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    pred_df </block><block class="operator token">=</block><block class=" token"> pipeline_model</block><block class="punctuation token">.</block><block class=" token">transform</block><block class="punctuation token">(</block><block class=" token">log_test_df</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    exp_df </block><block class="operator token">=</block><block class=" token"> pred_df</block><block class="punctuation token">.</block><block class=" token">withColumn</block><block class="punctuation token">(</block><block class="string token">"prediction"</block><block class="punctuation token">,</block><block class=" token"> exp</block><block class="punctuation token">(</block><block class=" token">col</block><block class="punctuation token">(</block><block class="string token">"log_prediction"</block><block class="punctuation token">)</block><block class="punctuation token">)</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block><block class="comment token"># Evaluate predictions</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    rmse </block><block class="operator token">=</block><block class=" token"> regression_evaluator</block><block class="punctuation token">.</block><block class=" token">setMetricName</block><block class="punctuation token">(</block><block class="string token">"rmse"</block><block class="punctuation token">)</block><block class="punctuation token">.</block><block class=" token">evaluate</block><block class="punctuation token">(</block><block class=" token">exp_df</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    r2 </block><block class="operator token">=</block><block class=" token"> regression_evaluator</block><block class="punctuation token">.</block><block class=" token">setMetricName</block><block class="punctuation token">(</block><block class="string token">"r2"</block><block class="punctuation token">)</block><block class="punctuation token">.</block><block class=" token">evaluate</block><block class="punctuation token">(</block><block class=" token">exp_df</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block><block class="comment token"># Log metrics</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    mlflow</block><block class="punctuation token">.</block><block class=" token">log_metric</block><block class="punctuation token">(</block><block class="string token">"rmse"</block><block class="punctuation token">,</block><block class=" token"> rmse</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    mlflow</block><block class="punctuation token">.</block><block class=" token">log_metric</block><block class="punctuation token">(</block><block class="string token">"r2"</block><block class="punctuation token">,</block><block class=" token"> r2</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block><block class="comment token"># Log artifact</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    plt</block><block class="punctuation token">.</block><block class=" token">clf</block><block class="punctuation token">(</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    log_train_df</block><block class="punctuation token">.</block><block class=" token">toPandas</block><block class="punctuation token">(</block><block class="punctuation token">)</block><block class="punctuation token">.</block><block class=" token">hist</block><block class="punctuation token">(</block><block class=" token">column</block><block class="operator token">=</block><block class="string token">"log_price"</block><block class="punctuation token">,</block><block class=" token"> bins</block><block class="operator token">=</block><block class="number token">100</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    fig </block><block class="operator token">=</block><block class=" token"> plt</block><block class="punctuation token">.</block><block class=" token">gcf</block><block class="punctuation token">(</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    mlflow</block><block class="punctuation token">.</block><block class=" token">log_figure</block><block class="punctuation token">(</block><block class=" token">fig</block><block class="punctuation token">,</block><block class=" token"> </block><block class="string-interpolation string token">f"</block><block class="string-interpolation interpolation punctuation token">{</block><block class="string-interpolation interpolation token">DA</block><block class="string-interpolation interpolation punctuation token">.</block><block class="string-interpolation interpolation token">username</block><block class="string-interpolation interpolation punctuation token">}</block><block class="string-interpolation string token">_log_normal.png"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    plt</block><block class="punctuation token">.</block><block class=" token">show</block><block class="punctuation token">(</block><block class="punctuation token">)</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 480.397px; height: 327.71px; position: relative;"><img src="image-resources/adbeeb20-6214-4de5-b380-9420b3549d46.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Now, we can query past runs either through the UI or the MLflow API.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">[</block><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><compositeblock dir="ltr" class="anchor-tag-ref inline" style="font-family: &quot;Computer Modern Serif&quot;, serif;"><a href="#n0.3295185310066928" style="color: inherit; text-decoration: inherit;">Back To Top</a></compositeblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">]</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode section sindent-2" data-line-id="n0.25874653523012436" style="font-size: 1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.25874653523012436" role="heading" aria-level="3"><prefix style="text-align: left; padding-right: 0em;">4.1.1. </prefix><blocks><baselineblock class="inline"></baselineblock><block>Querying Past Runs Programmatically</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>You can query past runs programmatically in order to use this data back in Python. </block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>The pathway to doing this is an </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(79, 167, 176); background-color: rgba(155, 155, 155, 0.2);">MlflowClient</block><block> object.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> mlflow</block><block class="punctuation token">.</block><block class=" token">tracking </block><block class="keyword token">import</block><block class=" token"> MlflowClient</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">client </block><block class="operator token">=</block><block class=" token"> MlflowClient</block><block class="punctuation token">(</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">display</block><block class="punctuation token">(</block><block class=" token">client</block><block class="punctuation token">.</block><block class=" token">search_experiments</block><block class="punctuation token">(</block><block class="punctuation token">)</block><block class="punctuation token">)</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 678.784px; height: 122.31px; position: relative;"><img src="image-resources/bd0b35ca-a57b-4eaf-8ed9-4b91acf1eb07.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>You can also use </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(79, 167, 176); background-color: rgba(155, 155, 155, 0.2);">search_runs</block><block> (</block><block class="role-hyper-link" data-hyper-link-url="https://mlflow.org/docs/latest/search-syntax.html" style="text-decoration: underline; color: rgb(17, 85, 204);"><a href="https://mlflow.org/docs/latest/search-syntax.html" target="_blank" style="color: inherit; text-decoration: inherit;">documentation</a></block><block>) to find all runs for a given experiment.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">experiment_id </block><block class="operator token">=</block><block class=" token"> run</block><block class="punctuation token">.</block><block class=" token">info</block><block class="punctuation token">.</block><block class=" token">experiment_id</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">runs_df </block><block class="operator token">=</block><block class=" token"> mlflow</block><block class="punctuation token">.</block><block class=" token">search_runs</block><block class="punctuation token">(</block><block class=" token">experiment_id</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">display</block><block class="punctuation token">(</block><block class=" token">runs_df</block><block class="punctuation token">)</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 679.195px; height: 139.02px; position: relative;"><img src="image-resources/18734256-ce83-471b-8c3a-f5a1da570d8c.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Pull the last run:</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">runs </block><block class="operator token">=</block><block class=" token"> client</block><block class="punctuation token">.</block><block class=" token">search_runs</block><block class="punctuation token">(</block><block class=" token">experiment_id</block><block class="punctuation token">,</block><block class=" token"> order_by</block><block class="operator token">=</block><block class="punctuation token">[</block><block class="string token">"attributes.start_time desc"</block><block class="punctuation token">]</block><block class="punctuation token">,</block><block class=" token"> max_results</block><block class="operator token">=</block><block class="number token">1</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">runs</block><block class="punctuation token">[</block><block class="number token">0</block><block class="punctuation token">]</block><block class="punctuation token">.</block><block class=" token">data</block><block class="punctuation token">.</block><block class=" token">metrics</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># {'rmse': 129.41173406054935, 'r2': 0.4749995257435917}</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">runs</block><block class="punctuation token">[</block><block class="number token">0</block><block class="punctuation token">]</block><block class="punctuation token">.</block><block class=" token">info</block><block class="punctuation token">.</block><block class=" token">run_id</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># 'b7369870dafc416ab570b6641674eb09'</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Loading a saved model:</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">model_path </block><block class="operator token">=</block><block class=" token"> </block><block class="string-interpolation string token">f"runs:/</block><block class="string-interpolation interpolation punctuation token">{</block><block class="string-interpolation interpolation token">run</block><block class="string-interpolation interpolation punctuation token">.</block><block class="string-interpolation interpolation token">info</block><block class="string-interpolation interpolation punctuation token">.</block><block class="string-interpolation interpolation token">run_id</block><block class="string-interpolation interpolation punctuation token">}</block><block class="string-interpolation string token">/log-model"</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">loaded_model </block><block class="operator token">=</block><block class=" token"> mlflow</block><block class="punctuation token">.</block><block class=" token">spark</block><block class="punctuation token">.</block><block class=" token">load_model</block><block class="punctuation token">(</block><block class=" token">model_path</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">display</block><block class="punctuation token">(</block><block class=" token">loaded_model</block><block class="punctuation token">.</block><block class=" token">transform</block><block class="punctuation token">(</block><block class=" token">test_df</block><block class="punctuation token">)</block><block class="punctuation token">)</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">[</block><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><compositeblock dir="ltr" class="anchor-tag-ref inline" style="font-family: &quot;Computer Modern Serif&quot;, serif;"><a href="#n0.3295185310066928" style="color: inherit; text-decoration: inherit;">Back To Top</a></compositeblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">]</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode section sindent-2" data-line-id="n0.9652764508646992" style="font-size: 1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.9652764508646992" role="heading" aria-level="3"><prefix style="text-align: left; padding-right: 0em;">4.1.2. </prefix><blocks><baselineblock class="inline"></baselineblock><block>View Past Runs Using MLflow UI</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Go to the </block><block style="font-weight: bold; color: rgb(255, 64, 0);">"Experiments"</block><block> page and click on the experiment that you want to view.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Examine the following experiment details using the UI:</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>The </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(79, 167, 176); background-color: rgba(155, 155, 155, 0.2);">Experiment ID</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>The </block><block style="font-weight: bold;">artifact location</block><block>  This is where the artifacts are stored in DBFS.</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="font-weight: bold; flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold;">Table View</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>You can customize the table view which lists all runs for the experiment. For example, you can show/hide rmse or features columns.</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Following details can be found on the Experiment list page:</block></blocks></line><line class="root text-mode indent-2 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="3"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;">* </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold;">Run Name</block><block>  This is the run name is used while logging the run. Click on the name to view details of the run. See steps below for more details about run page.</block></blocks></line><line class="root text-mode indent-2 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="3"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;">* </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold;">Duration</block><block>  This shows the elapsed time for each run.</block></blocks></line><line class="root text-mode indent-2 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="3"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;">* </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold;">Source</block><block>  This is the notebook that created this run.</block></blocks></line><line class="root text-mode indent-2 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="3"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;">* </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold;">Model</block><block>  This column shows the model type.</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>After clicking on the time of the run, take a look at the following:</block></blocks></line><line class="root text-mode indent-2 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="3"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;">* </prefix><blocks><baselineblock class="inline"></baselineblock><block>The </block><block style="font-weight: bold;">Run ID</block><block> will match what we printed above</block></blocks></line><line class="root text-mode indent-2 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="3"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;">* </prefix><blocks><baselineblock class="inline"></baselineblock><block>The model that we saved, as well as the Conda environment and the MLmodel file.</block></blocks></line><line class="root text-mode indent-2 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="3"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;">* </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">scikit-learn</block><block> models will have a </block><block style="text-decoration: underline;">pickled version</block><block> of the model. As in the code below we are using SparkML, no pickled version of the model is logged.</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; background-color: rgb(255, 254, 0);">Note:</block><block> that you can add notes under the "Description" tab to help keep track of important information about your models.</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Also, click on the run for the log normal distribution and see that the histogram is saved in "Artifacts".</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="font-weight: bold; flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold;">Chart View</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Chart view allows you to compare runs by features and evaluation metric. </block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>You can use various charts, such as bar chart or scatter plot chart, to visually compare experiment runs.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">[</block><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><compositeblock dir="ltr" class="anchor-tag-ref inline" style="font-family: &quot;Computer Modern Serif&quot;, serif;"><a href="#n0.3295185310066928" style="color: inherit; text-decoration: inherit;">Back To Top</a></compositeblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">]</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode section sindent-1" data-line-id="n0.5258652318920827" style="font-size: 1.1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.5258652318920827" role="heading" aria-level="2"><prefix style="text-align: left; padding-right: 0.25em;">4.2. </prefix><blocks><baselineblock class="inline"></baselineblock><block>MLflow Model Registry</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; color: rgb(255, 64, 0);">MLflow Model Registry</block><block> is a: </block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Collaborative, centralized </block><block style="text-decoration: underline;">model hub</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Facilitate experimentation, testing, and production</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Integrate with approval and governance workflows</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Monitor ML deployments and their performance</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block class="role-hyper-link" data-hyper-link-url="https://www.google.com/url?q=https://databricks.com/blog/2019/10/17/introducing-the-mlflow-model-registry.html&amp;sa=D&amp;source=editors&amp;ust=1701433483590849&amp;usg=AOvVaw3oYUGH9RiqBmto7Tcz__fE" style="text-decoration: underline; color: rgb(17, 85, 204);"><a href="https://www.google.com/url?q=https://databricks.com/blog/2019/10/17/introducing-the-mlflow-model-registry.html&amp;sa=D&amp;source=editors&amp;ust=1701433483590849&amp;usg=AOvVaw3oYUGH9RiqBmto7Tcz__fE" target="_blank" style="color: inherit; text-decoration: inherit;">Read more</a></block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; background-color: rgb(255, 254, 0);">Note:</block><block> If you would like to set up a model serving endpoint, you will need </block><block class="role-hyper-link" data-hyper-link-url="https://docs.databricks.com/applications/mlflow/model-serving.html#requirements" style="text-decoration: underline; color: rgb(17, 85, 204);"><a href="https://docs.databricks.com/applications/mlflow/model-serving.html#requirements" target="_blank" style="color: inherit; text-decoration: inherit;">cluster creation</a></block><block> permissions.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 648.791px; height: 353.54px; position: relative;"><img src="image-resources/2916274a-c25b-4667-9679-db339f525d58.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 640.587px; height: 342.18px; position: relative;"><img src="image-resources/6317506e-b0f6-4734-a836-a17f5d28dc32.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 632.391px; height: 322.91px; position: relative;"><img src="image-resources/15da5191-87ac-4e21-9e53-fcd911603d46.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>The </block><block style="font-weight: bold; color: rgb(255, 64, 0);">MLflow Model Registry</block><block> component is a centralized model store, set of APIs, and UI, to collaboratively manage the full lifecycle of an MLflow Model. </block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>It provides: </block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="color: rgb(0, 0, 0); flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; color: rgb(255, 64, 0);">model lineage</block><block>  which MLflow Experiment and Run produced the model </block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="color: rgb(0, 0, 0); font-weight: bold; flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; color: rgb(255, 64, 0);">model versioning</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="color: rgb(0, 0, 0); flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; color: rgb(255, 64, 0);">stage transitions</block><block>  e.g. from staging to production</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="color: rgb(0, 0, 0); flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; color: rgb(255, 64, 0);">annotations</block><block>  e.g. with comments, tags </block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="color: rgb(0, 0, 0); flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; color: rgb(255, 64, 0);">deployment management</block><block>  e.g. which production jobs have requested a specific model version</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="font-weight: bold; flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold;">MLflow Model Registry has the following features:</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; color: rgb(255, 64, 0);">Central Repository</block><block>  Register MLflow models with the MLflow Model Registry. </block></blocks></line><line class="root text-mode indent-2 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="3"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;">* </prefix><blocks><baselineblock class="inline"></baselineblock><block style="background-color: rgb(255, 254, 0);">A registered model has a unique name, version, stage, and other metadata</block><block>.</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; color: rgb(255, 64, 0);">Model Versioning</block><block>  Automatically keep track of versions for registered models when updated.</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; color: rgb(255, 64, 0);">Model Stage</block><block>  Assigned preset or custom stages to each model version, like </block><block style="font-weight: bold;">Staging</block><block> and </block><block style="font-weight: bold;">Production</block><block> to represent the lifecycle of a model.</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; color: rgb(255, 64, 0);">Model Stage Transitions </block><block> Record new registration events or changes as activities that automatically log users, changes, and additional metadata such as comments.</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; color: rgb(255, 64, 0);">CI/CD Workflow Integration</block><block>  Record stage transitions, request, review and approve changes as part of CI/CD pipelines for better control and governance.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>See </block><block class="role-hyper-link" data-hyper-link-url="https://mlflow.org/docs/latest/model-registry.html" style="text-decoration: underline; color: rgb(17, 85, 204);"><a href="https://mlflow.org/docs/latest/model-registry.html" target="_blank" style="color: inherit; text-decoration: inherit;">MLflow docs</a></block><block> for more info.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 639.991px; height: 352.22px; position: relative;"><img src="image-resources/92e52576-fd68-485b-85b2-6371750c6f07.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">[</block><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><compositeblock dir="ltr" class="anchor-tag-ref inline" style="font-family: &quot;Computer Modern Serif&quot;, serif;"><a href="#n0.3295185310066928" style="color: inherit; text-decoration: inherit;">Back To Top</a></compositeblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">]</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode section sindent-2" data-line-id="n0.4947416407927985" style="font-size: 1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.4947416407927985" role="heading" aria-level="3"><prefix style="text-align: left; padding-right: 0em;">4.2.1. </prefix><blocks><baselineblock class="inline"></baselineblock><block>Registering a Model</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; background-color: rgb(255, 254, 0);">Note:</block><block> The following workflow will work with either the UI or in pure Python. For the UI, go to the </block><block style="font-weight: bold;">"Models"</block><block> section from the sidebar.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 709.995px; height: 390.46px; position: relative;"><img src="image-resources/a6b7d5f0-32f7-4fc2-aff9-623f24b8359b.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="color: rgb(255, 64, 0); font-weight: bold; flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; color: rgb(255, 64, 0);">Autologging</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Train a model and log it to MLflow using </block><block class="role-hyper-link" data-hyper-link-url="https://mlflow.org/docs/latest/tracking.html#automatic-logging" style="text-decoration: underline; color: rgb(17, 85, 204);"><a href="https://mlflow.org/docs/latest/tracking.html#automatic-logging" target="_blank" style="color: inherit; text-decoration: inherit;">autologging</a></block><block>. </block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold;">Autologging</block><block> allows you to log metrics, parameters, and models without the need for explicit log statements.</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="font-weight: bold; flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold;">There are a few ways to use autologging:</block></blocks></line><line class="root text-mode indent-2 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="3"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;">* </prefix><blocks><baselineblock class="inline"></baselineblock><block>Call </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(79, 167, 176); background-color: rgba(155, 155, 155, 0.2);">mlflow.autolog()</block><block> before your training code. This will enable autologging for each supported library you have installed as soon as you import it.</block></blocks></line><line class="root text-mode indent-2 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="3"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;">* </prefix><blocks><baselineblock class="inline"></baselineblock><block>Enable autologging at the workspace level from the admin console.</block></blocks></line><line class="root text-mode indent-2 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="3"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;">* </prefix><blocks><baselineblock class="inline"></baselineblock><block>Use library-specific autolog calls for each library you use in your code (e.g. </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(79, 167, 176); background-color: rgba(155, 155, 155, 0.2);">mlflow.spark.autolog()</block><block>).</block></blocks></line><line class="root text-mode indent-2 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="3"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;">* </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">import</block><block class=" token"> mlflow</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">import</block><block class=" token"> mlflow</block><block class="punctuation token">.</block><block class=" token">sklearn</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> mlflow</block><block class="punctuation token">.</block><block class=" token">models</block><block class="punctuation token">.</block><block class=" token">signature </block><block class="keyword token">import</block><block class=" token"> infer_signature</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">import</block><block class=" token"> pandas </block><block class="keyword token">as</block><block class=" token"> pd</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> sklearn</block><block class="punctuation token">.</block><block class=" token">linear_model </block><block class="keyword token">import</block><block class=" token"> LinearRegression</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> sklearn</block><block class="punctuation token">.</block><block class=" token">metrics </block><block class="keyword token">import</block><block class=" token"> mean_squared_error</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> sklearn</block><block class="punctuation token">.</block><block class=" token">model_selection </block><block class="keyword token">import</block><block class=" token"> train_test_split</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">df </block><block class="operator token">=</block><block class=" token"> pd</block><block class="punctuation token">.</block><block class=" token">read_csv</block><block class="punctuation token">(</block><block class="string-interpolation string token">f"</block><block class="string-interpolation interpolation punctuation token">{</block><block class="string-interpolation interpolation token">DA</block><block class="string-interpolation interpolation punctuation token">.</block><block class="string-interpolation interpolation token">paths</block><block class="string-interpolation interpolation punctuation token">.</block><block class="string-interpolation interpolation token">datasets</block><block class="string-interpolation interpolation punctuation token">}</block><block class="string-interpolation string token">/airbnb/sf-listings/airbnb-cleaned-mlflow.csv"</block><block class="punctuation token">.</block><block class=" token">replace</block><block class="punctuation token">(</block><block class="string token">"dbfs:/"</block><block class="punctuation token">,</block><block class=" token"> </block><block class="string token">"/dbfs/"</block><block class="punctuation token">)</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># convert ineteger fields to double in case of missing values, which would cause error</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">int_cols </block><block class="operator token">=</block><block class=" token"> df</block><block class="punctuation token">.</block><block class=" token">select_dtypes</block><block class="punctuation token">(</block><block class=" token">include</block><block class="operator token">=</block><block class="string token">'int64'</block><block class="punctuation token">)</block><block class="punctuation token">.</block><block class=" token">columns</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">df</block><block class="punctuation token">[</block><block class=" token">int_cols</block><block class="punctuation token">]</block><block class=" token"> </block><block class="operator token">=</block><block class=" token"> df</block><block class="punctuation token">[</block><block class=" token">int_cols</block><block class="punctuation token">]</block><block class="punctuation token">.</block><block class=" token">astype</block><block class="punctuation token">(</block><block class="string token">'float64'</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">X_train</block><block class="punctuation token">,</block><block class=" token"> X_test</block><block class="punctuation token">,</block><block class=" token"> y_train</block><block class="punctuation token">,</block><block class=" token"> y_test </block><block class="operator token">=</block><block class=" token"> train_test_split</block><block class="punctuation token">(</block><block class=" token">df</block><block class="punctuation token">.</block><block class=" token">drop</block><block class="punctuation token">(</block><block class="punctuation token">[</block><block class="string token">"price"</block><block class="punctuation token">]</block><block class="punctuation token">,</block><block class=" token"> axis</block><block class="operator token">=</block><block class="number token">1</block><block class="punctuation token">)</block><block class="punctuation token">,</block><block class=" token"> df</block><block class="punctuation token">[</block><block class="punctuation token">[</block><block class="string token">"price"</block><block class="punctuation token">]</block><block class="punctuation token">]</block><block class="punctuation token">.</block><block class=" token">values</block><block class="punctuation token">.</block><block class=" token">ravel</block><block class="punctuation token">(</block><block class="punctuation token">)</block><block class="punctuation token">,</block><block class=" token"> random_state</block><block class="operator token">=</block><block class="number token">42</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">with</block><block class=" token"> mlflow</block><block class="punctuation token">.</block><block class=" token">start_run</block><block class="punctuation token">(</block><block class=" token">run_name</block><block class="operator token">=</block><block class="string token">"LR Model"</block><block class="punctuation token">)</block><block class=" token"> </block><block class="keyword token">as</block><block class=" token"> run</block><block class="punctuation token">:</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    mlflow</block><block class="punctuation token">.</block><block class=" token">sklearn</block><block class="punctuation token">.</block><block class=" token">autolog</block><block class="punctuation token">(</block><block class=" token">log_input_examples</block><block class="operator token">=</block><block class="boolean token">True</block><block class="punctuation token">,</block><block class=" token"> log_model_signatures</block><block class="operator token">=</block><block class="boolean token">True</block><block class="punctuation token">,</block><block class=" token"> log_models</block><block class="operator token">=</block><block class="boolean token">True</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    lr </block><block class="operator token">=</block><block class=" token"> LinearRegression</block><block class="punctuation token">(</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    lr</block><block class="punctuation token">.</block><block class=" token">fit</block><block class="punctuation token">(</block><block class=" token">X_train</block><block class="punctuation token">,</block><block class=" token"> y_train</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    signature </block><block class="operator token">=</block><block class=" token"> infer_signature</block><block class="punctuation token">(</block><block class=" token">X_train</block><block class="punctuation token">,</block><block class=" token"> lr</block><block class="punctuation token">.</block><block class=" token">predict</block><block class="punctuation token">(</block><block class=" token">X_train</block><block class="punctuation token">)</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Create a unique model name</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">suffix </block><block class="operator token">=</block><block class=" token"> DA</block><block class="punctuation token">.</block><block class=" token">unique_name</block><block class="punctuation token">(</block><block class="string token">"-"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">model_name </block><block class="operator token">=</block><block class=" token"> </block><block class="string-interpolation string token">f"sklearn-lr_</block><block class="string-interpolation interpolation punctuation token">{</block><block class="string-interpolation interpolation token">suffix</block><block class="string-interpolation interpolation punctuation token">}</block><block class="string-interpolation string token">"</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Register the model</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">run_id </block><block class="operator token">=</block><block class=" token"> run</block><block class="punctuation token">.</block><block class=" token">info</block><block class="punctuation token">.</block><block class=" token">run_id</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">model_uri </block><block class="operator token">=</block><block class=" token"> </block><block class="string-interpolation string token">f"runs:/</block><block class="string-interpolation interpolation punctuation token">{</block><block class="string-interpolation interpolation token">run_id</block><block class="string-interpolation interpolation punctuation token">}</block><block class="string-interpolation string token">/model"</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">model_details </block><block class="operator token">=</block><block class=" token"> mlflow</block><block class="punctuation token">.</block><block class=" token">register_model</block><block class="punctuation token">(</block><block class=" token">model_uri</block><block class="operator token">=</block><block class=" token">model_uri</block><block class="punctuation token">,</block><block class=" token"> name</block><block class="operator token">=</block><block class=" token">model_name</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Successfully registered model 'sklearn-lr_class-023-5lht-da-sml'.</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># 2023/12/05 17:01:29 INFO mlflow.tracking._model_registry.client: Waiting up to 300 seconds for model version to finish creation.                     Model name: sklearn-lr_class-023-5lht-da-sml, version 1</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Created version '1' of model 'sklearn-lr_class-023-5lht-da-sml'.</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># ------</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Check the status</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> mlflow</block><block class="punctuation token">.</block><block class=" token">tracking</block><block class="punctuation token">.</block><block class=" token">client </block><block class="keyword token">import</block><block class=" token"> MlflowClient</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">client </block><block class="operator token">=</block><block class=" token"> MlflowClient</block><block class="punctuation token">(</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">model_version_details </block><block class="operator token">=</block><block class=" token"> client</block><block class="punctuation token">.</block><block class=" token">get_model_version</block><block class="punctuation token">(</block><block class=" token">name</block><block class="operator token">=</block><block class=" token">model_name</block><block class="punctuation token">,</block><block class=" token"> version</block><block class="operator token">=</block><block class="number token">1</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">model_version_details</block><block class="punctuation token">.</block><block class=" token">status</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># 'READY'</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># ------</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Add a model description</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">client</block><block class="punctuation token">.</block><block class=" token">update_registered_model</block><block class="punctuation token">(</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    name</block><block class="operator token">=</block><block class=" token">model_details</block><block class="punctuation token">.</block><block class=" token">name</block><block class="punctuation token">,</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    description</block><block class="operator token">=</block><block class="string token">"This model forecasts Airbnb housing list prices based on various listing inputs."</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># &lt;RegisteredModel: creation_timestamp=1701795688743, description=('This model forecasts Airbnb housing list prices based on various listing '</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token">#  'inputs.'), last_updated_timestamp=1701795773103, latest_versions=[], name='sklearn-lr_class-023-5lht-da-sml', tags={}&gt;</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># ------</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Add a version-specific description</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">client</block><block class="punctuation token">.</block><block class=" token">update_model_version</block><block class="punctuation token">(</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    name</block><block class="operator token">=</block><block class=" token">model_details</block><block class="punctuation token">.</block><block class=" token">name</block><block class="punctuation token">,</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    version</block><block class="operator token">=</block><block class=" token">model_details</block><block class="punctuation token">.</block><block class=" token">version</block><block class="punctuation token">,</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    description</block><block class="operator token">=</block><block class="string token">"This model version was built using OLS linear regression with sklearn."</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># &lt;ModelVersion: creation_timestamp=1701795689048, current_stage='None', description='This model version was built using OLS linear regression with sklearn.', last_updated_timestamp=1701795774300, name='sklearn-lr_class-023-5lht-da-sml', run_id='d1fb1a414c9346bd8dddc8eba3cf3ff6', run_link='', source='dbfs:/databricks/mlflow-tracking/4470712829972569/d1fb1a414c9346bd8dddc8eba3cf3ff6/artifacts/model', status='READY', status_message='', tags={}, user_id='8998376680594099', version='1'&gt;</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">[</block><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><compositeblock dir="ltr" class="anchor-tag-ref inline" style="font-family: &quot;Computer Modern Serif&quot;, serif;"><a href="#n0.3295185310066928" style="color: inherit; text-decoration: inherit;">Back To Top</a></compositeblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">]</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode section sindent-2" data-line-id="n0.6582749301500999" style="font-size: 1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.6582749301500999" role="heading" aria-level="3"><prefix style="text-align: left; padding-right: 0em;">4.2.2. </prefix><blocks><baselineblock class="inline"></baselineblock><block>Deploying a Model</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>The </block><block style="font-weight: bold;">MLflow Model Registry</block><block> defines several model stages: </block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="font-weight: bold; flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">None</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="font-weight: bold; flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">Staging</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="font-weight: bold; flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">Production </block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="font-weight: bold; flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">Archived</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Each stage has a unique meaning. </block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>For example, </block><block style="font-weight: bold;">Staging</block><block> is meant for model testing, while </block><block style="font-weight: bold;">Production</block><block> is for models that have completed the testing or review processes and have been deployed to applications.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Users with appropriate permissions can transition models between stages.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Transition model to 'Production' stage</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">client</block><block class="punctuation token">.</block><block class=" token">transition_model_version_stage</block><block class="punctuation token">(</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    name</block><block class="operator token">=</block><block class=" token">model_details</block><block class="punctuation token">.</block><block class=" token">name</block><block class="punctuation token">,</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    version</block><block class="operator token">=</block><block class=" token">model_details</block><block class="punctuation token">.</block><block class=" token">version</block><block class="punctuation token">,</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    stage</block><block class="operator token">=</block><block class="string token">"Production"</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># &lt;ModelVersion: creation_timestamp=1701795689048, current_stage='Production', description='This model version was built using OLS linear regression with sklearn.', last_updated_timestamp=1701796040587, name='sklearn-lr_class-023-5lht-da-sml', run_id='d1fb1a414c9346bd8dddc8eba3cf3ff6', run_link='', source='dbfs:/databricks/mlflow-tracking/4470712829972569/d1fb1a414c9346bd8dddc8eba3cf3ff6/artifacts/model', status='READY', status_message='', tags={}, user_id='8998376680594099', version='1'&gt;</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># ------</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Fetch the model's current status</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">model_version_details </block><block class="operator token">=</block><block class=" token"> client</block><block class="punctuation token">.</block><block class=" token">get_model_version</block><block class="punctuation token">(</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    name</block><block class="operator token">=</block><block class=" token">model_details</block><block class="punctuation token">.</block><block class=" token">name</block><block class="punctuation token">,</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    version</block><block class="operator token">=</block><block class=" token">model_details</block><block class="punctuation token">.</block><block class=" token">version</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">print</block><block class="punctuation token">(</block><block class="string-interpolation string token">f"The current model stage is: '</block><block class="string-interpolation interpolation punctuation token">{</block><block class="string-interpolation interpolation token">model_version_details</block><block class="string-interpolation interpolation punctuation token">.</block><block class="string-interpolation interpolation token">current_stage</block><block class="string-interpolation interpolation punctuation token">}</block><block class="string-interpolation string token">'"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># The current model stage is: 'Production'</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># --------</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Fetch the latest model using a `pyfunc`. </block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Loading the model in this way allows us to use the model regardless of the package that was used to train it.</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># You can load a specific version of the model too.</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">import</block><block class=" token"> mlflow</block><block class="punctuation token">.</block><block class=" token">pyfunc</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">model_version_uri </block><block class="operator token">=</block><block class=" token"> </block><block class="string-interpolation string token">f"models:/</block><block class="string-interpolation interpolation punctuation token">{</block><block class="string-interpolation interpolation token">model_name</block><block class="string-interpolation interpolation punctuation token">}</block><block class="string-interpolation string token">/1"</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">print</block><block class="punctuation token">(</block><block class="string-interpolation string token">f"Loading registered model version from URI: '</block><block class="string-interpolation interpolation punctuation token">{</block><block class="string-interpolation interpolation token">model_version_uri</block><block class="string-interpolation interpolation punctuation token">}</block><block class="string-interpolation string token">'"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">model_version_1 </block><block class="operator token">=</block><block class=" token"> mlflow</block><block class="punctuation token">.</block><block class=" token">pyfunc</block><block class="punctuation token">.</block><block class=" token">load_model</block><block class="punctuation token">(</block><block class=" token">model_version_uri</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Loading registered model version from URI: 'models:/sklearn-lr_class-023-5lht-da-sml/1'</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># ----------</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Predict</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">model_version_1</block><block class="punctuation token">.</block><block class=" token">predict</block><block class="punctuation token">(</block><block class=" token">X_test</block><block class="punctuation token">)</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">[</block><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><compositeblock dir="ltr" class="anchor-tag-ref inline" style="font-family: &quot;Computer Modern Serif&quot;, serif;"><a href="#n0.3295185310066928" style="color: inherit; text-decoration: inherit;">Back To Top</a></compositeblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">]</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode section sindent-2" data-line-id="n0.7004408749430593" style="font-size: 1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.7004408749430593" role="heading" aria-level="3"><prefix style="text-align: left; padding-right: 0em;">4.2.3. </prefix><blocks><baselineblock class="inline"></baselineblock><block>Deploying a New Model Version</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>The </block><block style="font-weight: bold;">MLflow Model Registry</block><block> enables you to create multiple model versions corresponding to a single registered model. </block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="text-decoration: underline;">By performing stage transitions</block><block>, you can seamlessly integrate new model versions into your staging or production environments.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Create a new model version and register that model when it's logged</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> sklearn</block><block class="punctuation token">.</block><block class=" token">linear_model </block><block class="keyword token">import</block><block class=" token"> Ridge</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">with</block><block class=" token"> mlflow</block><block class="punctuation token">.</block><block class=" token">start_run</block><block class="punctuation token">(</block><block class=" token">run_name</block><block class="operator token">=</block><block class="string token">"LR Ridge Model"</block><block class="punctuation token">)</block><block class=" token"> </block><block class="keyword token">as</block><block class=" token"> run</block><block class="punctuation token">:</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    alpha </block><block class="operator token">=</block><block class=" token"> </block><block class="number token">.9</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    ridge_regression </block><block class="operator token">=</block><block class=" token"> Ridge</block><block class="punctuation token">(</block><block class=" token">alpha</block><block class="operator token">=</block><block class=" token">alpha</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    ridge_regression</block><block class="punctuation token">.</block><block class=" token">fit</block><block class="punctuation token">(</block><block class=" token">X_train</block><block class="punctuation token">,</block><block class=" token"> y_train</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block><block class="comment token"># Specify the `registered_model_name` parameter of the `mlflow.sklearn.log_model()`</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block><block class="comment token"># function to register the model with the MLflow Model Registry. This automatically</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block><block class="comment token"># creates a new model version</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    mlflow</block><block class="punctuation token">.</block><block class=" token">sklearn</block><block class="punctuation token">.</block><block class=" token">log_model</block><block class="punctuation token">(</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">        sk_model</block><block class="operator token">=</block><block class=" token">ridge_regression</block><block class="punctuation token">,</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">        artifact_path</block><block class="operator token">=</block><block class="string token">"sklearn-ridge-model"</block><block class="punctuation token">,</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">        registered_model_name</block><block class="operator token">=</block><block class=" token">model_name</block><block class="punctuation token">,</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    mlflow</block><block class="punctuation token">.</block><block class=" token">log_params</block><block class="punctuation token">(</block><block class=" token">ridge_regression</block><block class="punctuation token">.</block><block class=" token">get_params</block><block class="punctuation token">(</block><block class="punctuation token">)</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    mlflow</block><block class="punctuation token">.</block><block class=" token">log_metric</block><block class="punctuation token">(</block><block class="string token">"mse"</block><block class="punctuation token">,</block><block class=" token"> mean_squared_error</block><block class="punctuation token">(</block><block class=" token">y_test</block><block class="punctuation token">,</block><block class=" token"> ridge_regression</block><block class="punctuation token">.</block><block class=" token">predict</block><block class="punctuation token">(</block><block class=" token">X_test</block><block class="punctuation token">)</block><block class="punctuation token">)</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Registered model 'sklearn-lr_class-023-5lht-da-sml' already exists. Creating a new version of this model...</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># 2023/12/05 17:11:32 INFO mlflow.tracking._model_registry.client: Waiting up to 300 seconds for model version to finish creation.                     Model name: sklearn-lr_class-023-5lht-da-sml, version 2</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Created version '2' of model 'sklearn-lr_class-023-5lht-da-sml'.</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># -----------</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Put the new model into staging</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">client</block><block class="punctuation token">.</block><block class=" token">transition_model_version_stage</block><block class="punctuation token">(</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    name</block><block class="operator token">=</block><block class=" token">model_details</block><block class="punctuation token">.</block><block class=" token">name</block><block class="punctuation token">,</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    version</block><block class="operator token">=</block><block class="number token">2</block><block class="punctuation token">,</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    stage</block><block class="operator token">=</block><block class="string token">"Staging"</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># &lt;ModelVersion: creation_timestamp=1701796291978, current_stage='Staging', description='', last_updated_timestamp=1701796335048, name='sklearn-lr_class-023-5lht-da-sml', run_id='97dc42f9ff304db883fb43527e37fe8f', run_link='', source='dbfs:/databricks/mlflow-tracking/4470712829972569/97dc42f9ff304db883fb43527e37fe8f/artifacts/sklearn-ridge-model', status='READY', status_message='', tags={}, user_id='8998376680594099', version='2'&gt;</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># --------</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Use the search functionality to grab the latest model version</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">model_version_infos </block><block class="operator token">=</block><block class=" token"> client</block><block class="punctuation token">.</block><block class=" token">search_model_versions</block><block class="punctuation token">(</block><block class="string-interpolation string token">f"name = '</block><block class="string-interpolation interpolation punctuation token">{</block><block class="string-interpolation interpolation token">model_name</block><block class="string-interpolation interpolation punctuation token">}</block><block class="string-interpolation string token">'"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">new_model_version </block><block class="operator token">=</block><block class=" token"> </block><block class="builtin token">max</block><block class="punctuation token">(</block><block class="punctuation token">[</block><block class=" token">model_version_info</block><block class="punctuation token">.</block><block class=" token">version </block><block class="keyword token">for</block><block class=" token"> model_version_info </block><block class="keyword token">in</block><block class=" token"> model_version_infos</block><block class="punctuation token">]</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Update a Deployed Model</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">client</block><block class="punctuation token">.</block><block class=" token">update_model_version</block><block class="punctuation token">(</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    name</block><block class="operator token">=</block><block class=" token">model_name</block><block class="punctuation token">,</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    version</block><block class="operator token">=</block><block class=" token">new_model_version</block><block class="punctuation token">,</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    description</block><block class="operator token">=</block><block class="string-interpolation string token">f"This model version is a ridge regression model with an alpha value of </block><block class="string-interpolation interpolation punctuation token">{</block><block class="string-interpolation interpolation token">alpha</block><block class="string-interpolation interpolation punctuation token">}</block><block class="string-interpolation string token"> that was trained in scikit-learn."</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># &lt;ModelVersion: creation_timestamp=1701796291978, current_stage='Staging', description=('This model version is a ridge regression model with an alpha value of 0.9 '</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token">#  'that was trained in scikit-learn.'), last_updated_timestamp=1701797052271, name='sklearn-lr_class-023-5lht-da-sml', run_id='97dc42f9ff304db883fb43527e37fe8f', run_link='', source='dbfs:/databricks/mlflow-tracking/4470712829972569/97dc42f9ff304db883fb43527e37fe8f/artifacts/sklearn-ridge-model', status='READY', status_message='', tags={}, user_id='8998376680594099', version='2'&gt;</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># ----------</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Since this model is now in staging, you can execute an automated CI/CD pipeline against it to test it before going into production. Once that is completed, you can push that model into production.</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">client</block><block class="punctuation token">.</block><block class=" token">transition_model_version_stage</block><block class="punctuation token">(</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    name</block><block class="operator token">=</block><block class=" token">model_name</block><block class="punctuation token">,</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    version</block><block class="operator token">=</block><block class=" token">new_model_version</block><block class="punctuation token">,</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    stage</block><block class="operator token">=</block><block class="string token">"Production"</block><block class="punctuation token">,</block><block class=" token"> </block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    archive_existing_versions</block><block class="operator token">=</block><block class="boolean token">True</block><block class=" token"> </block><block class="comment token"># Archive existing model in production </block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># &lt;ModelVersion: creation_timestamp=1701796291978, current_stage='Production', description=('This model version is a ridge regression model with an alpha value of 0.9 '</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token">#  'that was trained in scikit-learn.'), last_updated_timestamp=1701797101377, name='sklearn-lr_class-023-5lht-da-sml', run_id='97dc42f9ff304db883fb43527e37fe8f', run_link='', source='dbfs:/databricks/mlflow-tracking/4470712829972569/97dc42f9ff304db883fb43527e37fe8f/artifacts/sklearn-ridge-model', status='READY', status_message='', tags={}, user_id='8998376680594099', version='2'&gt;</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># --------</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Deleting a model</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Note: You cannot delete a model that is not first Archived.</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">client</block><block class="punctuation token">.</block><block class=" token">transition_model_version_stage</block><block class="punctuation token">(</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    name</block><block class="operator token">=</block><block class=" token">model_name</block><block class="punctuation token">,</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    version</block><block class="operator token">=</block><block class="number token">2</block><block class="punctuation token">,</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    stage</block><block class="operator token">=</block><block class="string token">"Archived"</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">client</block><block class="punctuation token">.</block><block class=" token">delete_registered_model</block><block class="punctuation token">(</block><block class=" token">model_name</block><block class="punctuation token">)</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 673.587px; height: 335.54px; position: relative;"><img src="image-resources/32c0698c-8e4c-4fe1-a428-223fef3e48af.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold;">Question:</block><block> How does MLflow tracking differ from the model registry?</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold;">Answer:</block><block> Tracking is meant for experimentation and development. The model registry is designed to take a model from tracking and put it through staging and into production. This is often the point that a data engineer or a machine learning engineer takes responsibility for the deployment process.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold;">Question:</block><block> Why do I need a model registry?</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold;">Answer:</block><block> Just as MLflow tracking provides end-to-end reproducibility for the machine learning training process, a model registry provides reproducibility and governance for the deployment process. Since production systems are mission critical, components can be isolated with ACL's so only specific individuals can alter production models. Version control and CI/CD workflow integration is also a critical dimension of deploying models into production.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold;">Question:</block><block> What can I do programmatically versus using the UI?</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold;">Answer:</block><block> Most operations can be done using the UI or in pure Python. A model must be tracked using Python, but from that point on everything can be done either way. For instance, a model logged using the MLflow tracking API can then be registered using the UI and can then be pushed into production.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">[</block><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><compositeblock dir="ltr" class="anchor-tag-ref inline" style="font-family: &quot;Computer Modern Serif&quot;, serif;"><a href="#n0.3295185310066928" style="color: inherit; text-decoration: inherit;">Back To Top</a></compositeblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">]</block></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="inline" style="display: block;"><div style="vertical-align: baseline;"><div style="display: inline-block; height: 0px; border-bottom: 1px solid; width: 100%;"></div></div></compositeblock></blocks></line><line class="root text-mode section sindent-0" data-line-id="n0.8606550370686419" style="font-size: 1.2em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.8606550370686419" role="heading" aria-level="1"><prefix style="text-align: left; padding-right: 0.5em;">5. </prefix><blocks><baselineblock class="inline"></baselineblock><block>Non-linear Models</block></blocks></line><line class="root text-mode section sindent-1" data-line-id="n0.06710605972204298" style="font-size: 1.1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.06710605972204298" role="heading" aria-level="2"><prefix style="text-align: left; padding-right: 0.25em;">5.1. </prefix><blocks><baselineblock class="inline"></baselineblock><block>Decision Trees</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>In this section, we're going to build a decision tree model using SparkML.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode section sindent-2" data-line-id="n0.7265001738807313" style="font-size: 1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.7265001738807313" role="heading" aria-level="3"><prefix style="text-align: left; padding-right: 0em;">5.1.1. </prefix><blocks><baselineblock class="inline"></baselineblock><block>How to Handle Categorical Features?</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>We saw previously that we can use </block><block style="font-weight: bold; color: rgb(255, 64, 0);">StringIndexer</block><block>/</block><block style="font-weight: bold; color: rgb(255, 64, 0);">OneHotEncoder</block><block>/</block><block style="font-weight: bold; color: rgb(255, 64, 0);">VectorAssembler</block><block> or </block><block style="font-weight: bold; color: rgb(255, 64, 0);">RFormula</block><block>.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>However, for decision trees, and in particular, random forests, </block><block style="font-weight: bold; background-color: rgb(255, 254, 0);">we should not OHE our variables</block><block>.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>There is an excellent </block><block class="role-hyper-link" data-hyper-link-url="https://towardsdatascience.com/one-hot-encoding-is-making-your-tree-based-ensembles-worse-heres-why-d64b282b5769#:~:text=One%2Dhot%20encoding%20categorical%20variables,importance%20resulting%20in%20poorer%20performance" style="text-decoration: underline; color: rgb(17, 85, 204);"><a href="https://towardsdatascience.com/one-hot-encoding-is-making-your-tree-based-ensembles-worse-heres-why-d64b282b5769#:~:text=One%2Dhot%20encoding%20categorical%20variables,importance%20resulting%20in%20poorer%20performance" target="_blank" style="color: inherit; text-decoration: inherit;">blog</a></block><block> on this, and the essence is:</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>"</block><block style="font-style: italic;">One-hot encoding categorical variables with high cardinality can cause inefficiency in tree-based methods. Continuous variables will be given more importance than the dummy variables by the algorithm, which will obscure the order of feature importance and can result in poorer performance.</block><block>"</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> pyspark</block><block class="punctuation token">.</block><block class=" token">ml</block><block class="punctuation token">.</block><block class=" token">feature </block><block class="keyword token">import</block><block class=" token"> StringIndexer</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">categorical_cols </block><block class="operator token">=</block><block class=" token"> </block><block class="punctuation token">[</block><block class=" token">field </block><block class="keyword token">for</block><block class=" token"> </block><block class="punctuation token">(</block><block class=" token">field</block><block class="punctuation token">,</block><block class=" token"> dataType</block><block class="punctuation token">)</block><block class=" token"> </block><block class="keyword token">in</block><block class=" token"> train_df</block><block class="punctuation token">.</block><block class=" token">dtypes </block><block class="keyword token">if</block><block class=" token"> dataType </block><block class="operator token">==</block><block class=" token"> </block><block class="string token">"string"</block><block class="punctuation token">]</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">index_output_cols </block><block class="operator token">=</block><block class=" token"> </block><block class="punctuation token">[</block><block class=" token">x </block><block class="operator token">+</block><block class=" token"> </block><block class="string token">"Index"</block><block class=" token"> </block><block class="keyword token">for</block><block class=" token"> x </block><block class="keyword token">in</block><block class=" token"> categorical_cols</block><block class="punctuation token">]</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">string_indexer </block><block class="operator token">=</block><block class=" token"> StringIndexer</block><block class="punctuation token">(</block><block class=" token">inputCols</block><block class="operator token">=</block><block class=" token">categorical_cols</block><block class="punctuation token">,</block><block class=" token"> outputCols</block><block class="operator token">=</block><block class=" token">index_output_cols</block><block class="punctuation token">,</block><block class=" token"> handleInvalid</block><block class="operator token">=</block><block class="string token">"skip"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> pyspark</block><block class="punctuation token">.</block><block class=" token">ml</block><block class="punctuation token">.</block><block class=" token">feature </block><block class="keyword token">import</block><block class=" token"> VectorAssembler</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Filter for just numeric columns (and exclude price, our label)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">numeric_cols </block><block class="operator token">=</block><block class=" token"> </block><block class="punctuation token">[</block><block class=" token">field </block><block class="keyword token">for</block><block class=" token"> </block><block class="punctuation token">(</block><block class=" token">field</block><block class="punctuation token">,</block><block class=" token"> dataType</block><block class="punctuation token">)</block><block class=" token"> </block><block class="keyword token">in</block><block class=" token"> train_df</block><block class="punctuation token">.</block><block class=" token">dtypes </block><block class="keyword token">if</block><block class=" token"> </block><block class="punctuation token">(</block><block class="punctuation token">(</block><block class=" token">dataType </block><block class="operator token">==</block><block class=" token"> </block><block class="string token">"double"</block><block class="punctuation token">)</block><block class=" token"> </block><block class="operator token">&amp;</block><block class=" token"> </block><block class="punctuation token">(</block><block class=" token">field </block><block class="operator token">!=</block><block class=" token"> </block><block class="string token">"price"</block><block class="punctuation token">)</block><block class="punctuation token">)</block><block class="punctuation token">]</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Combine output of StringIndexer defined above and numeric columns</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">assembler_inputs </block><block class="operator token">=</block><block class=" token"> index_output_cols </block><block class="operator token">+</block><block class=" token"> numeric_cols</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">vec_assembler </block><block class="operator token">=</block><block class=" token"> VectorAssembler</block><block class="punctuation token">(</block><block class=" token">inputCols</block><block class="operator token">=</block><block class=" token">assembler_inputs</block><block class="punctuation token">,</block><block class=" token"> outputCol</block><block class="operator token">=</block><block class="string token">"features"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> pyspark</block><block class="punctuation token">.</block><block class=" token">ml</block><block class="punctuation token">.</block><block class=" token">regression </block><block class="keyword token">import</block><block class=" token"> DecisionTreeRegressor</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">dt </block><block class="operator token">=</block><block class=" token"> DecisionTreeRegressor</block><block class="punctuation token">(</block><block class=" token">labelCol</block><block class="operator token">=</block><block class="string token">"price"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Fit the pipeline</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> pyspark</block><block class="punctuation token">.</block><block class=" token">ml </block><block class="keyword token">import</block><block class=" token"> Pipeline</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Combine stages into pipeline</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">stages </block><block class="operator token">=</block><block class=" token"> </block><block class="punctuation token">[</block><block class=" token">string_indexer</block><block class="punctuation token">,</block><block class=" token"> vec_assembler</block><block class="punctuation token">,</block><block class=" token"> dt</block><block class="punctuation token">]</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">pipeline </block><block class="operator token">=</block><block class=" token"> Pipeline</block><block class="punctuation token">(</block><block class=" token">stages</block><block class="operator token">=</block><block class=" token">stages</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Uncomment to perform fit</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">pipeline_model </block><block class="operator token">=</block><block class=" token"> pipeline</block><block class="punctuation token">.</block><block class=" token">fit</block><block class="punctuation token">(</block><block class=" token">train_df</block><block class="punctuation token">)</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">[</block><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><compositeblock dir="ltr" class="anchor-tag-ref inline" style="font-family: &quot;Computer Modern Serif&quot;, serif;"><a href="#n0.3295185310066928" style="color: inherit; text-decoration: inherit;">Back To Top</a></compositeblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">]</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode section sindent-2" data-line-id="n0.050971711797828334" style="font-size: 1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.050971711797828334" role="heading" aria-level="3"><prefix style="text-align: left; padding-right: 0em;">5.1.2. </prefix><blocks><baselineblock class="inline"></baselineblock><block>maxBins</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>What is this parameter </block><block class="role-hyper-link" data-hyper-link-url="https://spark.apache.org/docs/latest/api/python/reference/api/pyspark.ml.regression.DecisionTreeRegressor.html?highlight=decisiontreeregressor#pyspark.ml.regression.DecisionTreeRegressor.maxBins" style="text-decoration: underline; color: rgb(17, 85, 204);"><a href="https://spark.apache.org/docs/latest/api/python/reference/api/pyspark.ml.regression.DecisionTreeRegressor.html?highlight=decisiontreeregressor#pyspark.ml.regression.DecisionTreeRegressor.maxBins" target="_blank" style="color: inherit; text-decoration: inherit;">maxBins</a></block><block>? </block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Let's take a look at the PLANET implementation of distributed decision trees to help explain the </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">maxBins</block><block> parameter.</block></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 438.348px; height: 476.55px; position: relative;"><img src="image-resources/07eccdbf-f147-462e-a815-2760186bc064.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="background-color: rgb(255, 254, 0);">In Spark, data is partitioned by row</block><block>. </block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold;">So when it needs to make a split, each worker has to compute summary statistics for every feature for each split point</block><block>. </block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold;">Then these summary statistics have to be aggregated (via tree reduce) for a split to be made</block><block>.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Think about it: </block><block style="font-weight: bold;">What if worker 1 had the value 32 but none of the others had it</block><block>. </block><block style="font-weight: bold;">How could you communicate how good of a split that would be?</block><block> </block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>So, Spark has a </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">maxBins</block><block> parameter for </block><block style="background-color: rgb(255, 254, 0);">discretizing continuous variables into buckets</block><block>, but the </block><block style="text-decoration: underline;">number of buckets has to be as large as the categorical variable with the highest cardinality</block><block>.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Let's increase the maxBins and run the pipeline again</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">dt</block><block class="punctuation token">.</block><block class=" token">setMaxBins</block><block class="punctuation token">(</block><block class="number token">40</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">pipeline_model </block><block class="operator token">=</block><block class=" token"> pipeline</block><block class="punctuation token">.</block><block class=" token">fit</block><block class="punctuation token">(</block><block class=" token">train_df</block><block class="punctuation token">)</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode section sindent-2" data-line-id="n0.24010656036608014" style="font-size: 1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.24010656036608014" role="heading" aria-level="3"><prefix style="text-align: left; padding-right: 0em;">5.1.3. </prefix><blocks><baselineblock class="inline"></baselineblock><block>Feature Importance</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">dt_model </block><block class="operator token">=</block><block class=" token"> pipeline_model</block><block class="punctuation token">.</block><block class=" token">stages</block><block class="punctuation token">[</block><block class="operator token">-</block><block class="number token">1</block><block class="punctuation token">]</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">display</block><block class="punctuation token">(</block><block class=" token">dt_model</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># ----</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">print</block><block class="punctuation token">(</block><block class=" token">dt_model</block><block class="punctuation token">.</block><block class=" token">featureImportances</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># SparseVector(33, {0: 0.0179, 1: 0.1551, 2: 0.1295, 3: 0.1013, 5: 0.0106, 8: 0.0035, 10: 0.0604, 12: 0.2111, 13: 0.0174, 14: 0.1433, 15: 0.1134, 22: 0.0365})</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 661.991px; height: 357.87px; position: relative;"><img src="image-resources/d6dbd172-d6d0-4692-9daf-6a69a95ffdbf.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">import</block><block class=" token"> pandas </block><block class="keyword token">as</block><block class=" token"> pd</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">features_df </block><block class="operator token">=</block><block class=" token"> pd</block><block class="punctuation token">.</block><block class=" token">DataFrame</block><block class="punctuation token">(</block><block class="builtin token">list</block><block class="punctuation token">(</block><block class="builtin token">zip</block><block class="punctuation token">(</block><block class=" token">vec_assembler</block><block class="punctuation token">.</block><block class=" token">getInputCols</block><block class="punctuation token">(</block><block class="punctuation token">)</block><block class="punctuation token">,</block><block class=" token"> dt_model</block><block class="punctuation token">.</block><block class=" token">featureImportances</block><block class="punctuation token">)</block><block class="punctuation token">)</block><block class="punctuation token">,</block><block class=" token"> columns</block><block class="operator token">=</block><block class="punctuation token">[</block><block class="string token">"feature"</block><block class="punctuation token">,</block><block class=" token"> </block><block class="string token">"importance"</block><block class="punctuation token">]</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">features_df</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 230.4px; height: 598.69px; position: relative;"><img src="image-resources/a308e60a-a4d7-4b68-a15a-af6cec4b1df2.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="font-weight: bold; flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold;">Why so few features are non-zero?</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="font-weight: bold; flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>With SparkML, the default </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(255, 64, 0);">maxDepth</block><block> is 5, so there are only a few features we could consider (we can also split on the same feature many times at different split points).</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Let's use a Databricks widget to get the top-K features.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">dbutils</block><block class="punctuation token">.</block><block class=" token">widgets</block><block class="punctuation token">.</block><block class=" token">text</block><block class="punctuation token">(</block><block class="string token">"top_k"</block><block class="punctuation token">,</block><block class=" token"> </block><block class="string token">"5"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">top_k </block><block class="operator token">=</block><block class=" token"> </block><block class="builtin token">int</block><block class="punctuation token">(</block><block class=" token">dbutils</block><block class="punctuation token">.</block><block class=" token">widgets</block><block class="punctuation token">.</block><block class=" token">get</block><block class="punctuation token">(</block><block class="string token">"top_k"</block><block class="punctuation token">)</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">top_features </block><block class="operator token">=</block><block class=" token"> features_df</block><block class="punctuation token">.</block><block class=" token">sort_values</block><block class="punctuation token">(</block><block class="punctuation token">[</block><block class="string token">"importance"</block><block class="punctuation token">]</block><block class="punctuation token">,</block><block class=" token"> ascending</block><block class="operator token">=</block><block class="boolean token">False</block><block class="punctuation token">)</block><block class="punctuation token">[</block><block class="punctuation token">:</block><block class=" token">top_k</block><block class="punctuation token">]</block><block class="punctuation token">[</block><block class="string token">"feature"</block><block class="punctuation token">]</block><block class="punctuation token">.</block><block class=" token">values</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">print</block><block class="punctuation token">(</block><block class=" token">top_features</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># ['bedrooms' 'cancellation_policyIndex' 'minimum_nights'</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># 'instant_bookableIndex' 'number_of_reviews']</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode section sindent-2" data-line-id="n0.42322203690377225" style="font-size: 1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.42322203690377225" role="heading" aria-level="3"><prefix style="text-align: left; padding-right: 0em;">5.1.4. </prefix><blocks><baselineblock class="inline"></baselineblock><block>Scale Invariant</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="background-color: rgb(255, 254, 0);">With decision trees, the scale of the features does not matter</block><block>. </block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>For example, it will split 1/3 of the data if that split point is 100 or if it is normalized to be .33. The only thing that matters is how many data points fall left and right of that split point - not the absolute value of the split point.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="background-color: rgb(255, 254, 0);">This is not true for linear regression, and the default in Spark is to standardize first</block><block>. </block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Think about it: If you measure shoe sizes in American vs European sizing, the corresponding weight of those features will be very different even those those measures represent the same thing: the size of a person's foot!</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode section sindent-2" data-line-id="n0.3886454780939601" style="font-size: 1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.3886454780939601" role="heading" aria-level="3"><prefix style="text-align: left; padding-right: 0em;">5.1.5. </prefix><blocks><baselineblock class="inline"></baselineblock><block>Prediction</block></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">pred_df </block><block class="operator token">=</block><block class=" token"> pipeline_model</block><block class="punctuation token">.</block><block class=" token">transform</block><block class="punctuation token">(</block><block class=" token">test_df</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">display</block><block class="punctuation token">(</block><block class=" token">pred_df</block><block class="punctuation token">.</block><block class=" token">select</block><block class="punctuation token">(</block><block class="string token">"features"</block><block class="punctuation token">,</block><block class=" token"> </block><block class="string token">"price"</block><block class="punctuation token">,</block><block class=" token"> </block><block class="string token">"prediction"</block><block class="punctuation token">)</block><block class="punctuation token">.</block><block class=" token">orderBy</block><block class="punctuation token">(</block><block class="string token">"price"</block><block class="punctuation token">,</block><block class=" token"> ascending</block><block class="operator token">=</block><block class="boolean token">False</block><block class="punctuation token">)</block><block class="punctuation token">)</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 676.789px; height: 364.35px; position: relative;"><img src="image-resources/d851c976-9282-47bd-8d03-9892b3f1495f.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode section sindent-2" data-line-id="n0.5406297241081" style="font-size: 1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.5406297241081" role="heading" aria-level="3"><prefix style="text-align: left; padding-right: 0em;">5.1.6. </prefix><blocks><baselineblock class="inline"></baselineblock><block>Pitfall</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>What if we get a massive Airbnb rental? It was 20 bedrooms and 20 bathrooms. What will a decision tree predict?</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="background-color: rgb(255, 254, 0);">It turns out decision trees cannot predict any values larger than they were trained on</block><block>. The max value in our training set was $10,000, so we can't predict any values larger than that.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> pyspark</block><block class="punctuation token">.</block><block class=" token">ml</block><block class="punctuation token">.</block><block class=" token">evaluation </block><block class="keyword token">import</block><block class=" token"> RegressionEvaluator</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">regression_evaluator </block><block class="operator token">=</block><block class=" token"> RegressionEvaluator</block><block class="punctuation token">(</block><block class=" token">predictionCol</block><block class="operator token">=</block><block class="string token">"prediction"</block><block class="punctuation token">,</block><block class=" token"> labelCol</block><block class="operator token">=</block><block class="string token">"price"</block><block class="punctuation token">,</block><block class=" token"> metricName</block><block class="operator token">=</block><block class="string token">"rmse"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">rmse </block><block class="operator token">=</block><block class=" token"> regression_evaluator</block><block class="punctuation token">.</block><block class=" token">evaluate</block><block class="punctuation token">(</block><block class=" token">pred_df</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">r2 </block><block class="operator token">=</block><block class=" token"> regression_evaluator</block><block class="punctuation token">.</block><block class=" token">setMetricName</block><block class="punctuation token">(</block><block class="string token">"r2"</block><block class="punctuation token">)</block><block class="punctuation token">.</block><block class=" token">evaluate</block><block class="punctuation token">(</block><block class=" token">pred_df</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">print</block><block class="punctuation token">(</block><block class="string-interpolation string token">f"RMSE is </block><block class="string-interpolation interpolation punctuation token">{</block><block class="string-interpolation interpolation token">rmse</block><block class="string-interpolation interpolation punctuation token">}</block><block class="string-interpolation string token">"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">print</block><block class="punctuation token">(</block><block class="string-interpolation string token">f"R2 is </block><block class="string-interpolation interpolation punctuation token">{</block><block class="string-interpolation interpolation token">r2</block><block class="string-interpolation interpolation punctuation token">}</block><block class="string-interpolation string token">"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># RMSE is 409.3381256547409</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># R2 is -4.252629588332073</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">[</block><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><compositeblock dir="ltr" class="anchor-tag-ref inline" style="font-family: &quot;Computer Modern Serif&quot;, serif;"><a href="#n0.3295185310066928" style="color: inherit; text-decoration: inherit;">Back To Top</a></compositeblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">]</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode section sindent-1" data-line-id="n0.8681313485843198" style="font-size: 1.1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.8681313485843198" role="heading" aria-level="2"><prefix style="text-align: left; padding-right: 0.25em;">5.2. </prefix><blocks><baselineblock class="inline"></baselineblock><block>Random Forests and Hyperparameter Tuning</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>In this section, we are going to look at how to tune random forests using grid search and cross validation in order to find the optimal hyperparameters. </block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Using the Databricks Runtime for ML, MLflow automatically logs metrics of all your experiments with the SparkML cross-validator as well as the best fit model!</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="font-weight: bold; flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold;">Let's start by building the model pipeline:</block></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> pyspark</block><block class="punctuation token">.</block><block class=" token">ml</block><block class="punctuation token">.</block><block class=" token">feature </block><block class="keyword token">import</block><block class=" token"> StringIndexer</block><block class="punctuation token">,</block><block class=" token"> VectorAssembler</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> pyspark</block><block class="punctuation token">.</block><block class=" token">ml</block><block class="punctuation token">.</block><block class=" token">regression </block><block class="keyword token">import</block><block class=" token"> RandomForestRegressor</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> pyspark</block><block class="punctuation token">.</block><block class=" token">ml </block><block class="keyword token">import</block><block class=" token"> Pipeline</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">file_path </block><block class="operator token">=</block><block class=" token"> </block><block class="string-interpolation string token">f"</block><block class="string-interpolation interpolation punctuation token">{</block><block class="string-interpolation interpolation token">DA</block><block class="string-interpolation interpolation punctuation token">.</block><block class="string-interpolation interpolation token">paths</block><block class="string-interpolation interpolation punctuation token">.</block><block class="string-interpolation interpolation token">datasets</block><block class="string-interpolation interpolation punctuation token">}</block><block class="string-interpolation string token">/airbnb/sf-listings/sf-listings-2019-03-06-clean.delta/"</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">airbnb_df </block><block class="operator token">=</block><block class=" token"> spark</block><block class="punctuation token">.</block><block class=" token">read</block><block class="punctuation token">.</block><block class="builtin token">format</block><block class="punctuation token">(</block><block class="string token">"delta"</block><block class="punctuation token">)</block><block class="punctuation token">.</block><block class=" token">load</block><block class="punctuation token">(</block><block class=" token">file_path</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">train_df</block><block class="punctuation token">,</block><block class=" token"> test_df </block><block class="operator token">=</block><block class=" token"> airbnb_df</block><block class="punctuation token">.</block><block class=" token">randomSplit</block><block class="punctuation token">(</block><block class="punctuation token">[</block><block class="number token">.8</block><block class="punctuation token">,</block><block class=" token"> </block><block class="number token">.2</block><block class="punctuation token">]</block><block class="punctuation token">,</block><block class=" token"> seed</block><block class="operator token">=</block><block class="number token">42</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">categorical_cols </block><block class="operator token">=</block><block class=" token"> </block><block class="punctuation token">[</block><block class=" token">field </block><block class="keyword token">for</block><block class=" token"> </block><block class="punctuation token">(</block><block class=" token">field</block><block class="punctuation token">,</block><block class=" token"> dataType</block><block class="punctuation token">)</block><block class=" token"> </block><block class="keyword token">in</block><block class=" token"> train_df</block><block class="punctuation token">.</block><block class=" token">dtypes </block><block class="keyword token">if</block><block class=" token"> dataType </block><block class="operator token">==</block><block class=" token"> </block><block class="string token">"string"</block><block class="punctuation token">]</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">index_output_cols </block><block class="operator token">=</block><block class=" token"> </block><block class="punctuation token">[</block><block class=" token">x </block><block class="operator token">+</block><block class=" token"> </block><block class="string token">"Index"</block><block class=" token"> </block><block class="keyword token">for</block><block class=" token"> x </block><block class="keyword token">in</block><block class=" token"> categorical_cols</block><block class="punctuation token">]</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">string_indexer </block><block class="operator token">=</block><block class=" token"> StringIndexer</block><block class="punctuation token">(</block><block class=" token">inputCols</block><block class="operator token">=</block><block class=" token">categorical_cols</block><block class="punctuation token">,</block><block class=" token"> outputCols</block><block class="operator token">=</block><block class=" token">index_output_cols</block><block class="punctuation token">,</block><block class=" token"> handleInvalid</block><block class="operator token">=</block><block class="string token">"skip"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">numeric_cols </block><block class="operator token">=</block><block class=" token"> </block><block class="punctuation token">[</block><block class=" token">field </block><block class="keyword token">for</block><block class=" token"> </block><block class="punctuation token">(</block><block class=" token">field</block><block class="punctuation token">,</block><block class=" token"> dataType</block><block class="punctuation token">)</block><block class=" token"> </block><block class="keyword token">in</block><block class=" token"> train_df</block><block class="punctuation token">.</block><block class=" token">dtypes </block><block class="keyword token">if</block><block class=" token"> </block><block class="punctuation token">(</block><block class="punctuation token">(</block><block class=" token">dataType </block><block class="operator token">==</block><block class=" token"> </block><block class="string token">"double"</block><block class="punctuation token">)</block><block class=" token"> </block><block class="operator token">&amp;</block><block class=" token"> </block><block class="punctuation token">(</block><block class=" token">field </block><block class="operator token">!=</block><block class=" token"> </block><block class="string token">"price"</block><block class="punctuation token">)</block><block class="punctuation token">)</block><block class="punctuation token">]</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">assembler_inputs </block><block class="operator token">=</block><block class=" token"> index_output_cols </block><block class="operator token">+</block><block class=" token"> numeric_cols</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">vec_assembler </block><block class="operator token">=</block><block class=" token"> VectorAssembler</block><block class="punctuation token">(</block><block class=" token">inputCols</block><block class="operator token">=</block><block class=" token">assembler_inputs</block><block class="punctuation token">,</block><block class=" token"> outputCol</block><block class="operator token">=</block><block class="string token">"features"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">rf </block><block class="operator token">=</block><block class=" token"> RandomForestRegressor</block><block class="punctuation token">(</block><block class=" token">labelCol</block><block class="operator token">=</block><block class="string token">"price"</block><block class="punctuation token">,</block><block class=" token"> maxBins</block><block class="operator token">=</block><block class="number token">40</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">stages </block><block class="operator token">=</block><block class=" token"> </block><block class="punctuation token">[</block><block class=" token">string_indexer</block><block class="punctuation token">,</block><block class=" token"> vec_assembler</block><block class="punctuation token">,</block><block class=" token"> rf</block><block class="punctuation token">]</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">pipeline </block><block class="operator token">=</block><block class=" token"> Pipeline</block><block class="punctuation token">(</block><block class=" token">stages</block><block class="operator token">=</block><block class=" token">stages</block><block class="punctuation token">)</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">[</block><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><compositeblock dir="ltr" class="anchor-tag-ref inline" style="font-family: &quot;Computer Modern Serif&quot;, serif;"><a href="#n0.3295185310066928" style="color: inherit; text-decoration: inherit;">Back To Top</a></compositeblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">]</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode section sindent-2" data-line-id="n0.7379932207959412" style="font-size: 1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.7379932207959412" role="heading" aria-level="3"><prefix style="text-align: left; padding-right: 0em;">5.2.1. </prefix><blocks><baselineblock class="inline"></baselineblock><block>ParamGrid</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; background-color: rgb(255, 254, 0);">Note:</block><block> To get the list of hyperparameters run  </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(255, 64, 0);">rf.explainParams()</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>There are a lot of hyperparameters we could tune, and it would take a long time to manually configure.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Instead of a manual (ad-hoc) approach, let's use Spark's </block><block class="role-hyper-link" data-hyper-link-url="https://spark.apache.org/docs/latest/api/python/reference/api/pyspark.ml.tuning.ParamGridBuilder.html?highlight=paramgridbuilder#pyspark.ml.tuning.ParamGridBuilder" style="text-decoration: underline; font-weight: bold; color: rgb(17, 85, 204);"><a href="https://spark.apache.org/docs/latest/api/python/reference/api/pyspark.ml.tuning.ParamGridBuilder.html?highlight=paramgridbuilder#pyspark.ml.tuning.ParamGridBuilder" target="_blank" style="color: inherit; text-decoration: inherit;">ParamGridBuilder</a></block><block> to find the optimal hyperparameters in a more systematic approach.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Let's define a grid of hyperparameters to test:</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">maxDepth</block><block>  max depth of each decision tree (Use the values 2, 5)</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">numTrees</block><block>  number of decision trees to train (Use the values 5, 10)</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">addGrid()</block><block> accepts the name of the parameter (e.g. </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">rf.maxDepth</block><block>), and a list of the possible values (e.g. [2, 5]).</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> pyspark</block><block class="punctuation token">.</block><block class=" token">ml</block><block class="punctuation token">.</block><block class=" token">tuning </block><block class="keyword token">import</block><block class=" token"> ParamGridBuilder</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">param_grid </block><block class="operator token">=</block><block class=" token"> </block><block class="punctuation token">(</block><block class=" token">ParamGridBuilder</block><block class="punctuation token">(</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">              </block><block class="punctuation token">.</block><block class=" token">addGrid</block><block class="punctuation token">(</block><block class=" token">rf</block><block class="punctuation token">.</block><block class=" token">maxDepth</block><block class="punctuation token">,</block><block class=" token"> </block><block class="punctuation token">[</block><block class="number token">2</block><block class="punctuation token">,</block><block class=" token"> </block><block class="number token">5</block><block class="punctuation token">]</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">              </block><block class="punctuation token">.</block><block class=" token">addGrid</block><block class="punctuation token">(</block><block class=" token">rf</block><block class="punctuation token">.</block><block class=" token">numTrees</block><block class="punctuation token">,</block><block class=" token"> </block><block class="punctuation token">[</block><block class="number token">5</block><block class="punctuation token">,</block><block class=" token"> </block><block class="number token">10</block><block class="punctuation token">]</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">              </block><block class="punctuation token">.</block><block class=" token">build</block><block class="punctuation token">(</block><block class="punctuation token">)</block><block class="punctuation token">)</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">[</block><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><compositeblock dir="ltr" class="anchor-tag-ref inline" style="font-family: &quot;Computer Modern Serif&quot;, serif;"><a href="#n0.3295185310066928" style="color: inherit; text-decoration: inherit;">Back To Top</a></compositeblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">]</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode section sindent-2" data-line-id="n0.9782031911049784" style="font-size: 1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.9782031911049784" role="heading" aria-level="3"><prefix style="text-align: left; padding-right: 0em;">5.2.2. </prefix><blocks><baselineblock class="inline"></baselineblock><block>Cross Validation</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>We are also going to use 3-fold cross validation to identify the optimal hyperparameters.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 439.2px; height: 129.72px; position: relative;"><img src="image-resources/e4b1f44d-94d0-40d6-b2e7-5bdb31241fce.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>We pass in the </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">estimator</block><block> (pipeline), </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">evaluator</block><block>, and </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">estimatorParamMaps</block><block> to </block><block class="role-hyper-link" data-hyper-link-url="https://spark.apache.org/docs/latest/api/python/reference/api/pyspark.ml.tuning.CrossValidator.html?highlight=crossvalidator#pyspark.ml.tuning.CrossValidator" style="text-decoration: underline; color: rgb(17, 85, 204);"><a href="https://spark.apache.org/docs/latest/api/python/reference/api/pyspark.ml.tuning.CrossValidator.html?highlight=crossvalidator#pyspark.ml.tuning.CrossValidator" target="_blank" style="color: inherit; text-decoration: inherit;">CrossValidator</a></block><block> so that it knows:</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Which model to use</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>How to evaluate the model</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>What hyperparameters to set for the model</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>We can also set the number of folds we want to split our data into (3), as well as setting a seed so we all have the same split in the data.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> pyspark</block><block class="punctuation token">.</block><block class=" token">ml</block><block class="punctuation token">.</block><block class=" token">evaluation </block><block class="keyword token">import</block><block class=" token"> RegressionEvaluator</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> pyspark</block><block class="punctuation token">.</block><block class=" token">ml</block><block class="punctuation token">.</block><block class=" token">tuning </block><block class="keyword token">import</block><block class=" token"> CrossValidator</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">evaluator </block><block class="operator token">=</block><block class=" token"> RegressionEvaluator</block><block class="punctuation token">(</block><block class=" token">labelCol</block><block class="operator token">=</block><block class="string token">"price"</block><block class="punctuation token">,</block><block class=" token"> predictionCol</block><block class="operator token">=</block><block class="string token">"prediction"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">cv </block><block class="operator token">=</block><block class=" token"> CrossValidator</block><block class="punctuation token">(</block><block class=" token">estimator</block><block class="operator token">=</block><block class=" token">pipeline</block><block class="punctuation token">,</block><block class=" token"> evaluator</block><block class="operator token">=</block><block class=" token">evaluator</block><block class="punctuation token">,</block><block class=" token"> estimatorParamMaps</block><block class="operator token">=</block><block class=" token">param_grid</block><block class="punctuation token">,</block><block class=" token"> </block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">                    numFolds</block><block class="operator token">=</block><block class="number token">3</block><block class="punctuation token">,</block><block class=" token"> seed</block><block class="operator token">=</block><block class="number token">42</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">cv_model </block><block class="operator token">=</block><block class=" token"> cv</block><block class="punctuation token">.</block><block class=" token">fit</block><block class="punctuation token">(</block><block class=" token">train_df</block><block class="punctuation token">)</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; background-color: rgb(255, 254, 0);">Question:</block><block style="background-color: rgb(255, 254, 0);"> Should we put the pipeline in the cross validator, or the cross validator in the pipeline?</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="background-color: rgb(255, 254, 0);">It depends if there are estimators or transformers in the pipeline.</block><block> </block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>If you have things like </block><block style="font-style: italic;">StringIndexer</block><block> (an estimator) in the pipeline, then you have to refit it every time if you put the entire pipeline in the cross validator.</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>However, if there is </block><block style="text-decoration: underline;">any concern about data leakage from the earlier steps</block><block>, the safest thing is to put the pipeline inside the CV, not the other way. </block></blocks></line><line class="root text-mode indent-2 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="3"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;">* </prefix><blocks><baselineblock class="inline"></baselineblock><block>CV first splits the data and then </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">.fit()</block><block> the pipeline. </block></blocks></line><line class="root text-mode indent-2 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="3"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;">* </prefix><blocks><baselineblock class="inline"></baselineblock><block style="text-decoration: underline;">If it is placed at the end of the pipeline, we potentially can leak the info from hold-out set to train set</block><block>.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">cv </block><block class="operator token">=</block><block class=" token"> CrossValidator</block><block class="punctuation token">(</block><block class=" token">estimator</block><block class="operator token">=</block><block class=" token">rf</block><block class="punctuation token">,</block><block class=" token"> evaluator</block><block class="operator token">=</block><block class=" token">evaluator</block><block class="punctuation token">,</block><block class=" token"> estimatorParamMaps</block><block class="operator token">=</block><block class=" token">param_grid</block><block class="punctuation token">,</block><block class=" token"> </block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">                    numFolds</block><block class="operator token">=</block><block class="number token">3</block><block class="punctuation token">,</block><block class=" token"> seed</block><block class="operator token">=</block><block class="number token">42</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">stages_with_cv </block><block class="operator token">=</block><block class=" token"> </block><block class="punctuation token">[</block><block class=" token">string_indexer</block><block class="punctuation token">,</block><block class=" token"> vec_assembler</block><block class="punctuation token">,</block><block class=" token"> cv</block><block class="punctuation token">]</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">pipeline </block><block class="operator token">=</block><block class=" token"> Pipeline</block><block class="punctuation token">(</block><block class=" token">stages</block><block class="operator token">=</block><block class=" token">stages_with_cv</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">pipeline_model </block><block class="operator token">=</block><block class=" token"> pipeline</block><block class="punctuation token">.</block><block class=" token">fit</block><block class="punctuation token">(</block><block class=" token">train_df</block><block class="punctuation token">)</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="text-decoration: none; background-color: rgb(255, 254, 0);">In the current method, only one MLflow run is logged, whereas in the previous method, five runs were logged</block><block>. </block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>This is because, in the first method, the pipeline was placed within the CrossValidator, which automatically logs all runs. </block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>However, in the second method, since the pipeline only returns the best model without evaluating metrics, only that single model is seen. </block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Additionally, no evaluation metrics are logged. </block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Essentially, the Pipeline logs all stages and directly returns the best model without performing model evaluations.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># model with the best hyperparameter configuration</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="builtin token">list</block><block class="punctuation token">(</block><block class="builtin token">zip</block><block class="punctuation token">(</block><block class=" token">cv_model</block><block class="punctuation token">.</block><block class=" token">getEstimatorParamMaps</block><block class="punctuation token">(</block><block class="punctuation token">)</block><block class="punctuation token">,</block><block class=" token"> cv_model</block><block class="punctuation token">.</block><block class=" token">avgMetrics</block><block class="punctuation token">)</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># [({Param(parent='RandomForestRegressor_401a5f438e22', name='maxDepth', doc='Maximum depth of the tree. (&gt;= 0) E.g., depth 0 means 1 leaf node; depth 1 means 1 internal node + 2 leaf nodes. Must be in range [0, 30].'): 2,</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token">#    Param(parent='RandomForestRegressor_401a5f438e22', name='numTrees', doc='Number of trees to train (&gt;= 1).'): 5},</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token">#   280.13676707305024),</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token">#  ({Param(parent='RandomForestRegressor_401a5f438e22', name='maxDepth', doc='Maximum depth of the tree. (&gt;= 0) E.g., depth 0 means 1 leaf node; depth 1 means 1 internal node + 2 leaf nodes. Must be in range [0, 30].'): 2,</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token">#    Param(parent='RandomForestRegressor_401a5f438e22', name='numTrees', doc='Number of trees to train (&gt;= 1).'): 10},</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token">#   280.00286295955465),</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token">#  ({Param(parent='RandomForestRegressor_401a5f438e22', name='maxDepth', doc='Maximum depth of the tree. (&gt;= 0) E.g., depth 0 means 1 leaf node; depth 1 means 1 internal node + 2 leaf nodes. Must be in range [0, 30].'): 5,</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token">#    Param(parent='RandomForestRegressor_401a5f438e22', name='numTrees', doc='Number of trees to train (&gt;= 1).'): 5},</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token">#   287.9329709115638),</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token">#  ({Param(parent='RandomForestRegressor_401a5f438e22', name='maxDepth', doc='Maximum depth of the tree. (&gt;= 0) E.g., depth 0 means 1 leaf node; depth 1 means 1 internal node + 2 leaf nodes. Must be in range [0, 30].'): 5,</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token">#    Param(parent='RandomForestRegressor_401a5f438e22', name='numTrees', doc='Number of trees to train (&gt;= 1).'): 10},</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token">#   294.6576018771978)]</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Predictions are outperforming the decision tree model</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">pred_df </block><block class="operator token">=</block><block class=" token"> pipeline_model</block><block class="punctuation token">.</block><block class=" token">transform</block><block class="punctuation token">(</block><block class=" token">test_df</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">rmse </block><block class="operator token">=</block><block class=" token"> evaluator</block><block class="punctuation token">.</block><block class=" token">evaluate</block><block class="punctuation token">(</block><block class=" token">pred_df</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">r2 </block><block class="operator token">=</block><block class=" token"> evaluator</block><block class="punctuation token">.</block><block class=" token">setMetricName</block><block class="punctuation token">(</block><block class="string token">"r2"</block><block class="punctuation token">)</block><block class="punctuation token">.</block><block class=" token">evaluate</block><block class="punctuation token">(</block><block class=" token">pred_df</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">print</block><block class="punctuation token">(</block><block class="string-interpolation string token">f"RMSE is </block><block class="string-interpolation interpolation punctuation token">{</block><block class="string-interpolation interpolation token">rmse</block><block class="string-interpolation interpolation punctuation token">}</block><block class="string-interpolation string token">"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">print</block><block class="punctuation token">(</block><block class="string-interpolation string token">f"R2 is </block><block class="string-interpolation interpolation punctuation token">{</block><block class="string-interpolation interpolation token">r2</block><block class="string-interpolation interpolation punctuation token">}</block><block class="string-interpolation string token">"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># RMSE is 143.06124338029716</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># R2 is 0.35841179228176656</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">[</block><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><compositeblock dir="ltr" class="anchor-tag-ref inline" style="font-family: &quot;Computer Modern Serif&quot;, serif;"><a href="#n0.3295185310066928" style="color: inherit; text-decoration: inherit;">Back To Top</a></compositeblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">]</block></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="inline" style="display: block;"><div style="vertical-align: baseline;"><div style="display: inline-block; height: 0px; border-bottom: 1px solid; width: 100%;"></div></div></compositeblock></blocks></line><line class="root text-mode section sindent-0" data-line-id="n0.5499876245011357" style="font-size: 1.2em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.5499876245011357" role="heading" aria-level="1"><prefix style="text-align: left; padding-right: 0.5em;">6. </prefix><blocks><baselineblock class="inline"></baselineblock><block>Hyperopt</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; color: rgb(255, 64, 0);">Hyperopt</block><block> is a Python library for </block><block style="font-weight: bold;">"serial and parallel optimization over awkward search spaces, which may include real-valued, discrete, and conditional dimensions"</block><block>.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>In the machine learning workflow, </block><block style="font-style: italic;">hyperopt</block><block> can be </block><block style="background-color: rgb(255, 254, 0);">used to distribute/parallelize the hyperparameter optimization process with more advanced optimization strategies than are available in other libraries</block><block>.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block class="role-hyper-link" data-hyper-link-url="https://proceedings.neurips.cc/paper_files/paper/2011/file/86e8f7ab32cfd12577bc2619bc635690-Paper.pdf" style="text-decoration: underline; color: rgb(17, 85, 204);"><a href="https://proceedings.neurips.cc/paper_files/paper/2011/file/86e8f7ab32cfd12577bc2619bc635690-Paper.pdf" target="_blank" style="color: inherit; text-decoration: inherit;">Hyperopt paper</a></block><block>.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 692.994px; height: 312.07px; position: relative;"><img src="image-resources/23b3182a-03a4-43f1-a19a-906ac78cc02b.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 693.192px; height: 312.36px; position: relative;"><img src="image-resources/73f03d68-b1e4-4603-9f1a-9098786d906b.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 689.395px; height: 373.14px; position: relative;"><img src="image-resources/c43dcdfa-fe9d-4d7b-a1ea-927042555905.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 684.192px; height: 361.06px; position: relative;"><img src="image-resources/4a3f20cc-f5f4-4792-b3f5-1453b843bafb.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="font-weight: bold; flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; background-color: rgb(255, 254, 0);">There are two ways to scale hyperopt with Apache Spark:</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Use single-machine hyperopt with a distributed training algorithm (e.g. MLlib)</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Use distributed hyperopt with single-machine training algorithms (e.g. scikit-learn) with the SparkTrials class.</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>In this lesson, we will use single-machine hyperopt with MLlib, but in the lab, you will see how to use hyperopt to distribute the hyperparameter tuning of single node models.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Unfortunately, you cant use hyperopt to distribute the hyperparameter optimization for distributed training algorithims at this time. However, you do still get the benefit of using more advanced hyperparameter search algorthims (random search, TPE, etc.) with Spark ML.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="font-weight: bold; flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold;">Resources:</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block class="role-hyper-link" data-hyper-link-url="http://hyperopt.github.io/hyperopt/scaleout/spark/" style="text-decoration: underline; color: rgb(17, 85, 204);"><a href="http://hyperopt.github.io/hyperopt/scaleout/spark/" target="_blank" style="color: inherit; text-decoration: inherit;">Documentation</a></block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block class="role-hyper-link" data-hyper-link-url="https://docs.databricks.com/applications/machine-learning/automl/hyperopt/index.html" style="text-decoration: underline; color: rgb(17, 85, 204);"><a href="https://docs.databricks.com/applications/machine-learning/automl/hyperopt/index.html" target="_blank" style="color: inherit; text-decoration: inherit;">Hyperopt on Databricks</a></block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block class="role-hyper-link" data-hyper-link-url="https://databricks.com/blog/2019/06/07/hyperparameter-tuning-with-mlflow-apache-spark-mllib-and-hyperopt.html" style="text-decoration: underline; color: rgb(17, 85, 204);"><a href="https://databricks.com/blog/2019/06/07/hyperparameter-tuning-with-mlflow-apache-spark-mllib-and-hyperopt.html" target="_blank" style="color: inherit; text-decoration: inherit;">Hyperparameter Tuning with MLflow, Apache Spark MLlib and Hyperopt</a></block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block class="role-hyper-link" data-hyper-link-url="https://databricks.com/blog/2021/04/15/how-not-to-tune-your-model-with-hyperopt.html" style="text-decoration: underline; color: rgb(17, 85, 204);"><a href="https://databricks.com/blog/2021/04/15/how-not-to-tune-your-model-with-hyperopt.html" target="_blank" style="color: inherit; text-decoration: inherit;">How (Not) to Tune Your Model With Hyperopt</a></block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Load the data and build the model pipeline</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">file_path </block><block class="operator token">=</block><block class=" token"> </block><block class="string-interpolation string token">f"</block><block class="string-interpolation interpolation punctuation token">{</block><block class="string-interpolation interpolation token">DA</block><block class="string-interpolation interpolation punctuation token">.</block><block class="string-interpolation interpolation token">paths</block><block class="string-interpolation interpolation punctuation token">.</block><block class="string-interpolation interpolation token">datasets</block><block class="string-interpolation interpolation punctuation token">}</block><block class="string-interpolation string token">/airbnb/sf-listings/sf-listings-2019-03-06-clean.delta/"</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">airbnb_df </block><block class="operator token">=</block><block class=" token"> spark</block><block class="punctuation token">.</block><block class=" token">read</block><block class="punctuation token">.</block><block class="builtin token">format</block><block class="punctuation token">(</block><block class="string token">"delta"</block><block class="punctuation token">)</block><block class="punctuation token">.</block><block class=" token">load</block><block class="punctuation token">(</block><block class=" token">file_path</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">train_df</block><block class="punctuation token">,</block><block class=" token"> val_df</block><block class="punctuation token">,</block><block class=" token"> test_df </block><block class="operator token">=</block><block class=" token"> airbnb_df</block><block class="punctuation token">.</block><block class=" token">randomSplit</block><block class="punctuation token">(</block><block class="punctuation token">[</block><block class="number token">.6</block><block class="punctuation token">,</block><block class=" token"> </block><block class="number token">.2</block><block class="punctuation token">,</block><block class=" token"> </block><block class="number token">.2</block><block class="punctuation token">]</block><block class="punctuation token">,</block><block class=" token"> seed</block><block class="operator token">=</block><block class="number token">42</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> pyspark</block><block class="punctuation token">.</block><block class=" token">ml</block><block class="punctuation token">.</block><block class=" token">feature </block><block class="keyword token">import</block><block class=" token"> StringIndexer</block><block class="punctuation token">,</block><block class=" token"> VectorAssembler</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> pyspark</block><block class="punctuation token">.</block><block class=" token">ml </block><block class="keyword token">import</block><block class=" token"> Pipeline</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> pyspark</block><block class="punctuation token">.</block><block class=" token">ml</block><block class="punctuation token">.</block><block class=" token">regression </block><block class="keyword token">import</block><block class=" token"> RandomForestRegressor</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> pyspark</block><block class="punctuation token">.</block><block class=" token">ml</block><block class="punctuation token">.</block><block class=" token">evaluation </block><block class="keyword token">import</block><block class=" token"> RegressionEvaluator</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">categorical_cols </block><block class="operator token">=</block><block class=" token"> </block><block class="punctuation token">[</block><block class=" token">field </block><block class="keyword token">for</block><block class=" token"> </block><block class="punctuation token">(</block><block class=" token">field</block><block class="punctuation token">,</block><block class=" token"> dataType</block><block class="punctuation token">)</block><block class=" token"> </block><block class="keyword token">in</block><block class=" token"> train_df</block><block class="punctuation token">.</block><block class=" token">dtypes </block><block class="keyword token">if</block><block class=" token"> dataType </block><block class="operator token">==</block><block class=" token"> </block><block class="string token">"string"</block><block class="punctuation token">]</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">index_output_cols </block><block class="operator token">=</block><block class=" token"> </block><block class="punctuation token">[</block><block class=" token">x </block><block class="operator token">+</block><block class=" token"> </block><block class="string token">"Index"</block><block class=" token"> </block><block class="keyword token">for</block><block class=" token"> x </block><block class="keyword token">in</block><block class=" token"> categorical_cols</block><block class="punctuation token">]</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">string_indexer </block><block class="operator token">=</block><block class=" token"> StringIndexer</block><block class="punctuation token">(</block><block class=" token">inputCols</block><block class="operator token">=</block><block class=" token">categorical_cols</block><block class="punctuation token">,</block><block class=" token"> outputCols</block><block class="operator token">=</block><block class=" token">index_output_cols</block><block class="punctuation token">,</block><block class=" token"> handleInvalid</block><block class="operator token">=</block><block class="string token">"skip"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">numeric_cols </block><block class="operator token">=</block><block class=" token"> </block><block class="punctuation token">[</block><block class=" token">field </block><block class="keyword token">for</block><block class=" token"> </block><block class="punctuation token">(</block><block class=" token">field</block><block class="punctuation token">,</block><block class=" token"> dataType</block><block class="punctuation token">)</block><block class=" token"> </block><block class="keyword token">in</block><block class=" token"> train_df</block><block class="punctuation token">.</block><block class=" token">dtypes </block><block class="keyword token">if</block><block class=" token"> </block><block class="punctuation token">(</block><block class="punctuation token">(</block><block class=" token">dataType </block><block class="operator token">==</block><block class=" token"> </block><block class="string token">"double"</block><block class="punctuation token">)</block><block class=" token"> </block><block class="operator token">&amp;</block><block class=" token"> </block><block class="punctuation token">(</block><block class=" token">field </block><block class="operator token">!=</block><block class=" token"> </block><block class="string token">"price"</block><block class="punctuation token">)</block><block class="punctuation token">)</block><block class="punctuation token">]</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">assembler_inputs </block><block class="operator token">=</block><block class=" token"> index_output_cols </block><block class="operator token">+</block><block class=" token"> numeric_cols</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">vec_assembler </block><block class="operator token">=</block><block class=" token"> VectorAssembler</block><block class="punctuation token">(</block><block class=" token">inputCols</block><block class="operator token">=</block><block class=" token">assembler_inputs</block><block class="punctuation token">,</block><block class=" token"> outputCol</block><block class="operator token">=</block><block class="string token">"features"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">rf </block><block class="operator token">=</block><block class=" token"> RandomForestRegressor</block><block class="punctuation token">(</block><block class=" token">labelCol</block><block class="operator token">=</block><block class="string token">"price"</block><block class="punctuation token">,</block><block class=" token"> maxBins</block><block class="operator token">=</block><block class="number token">40</block><block class="punctuation token">,</block><block class=" token"> seed</block><block class="operator token">=</block><block class="number token">42</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">pipeline </block><block class="operator token">=</block><block class=" token"> Pipeline</block><block class="punctuation token">(</block><block class=" token">stages</block><block class="operator token">=</block><block class="punctuation token">[</block><block class=" token">string_indexer</block><block class="punctuation token">,</block><block class=" token"> vec_assembler</block><block class="punctuation token">,</block><block class=" token"> rf</block><block class="punctuation token">]</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">regression_evaluator </block><block class="operator token">=</block><block class=" token"> RegressionEvaluator</block><block class="punctuation token">(</block><block class=" token">predictionCol</block><block class="operator token">=</block><block class="string token">"prediction"</block><block class="punctuation token">,</block><block class=" token"> labelCol</block><block class="operator token">=</block><block class="string token">"price"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">[</block><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><compositeblock dir="ltr" class="anchor-tag-ref inline" style="font-family: &quot;Computer Modern Serif&quot;, serif;"><a href="#n0.3295185310066928" style="color: inherit; text-decoration: inherit;">Back To Top</a></compositeblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">]</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode section sindent-1" data-line-id="n0.37270013453753537" style="font-size: 1.1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.37270013453753537" role="heading" aria-level="2"><prefix style="text-align: left; padding-right: 0.25em;">6.1. </prefix><blocks><baselineblock class="inline"></baselineblock><block>Define Objective Function</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>First, we define our objective function. The objective function has </block><block style="text-decoration: underline;">two primary requirements</block><block>:</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>An </block><block style="font-weight: bold;">input</block><block> params including hyperparameter values to use when training the model</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>An </block><block style="font-weight: bold;">output</block><block> containing a loss metric on which to optimize</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>In this case, we are specifying values of </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">max_depth</block><block> and </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">num_trees</block><block> and returning the RMSE as our loss metric.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>We are reconstructing our pipeline for the </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">RandomForestRegressor</block><block> to use the specified hyperparameter values.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">def</block><block class=" token"> </block><block class="function token">objective_function</block><block class="punctuation token">(</block><block class=" token">params</block><block class="punctuation token">)</block><block class="punctuation token">:</block><block class=" token">    </block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block><block class="comment token"># set the hyperparameters that we want to tune</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    max_depth </block><block class="operator token">=</block><block class=" token"> params</block><block class="punctuation token">[</block><block class="string token">"max_depth"</block><block class="punctuation token">]</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    num_trees </block><block class="operator token">=</block><block class=" token"> params</block><block class="punctuation token">[</block><block class="string token">"num_trees"</block><block class="punctuation token">]</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block><block class="keyword token">with</block><block class=" token"> mlflow</block><block class="punctuation token">.</block><block class=" token">start_run</block><block class="punctuation token">(</block><block class="punctuation token">)</block><block class="punctuation token">:</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">        estimator </block><block class="operator token">=</block><block class=" token"> pipeline</block><block class="punctuation token">.</block><block class=" token">copy</block><block class="punctuation token">(</block><block class="punctuation token">{</block><block class=" token">rf</block><block class="punctuation token">.</block><block class=" token">maxDepth</block><block class="punctuation token">:</block><block class=" token"> max_depth</block><block class="punctuation token">,</block><block class=" token"> rf</block><block class="punctuation token">.</block><block class=" token">numTrees</block><block class="punctuation token">:</block><block class=" token"> num_trees</block><block class="punctuation token">}</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">        model </block><block class="operator token">=</block><block class=" token"> estimator</block><block class="punctuation token">.</block><block class=" token">fit</block><block class="punctuation token">(</block><block class=" token">train_df</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">        preds </block><block class="operator token">=</block><block class=" token"> model</block><block class="punctuation token">.</block><block class=" token">transform</block><block class="punctuation token">(</block><block class=" token">val_df</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">        rmse </block><block class="operator token">=</block><block class=" token"> regression_evaluator</block><block class="punctuation token">.</block><block class=" token">evaluate</block><block class="punctuation token">(</block><block class=" token">preds</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">        mlflow</block><block class="punctuation token">.</block><block class=" token">log_metric</block><block class="punctuation token">(</block><block class="string token">"rmse"</block><block class="punctuation token">,</block><block class=" token"> rmse</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block><block class="keyword token">return</block><block class=" token"> rmse</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">[</block><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><compositeblock dir="ltr" class="anchor-tag-ref inline" style="font-family: &quot;Computer Modern Serif&quot;, serif;"><a href="#n0.3295185310066928" style="color: inherit; text-decoration: inherit;">Back To Top</a></compositeblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">]</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode section sindent-1" data-line-id="n0.8023239447206147" style="font-size: 1.1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.8023239447206147" role="heading" aria-level="2"><prefix style="text-align: left; padding-right: 0.25em;">6.2. </prefix><blocks><baselineblock class="inline"></baselineblock><block>Define Search Space</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>This is </block><block style="text-decoration: underline;">similar to the parameter grid</block><block> in a grid search process. </block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>However, </block><block style="background-color: rgb(255, 254, 0);">we are only specifying the range of values rather than the individual, specific values to be tested</block><block>. </block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>It's up to hyperopt's optimization algorithm to choose the actual values.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>See the </block><block class="role-hyper-link" data-hyper-link-url="https://github.com/hyperopt/hyperopt/wiki/FMin" style="text-decoration: underline; color: rgb(17, 85, 204);"><a href="https://github.com/hyperopt/hyperopt/wiki/FMin" target="_blank" style="color: inherit; text-decoration: inherit;">documentation</a></block><block> for helpful tips on defining your search space.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> hyperopt </block><block class="keyword token">import</block><block class=" token"> hp</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">search_space </block><block class="operator token">=</block><block class=" token"> </block><block class="punctuation token">{</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block><block class="string token">"max_depth"</block><block class="punctuation token">:</block><block class=" token"> hp</block><block class="punctuation token">.</block><block class=" token">quniform</block><block class="punctuation token">(</block><block class="string token">"max_depth"</block><block class="punctuation token">,</block><block class=" token"> </block><block class="number token">2</block><block class="punctuation token">,</block><block class=" token"> </block><block class="number token">5</block><block class="punctuation token">,</block><block class=" token"> </block><block class="number token">1</block><block class="punctuation token">)</block><block class="punctuation token">,</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block><block class="string token">"num_trees"</block><block class="punctuation token">:</block><block class=" token"> hp</block><block class="punctuation token">.</block><block class=" token">quniform</block><block class="punctuation token">(</block><block class="string token">"num_trees"</block><block class="punctuation token">,</block><block class=" token"> </block><block class="number token">10</block><block class="punctuation token">,</block><block class=" token"> </block><block class="number token">100</block><block class="punctuation token">,</block><block class=" token"> </block><block class="number token">1</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="punctuation token">}</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(255, 64, 0);">fmin()</block><block> generates new hyperparameter configurations to use for your </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(255, 64, 0);">objective_function</block><block>. </block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>It will evaluate 4 models in total, using the information from the previous models to make a more informative decision for the next hyperparameter to try.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold;">Hyperopt</block><block> allows for </block><block style="font-weight: bold; background-color: rgb(255, 254, 0);">parallel hyperparameter tuning</block><block> using either </block><block style="font-weight: bold; color: rgb(255, 64, 0);">random search</block><block> or </block><block style="font-weight: bold; color: rgb(255, 64, 0);">Tree of Parzen Estimators (TPE)</block><block>. </block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>According to the </block><block class="role-hyper-link" data-hyper-link-url="http://hyperopt.github.io/hyperopt/scaleout/spark/" style="text-decoration: underline; color: rgb(17, 85, 204);"><a href="http://hyperopt.github.io/hyperopt/scaleout/spark/" target="_blank" style="color: inherit; text-decoration: inherit;">documentation</a></block><block>, TPE is an </block><block style="text-decoration: underline;">adaptive algorithm that iteratively explores the hyperparameter space</block><block>. Each new hyperparameter setting tested will be chosen based on previous results.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Hence, </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(255, 64, 0);">tpe.suggest</block><block> is a </block><block style="font-weight: bold;">Bayesian method</block><block>.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="text-decoration: underline;">MLflow also integrates with Hyperopt</block><block>, so you can track the results of all the models youve trained and their results as part of your hyperparameter tuning. </block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Notice you can track the MLflow experiment in this notebook, but you can also specify an external experiment.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> hyperopt </block><block class="keyword token">import</block><block class=" token"> fmin</block><block class="punctuation token">,</block><block class=" token"> tpe</block><block class="punctuation token">,</block><block class=" token"> Trials</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">import</block><block class=" token"> numpy </block><block class="keyword token">as</block><block class=" token"> np</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">import</block><block class=" token"> mlflow</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">import</block><block class=" token"> mlflow</block><block class="punctuation token">.</block><block class=" token">spark</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">mlflow</block><block class="punctuation token">.</block><block class=" token">pyspark</block><block class="punctuation token">.</block><block class=" token">ml</block><block class="punctuation token">.</block><block class=" token">autolog</block><block class="punctuation token">(</block><block class=" token">log_models</block><block class="operator token">=</block><block class="boolean token">False</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">num_evals </block><block class="operator token">=</block><block class=" token"> </block><block class="number token">4</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">trials </block><block class="operator token">=</block><block class=" token"> Trials</block><block class="punctuation token">(</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">best_hyperparam </block><block class="operator token">=</block><block class=" token"> fmin</block><block class="punctuation token">(</block><block class=" token">fn</block><block class="operator token">=</block><block class=" token">objective_function</block><block class="punctuation token">,</block><block class=" token"> </block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">                       space</block><block class="operator token">=</block><block class=" token">search_space</block><block class="punctuation token">,</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">                       algo</block><block class="operator token">=</block><block class=" token">tpe</block><block class="punctuation token">.</block><block class=" token">suggest</block><block class="punctuation token">,</block><block class=" token"> </block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">                       max_evals</block><block class="operator token">=</block><block class=" token">num_evals</block><block class="punctuation token">,</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">                       trials</block><block class="operator token">=</block><block class=" token">trials</block><block class="punctuation token">,</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">                       rstate</block><block class="operator token">=</block><block class=" token">np</block><block class="punctuation token">.</block><block class=" token">random</block><block class="punctuation token">.</block><block class=" token">default_rng</block><block class="punctuation token">(</block><block class="number token">42</block><block class="punctuation token">)</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Retrain model on train &amp; validation dataset and evaluate on test dataset</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">with</block><block class=" token"> mlflow</block><block class="punctuation token">.</block><block class=" token">start_run</block><block class="punctuation token">(</block><block class="punctuation token">)</block><block class="punctuation token">:</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    best_max_depth </block><block class="operator token">=</block><block class=" token"> best_hyperparam</block><block class="punctuation token">[</block><block class="string token">"max_depth"</block><block class="punctuation token">]</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    best_num_trees </block><block class="operator token">=</block><block class=" token"> best_hyperparam</block><block class="punctuation token">[</block><block class="string token">"num_trees"</block><block class="punctuation token">]</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    estimator </block><block class="operator token">=</block><block class=" token"> pipeline</block><block class="punctuation token">.</block><block class=" token">copy</block><block class="punctuation token">(</block><block class="punctuation token">{</block><block class=" token">rf</block><block class="punctuation token">.</block><block class=" token">maxDepth</block><block class="punctuation token">:</block><block class=" token"> best_max_depth</block><block class="punctuation token">,</block><block class=" token"> rf</block><block class="punctuation token">.</block><block class=" token">numTrees</block><block class="punctuation token">:</block><block class=" token"> best_num_trees</block><block class="punctuation token">}</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    combined_df </block><block class="operator token">=</block><block class=" token"> train_df</block><block class="punctuation token">.</block><block class=" token">union</block><block class="punctuation token">(</block><block class=" token">val_df</block><block class="punctuation token">)</block><block class=" token"> </block><block class="comment token"># Combine train &amp; validation together</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    pipeline_model </block><block class="operator token">=</block><block class=" token"> estimator</block><block class="punctuation token">.</block><block class=" token">fit</block><block class="punctuation token">(</block><block class=" token">combined_df</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    pred_df </block><block class="operator token">=</block><block class=" token"> pipeline_model</block><block class="punctuation token">.</block><block class=" token">transform</block><block class="punctuation token">(</block><block class=" token">test_df</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    rmse </block><block class="operator token">=</block><block class=" token"> regression_evaluator</block><block class="punctuation token">.</block><block class=" token">evaluate</block><block class="punctuation token">(</block><block class=" token">pred_df</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block><block class="comment token"># Log param and metrics for the final model</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    mlflow</block><block class="punctuation token">.</block><block class=" token">log_param</block><block class="punctuation token">(</block><block class="string token">"maxDepth"</block><block class="punctuation token">,</block><block class=" token"> best_max_depth</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    mlflow</block><block class="punctuation token">.</block><block class=" token">log_param</block><block class="punctuation token">(</block><block class="string token">"numTrees"</block><block class="punctuation token">,</block><block class=" token"> best_num_trees</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    mlflow</block><block class="punctuation token">.</block><block class=" token">log_metric</block><block class="punctuation token">(</block><block class="string token">"rmse"</block><block class="punctuation token">,</block><block class=" token"> rmse</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    mlflow</block><block class="punctuation token">.</block><block class=" token">spark</block><block class="punctuation token">.</block><block class=" token">log_model</block><block class="punctuation token">(</block><block class=" token">pipeline_model</block><block class="punctuation token">,</block><block class=" token"> </block><block class="string token">"model"</block><block class="punctuation token">)</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 702.387px; height: 376.63px; position: relative;"><img src="image-resources/b7c0cd49-d91e-4130-b810-cd2baa616694.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">[</block><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><compositeblock dir="ltr" class="anchor-tag-ref inline" style="font-family: &quot;Computer Modern Serif&quot;, serif;"><a href="#n0.3295185310066928" style="color: inherit; text-decoration: inherit;">Back To Top</a></compositeblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">]</block></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="inline" style="display: block;"><div style="vertical-align: baseline;"><div style="display: inline-block; height: 0px; border-bottom: 1px solid; width: 100%;"></div></div></compositeblock></blocks></line><line class="root text-mode section sindent-0" data-line-id="n0.8812980031176083" style="font-size: 1.2em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.8812980031176083" role="heading" aria-level="1"><prefix style="text-align: left; padding-right: 0.5em;">7. </prefix><blocks><baselineblock class="inline"></baselineblock><block>AutoML</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block class="role-hyper-link" data-hyper-link-url="https://docs.databricks.com/applications/machine-learning/automl.html" style="text-decoration: underline; font-weight: bold; color: rgb(17, 85, 204);"><a href="https://docs.databricks.com/applications/machine-learning/automl.html" target="_blank" style="color: inherit; text-decoration: inherit;">Databricks AutoML</a></block><block> helps you automatically build machine learning models both through a </block><block style="text-decoration: underline;">UI and programmatically</block><block>. </block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>It prepares the dataset for model training and then performs and records a set of trials (using </block><block style="font-weight: bold;">HyperOpt</block><block>), creating, tuning, and evaluating multiple models.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; background-color: rgb(255, 254, 0);">Note:</block><block> In practice, it's not recommended to use the AutoML model directly. It's recommended to consider it as a good baseline and develop on top of that. </block><block style="text-decoration: underline;">AutoML is a good tool to quickly get a baseline model up and running</block><block>.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 692.797px; height: 363.45px; position: relative;"><img src="image-resources/fa83f492-41b0-4475-867d-e38be8b2a766.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 696.192px; height: 365.62px; position: relative;"><img src="image-resources/aeadef47-de4d-493e-aa55-da68c5a94b30.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 692.794px; height: 385.73px; position: relative;"><img src="image-resources/80f52555-24e0-458b-9b6b-d4c894afcc01.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 696.389px; height: 370.6px; position: relative;"><img src="image-resources/cb0828e0-7ce7-4c19-9cf8-6f86593db50c.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Currently, AutoML uses a combination of:</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="font-weight: bold; flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold;">XGBoost</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="font-weight: bold; flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold;">LightGBM</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="font-weight: bold; flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold;">sklearn (only single node models)</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>It </block><block style="text-decoration: underline;">optimizes the hyperparameters</block><block> within each.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">[</block><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><compositeblock dir="ltr" class="anchor-tag-ref inline" style="font-family: &quot;Computer Modern Serif&quot;, serif;"><a href="#n0.3295185310066928" style="color: inherit; text-decoration: inherit;">Back To Top</a></compositeblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">]</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode section sindent-1" data-line-id="n0.8258081530904544" style="font-size: 1.1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.8258081530904544" role="heading" aria-level="2"><prefix style="text-align: left; padding-right: 0.25em;">7.1. </prefix><blocks><baselineblock class="inline"></baselineblock><block>Implementation</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Let's use AutoML to search for the optimal regression model.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="font-weight: bold; flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold;">Required parameters:</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(79, 167, 176); background-color: rgba(155, 155, 155, 0.2);">dataset</block><block>  Input Spark or pandas DataFrame that contains training features and targets. If using a Spark DataFrame, it will convert it to a Pandas DataFrame under the hood by calling </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">.toPandas()</block><block> - just be careful you don't OOM!</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(79, 167, 176); background-color: rgba(155, 155, 155, 0.2);">target_col</block><block>  Column name of the target labels.</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>We will also specify these </block><block style="font-weight: bold;">optional parameters</block><block>:</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(79, 167, 176); background-color: rgba(155, 155, 155, 0.2);">primary_metric</block><block>  Primary metric to select the best model. Each trial will compute several metrics, but this one determines which model is selected from all the trials. One of r2 (default, R squared), mse (mean squared error), rmse (root mean squared error), mae (mean absolute error) for regression problems.</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(79, 167, 176); background-color: rgba(155, 155, 155, 0.2);">timeout_minutes</block><block>  The maximum time to wait for the AutoML trials to complete. </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">timeout_minutes=None</block><block> will run the trials without any timeout restrictions.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">file_path </block><block class="operator token">=</block><block class=" token"> </block><block class="string-interpolation string token">f"</block><block class="string-interpolation interpolation punctuation token">{</block><block class="string-interpolation interpolation token">DA</block><block class="string-interpolation interpolation punctuation token">.</block><block class="string-interpolation interpolation token">paths</block><block class="string-interpolation interpolation punctuation token">.</block><block class="string-interpolation interpolation token">datasets</block><block class="string-interpolation interpolation punctuation token">}</block><block class="string-interpolation string token">/airbnb/sf-listings/sf-listings-2019-03-06-clean.delta/"</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">airbnb_df </block><block class="operator token">=</block><block class=" token"> spark</block><block class="punctuation token">.</block><block class=" token">read</block><block class="punctuation token">.</block><block class="builtin token">format</block><block class="punctuation token">(</block><block class="string token">"delta"</block><block class="punctuation token">)</block><block class="punctuation token">.</block><block class=" token">load</block><block class="punctuation token">(</block><block class=" token">file_path</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">train_df</block><block class="punctuation token">,</block><block class=" token"> test_df </block><block class="operator token">=</block><block class=" token"> airbnb_df</block><block class="punctuation token">.</block><block class=" token">randomSplit</block><block class="punctuation token">(</block><block class="punctuation token">[</block><block class="number token">.8</block><block class="punctuation token">,</block><block class=" token"> </block><block class="number token">.2</block><block class="punctuation token">]</block><block class="punctuation token">,</block><block class=" token"> seed</block><block class="operator token">=</block><block class="number token">42</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> databricks </block><block class="keyword token">import</block><block class=" token"> automl</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">summary </block><block class="operator token">=</block><block class=" token"> automl</block><block class="punctuation token">.</block><block class=" token">regress</block><block class="punctuation token">(</block><block class=" token">train_df</block><block class="punctuation token">,</block><block class=" token"> target_col</block><block class="operator token">=</block><block class="string token">"price"</block><block class="punctuation token">,</block><block class=" token"> primary_metric</block><block class="operator token">=</block><block class="string token">"rmse"</block><block class="punctuation token">,</block><block class=" token"> timeout_minutes</block><block class="operator token">=</block><block class="number token">5</block><block class="punctuation token">,</block><block class=" token"> max_trials</block><block class="operator token">=</block><block class="number token">10</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">print</block><block class="punctuation token">(</block><block class=" token">summary</block><block class="punctuation token">.</block><block class=" token">best_trial</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Model: Pipeline</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Model path: dbfs:/databricks/mlflow-tracking/1402038781911810/4cc3841647fa480b82681cfcfdfaaab3/artifacts/model</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Preprocessors: [('boolean', Pipeline(steps=[('cast_type',</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token">#          FunctionTransformer(func=&lt;function &lt;lambda&gt; at 0x7fd4c044ea60&gt;)),</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token">#         ('imputers',</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token">#          ColumnTransformer(remainder='passthrough', transformers=[])),</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token">#         ('onehot',</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token">#          OneHotEncoder(drop='first', handle_unknown='ignore'))]), ['review_scores_checkin_na', 'review_scores_accuracy_na', 'review_scores_value_na', 'review_scores_rating_na', 'review_scores_cleanliness_na', 'bathrooms_na', 'be...</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Training duration: 0.323 minutes</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Evaluation metric score: 323.241</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Evaluation metric: root mean squared error (tracked as val_root_mean_squared_error)</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>After running the code above, two notebooks and an MLflow experiment will be created:</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(79, 167, 176); background-color: rgba(155, 155, 155, 0.2);">Data exploration notebook</block><block>  we can see a </block><block style="font-weight: bold;">Profiling Report</block><block> which organizes the input columns and discusses values, frequency and other information</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(79, 167, 176); background-color: rgba(155, 155, 155, 0.2);">Best trial notebook</block><block>  shows the source code for reproducing the </block><block style="text-decoration: underline;">best trial</block><block> conducted by AutoML.</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(79, 167, 176); background-color: rgba(155, 155, 155, 0.2);">MLflow experiment</block><block>  contains </block><block style="text-decoration: underline;">high level information</block><block>, such as the root artifact location, experiment ID, and experiment tags. The list of trials contains detailed summaries of each trial, such as the notebook and model location, training parameters, and overall metrics.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 725.595px; height: 425.5px; position: relative;"><img src="image-resources/372affb0-8207-4e40-b8eb-e9c7abfdb0d1.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode section sindent-2" data-line-id="n0.49806182713381264" style="font-size: 1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.49806182713381264" role="heading" aria-level="3"><prefix style="text-align: left; padding-right: 0em;">7.1.1. </prefix><blocks><baselineblock class="inline"></baselineblock><block>Use the Best Model for Inference</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Now we can test the model that we got from AutoML against our test data. </block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>We'll be using </block><block class="role-hyper-link" data-hyper-link-url="https://mlflow.org/docs/latest/python_api/mlflow.pyfunc.html#mlflow.pyfunc.spark_udf" style="text-decoration: underline; color: rgb(17, 85, 204);"><a href="https://mlflow.org/docs/latest/python_api/mlflow.pyfunc.html#mlflow.pyfunc.spark_udf" target="_blank" style="color: inherit; text-decoration: inherit;">mlflow.pyfunc.spark_udf</a></block><block> to register our model as a UDF and apply it in parallel to our test data.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Load the best trial as an MLflow Model</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">import</block><block class=" token"> mlflow</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">model_uri </block><block class="operator token">=</block><block class=" token"> </block><block class="string-interpolation string token">f"runs:/</block><block class="string-interpolation interpolation punctuation token">{</block><block class="string-interpolation interpolation token">summary</block><block class="string-interpolation interpolation punctuation token">.</block><block class="string-interpolation interpolation token">best_trial</block><block class="string-interpolation interpolation punctuation token">.</block><block class="string-interpolation interpolation token">mlflow_run_id</block><block class="string-interpolation interpolation punctuation token">}</block><block class="string-interpolation string token">/model"</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">predict </block><block class="operator token">=</block><block class=" token"> mlflow</block><block class="punctuation token">.</block><block class=" token">pyfunc</block><block class="punctuation token">.</block><block class=" token">spark_udf</block><block class="punctuation token">(</block><block class=" token">spark</block><block class="punctuation token">,</block><block class=" token"> model_uri</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">pred_df </block><block class="operator token">=</block><block class=" token"> test_df</block><block class="punctuation token">.</block><block class=" token">withColumn</block><block class="punctuation token">(</block><block class="string token">"prediction"</block><block class="punctuation token">,</block><block class=" token"> predict</block><block class="punctuation token">(</block><block class="operator token">*</block><block class=" token">test_df</block><block class="punctuation token">.</block><block class=" token">drop</block><block class="punctuation token">(</block><block class="string token">"price"</block><block class="punctuation token">)</block><block class="punctuation token">.</block><block class=" token">columns</block><block class="punctuation token">)</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">display</block><block class="punctuation token">(</block><block class=" token">pred_df</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> pyspark</block><block class="punctuation token">.</block><block class=" token">ml</block><block class="punctuation token">.</block><block class=" token">evaluation </block><block class="keyword token">import</block><block class=" token"> RegressionEvaluator</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">regression_evaluator </block><block class="operator token">=</block><block class=" token"> RegressionEvaluator</block><block class="punctuation token">(</block><block class=" token">predictionCol</block><block class="operator token">=</block><block class="string token">"prediction"</block><block class="punctuation token">,</block><block class=" token"> labelCol</block><block class="operator token">=</block><block class="string token">"price"</block><block class="punctuation token">,</block><block class=" token"> metricName</block><block class="operator token">=</block><block class="string token">"rmse"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">rmse </block><block class="operator token">=</block><block class=" token"> regression_evaluator</block><block class="punctuation token">.</block><block class=" token">evaluate</block><block class="punctuation token">(</block><block class=" token">pred_df</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">print</block><block class="punctuation token">(</block><block class="string-interpolation string token">f"RMSE on test dataset: </block><block class="string-interpolation interpolation punctuation token">{</block><block class="string-interpolation interpolation token">rmse</block><block class="string-interpolation interpolation punctuation token">:</block><block class="string-interpolation interpolation format-spec token">.3f</block><block class="string-interpolation interpolation punctuation token">}</block><block class="string-interpolation string token">"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># RMSE on test dataset: 120.458</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">[</block><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><compositeblock dir="ltr" class="anchor-tag-ref inline" style="font-family: &quot;Computer Modern Serif&quot;, serif;"><a href="#n0.3295185310066928" style="color: inherit; text-decoration: inherit;">Back To Top</a></compositeblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">]</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode section sindent-1" data-line-id="n0.16392541670988847" style="font-size: 1.1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.16392541670988847" role="heading" aria-level="2"><prefix style="text-align: left; padding-right: 0.25em;">7.2. </prefix><blocks><baselineblock class="inline"></baselineblock><block>AutoML UI</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Navigate to the sidebar on the workspace homepage.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Click on the </block><block style="font-weight: bold;">Experiments</block><block> tab.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Click on </block><block style="font-weight: bold;">Create AutoML Experiment</block><block> button on the top-right corner.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Configure the AutoML experiment.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 742.192px; height: 408.58px; position: relative;"><img src="image-resources/a95a462c-748f-4229-9743-41452f8a6c9d.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">[</block><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><compositeblock dir="ltr" class="anchor-tag-ref inline" style="font-family: &quot;Computer Modern Serif&quot;, serif;"><a href="#n0.3295185310066928" style="color: inherit; text-decoration: inherit;">Back To Top</a></compositeblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">]</block></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="inline" style="display: block;"><div style="vertical-align: baseline;"><div style="display: inline-block; height: 0px; border-bottom: 1px solid; width: 100%;"></div></div></compositeblock></blocks></line><line class="root text-mode section sindent-0" data-line-id="n0.6174527870243469" style="font-size: 1.2em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.6174527870243469" role="heading" aria-level="1"><prefix style="text-align: left; padding-right: 0.5em;">8. </prefix><blocks><baselineblock class="inline"></baselineblock><block>Feature Store</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>The </block><block class="role-hyper-link" data-hyper-link-url="https://docs.databricks.com/applications/machine-learning/feature-store.html" style="text-decoration: underline; color: rgb(17, 85, 204);"><a href="https://docs.databricks.com/applications/machine-learning/feature-store.html" target="_blank" style="color: inherit; text-decoration: inherit;">Databricks Feature Store</a></block><block> is a </block><block style="background-color: rgb(255, 254, 0);">centralized repository of features</block><block>. </block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>It enables </block><block style="text-decoration: underline;">feature sharing and discovery</block><block> across your organization and also ensures that the same feature computation code is used for model training and inference.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Check out Feature Store Python API documentation </block><block class="role-hyper-link" data-hyper-link-url="https://docs.databricks.com/dev-tools/api/python/latest/index.html#feature-store-python-api-reference" style="text-decoration: underline; color: rgb(17, 85, 204);"><a href="https://docs.databricks.com/dev-tools/api/python/latest/index.html#feature-store-python-api-reference" target="_blank" style="color: inherit; text-decoration: inherit;">here</a></block><block>.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 731.595px; height: 457.57px; position: relative;"><img src="image-resources/6c811e62-3017-4772-a5fa-ebbc431345c0.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>We first need to create </block><block class="role-hyper-link" data-hyper-link-url="https://docs.databricks.com/applications/machine-learning/feature-store.html#create-a-feature-table-in-databricks-feature-store" style="text-decoration: underline; font-weight: bold; color: rgb(17, 85, 204);"><a href="https://docs.databricks.com/applications/machine-learning/feature-store.html#create-a-feature-table-in-databricks-feature-store" target="_blank" style="color: inherit; text-decoration: inherit;">Feature Store Client</a></block><block> so we can populate our feature store.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> pyspark</block><block class="punctuation token">.</block><block class=" token">sql</block><block class="punctuation token">.</block><block class=" token">functions </block><block class="keyword token">import</block><block class=" token"> monotonically_increasing_id</block><block class="punctuation token">,</block><block class=" token"> lit</block><block class="punctuation token">,</block><block class=" token"> expr</block><block class="punctuation token">,</block><block class=" token"> rand</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> databricks </block><block class="keyword token">import</block><block class=" token"> feature_store</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> pyspark</block><block class="punctuation token">.</block><block class=" token">sql</block><block class="punctuation token">.</block><block class=" token">types </block><block class="keyword token">import</block><block class=" token"> StringType</block><block class="punctuation token">,</block><block class=" token"> DoubleType</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> databricks</block><block class="punctuation token">.</block><block class=" token">feature_store </block><block class="keyword token">import</block><block class=" token"> feature_table</block><block class="punctuation token">,</block><block class=" token"> FeatureLookup</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">import</block><block class=" token"> mlflow</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">import</block><block class=" token"> mlflow</block><block class="punctuation token">.</block><block class=" token">sklearn</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> mlflow</block><block class="punctuation token">.</block><block class=" token">models</block><block class="punctuation token">.</block><block class=" token">signature </block><block class="keyword token">import</block><block class=" token"> infer_signature</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> sklearn</block><block class="punctuation token">.</block><block class=" token">model_selection </block><block class="keyword token">import</block><block class=" token"> train_test_split</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> sklearn</block><block class="punctuation token">.</block><block class=" token">ensemble </block><block class="keyword token">import</block><block class=" token"> RandomForestRegressor</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> sklearn</block><block class="punctuation token">.</block><block class=" token">metrics </block><block class="keyword token">import</block><block class=" token"> mean_squared_error</block><block class="punctuation token">,</block><block class=" token"> r2_score</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">file_path </block><block class="operator token">=</block><block class=" token"> </block><block class="string-interpolation string token">f"</block><block class="string-interpolation interpolation punctuation token">{</block><block class="string-interpolation interpolation token">DA</block><block class="string-interpolation interpolation punctuation token">.</block><block class="string-interpolation interpolation token">paths</block><block class="string-interpolation interpolation punctuation token">.</block><block class="string-interpolation interpolation token">datasets</block><block class="string-interpolation interpolation punctuation token">}</block><block class="string-interpolation string token">/airbnb/sf-listings/sf-listings-2019-03-06-clean.delta/"</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">airbnb_df </block><block class="operator token">=</block><block class=" token"> spark</block><block class="punctuation token">.</block><block class=" token">read</block><block class="punctuation token">.</block><block class="builtin token">format</block><block class="punctuation token">(</block><block class="string token">"delta"</block><block class="punctuation token">)</block><block class="punctuation token">.</block><block class=" token">load</block><block class="punctuation token">(</block><block class=" token">file_path</block><block class="punctuation token">)</block><block class="punctuation token">.</block><block class=" token">coalesce</block><block class="punctuation token">(</block><block class="number token">1</block><block class="punctuation token">)</block><block class="punctuation token">.</block><block class=" token">withColumn</block><block class="punctuation token">(</block><block class="string token">"index"</block><block class="punctuation token">,</block><block class=" token"> monotonically_increasing_id</block><block class="punctuation token">(</block><block class="punctuation token">)</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Create a new database and unique table name (in case you re-run the notebook multiple times)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">spark</block><block class="punctuation token">.</block><block class=" token">sql</block><block class="punctuation token">(</block><block class="string-interpolation string token">f"CREATE DATABASE IF NOT EXISTS </block><block class="string-interpolation interpolation punctuation token">{</block><block class="string-interpolation interpolation token">DA</block><block class="string-interpolation interpolation punctuation token">.</block><block class="string-interpolation interpolation token">schema_name</block><block class="string-interpolation interpolation punctuation token">}</block><block class="string-interpolation string token">"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">table_name </block><block class="operator token">=</block><block class=" token"> </block><block class="string-interpolation string token">f"</block><block class="string-interpolation interpolation punctuation token">{</block><block class="string-interpolation interpolation token">DA</block><block class="string-interpolation interpolation punctuation token">.</block><block class="string-interpolation interpolation token">schema_name</block><block class="string-interpolation interpolation punctuation token">}</block><block class="string-interpolation string token">.airbnb"</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">[</block><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><compositeblock dir="ltr" class="anchor-tag-ref inline" style="font-family: &quot;Computer Modern Serif&quot;, serif;"><a href="#n0.3295185310066928" style="color: inherit; text-decoration: inherit;">Back To Top</a></compositeblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">]</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode section sindent-1" data-line-id="n0.1595811249540351" style="font-size: 1.1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.1595811249540351" role="heading" aria-level="2"><prefix style="text-align: left; padding-right: 0.25em;">8.1. </prefix><blocks><baselineblock class="inline"></baselineblock><block>Create a Feature Table</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Next, we can create the Feature Table using the </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(79, 167, 176); background-color: rgba(155, 155, 155, 0.2);">create_table</block><block> method.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>This method takes a few parameters as inputs:</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(79, 167, 176); background-color: rgba(155, 155, 155, 0.2);">name</block><block>  A feature table name of the form </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">&lt;database_name&gt;.&lt;table_name&gt;</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(79, 167, 176); background-color: rgba(155, 155, 155, 0.2);">primary_keys</block><block>  The primary key(s). If multiple columns are required, specify a list of column names.</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(79, 167, 176); background-color: rgba(155, 155, 155, 0.2);">df</block><block>  Data to insert into this feature table. The schema of </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">features_df</block><block> will be used as the feature table schema.</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(79, 167, 176); background-color: rgba(155, 155, 155, 0.2);">schema</block><block>  Feature table schema. Note that either </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">schema</block><block> or </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">features_df</block><block> must be provided.</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(79, 167, 176); background-color: rgba(155, 155, 155, 0.2);">description</block><block>  Description of the feature table</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(79, 167, 176); background-color: rgba(155, 155, 155, 0.2);">partition_columns</block><block>  Column(s) used to partition the feature table.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token">## select numeric features and exclude target column "price"</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">numeric_cols </block><block class="operator token">=</block><block class=" token"> </block><block class="punctuation token">[</block><block class=" token">x</block><block class="punctuation token">.</block><block class=" token">name </block><block class="keyword token">for</block><block class=" token"> x </block><block class="keyword token">in</block><block class=" token"> airbnb_df</block><block class="punctuation token">.</block><block class=" token">schema</block><block class="punctuation token">.</block><block class=" token">fields </block><block class="keyword token">if</block><block class=" token"> </block><block class="punctuation token">(</block><block class=" token">x</block><block class="punctuation token">.</block><block class=" token">dataType </block><block class="operator token">==</block><block class=" token"> DoubleType</block><block class="punctuation token">(</block><block class="punctuation token">)</block><block class="punctuation token">)</block><block class=" token"> </block><block class="keyword token">and</block><block class=" token"> </block><block class="punctuation token">(</block><block class=" token">x</block><block class="punctuation token">.</block><block class=" token">name </block><block class="operator token">!=</block><block class=" token"> </block><block class="string token">"price"</block><block class="punctuation token">)</block><block class="punctuation token">]</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">numeric_features_df </block><block class="operator token">=</block><block class=" token"> airbnb_df</block><block class="punctuation token">.</block><block class=" token">select</block><block class="punctuation token">(</block><block class="punctuation token">[</block><block class="string token">"index"</block><block class="punctuation token">]</block><block class=" token"> </block><block class="operator token">+</block><block class=" token"> numeric_cols</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">fs</block><block class="punctuation token">.</block><block class=" token">create_table</block><block class="punctuation token">(</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    name</block><block class="operator token">=</block><block class=" token">table_name</block><block class="punctuation token">,</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    primary_keys</block><block class="operator token">=</block><block class="punctuation token">[</block><block class="string token">"index"</block><block class="punctuation token">]</block><block class="punctuation token">,</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    df</block><block class="operator token">=</block><block class=" token">numeric_features_df</block><block class="punctuation token">,</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    schema</block><block class="operator token">=</block><block class=" token">numeric_features_df</block><block class="punctuation token">.</block><block class=" token">schema</block><block class="punctuation token">,</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    description</block><block class="operator token">=</block><block class="string token">"Numeric features of airbnb data"</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># 2023/12/07 15:42:53 INFO databricks.feature_store._compute_client._compute_client: Created feature table 'hive_metastore.class_023_5lht_da_sml.airbnb'.</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># /databricks/python/lib/python3.9/site-packages/databricks/feature_store/entities/_feature_store_object.py:8: FutureWarning: ``databricks.feature_store.entities.feature_table.FeatureTable.keys`` is deprecated since v0.3.6. This method will be removed in a future release. Use ``FeatureTable.primary_keys`` instead.</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token">#   yield prop, self.__getattribute__(prop)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Out[10]: &lt;FeatureTable: keys=['index'], tags={}&gt;</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Alternatively, you can </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(79, 167, 176); background-color: rgba(155, 155, 155, 0.2);">create_table</block><block> with schema only (without </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(79, 167, 176); background-color: rgba(155, 155, 155, 0.2);">df</block><block>), and populate data to the feature table with </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(79, 167, 176); background-color: rgba(155, 155, 155, 0.2);">fs.write_table</block><block>. </block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(79, 167, 176); background-color: rgba(155, 155, 155, 0.2);">fs.write_table</block><block> supports both overwrite and merge modes.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">fs</block><block class="punctuation token">.</block><block class=" token">create_table</block><block class="punctuation token">(</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    name</block><block class="operator token">=</block><block class=" token">table_name</block><block class="punctuation token">,</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    primary_keys</block><block class="operator token">=</block><block class="punctuation token">[</block><block class="string token">"index"</block><block class="punctuation token">]</block><block class="punctuation token">,</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    schema</block><block class="operator token">=</block><block class=" token">numeric_features_df</block><block class="punctuation token">.</block><block class=" token">schema</block><block class="punctuation token">,</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    description</block><block class="operator token">=</block><block class="string token">"Original Airbnb data"</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">fs</block><block class="punctuation token">.</block><block class=" token">write_table</block><block class="punctuation token">(</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    name</block><block class="operator token">=</block><block class=" token">table_name</block><block class="punctuation token">,</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    df</block><block class="operator token">=</block><block class=" token">numeric_features_df</block><block class="punctuation token">,</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    mode</block><block class="operator token">=</block><block class="string token">"overwrite"</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="punctuation token">)</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>We can also look at the metadata of the feature store via the FeatureStore client by using </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(79, 167, 176); background-color: rgba(155, 155, 155, 0.2);">get_table()</block><block>.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">fs</block><block class="punctuation token">.</block><block class=" token">get_table</block><block class="punctuation token">(</block><block class=" token">table_name</block><block class="punctuation token">)</block><block class="punctuation token">.</block><block class=" token">path_data_sources</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># ['dbfs:/mnt/dbacademy-datasets/scalable-machine-learning-with-apache-spark/v02/airbnb/sf-listings/sf-listings-2019-03-06-clean.delta']</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">fs</block><block class="punctuation token">.</block><block class=" token">get_table</block><block class="punctuation token">(</block><block class=" token">table_name</block><block class="punctuation token">)</block><block class="punctuation token">.</block><block class=" token">description</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># 'Numeric features of airbnb data'</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">[</block><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><compositeblock dir="ltr" class="anchor-tag-ref inline" style="font-family: &quot;Computer Modern Serif&quot;, serif;"><a href="#n0.3295185310066928" style="color: inherit; text-decoration: inherit;">Back To Top</a></compositeblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">]</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode section sindent-1" data-line-id="n0.7469505054988943" style="font-size: 1.1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.7469505054988943" role="heading" aria-level="2"><prefix style="text-align: left; padding-right: 0.25em;">8.2. </prefix><blocks><baselineblock class="inline"></baselineblock><block>Feature Table UI</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 261.6px; height: 224.48px; position: relative;"><img src="image-resources/bb59dc16-0d82-4a4c-b98c-92d49ef5e54b.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 687.991px; height: 366.1px; position: relative;"><img src="image-resources/053a68cd-1bbb-4743-8c2b-3f527ba49865.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">[</block><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><compositeblock dir="ltr" class="anchor-tag-ref inline" style="font-family: &quot;Computer Modern Serif&quot;, serif;"><a href="#n0.3295185310066928" style="color: inherit; text-decoration: inherit;">Back To Top</a></compositeblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">]</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode section sindent-1" data-line-id="n0.9482869717199411" style="font-size: 1.1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.9482869717199411" role="heading" aria-level="2"><prefix style="text-align: left; padding-right: 0.25em;">8.3. </prefix><blocks><baselineblock class="inline"></baselineblock><block>Train a Model with Feature Store</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>The prediction target </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">price</block><block> </block><block style="background-color: rgb(255, 254, 0);">should NOT BE included as a feature in the registered feature table</block><block>.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Further, there may be other information that can be supplied at inference time, but does not make sense to consider a feature to look up.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>In this (fictional) example, we made up a feature </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">score_diff_from_last_month</block><block>. </block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>It is a feature generated at inference time and used in training as well.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Below, we're building a training dataset that will use the indicated "key" to lookup features from the feature table and also the online </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">feature score_diff_from_last_month</block><block>. </block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>We will use </block><block class="role-hyper-link" data-hyper-link-url="https://docs.databricks.com/dev-tools/api/python/latest/index.html" style="text-decoration: underline; color: rgb(17, 85, 204);"><a href="https://docs.databricks.com/dev-tools/api/python/latest/index.html" target="_blank" style="color: inherit; text-decoration: inherit;">FeatureLookup</a></block><block> and if you specify no features, it will return all of them except the primary key.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token">## inference data -- index (key), price (target) and a online feature (make up a fictional column - diff of review score in a month) </block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">inference_data_df </block><block class="operator token">=</block><block class=" token"> airbnb_df</block><block class="punctuation token">.</block><block class=" token">select</block><block class="punctuation token">(</block><block class="string token">"index"</block><block class="punctuation token">,</block><block class=" token"> </block><block class="string token">"price"</block><block class="punctuation token">,</block><block class=" token"> </block><block class="punctuation token">(</block><block class=" token">rand</block><block class="punctuation token">(</block><block class="punctuation token">)</block><block class=" token"> </block><block class="operator token">*</block><block class=" token"> </block><block class="number token">0.5</block><block class="operator token">-</block><block class="number token">0.25</block><block class="punctuation token">)</block><block class="punctuation token">.</block><block class=" token">alias</block><block class="punctuation token">(</block><block class="string token">"score_diff_from_last_month"</block><block class="punctuation token">)</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">def</block><block class=" token"> </block><block class="function token">load_data</block><block class="punctuation token">(</block><block class=" token">table_name</block><block class="punctuation token">,</block><block class=" token"> lookup_key</block><block class="punctuation token">)</block><block class="punctuation token">:</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    model_feature_lookups </block><block class="operator token">=</block><block class=" token"> </block><block class="punctuation token">[</block><block class=" token">FeatureLookup</block><block class="punctuation token">(</block><block class=" token">table_name</block><block class="operator token">=</block><block class=" token">table_name</block><block class="punctuation token">,</block><block class=" token"> lookup_key</block><block class="operator token">=</block><block class=" token">lookup_key</block><block class="punctuation token">)</block><block class="punctuation token">]</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block><block class="comment token"># fs.create_training_set will look up features in model_feature_lookups with matched key from inference_data_df</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    training_set </block><block class="operator token">=</block><block class=" token"> fs</block><block class="punctuation token">.</block><block class=" token">create_training_set</block><block class="punctuation token">(</block><block class=" token">inference_data_df</block><block class="punctuation token">,</block><block class=" token"> model_feature_lookups</block><block class="punctuation token">,</block><block class=" token"> label</block><block class="operator token">=</block><block class="string token">"price"</block><block class="punctuation token">,</block><block class=" token"> exclude_columns</block><block class="operator token">=</block><block class="string token">"index"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    training_pd </block><block class="operator token">=</block><block class=" token"> training_set</block><block class="punctuation token">.</block><block class=" token">load_df</block><block class="punctuation token">(</block><block class="punctuation token">)</block><block class="punctuation token">.</block><block class=" token">toPandas</block><block class="punctuation token">(</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block><block class="comment token"># Create train and test datasets</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    X </block><block class="operator token">=</block><block class=" token"> training_pd</block><block class="punctuation token">.</block><block class=" token">drop</block><block class="punctuation token">(</block><block class="string token">"price"</block><block class="punctuation token">,</block><block class=" token"> axis</block><block class="operator token">=</block><block class="number token">1</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    y </block><block class="operator token">=</block><block class=" token"> training_pd</block><block class="punctuation token">[</block><block class="string token">"price"</block><block class="punctuation token">]</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    X_train</block><block class="punctuation token">,</block><block class=" token"> X_test</block><block class="punctuation token">,</block><block class=" token"> y_train</block><block class="punctuation token">,</block><block class=" token"> y_test </block><block class="operator token">=</block><block class=" token"> train_test_split</block><block class="punctuation token">(</block><block class=" token">X</block><block class="punctuation token">,</block><block class=" token"> y</block><block class="punctuation token">,</block><block class=" token"> test_size</block><block class="operator token">=</block><block class="number token">0.2</block><block class="punctuation token">,</block><block class=" token"> random_state</block><block class="operator token">=</block><block class="number token">42</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block><block class="keyword token">return</block><block class=" token"> X_train</block><block class="punctuation token">,</block><block class=" token"> X_test</block><block class="punctuation token">,</block><block class=" token"> y_train</block><block class="punctuation token">,</block><block class=" token"> y_test</block><block class="punctuation token">,</block><block class=" token"> training_set</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">X_train</block><block class="punctuation token">,</block><block class=" token"> X_test</block><block class="punctuation token">,</block><block class=" token"> y_train</block><block class="punctuation token">,</block><block class=" token"> y_test</block><block class="punctuation token">,</block><block class=" token"> training_set </block><block class="operator token">=</block><block class=" token"> load_data</block><block class="punctuation token">(</block><block class=" token">table_name</block><block class="punctuation token">,</block><block class=" token"> </block><block class="string token">"index"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">X_train</block><block class="punctuation token">.</block><block class=" token">head</block><block class="punctuation token">(</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> mlflow</block><block class="punctuation token">.</block><block class=" token">tracking</block><block class="punctuation token">.</block><block class=" token">client </block><block class="keyword token">import</block><block class=" token"> MlflowClient</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">client </block><block class="operator token">=</block><block class=" token"> MlflowClient</block><block class="punctuation token">(</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">suffix </block><block class="operator token">=</block><block class=" token"> DA</block><block class="punctuation token">.</block><block class=" token">unique_name</block><block class="punctuation token">(</block><block class="string token">"-"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">model_name </block><block class="operator token">=</block><block class=" token"> </block><block class="string-interpolation string token">f"feature-store-airbnb_</block><block class="string-interpolation interpolation punctuation token">{</block><block class="string-interpolation interpolation token">suffix</block><block class="string-interpolation interpolation punctuation token">}</block><block class="string-interpolation string token">"</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">print</block><block class="punctuation token">(</block><block class="string-interpolation string token">f"Model Name: </block><block class="string-interpolation interpolation punctuation token">{</block><block class="string-interpolation interpolation token">model_name</block><block class="string-interpolation interpolation punctuation token">}</block><block class="string-interpolation string token">"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">try</block><block class="punctuation token">:</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block><block class="comment token"># Deleting model if already created</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    client</block><block class="punctuation token">.</block><block class=" token">delete_registered_model</block><block class="punctuation token">(</block><block class=" token">model_name</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">except</block><block class="punctuation token">:</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block><block class="boolean token">None</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Disable model autologging and instead log explicitly via the FeatureStore</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">mlflow</block><block class="punctuation token">.</block><block class=" token">sklearn</block><block class="punctuation token">.</block><block class=" token">autolog</block><block class="punctuation token">(</block><block class=" token">log_models</block><block class="operator token">=</block><block class="boolean token">False</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">def</block><block class=" token"> </block><block class="function token">train_model</block><block class="punctuation token">(</block><block class=" token">X_train</block><block class="punctuation token">,</block><block class=" token"> X_test</block><block class="punctuation token">,</block><block class=" token"> y_train</block><block class="punctuation token">,</block><block class=" token"> y_test</block><block class="punctuation token">,</block><block class=" token"> training_set</block><block class="punctuation token">,</block><block class=" token"> fs</block><block class="punctuation token">)</block><block class="punctuation token">:</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block><block class="comment token">## fit and log model</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block><block class="keyword token">with</block><block class=" token"> mlflow</block><block class="punctuation token">.</block><block class=" token">start_run</block><block class="punctuation token">(</block><block class="punctuation token">)</block><block class=" token"> </block><block class="keyword token">as</block><block class=" token"> run</block><block class="punctuation token">:</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">        rf </block><block class="operator token">=</block><block class=" token"> RandomForestRegressor</block><block class="punctuation token">(</block><block class=" token">max_depth</block><block class="operator token">=</block><block class="number token">3</block><block class="punctuation token">,</block><block class=" token"> n_estimators</block><block class="operator token">=</block><block class="number token">20</block><block class="punctuation token">,</block><block class=" token"> random_state</block><block class="operator token">=</block><block class="number token">42</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">        rf</block><block class="punctuation token">.</block><block class=" token">fit</block><block class="punctuation token">(</block><block class=" token">X_train</block><block class="punctuation token">,</block><block class=" token"> y_train</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">        y_pred </block><block class="operator token">=</block><block class=" token"> rf</block><block class="punctuation token">.</block><block class=" token">predict</block><block class="punctuation token">(</block><block class=" token">X_test</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">        mlflow</block><block class="punctuation token">.</block><block class=" token">log_metric</block><block class="punctuation token">(</block><block class="string token">"test_mse"</block><block class="punctuation token">,</block><block class=" token"> mean_squared_error</block><block class="punctuation token">(</block><block class=" token">y_test</block><block class="punctuation token">,</block><block class=" token"> y_pred</block><block class="punctuation token">)</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">        mlflow</block><block class="punctuation token">.</block><block class=" token">log_metric</block><block class="punctuation token">(</block><block class="string token">"test_r2_score"</block><block class="punctuation token">,</block><block class=" token"> r2_score</block><block class="punctuation token">(</block><block class=" token">y_test</block><block class="punctuation token">,</block><block class=" token"> y_pred</block><block class="punctuation token">)</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">        </block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">        fs</block><block class="punctuation token">.</block><block class=" token">log_model</block><block class="punctuation token">(</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">            model</block><block class="operator token">=</block><block class=" token">rf</block><block class="punctuation token">,</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">            artifact_path</block><block class="operator token">=</block><block class="string token">"feature-store-model"</block><block class="punctuation token">,</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">            flavor</block><block class="operator token">=</block><block class=" token">mlflow</block><block class="punctuation token">.</block><block class=" token">sklearn</block><block class="punctuation token">,</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">            training_set</block><block class="operator token">=</block><block class=" token">training_set</block><block class="punctuation token">,</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">            registered_model_name</block><block class="operator token">=</block><block class=" token">model_name</block><block class="punctuation token">,</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">            input_example</block><block class="operator token">=</block><block class=" token">X_train</block><block class="punctuation token">[</block><block class="punctuation token">:</block><block class="number token">5</block><block class="punctuation token">]</block><block class="punctuation token">,</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">            signature</block><block class="operator token">=</block><block class=" token">infer_signature</block><block class="punctuation token">(</block><block class=" token">X_train</block><block class="punctuation token">,</block><block class=" token"> y_train</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">        </block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">train_model</block><block class="punctuation token">(</block><block class=" token">X_train</block><block class="punctuation token">,</block><block class=" token"> X_test</block><block class="punctuation token">,</block><block class=" token"> y_train</block><block class="punctuation token">,</block><block class=" token"> y_test</block><block class="punctuation token">,</block><block class=" token"> training_set</block><block class="punctuation token">,</block><block class=" token"> fs</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># /databricks/python/lib/python3.9/site-packages/_distutils_hack/__init__.py:30: UserWarning: Setuptools is replacing distutils.</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token">#   warnings.warn("Setuptools is replacing distutils.")</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Successfully registered model 'feature-store-airbnb_class-023-5lht-da-sml'.</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># 2023/12/07 15:43:07 INFO mlflow.tracking._model_registry.client: Waiting up to 300 seconds for model version to finish creation.                     Model name: feature-store-airbnb_class-023-5lht-da-sml, version 1</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Created version '1' of model 'feature-store-airbnb_class-023-5lht-da-sml'.</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>View the model and Feature Store from the UI:</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 690.797px; height: 188.01px; position: relative;"><img src="image-resources/8e4fa8fd-e31e-4658-9c63-79b132d2ffc3.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 697.195px; height: 391.35px; position: relative;"><img src="image-resources/2e4f61a9-f635-4c59-a437-86b20c8fc4dc.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 710.787px; height: 365.6px; position: relative;"><img src="image-resources/499ffe3d-59a9-467f-bd25-5a3db3204774.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 710.795px; height: 391.58px; position: relative;"><img src="image-resources/89f91005-6138-48a6-9e51-759821cd02ab.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; background-color: rgb(255, 254, 0);">Note:</block><block> The </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">feature_store_model</block><block> is registered in the MLflow model registry as well. </block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>You can find it on the </block><block style="font-weight: bold;">Models</block><block> page. </block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>It is </block><block style="text-decoration: underline;">also logged at the feature store page</block><block>, indicating which features in the feature table are used for the model. </block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">[</block><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><compositeblock dir="ltr" class="anchor-tag-ref inline" style="font-family: &quot;Computer Modern Serif&quot;, serif;"><a href="#n0.3295185310066928" style="color: inherit; text-decoration: inherit;">Back To Top</a></compositeblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">]</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode section sindent-1" data-line-id="n0.7569051069523867" style="font-size: 1.1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.7569051069523867" role="heading" aria-level="2"><prefix style="text-align: left; padding-right: 0.25em;">8.4. </prefix><blocks><baselineblock class="inline"></baselineblock><block>Feature Score Batch Scoring</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Apply a feature store registered MLflow model to features with </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(79, 167, 176); background-color: rgba(155, 155, 155, 0.2);">score_batch</block><block>. </block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Input data only need the key column </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">index</block><block> and online feature </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">score_diff_from_last_month</block><block>. </block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Everything else is looked up.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token">## For sake of simplicity, we will just predict on the same inference_data_df</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">batch_input_df </block><block class="operator token">=</block><block class=" token"> inference_data_df</block><block class="punctuation token">.</block><block class=" token">drop</block><block class="punctuation token">(</block><block class="string token">"price"</block><block class="punctuation token">)</block><block class=" token"> </block><block class="comment token"># Exclude true label</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">predictions_df </block><block class="operator token">=</block><block class=" token"> fs</block><block class="punctuation token">.</block><block class=" token">score_batch</block><block class="punctuation token">(</block><block class="string-interpolation string token">f"models:/</block><block class="string-interpolation interpolation punctuation token">{</block><block class="string-interpolation interpolation token">model_name</block><block class="string-interpolation interpolation punctuation token">}</block><block class="string-interpolation string token">/1"</block><block class="punctuation token">,</block><block class=" token"> </block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">                                  batch_input_df</block><block class="punctuation token">,</block><block class=" token"> result_type</block><block class="operator token">=</block><block class="string token">"double"</block><block class="punctuation token">)</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 695.992px; height: 283.9px; position: relative;"><img src="image-resources/bcc5a361-a25e-46fc-a389-ef349911ad00.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">[</block><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><compositeblock dir="ltr" class="anchor-tag-ref inline" style="font-family: &quot;Computer Modern Serif&quot;, serif;"><a href="#n0.3295185310066928" style="color: inherit; text-decoration: inherit;">Back To Top</a></compositeblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">]</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode section sindent-1" data-line-id="n0.9938986595418651" style="font-size: 1.1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.9938986595418651" role="heading" aria-level="2"><prefix style="text-align: left; padding-right: 0.25em;">8.5. </prefix><blocks><baselineblock class="inline"></baselineblock><block>Overwrite Feature Table</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>We'll make some feature change and then overwrite on the Feature Store we just created.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token">## select numeric features and aggregate the review scores</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">review_columns </block><block class="operator token">=</block><block class=" token"> </block><block class="punctuation token">[</block><block class="string token">"review_scores_accuracy"</block><block class="punctuation token">,</block><block class=" token"> </block><block class="string token">"review_scores_cleanliness"</block><block class="punctuation token">,</block><block class=" token"> </block><block class="string token">"review_scores_checkin"</block><block class="punctuation token">,</block><block class=" token"> </block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">                 </block><block class="string token">"review_scores_communication"</block><block class="punctuation token">,</block><block class=" token"> </block><block class="string token">"review_scores_location"</block><block class="punctuation token">,</block><block class=" token"> </block><block class="string token">"review_scores_value"</block><block class="punctuation token">]</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">condensed_review_df </block><block class="operator token">=</block><block class=" token"> </block><block class="punctuation token">(</block><block class=" token">airbnb_df</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">                       </block><block class="punctuation token">.</block><block class=" token">select</block><block class="punctuation token">(</block><block class="punctuation token">[</block><block class="string token">"index"</block><block class="punctuation token">]</block><block class=" token"> </block><block class="operator token">+</block><block class=" token"> numeric_cols</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">                       </block><block class="punctuation token">.</block><block class=" token">withColumn</block><block class="punctuation token">(</block><block class="string token">"average_review_score"</block><block class="punctuation token">,</block><block class=" token"> expr</block><block class="punctuation token">(</block><block class="string token">"+"</block><block class="punctuation token">.</block><block class=" token">join</block><block class="punctuation token">(</block><block class=" token">review_columns</block><block class="punctuation token">)</block><block class="punctuation token">)</block><block class=" token"> </block><block class="operator token">/</block><block class=" token"> lit</block><block class="punctuation token">(</block><block class="builtin token">len</block><block class="punctuation token">(</block><block class=" token">review_columns</block><block class="punctuation token">)</block><block class="punctuation token">)</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">                       </block><block class="punctuation token">.</block><block class=" token">drop</block><block class="punctuation token">(</block><block class="operator token">*</block><block class=" token">review_columns</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">                      </block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Overwrite the feature store</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">fs</block><block class="punctuation token">.</block><block class=" token">write_table</block><block class="punctuation token">(</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    name</block><block class="operator token">=</block><block class=" token">table_name</block><block class="punctuation token">,</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    df</block><block class="operator token">=</block><block class=" token">condensed_review_df</block><block class="punctuation token">,</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    mode</block><block class="operator token">=</block><block class="string token">"overwrite"</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="punctuation token">)</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; background-color: rgb(255, 254, 0);">Note:</block><block> By default, </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(79, 167, 176); background-color: rgba(155, 155, 155, 0.2);">fs.read_table()</block><block> reads in the latest version of the feature table. </block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>To read in the </block><block style="text-decoration: underline;">specific version</block><block> of feature table, you can optionally specify the argument </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(79, 167, 176); background-color: rgba(155, 155, 155, 0.2);">as_of_delta_timestamp</block><block> by passing a date in a timestamp format or string.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; background-color: rgb(255, 254, 0);">Note:</block><block> The values of the deleted columns have been replaced by </block><block style="font-weight: bold;">null</block><block>.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Displays most recent table</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">display</block><block class="punctuation token">(</block><block class=" token">fs</block><block class="punctuation token">.</block><block class=" token">read_table</block><block class="punctuation token">(</block><block class=" token">name</block><block class="operator token">=</block><block class=" token">table_name</block><block class="punctuation token">)</block><block class="punctuation token">)</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; background-color: rgb(255, 254, 0);">Note:</block><block> If you need to use the features for real-time serving, you can publish your features to an </block><block class="role-hyper-link" data-hyper-link-url="https://docs.databricks.com/applications/machine-learning/feature-store.html#publish-features-to-an-online-feature-store" style="text-decoration: underline; color: rgb(17, 85, 204);"><a href="https://docs.databricks.com/applications/machine-learning/feature-store.html#publish-features-to-an-online-feature-store" target="_blank" style="color: inherit; text-decoration: inherit;">online store</a></block><block>.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; background-color: rgb(255, 254, 0);">Note:</block><block> You can also set who can access the Feature Store you created through the </block><block style="font-weight: bold;">"Permissions"</block><block> button in the UI.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">[</block><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><compositeblock dir="ltr" class="anchor-tag-ref inline" style="font-family: &quot;Computer Modern Serif&quot;, serif;"><a href="#n0.3295185310066928" style="color: inherit; text-decoration: inherit;">Back To Top</a></compositeblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">]</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode section sindent-1" data-line-id="n0.8630205650666423" style="font-size: 1.1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.8630205650666423" role="heading" aria-level="2"><prefix style="text-align: left; padding-right: 0.25em;">8.6. </prefix><blocks><baselineblock class="inline"></baselineblock><block>Retrain a New Model with New Features</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>We're going to retrain a new model with the new </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">average_review_score</block><block> feature.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">def</block><block class=" token"> </block><block class="function token">load_data</block><block class="punctuation token">(</block><block class=" token">table_name</block><block class="punctuation token">,</block><block class=" token"> lookup_key</block><block class="punctuation token">)</block><block class="punctuation token">:</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    model_feature_lookups </block><block class="operator token">=</block><block class=" token"> </block><block class="punctuation token">[</block><block class=" token">FeatureLookup</block><block class="punctuation token">(</block><block class=" token">table_name</block><block class="operator token">=</block><block class=" token">table_name</block><block class="punctuation token">,</block><block class=" token"> lookup_key</block><block class="operator token">=</block><block class=" token">lookup_key</block><block class="punctuation token">)</block><block class="punctuation token">]</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block><block class="comment token"># fs.create_training_set will look up features in model_feature_lookups with matched key from inference_data_df</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    training_set </block><block class="operator token">=</block><block class=" token"> fs</block><block class="punctuation token">.</block><block class=" token">create_training_set</block><block class="punctuation token">(</block><block class=" token">inference_data_df</block><block class="punctuation token">,</block><block class=" token"> model_feature_lookups</block><block class="punctuation token">,</block><block class=" token"> label</block><block class="operator token">=</block><block class="string token">"price"</block><block class="punctuation token">,</block><block class=" token"> exclude_columns</block><block class="operator token">=</block><block class="string token">"index"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    training_pd </block><block class="operator token">=</block><block class=" token"> training_set</block><block class="punctuation token">.</block><block class=" token">load_df</block><block class="punctuation token">(</block><block class="punctuation token">)</block><block class="punctuation token">.</block><block class=" token">drop</block><block class="punctuation token">(</block><block class="operator token">*</block><block class=" token">review_columns</block><block class="punctuation token">)</block><block class="punctuation token">.</block><block class=" token">toPandas</block><block class="punctuation token">(</block><block class="punctuation token">)</block><block class=" token">  </block><block class="comment token">#remove all those null columns, should now have the new average_review_score in it</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block><block class="comment token"># Create train and test datasets</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    X </block><block class="operator token">=</block><block class=" token"> training_pd</block><block class="punctuation token">.</block><block class=" token">drop</block><block class="punctuation token">(</block><block class="string token">"price"</block><block class="punctuation token">,</block><block class=" token"> axis</block><block class="operator token">=</block><block class="number token">1</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    y </block><block class="operator token">=</block><block class=" token"> training_pd</block><block class="punctuation token">[</block><block class="string token">"price"</block><block class="punctuation token">]</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    X_train</block><block class="punctuation token">,</block><block class=" token"> X_test</block><block class="punctuation token">,</block><block class=" token"> y_train</block><block class="punctuation token">,</block><block class=" token"> y_test </block><block class="operator token">=</block><block class=" token"> train_test_split</block><block class="punctuation token">(</block><block class=" token">X</block><block class="punctuation token">,</block><block class=" token"> y</block><block class="punctuation token">,</block><block class=" token"> test_size</block><block class="operator token">=</block><block class="number token">0.2</block><block class="punctuation token">,</block><block class=" token"> random_state</block><block class="operator token">=</block><block class="number token">42</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block><block class="keyword token">return</block><block class=" token"> X_train</block><block class="punctuation token">,</block><block class=" token"> X_test</block><block class="punctuation token">,</block><block class=" token"> y_train</block><block class="punctuation token">,</block><block class=" token"> y_test</block><block class="punctuation token">,</block><block class=" token"> training_set</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">X_train</block><block class="punctuation token">,</block><block class=" token"> X_test</block><block class="punctuation token">,</block><block class=" token"> y_train</block><block class="punctuation token">,</block><block class=" token"> y_test</block><block class="punctuation token">,</block><block class=" token"> training_set </block><block class="operator token">=</block><block class=" token"> load_data</block><block class="punctuation token">(</block><block class=" token">table_name</block><block class="punctuation token">,</block><block class=" token"> </block><block class="string token">"index"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">def</block><block class=" token"> </block><block class="function token">train_model</block><block class="punctuation token">(</block><block class=" token">X_train</block><block class="punctuation token">,</block><block class=" token"> X_test</block><block class="punctuation token">,</block><block class=" token"> y_train</block><block class="punctuation token">,</block><block class=" token"> y_test</block><block class="punctuation token">,</block><block class=" token"> training_set</block><block class="punctuation token">,</block><block class=" token"> fs</block><block class="punctuation token">)</block><block class="punctuation token">:</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block><block class="comment token">## fit and log model</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block><block class="keyword token">with</block><block class=" token"> mlflow</block><block class="punctuation token">.</block><block class=" token">start_run</block><block class="punctuation token">(</block><block class="punctuation token">)</block><block class=" token"> </block><block class="keyword token">as</block><block class=" token"> run</block><block class="punctuation token">:</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">        rf </block><block class="operator token">=</block><block class=" token"> RandomForestRegressor</block><block class="punctuation token">(</block><block class=" token">max_depth</block><block class="operator token">=</block><block class="number token">3</block><block class="punctuation token">,</block><block class=" token"> n_estimators</block><block class="operator token">=</block><block class="number token">20</block><block class="punctuation token">,</block><block class=" token"> random_state</block><block class="operator token">=</block><block class="number token">42</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">        rf</block><block class="punctuation token">.</block><block class=" token">fit</block><block class="punctuation token">(</block><block class=" token">X_train</block><block class="punctuation token">,</block><block class=" token"> y_train</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">        y_pred </block><block class="operator token">=</block><block class=" token"> rf</block><block class="punctuation token">.</block><block class=" token">predict</block><block class="punctuation token">(</block><block class=" token">X_test</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">        mlflow</block><block class="punctuation token">.</block><block class=" token">log_metric</block><block class="punctuation token">(</block><block class="string token">"test_mse"</block><block class="punctuation token">,</block><block class=" token"> mean_squared_error</block><block class="punctuation token">(</block><block class=" token">y_test</block><block class="punctuation token">,</block><block class=" token"> y_pred</block><block class="punctuation token">)</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">        mlflow</block><block class="punctuation token">.</block><block class=" token">log_metric</block><block class="punctuation token">(</block><block class="string token">"test_r2_score"</block><block class="punctuation token">,</block><block class=" token"> r2_score</block><block class="punctuation token">(</block><block class=" token">y_test</block><block class="punctuation token">,</block><block class=" token"> y_pred</block><block class="punctuation token">)</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">        </block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">        fs</block><block class="punctuation token">.</block><block class=" token">log_model</block><block class="punctuation token">(</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">            model</block><block class="operator token">=</block><block class=" token">rf</block><block class="punctuation token">,</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">            artifact_path</block><block class="operator token">=</block><block class="string token">"feature-store-model"</block><block class="punctuation token">,</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">            flavor</block><block class="operator token">=</block><block class=" token">mlflow</block><block class="punctuation token">.</block><block class=" token">sklearn</block><block class="punctuation token">,</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">            training_set</block><block class="operator token">=</block><block class=" token">training_set</block><block class="punctuation token">,</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">            registered_model_name</block><block class="operator token">=</block><block class=" token">model_name</block><block class="punctuation token">,</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">            input_example</block><block class="operator token">=</block><block class=" token">X_train</block><block class="punctuation token">[</block><block class="punctuation token">:</block><block class="number token">5</block><block class="punctuation token">]</block><block class="punctuation token">,</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">            signature</block><block class="operator token">=</block><block class=" token">infer_signature</block><block class="punctuation token">(</block><block class=" token">X_train</block><block class="punctuation token">,</block><block class=" token"> y_train</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">        </block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">train_model</block><block class="punctuation token">(</block><block class=" token">X_train</block><block class="punctuation token">,</block><block class=" token"> X_test</block><block class="punctuation token">,</block><block class=" token"> y_train</block><block class="punctuation token">,</block><block class=" token"> y_test</block><block class="punctuation token">,</block><block class=" token"> training_set</block><block class="punctuation token">,</block><block class=" token"> fs</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token">## For sake of simplicity, we will just predict on the same inference_data_df</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">batch_input_df </block><block class="operator token">=</block><block class=" token"> inference_data_df</block><block class="punctuation token">.</block><block class=" token">drop</block><block class="punctuation token">(</block><block class="string token">"price"</block><block class="punctuation token">)</block><block class=" token"> </block><block class="comment token"># Exclude true label</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">predictions_df </block><block class="operator token">=</block><block class=" token"> fs</block><block class="punctuation token">.</block><block class=" token">score_batch</block><block class="punctuation token">(</block><block class="string-interpolation string token">f"models:/</block><block class="string-interpolation interpolation punctuation token">{</block><block class="string-interpolation interpolation token">model_name</block><block class="string-interpolation interpolation punctuation token">}</block><block class="string-interpolation string token">/2"</block><block class="punctuation token">,</block><block class=" token"> </block><block class="comment token">#notice we are using version2</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">                                  batch_input_df</block><block class="punctuation token">,</block><block class=" token"> result_type</block><block class="operator token">=</block><block class="string token">"double"</block><block class="punctuation token">)</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">[</block><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><compositeblock dir="ltr" class="anchor-tag-ref inline" style="font-family: &quot;Computer Modern Serif&quot;, serif;"><a href="#n0.3295185310066928" style="color: inherit; text-decoration: inherit;">Back To Top</a></compositeblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">]</block></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="inline" style="display: block;"><div style="vertical-align: baseline;"><div style="display: inline-block; height: 0px; border-bottom: 1px solid; width: 100%;"></div></div></compositeblock></blocks></line><line class="root text-mode section sindent-0" data-line-id="n0.2938160235336882" style="font-size: 1.2em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.2938160235336882" role="heading" aria-level="1"><prefix style="text-align: left; padding-right: 0.5em;">9. </prefix><blocks><baselineblock class="inline"></baselineblock><block>XGBoost</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 701.591px; height: 304.56px; position: relative;"><img src="image-resources/5b51dcd2-79b6-450b-95dd-169ce85a9b5c.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 702.589px; height: 381.04px; position: relative;"><img src="image-resources/a24c54d9-e63f-4361-8378-18a01c96c2aa.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 703.6px; height: 360.82px; position: relative;"><img src="image-resources/1a0260e5-ee2f-4c27-ace0-956cba85e32a.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 700.289px; height: 378.71px; position: relative;"><img src="image-resources/a9fffd96-08be-4ae8-81bb-022145a900e3.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 697.992px; height: 284.34px; position: relative;"><img src="image-resources/57b80c0a-d6b4-4af5-8d86-affc7f1c06c1.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>More info on xgb parameters and performance considerations </block><block class="role-hyper-link" data-hyper-link-url="https://docs.databricks.com/en/machine-learning/train-model/xgboost-spark.html" style="text-decoration: underline; color: rgb(17, 85, 204);"><a href="https://docs.databricks.com/en/machine-learning/train-model/xgboost-spark.html" target="_blank" style="color: inherit; text-decoration: inherit;">here</a></block><block>.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Data preparation</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Let's go ahead and index all of our categorical features, and set our label to be log(price).</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> pyspark</block><block class="punctuation token">.</block><block class=" token">sql</block><block class="punctuation token">.</block><block class=" token">functions </block><block class="keyword token">import</block><block class=" token"> log</block><block class="punctuation token">,</block><block class=" token"> col</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> pyspark</block><block class="punctuation token">.</block><block class=" token">ml</block><block class="punctuation token">.</block><block class=" token">feature </block><block class="keyword token">import</block><block class=" token"> StringIndexer</block><block class="punctuation token">,</block><block class=" token"> VectorAssembler</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">file_path </block><block class="operator token">=</block><block class=" token"> </block><block class="string-interpolation string token">f"</block><block class="string-interpolation interpolation punctuation token">{</block><block class="string-interpolation interpolation token">DA</block><block class="string-interpolation interpolation punctuation token">.</block><block class="string-interpolation interpolation token">paths</block><block class="string-interpolation interpolation punctuation token">.</block><block class="string-interpolation interpolation token">datasets</block><block class="string-interpolation interpolation punctuation token">}</block><block class="string-interpolation string token">/airbnb/sf-listings/sf-listings-2019-03-06-clean.delta/"</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">airbnb_df </block><block class="operator token">=</block><block class=" token"> spark</block><block class="punctuation token">.</block><block class=" token">read</block><block class="punctuation token">.</block><block class="builtin token">format</block><block class="punctuation token">(</block><block class="string token">"delta"</block><block class="punctuation token">)</block><block class="punctuation token">.</block><block class=" token">load</block><block class="punctuation token">(</block><block class=" token">file_path</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">train_df</block><block class="punctuation token">,</block><block class=" token"> test_df </block><block class="operator token">=</block><block class=" token"> airbnb_df</block><block class="punctuation token">.</block><block class=" token">withColumn</block><block class="punctuation token">(</block><block class="string token">"label"</block><block class="punctuation token">,</block><block class=" token"> log</block><block class="punctuation token">(</block><block class=" token">col</block><block class="punctuation token">(</block><block class="string token">"price"</block><block class="punctuation token">)</block><block class="punctuation token">)</block><block class="punctuation token">)</block><block class="punctuation token">.</block><block class=" token">randomSplit</block><block class="punctuation token">(</block><block class="punctuation token">[</block><block class="number token">.8</block><block class="punctuation token">,</block><block class=" token"> </block><block class="number token">.2</block><block class="punctuation token">]</block><block class="punctuation token">,</block><block class=" token"> seed</block><block class="operator token">=</block><block class="number token">42</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">categorical_cols </block><block class="operator token">=</block><block class=" token"> </block><block class="punctuation token">[</block><block class=" token">field </block><block class="keyword token">for</block><block class=" token"> </block><block class="punctuation token">(</block><block class=" token">field</block><block class="punctuation token">,</block><block class=" token"> dataType</block><block class="punctuation token">)</block><block class=" token"> </block><block class="keyword token">in</block><block class=" token"> train_df</block><block class="punctuation token">.</block><block class=" token">dtypes </block><block class="keyword token">if</block><block class=" token"> dataType </block><block class="operator token">==</block><block class=" token"> </block><block class="string token">"string"</block><block class="punctuation token">]</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">index_output_cols </block><block class="operator token">=</block><block class=" token"> </block><block class="punctuation token">[</block><block class=" token">x </block><block class="operator token">+</block><block class=" token"> </block><block class="string token">"Index"</block><block class=" token"> </block><block class="keyword token">for</block><block class=" token"> x </block><block class="keyword token">in</block><block class=" token"> categorical_cols</block><block class="punctuation token">]</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">string_indexer </block><block class="operator token">=</block><block class=" token"> StringIndexer</block><block class="punctuation token">(</block><block class=" token">inputCols</block><block class="operator token">=</block><block class=" token">categorical_cols</block><block class="punctuation token">,</block><block class=" token"> outputCols</block><block class="operator token">=</block><block class=" token">index_output_cols</block><block class="punctuation token">,</block><block class=" token"> handleInvalid</block><block class="operator token">=</block><block class="string token">"skip"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">numeric_cols </block><block class="operator token">=</block><block class=" token"> </block><block class="punctuation token">[</block><block class=" token">field </block><block class="keyword token">for</block><block class=" token"> </block><block class="punctuation token">(</block><block class=" token">field</block><block class="punctuation token">,</block><block class=" token"> dataType</block><block class="punctuation token">)</block><block class=" token"> </block><block class="keyword token">in</block><block class=" token"> train_df</block><block class="punctuation token">.</block><block class=" token">dtypes </block><block class="keyword token">if</block><block class=" token"> </block><block class="punctuation token">(</block><block class="punctuation token">(</block><block class=" token">dataType </block><block class="operator token">==</block><block class=" token"> </block><block class="string token">"double"</block><block class="punctuation token">)</block><block class=" token"> </block><block class="operator token">&amp;</block><block class=" token"> </block><block class="punctuation token">(</block><block class=" token">field </block><block class="operator token">!=</block><block class=" token"> </block><block class="string token">"price"</block><block class="punctuation token">)</block><block class=" token"> </block><block class="operator token">&amp;</block><block class=" token"> </block><block class="punctuation token">(</block><block class=" token">field </block><block class="operator token">!=</block><block class=" token"> </block><block class="string token">"label"</block><block class="punctuation token">)</block><block class="punctuation token">)</block><block class="punctuation token">]</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">assembler_inputs </block><block class="operator token">=</block><block class=" token"> index_output_cols </block><block class="operator token">+</block><block class=" token"> numeric_cols</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">vec_assembler </block><block class="operator token">=</block><block class=" token"> VectorAssembler</block><block class="punctuation token">(</block><block class=" token">inputCols</block><block class="operator token">=</block><block class=" token">assembler_inputs</block><block class="punctuation token">,</block><block class=" token"> outputCol</block><block class="operator token">=</block><block class="string token">"features"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># --------- Distributed Training of XGBoost Models</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># To use the distributed version of XGBoost's PySpark estimators, we can specify two additional parameters:</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># 1) num_workers</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># 2) use_gpu</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> xgboost</block><block class="punctuation token">.</block><block class=" token">spark </block><block class="keyword token">import</block><block class=" token"> SparkXGBRegressor</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> pyspark</block><block class="punctuation token">.</block><block class=" token">ml </block><block class="keyword token">import</block><block class=" token"> Pipeline</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">params </block><block class="operator token">=</block><block class=" token"> </block><block class="punctuation token">{</block><block class="string token">"n_estimators"</block><block class="punctuation token">:</block><block class=" token"> </block><block class="number token">100</block><block class="punctuation token">,</block><block class=" token"> </block><block class="string token">"learning_rate"</block><block class="punctuation token">:</block><block class=" token"> </block><block class="number token">0.1</block><block class="punctuation token">,</block><block class=" token"> </block><block class="string token">"max_depth"</block><block class="punctuation token">:</block><block class=" token"> </block><block class="number token">4</block><block class="punctuation token">,</block><block class=" token"> </block><block class="string token">"random_state"</block><block class="punctuation token">:</block><block class=" token"> </block><block class="number token">42</block><block class="punctuation token">,</block><block class=" token"> </block><block class="string token">"missing"</block><block class="punctuation token">:</block><block class=" token"> </block><block class="number token">0</block><block class="punctuation token">}</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">xgboost </block><block class="operator token">=</block><block class=" token"> SparkXGBRegressor</block><block class="punctuation token">(</block><block class="operator token">**</block><block class=" token">params</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">pipeline </block><block class="operator token">=</block><block class=" token"> Pipeline</block><block class="punctuation token">(</block><block class=" token">stages</block><block class="operator token">=</block><block class="punctuation token">[</block><block class=" token">string_indexer</block><block class="punctuation token">,</block><block class=" token"> vec_assembler</block><block class="punctuation token">,</block><block class=" token"> xgboost</block><block class="punctuation token">]</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">pipeline_model </block><block class="operator token">=</block><block class=" token"> pipeline</block><block class="punctuation token">.</block><block class=" token">fit</block><block class="punctuation token">(</block><block class=" token">train_df</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Evaluate model performance</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> pyspark</block><block class="punctuation token">.</block><block class=" token">sql</block><block class="punctuation token">.</block><block class=" token">functions </block><block class="keyword token">import</block><block class=" token"> exp</block><block class="punctuation token">,</block><block class=" token"> col</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">log_pred_df </block><block class="operator token">=</block><block class=" token"> pipeline_model</block><block class="punctuation token">.</block><block class=" token">transform</block><block class="punctuation token">(</block><block class=" token">test_df</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">exp_xgboost_df </block><block class="operator token">=</block><block class=" token"> log_pred_df</block><block class="punctuation token">.</block><block class=" token">withColumn</block><block class="punctuation token">(</block><block class="string token">"prediction"</block><block class="punctuation token">,</block><block class=" token"> exp</block><block class="punctuation token">(</block><block class=" token">col</block><block class="punctuation token">(</block><block class="string token">"prediction"</block><block class="punctuation token">)</block><block class="punctuation token">)</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> pyspark</block><block class="punctuation token">.</block><block class=" token">ml</block><block class="punctuation token">.</block><block class=" token">evaluation </block><block class="keyword token">import</block><block class=" token"> RegressionEvaluator</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">regression_evaluator </block><block class="operator token">=</block><block class=" token"> RegressionEvaluator</block><block class="punctuation token">(</block><block class=" token">predictionCol</block><block class="operator token">=</block><block class="string token">"prediction"</block><block class="punctuation token">,</block><block class=" token"> labelCol</block><block class="operator token">=</block><block class="string token">"price"</block><block class="punctuation token">,</block><block class=" token"> metricName</block><block class="operator token">=</block><block class="string token">"rmse"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">rmse </block><block class="operator token">=</block><block class=" token"> regression_evaluator</block><block class="punctuation token">.</block><block class=" token">evaluate</block><block class="punctuation token">(</block><block class=" token">exp_xgboost_df</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">r2 </block><block class="operator token">=</block><block class=" token"> regression_evaluator</block><block class="punctuation token">.</block><block class=" token">setMetricName</block><block class="punctuation token">(</block><block class="string token">"r2"</block><block class="punctuation token">)</block><block class="punctuation token">.</block><block class=" token">evaluate</block><block class="punctuation token">(</block><block class=" token">exp_xgboost_df</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">print</block><block class="punctuation token">(</block><block class="string-interpolation string token">f"RMSE is </block><block class="string-interpolation interpolation punctuation token">{</block><block class="string-interpolation interpolation token">rmse</block><block class="string-interpolation interpolation punctuation token">}</block><block class="string-interpolation string token">"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">print</block><block class="punctuation token">(</block><block class="string-interpolation string token">f"R2 is </block><block class="string-interpolation interpolation punctuation token">{</block><block class="string-interpolation interpolation token">r2</block><block class="string-interpolation interpolation punctuation token">}</block><block class="string-interpolation string token">"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># RMSE is 119.30345607045693</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># R2 is 0.5538114388646336</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Alternatively, you can use other gradient boosted approaches:</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block class="role-hyper-link" data-hyper-link-url="https://catboost.ai/" style="text-decoration: underline; color: rgb(17, 85, 204);"><a href="https://catboost.ai/" target="_blank" style="color: inherit; text-decoration: inherit;">CatBoost</a></block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block class="role-hyper-link" data-hyper-link-url="https://github.com/microsoft/LightGBM" style="text-decoration: underline; color: rgb(17, 85, 204);"><a href="https://github.com/microsoft/LightGBM" target="_blank" style="color: inherit; text-decoration: inherit;">LightGBM</a></block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block class="role-hyper-link" data-hyper-link-url="https://spark.apache.org/docs/latest/api/python/reference/api/pyspark.ml.classification.GBTClassifier.html?highlight=gbt#pyspark.ml.classification.GBTClassifier" style="text-decoration: underline; color: rgb(17, 85, 204);"><a href="https://spark.apache.org/docs/latest/api/python/reference/api/pyspark.ml.classification.GBTClassifier.html?highlight=gbt#pyspark.ml.classification.GBTClassifier" target="_blank" style="color: inherit; text-decoration: inherit;">Vanilla GB trees in SparkML</a></block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block class="role-hyper-link" data-hyper-link-url="https://towardsdatascience.com/catboost-vs-light-gbm-vs-xgboost-5f93620723db" style="text-decoration: underline; color: rgb(17, 85, 204);"><a href="https://towardsdatascience.com/catboost-vs-light-gbm-vs-xgboost-5f93620723db" target="_blank" style="color: inherit; text-decoration: inherit;">Pros &amp; Cons</a></block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">[</block><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><compositeblock dir="ltr" class="anchor-tag-ref inline" style="font-family: &quot;Computer Modern Serif&quot;, serif;"><a href="#n0.3295185310066928" style="color: inherit; text-decoration: inherit;">Back To Top</a></compositeblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">]</block></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="inline" style="display: block;"><div style="vertical-align: baseline;"><div style="display: inline-block; height: 0px; border-bottom: 1px solid; width: 100%;"></div></div></compositeblock></blocks></line><line class="root text-mode section sindent-0" data-line-id="n0.32622856639062836" style="font-size: 1.2em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.32622856639062836" role="heading" aria-level="1"><prefix style="text-align: left; padding-right: 0.5em;">10. </prefix><blocks><baselineblock class="inline"></baselineblock><block>Inference with Pandas UDFs</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>So far, we learned how to create a model using MLflow and track our different experiments.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>In this section, we will learn how to use </block><block style="font-weight: bold; color: rgb(255, 64, 0);">Pandas UDFs</block><block> and </block><block style="font-weight: bold; color: rgb(255, 64, 0);">Function API</block><block> for model inference.</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>We will also compare and contrast </block><block style="font-weight: bold; color: rgb(255, 64, 0);">Pandas UDFs</block><block>, </block><block style="font-weight: bold; color: rgb(255, 64, 0);">Scalar Iterator UDFs</block><block>, and </block><block style="font-weight: bold; color: rgb(255, 64, 0);">Function API</block><block>.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>To learn more about Pandas UDFs see </block><block class="role-hyper-link" data-hyper-link-url="https://databricks.com/blog/2020/05/20/new-pandas-udfs-and-python-type-hints-in-the-upcoming-release-of-apache-spark-3-0.html" style="text-decoration: underline; color: rgb(17, 85, 204);"><a href="https://databricks.com/blog/2020/05/20/new-pandas-udfs-and-python-type-hints-in-the-upcoming-release-of-apache-spark-3-0.html" target="_blank" style="color: inherit; text-decoration: inherit;">here</a></block><block>.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Let's start by loading the dataset and train a model.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">import</block><block class=" token"> mlflow</block><block class="punctuation token">.</block><block class=" token">sklearn</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">import</block><block class=" token"> pandas </block><block class="keyword token">as</block><block class=" token"> pd</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> sklearn</block><block class="punctuation token">.</block><block class=" token">ensemble </block><block class="keyword token">import</block><block class=" token"> RandomForestRegressor</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> sklearn</block><block class="punctuation token">.</block><block class=" token">model_selection </block><block class="keyword token">import</block><block class=" token"> train_test_split</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">with</block><block class=" token"> mlflow</block><block class="punctuation token">.</block><block class=" token">start_run</block><block class="punctuation token">(</block><block class=" token">run_name</block><block class="operator token">=</block><block class="string token">"sklearn-random-forest"</block><block class="punctuation token">)</block><block class=" token"> </block><block class="keyword token">as</block><block class=" token"> run</block><block class="punctuation token">:</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block><block class="comment token"># Enable autologging </block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    mlflow</block><block class="punctuation token">.</block><block class=" token">sklearn</block><block class="punctuation token">.</block><block class=" token">autolog</block><block class="punctuation token">(</block><block class=" token">log_input_examples</block><block class="operator token">=</block><block class="boolean token">True</block><block class="punctuation token">,</block><block class=" token"> log_model_signatures</block><block class="operator token">=</block><block class="boolean token">True</block><block class="punctuation token">,</block><block class=" token"> log_models</block><block class="operator token">=</block><block class="boolean token">True</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block><block class="comment token"># Import the data</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    df </block><block class="operator token">=</block><block class=" token"> pd</block><block class="punctuation token">.</block><block class=" token">read_csv</block><block class="punctuation token">(</block><block class="string-interpolation string token">f"</block><block class="string-interpolation interpolation punctuation token">{</block><block class="string-interpolation interpolation token">DA</block><block class="string-interpolation interpolation punctuation token">.</block><block class="string-interpolation interpolation token">paths</block><block class="string-interpolation interpolation punctuation token">.</block><block class="string-interpolation interpolation token">datasets</block><block class="string-interpolation interpolation punctuation token">}</block><block class="string-interpolation string token">/airbnb/sf-listings/airbnb-cleaned-mlflow.csv"</block><block class="punctuation token">.</block><block class=" token">replace</block><block class="punctuation token">(</block><block class="string token">"dbfs:/"</block><block class="punctuation token">,</block><block class=" token"> </block><block class="string token">"/dbfs/"</block><block class="punctuation token">)</block><block class="punctuation token">)</block><block class="punctuation token">.</block><block class=" token">drop</block><block class="punctuation token">(</block><block class="punctuation token">[</block><block class="string token">"zipcode"</block><block class="punctuation token">]</block><block class="punctuation token">,</block><block class=" token"> axis</block><block class="operator token">=</block><block class="number token">1</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    X_train</block><block class="punctuation token">,</block><block class=" token"> X_test</block><block class="punctuation token">,</block><block class=" token"> y_train</block><block class="punctuation token">,</block><block class=" token"> y_test </block><block class="operator token">=</block><block class=" token"> train_test_split</block><block class="punctuation token">(</block><block class=" token">df</block><block class="punctuation token">.</block><block class=" token">drop</block><block class="punctuation token">(</block><block class="punctuation token">[</block><block class="string token">"price"</block><block class="punctuation token">]</block><block class="punctuation token">,</block><block class=" token"> axis</block><block class="operator token">=</block><block class="number token">1</block><block class="punctuation token">)</block><block class="punctuation token">,</block><block class=" token"> df</block><block class="punctuation token">[</block><block class="punctuation token">[</block><block class="string token">"price"</block><block class="punctuation token">]</block><block class="punctuation token">]</block><block class="punctuation token">.</block><block class=" token">values</block><block class="punctuation token">.</block><block class=" token">ravel</block><block class="punctuation token">(</block><block class="punctuation token">)</block><block class="punctuation token">,</block><block class=" token"> random_state</block><block class="operator token">=</block><block class="number token">42</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block><block class="comment token"># Create model</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    rf </block><block class="operator token">=</block><block class=" token"> RandomForestRegressor</block><block class="punctuation token">(</block><block class=" token">n_estimators</block><block class="operator token">=</block><block class="number token">100</block><block class="punctuation token">,</block><block class=" token"> max_depth</block><block class="operator token">=</block><block class="number token">10</block><block class="punctuation token">,</block><block class=" token"> random_state</block><block class="operator token">=</block><block class="number token">42</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    rf</block><block class="punctuation token">.</block><block class=" token">fit</block><block class="punctuation token">(</block><block class=" token">X_train</block><block class="punctuation token">,</block><block class=" token"> y_train</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Create Spark DataFrame</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">spark_df </block><block class="operator token">=</block><block class=" token"> spark</block><block class="punctuation token">.</block><block class=" token">createDataFrame</block><block class="punctuation token">(</block><block class=" token">X_test</block><block class="punctuation token">)</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">[</block><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><compositeblock dir="ltr" class="anchor-tag-ref inline" style="font-family: &quot;Computer Modern Serif&quot;, serif;"><a href="#n0.3295185310066928" style="color: inherit; text-decoration: inherit;">Back To Top</a></compositeblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">]</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode section sindent-1" data-line-id="n0.9064685869917974" style="font-size: 1.1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.9064685869917974" role="heading" aria-level="2"><prefix style="text-align: left; padding-right: 0.25em;">10.1. </prefix><blocks><baselineblock class="inline"></baselineblock><block>Pandas/Vectorized UDFs</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>As of Spark 2.3, there are </block><block style="font-weight: bold;">Pandas UDFs</block><block> available in Python to improve the efficiency of UDFs. </block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; color: rgb(255, 64, 0);">Pandas UDFs</block><block> utilize </block><block class="role-hyper-link" data-hyper-link-url="https://arrow.apache.org/" style="text-decoration: underline; font-weight: bold; color: rgb(17, 85, 204);"><a href="https://arrow.apache.org/" target="_blank" style="color: inherit; text-decoration: inherit;">Apache Arrow</a></block><block> to speed up computation. Let's see how that helps improve our processing time.</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block class="role-hyper-link" data-hyper-link-url="https://databricks.com/blog/2017/10/30/introducing-vectorized-udfs-for-pyspark.html" style="text-decoration: underline; color: rgb(17, 85, 204);"><a href="https://databricks.com/blog/2017/10/30/introducing-vectorized-udfs-for-pyspark.html" target="_blank" style="color: inherit; text-decoration: inherit;">Blog post</a></block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block class="role-hyper-link" data-hyper-link-url="https://spark.apache.org/docs/latest/sql-programming-guide.html#pyspark-usage-guide-for-pandas-with-apache-arrow" style="text-decoration: underline; color: rgb(17, 85, 204);"><a href="https://spark.apache.org/docs/latest/sql-programming-guide.html#pyspark-usage-guide-for-pandas-with-apache-arrow" target="_blank" style="color: inherit; text-decoration: inherit;">Documentation</a></block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 493.6px; height: 320.55px; position: relative;"><img src="image-resources/3ff6975b-2f83-4b97-a234-701f5531c9ac.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>The user-defined functions are executed by:</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; color: rgb(255, 64, 0);">Apache Arrow,</block><block> is an </block><block style="text-decoration: underline;">in-memory columnar data format</block><block> that is used in Spark to </block><block style="background-color: rgb(255, 254, 0);">efficiently transfer data between JVM and Python processes with near-zero (de)serialization cost</block><block>. See more </block><block class="role-hyper-link" data-hyper-link-url="https://spark.apache.org/docs/latest/sql-pyspark-pandas-with-arrow.html" style="text-decoration: underline; color: rgb(17, 85, 204);"><a href="https://spark.apache.org/docs/latest/sql-pyspark-pandas-with-arrow.html" target="_blank" style="color: inherit; text-decoration: inherit;">here</a></block><block>.</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Pandas inside the function, to work with pandas instances and APIs.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; background-color: rgb(255, 254, 0);">Note:</block><block> In Spark 3.0, you should define your Pandas UDF using </block><block style="text-decoration: underline;">Python type hints</block><block>.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> pyspark</block><block class="punctuation token">.</block><block class=" token">sql</block><block class="punctuation token">.</block><block class=" token">functions </block><block class="keyword token">import</block><block class=" token"> pandas_udf</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">@pandas_udf</block><block class="punctuation token">(</block><block class="string token">"double"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">def</block><block class=" token"> </block><block class="function token">predict</block><block class="punctuation token">(</block><block class="operator token">*</block><block class=" token">args</block><block class="punctuation token">:</block><block class=" token"> pd</block><block class="punctuation token">.</block><block class=" token">Series</block><block class="punctuation token">)</block><block class=" token"> </block><block class="operator token">-</block><block class="operator token">&gt;</block><block class=" token"> pd</block><block class="punctuation token">.</block><block class=" token">Series</block><block class="punctuation token">:</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    model_path </block><block class="operator token">=</block><block class=" token"> </block><block class="string-interpolation string token">f"runs:/</block><block class="string-interpolation interpolation punctuation token">{</block><block class="string-interpolation interpolation token">run</block><block class="string-interpolation interpolation punctuation token">.</block><block class="string-interpolation interpolation token">info</block><block class="string-interpolation interpolation punctuation token">.</block><block class="string-interpolation interpolation token">run_id</block><block class="string-interpolation interpolation punctuation token">}</block><block class="string-interpolation string token">/model"</block><block class=" token"> </block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    model </block><block class="operator token">=</block><block class=" token"> mlflow</block><block class="punctuation token">.</block><block class=" token">sklearn</block><block class="punctuation token">.</block><block class=" token">load_model</block><block class="punctuation token">(</block><block class=" token">model_path</block><block class="punctuation token">)</block><block class=" token"> </block><block class="comment token"># Load model</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    pdf </block><block class="operator token">=</block><block class=" token"> pd</block><block class="punctuation token">.</block><block class=" token">concat</block><block class="punctuation token">(</block><block class=" token">args</block><block class="punctuation token">,</block><block class=" token"> axis</block><block class="operator token">=</block><block class="number token">1</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block><block class="keyword token">return</block><block class=" token"> pd</block><block class="punctuation token">.</block><block class=" token">Series</block><block class="punctuation token">(</block><block class=" token">model</block><block class="punctuation token">.</block><block class=" token">predict</block><block class="punctuation token">(</block><block class=" token">pdf</block><block class="punctuation token">)</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">prediction_df </block><block class="operator token">=</block><block class=" token"> spark_df</block><block class="punctuation token">.</block><block class=" token">withColumn</block><block class="punctuation token">(</block><block class="string token">"prediction"</block><block class="punctuation token">,</block><block class=" token"> predict</block><block class="punctuation token">(</block><block class="operator token">*</block><block class=" token">spark_df</block><block class="punctuation token">.</block><block class=" token">columns</block><block class="punctuation token">)</block><block class="punctuation token">)</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">[</block><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><compositeblock dir="ltr" class="anchor-tag-ref inline" style="font-family: &quot;Computer Modern Serif&quot;, serif;"><a href="#n0.3295185310066928" style="color: inherit; text-decoration: inherit;">Back To Top</a></compositeblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">]</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode section sindent-1" data-line-id="n0.49891190197894164" style="font-size: 1.1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.49891190197894164" role="heading" aria-level="2"><prefix style="text-align: left; padding-right: 0.25em;">10.2. </prefix><blocks><baselineblock class="inline"></baselineblock><block>Pandas Scalar Iterator UDF</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="background-color: rgb(255, 254, 0);">If your model is very large, then there is high overhead for the </block><block style="font-weight: bold; background-color: rgb(255, 254, 0);">Pandas UDF</block><block style="background-color: rgb(255, 254, 0);"> to repeatedly load the same model for every batch in the same Python worker process</block><block>. </block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>In Spark 3.0, </block><block style="font-weight: bold;">Pandas UDFs</block><block> can accept an iterator of </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">pandas.Series</block><block> or </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">pandas.DataFrame</block><block> so that you can load the model only once instead of loading it for every series in the iterator.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>This way the </block><block style="text-decoration: underline;">cost of any set-up needed will be incurred fewer times</block><block>. </block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>When the number of records youre working with is greater than </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">spark.conf.get('spark.sql.execution.arrow.maxRecordsPerBatch')</block><block>, which is </block><block style="font-weight: bold;">10,000</block><block> by default, you should see speed ups over a pandas scalar UDF because it iterates through batches of </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">pd.Series</block><block>.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>It has the general syntax of:</block></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="decorator annotation punctuation token">@pandas_udf</block><block class="punctuation token">(</block><block class="punctuation token">.</block><block class="punctuation token">.</block><block class="punctuation token">.</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">def</block><block class=" token"> </block><block class="function token">predict</block><block class="punctuation token">(</block><block class=" token">iterator</block><block class="punctuation token">)</block><block class="punctuation token">:</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    model </block><block class="operator token">=</block><block class=" token"> </block><block class="punctuation token">.</block><block class="punctuation token">.</block><block class="punctuation token">.</block><block class=" token"> </block><block class="comment token"># load model</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block><block class="keyword token">for</block><block class=" token"> features </block><block class="keyword token">in</block><block class=" token"> iterator</block><block class="punctuation token">:</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">        </block><block class="keyword token">yield</block><block class=" token"> model</block><block class="punctuation token">.</block><block class=" token">predict</block><block class="punctuation token">(</block><block class=" token">features</block><block class="punctuation token">)</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> typing </block><block class="keyword token">import</block><block class=" token"> Iterator</block><block class="punctuation token">,</block><block class=" token"> Tuple</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">@pandas_udf</block><block class="punctuation token">(</block><block class="string token">"double"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">def</block><block class=" token"> </block><block class="function token">predict</block><block class="punctuation token">(</block><block class=" token">iterator</block><block class="punctuation token">:</block><block class=" token"> Iterator</block><block class="punctuation token">[</block><block class=" token">pd</block><block class="punctuation token">.</block><block class=" token">DataFrame</block><block class="punctuation token">]</block><block class="punctuation token">)</block><block class=" token"> </block><block class="operator token">-</block><block class="operator token">&gt;</block><block class=" token"> Iterator</block><block class="punctuation token">[</block><block class=" token">pd</block><block class="punctuation token">.</block><block class=" token">Series</block><block class="punctuation token">]</block><block class="punctuation token">:</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    model_path </block><block class="operator token">=</block><block class=" token"> </block><block class="string-interpolation string token">f"runs:/</block><block class="string-interpolation interpolation punctuation token">{</block><block class="string-interpolation interpolation token">run</block><block class="string-interpolation interpolation punctuation token">.</block><block class="string-interpolation interpolation token">info</block><block class="string-interpolation interpolation punctuation token">.</block><block class="string-interpolation interpolation token">run_id</block><block class="string-interpolation interpolation punctuation token">}</block><block class="string-interpolation string token">/model"</block><block class=" token"> </block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    model </block><block class="operator token">=</block><block class=" token"> mlflow</block><block class="punctuation token">.</block><block class=" token">sklearn</block><block class="punctuation token">.</block><block class=" token">load_model</block><block class="punctuation token">(</block><block class=" token">model_path</block><block class="punctuation token">)</block><block class=" token"> </block><block class="comment token"># Load model</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block><block class="keyword token">for</block><block class=" token"> features </block><block class="keyword token">in</block><block class=" token"> iterator</block><block class="punctuation token">:</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">        pdf </block><block class="operator token">=</block><block class=" token"> pd</block><block class="punctuation token">.</block><block class=" token">concat</block><block class="punctuation token">(</block><block class=" token">features</block><block class="punctuation token">,</block><block class=" token"> axis</block><block class="operator token">=</block><block class="number token">1</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">        </block><block class="keyword token">yield</block><block class=" token"> pd</block><block class="punctuation token">.</block><block class=" token">Series</block><block class="punctuation token">(</block><block class=" token">model</block><block class="punctuation token">.</block><block class=" token">predict</block><block class="punctuation token">(</block><block class=" token">pdf</block><block class="punctuation token">)</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">prediction_df </block><block class="operator token">=</block><block class=" token"> spark_df</block><block class="punctuation token">.</block><block class=" token">withColumn</block><block class="punctuation token">(</block><block class="string token">"prediction"</block><block class="punctuation token">,</block><block class=" token"> predict</block><block class="punctuation token">(</block><block class="operator token">*</block><block class=" token">spark_df</block><block class="punctuation token">.</block><block class=" token">columns</block><block class="punctuation token">)</block><block class="punctuation token">)</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Runtime in our example reduced from 6.66 sec. to 2.33 sec.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">[</block><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><compositeblock dir="ltr" class="anchor-tag-ref inline" style="font-family: &quot;Computer Modern Serif&quot;, serif;"><a href="#n0.3295185310066928" style="color: inherit; text-decoration: inherit;">Back To Top</a></compositeblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">]</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode section sindent-1" data-line-id="n0.7147469101865547" style="font-size: 1.1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.7147469101865547" role="heading" aria-level="2"><prefix style="text-align: left; padding-right: 0.25em;">10.3. </prefix><blocks><baselineblock class="inline"></baselineblock><block>Pandas Function API</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Instead of using a </block><block style="font-weight: bold;">Pandas UDF</block><block>, we can use a </block><block style="font-weight: bold; color: rgb(255, 64, 0);">Pandas Function API</block><block>. </block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>This new category in Apache Spark 3.0 enables you to </block><block style="background-color: rgb(255, 254, 0);">directly apply a Python native function, which takes and outputs Pandas instances against a PySpark DataFrame</block><block>. </block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold;">Pandas Functions APIs</block><block> supported in Apache Spark 3.0 are grouped map, map, and co-grouped map.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(255, 64, 0);">mapInPandas()</block><block> takes an iterator of </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">pandas.DataFrame</block><block> as input, and outputs another iterator of </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">pandas.DataFrame</block><block>. </block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>It's flexible and easy to use if your model requires all of your columns as input, but it requires serialization/deserialization of the whole DataFrame (as it is passed to its input). </block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>You can control the size of each </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">pandas.DataFrame</block><block> with the </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">spark.sql.execution.arrow.maxRecordsPerBatch</block><block> config.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">def</block><block class=" token"> </block><block class="function token">predict</block><block class="punctuation token">(</block><block class=" token">iterator</block><block class="punctuation token">:</block><block class=" token"> Iterator</block><block class="punctuation token">[</block><block class=" token">pd</block><block class="punctuation token">.</block><block class=" token">DataFrame</block><block class="punctuation token">]</block><block class="punctuation token">)</block><block class=" token"> </block><block class="operator token">-</block><block class="operator token">&gt;</block><block class=" token"> Iterator</block><block class="punctuation token">[</block><block class=" token">pd</block><block class="punctuation token">.</block><block class=" token">DataFrame</block><block class="punctuation token">]</block><block class="punctuation token">:</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    model_path </block><block class="operator token">=</block><block class=" token"> </block><block class="string-interpolation string token">f"runs:/</block><block class="string-interpolation interpolation punctuation token">{</block><block class="string-interpolation interpolation token">run</block><block class="string-interpolation interpolation punctuation token">.</block><block class="string-interpolation interpolation token">info</block><block class="string-interpolation interpolation punctuation token">.</block><block class="string-interpolation interpolation token">run_id</block><block class="string-interpolation interpolation punctuation token">}</block><block class="string-interpolation string token">/model"</block><block class=" token"> </block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    model </block><block class="operator token">=</block><block class=" token"> mlflow</block><block class="punctuation token">.</block><block class=" token">sklearn</block><block class="punctuation token">.</block><block class=" token">load_model</block><block class="punctuation token">(</block><block class=" token">model_path</block><block class="punctuation token">)</block><block class=" token"> </block><block class="comment token"># Load model</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block><block class="keyword token">for</block><block class=" token"> features </block><block class="keyword token">in</block><block class=" token"> iterator</block><block class="punctuation token">:</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">        </block><block class="keyword token">yield</block><block class=" token"> pd</block><block class="punctuation token">.</block><block class=" token">concat</block><block class="punctuation token">(</block><block class="punctuation token">[</block><block class=" token">features</block><block class="punctuation token">,</block><block class=" token"> pd</block><block class="punctuation token">.</block><block class=" token">Series</block><block class="punctuation token">(</block><block class=" token">model</block><block class="punctuation token">.</block><block class=" token">predict</block><block class="punctuation token">(</block><block class=" token">features</block><block class="punctuation token">)</block><block class="punctuation token">,</block><block class=" token"> name</block><block class="operator token">=</block><block class="string token">"prediction"</block><block class="punctuation token">)</block><block class="punctuation token">]</block><block class="punctuation token">,</block><block class=" token"> axis</block><block class="operator token">=</block><block class="number token">1</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">display</block><block class="punctuation token">(</block><block class=" token">spark_df</block><block class="punctuation token">.</block><block class=" token">mapInPandas</block><block class="punctuation token">(</block><block class=" token">predict</block><block class="punctuation token">,</block><block class=" token"> </block><block class="triple-quoted-string string token">"""`host_total_listings_count` DOUBLE,`neighbourhood_cleansed` BIGINT,`latitude` DOUBLE,`longitude` DOUBLE,`property_type` BIGINT,`room_type` BIGINT,`accommodates` DOUBLE,`bathrooms` DOUBLE,`bedrooms` DOUBLE,`beds` DOUBLE,`bed_type` BIGINT,`minimum_nights` DOUBLE,`number_of_reviews` DOUBLE,`review_scores_rating` DOUBLE,`review_scores_accuracy` DOUBLE,`review_scores_cleanliness` DOUBLE,`review_scores_checkin` DOUBLE,`review_scores_communication` DOUBLE,`review_scores_location` DOUBLE,`review_scores_value` DOUBLE, `prediction` DOUBLE"""</block><block class="punctuation token">)</block><block class="punctuation token">)</block><block class=" token"> </block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Or you can define the schema like this below:</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> pyspark</block><block class="punctuation token">.</block><block class=" token">sql</block><block class="punctuation token">.</block><block class=" token">functions </block><block class="keyword token">import</block><block class=" token"> lit</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> pyspark</block><block class="punctuation token">.</block><block class=" token">sql</block><block class="punctuation token">.</block><block class=" token">types </block><block class="keyword token">import</block><block class=" token"> DoubleType</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">schema </block><block class="operator token">=</block><block class=" token"> spark_df</block><block class="punctuation token">.</block><block class=" token">withColumn</block><block class="punctuation token">(</block><block class="string token">"prediction"</block><block class="punctuation token">,</block><block class=" token"> lit</block><block class="punctuation token">(</block><block class="boolean token">None</block><block class="punctuation token">)</block><block class="punctuation token">.</block><block class=" token">cast</block><block class="punctuation token">(</block><block class=" token">DoubleType</block><block class="punctuation token">(</block><block class="punctuation token">)</block><block class="punctuation token">)</block><block class="punctuation token">)</block><block class="punctuation token">.</block><block class=" token">schema</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">display</block><block class="punctuation token">(</block><block class=" token">spark_df</block><block class="punctuation token">.</block><block class=" token">mapInPandas</block><block class="punctuation token">(</block><block class=" token">predict</block><block class="punctuation token">,</block><block class=" token"> schema</block><block class="punctuation token">)</block><block class="punctuation token">)</block><block class=" token"> </block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">[</block><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><compositeblock dir="ltr" class="anchor-tag-ref inline" style="font-family: &quot;Computer Modern Serif&quot;, serif;"><a href="#n0.3295185310066928" style="color: inherit; text-decoration: inherit;">Back To Top</a></compositeblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">]</block></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="inline" style="display: block;"><div style="vertical-align: baseline;"><div style="display: inline-block; height: 0px; border-bottom: 1px solid; width: 100%;"></div></div></compositeblock></blocks></line><line class="root text-mode section sindent-0" data-line-id="n0.29592542497501384" style="font-size: 1.2em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.29592542497501384" role="heading" aria-level="1"><prefix style="text-align: left; padding-right: 0.5em;">11. </prefix><blocks><baselineblock class="inline"></baselineblock><block>Training with Pandas Function API</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>In this section, we'll learn how to use </block><block style="font-weight: bold;">Pandas Function API</block><block> to manage and scale machine learning models for </block><block style="text-decoration: underline;">IoT devices</block><block>. We'll do this by:</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Defining a Pandas function and apply it to a model.</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Using </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold; color: rgb(255, 64, 0);">.groupBy().applyInPandas()</block><block> to build many models in parallel.</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Serve multiple models from a registered model.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="font-weight: bold; flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold;">Let's start by creating a dummy data:</block></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">import</block><block class=" token"> pyspark</block><block class="punctuation token">.</block><block class=" token">sql</block><block class="punctuation token">.</block><block class=" token">functions </block><block class="keyword token">as</block><block class=" token"> f</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">df </block><block class="operator token">=</block><block class=" token"> </block><block class="punctuation token">(</block><block class=" token">spark</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">      </block><block class="punctuation token">.</block><block class="builtin token">range</block><block class="punctuation token">(</block><block class="number token">1000</block><block class="operator token">*</block><block class="number token">100</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">      </block><block class="punctuation token">.</block><block class=" token">select</block><block class="punctuation token">(</block><block class=" token">f</block><block class="punctuation token">.</block><block class=" token">col</block><block class="punctuation token">(</block><block class="string token">"id"</block><block class="punctuation token">)</block><block class="punctuation token">.</block><block class=" token">alias</block><block class="punctuation token">(</block><block class="string token">"record_id"</block><block class="punctuation token">)</block><block class="punctuation token">,</block><block class=" token"> </block><block class="punctuation token">(</block><block class=" token">f</block><block class="punctuation token">.</block><block class=" token">col</block><block class="punctuation token">(</block><block class="string token">"id"</block><block class="punctuation token">)</block><block class="operator token">%</block><block class="number token">10</block><block class="punctuation token">)</block><block class="punctuation token">.</block><block class=" token">alias</block><block class="punctuation token">(</block><block class="string token">"device_id"</block><block class="punctuation token">)</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">      </block><block class="punctuation token">.</block><block class=" token">withColumn</block><block class="punctuation token">(</block><block class="string token">"feature_1"</block><block class="punctuation token">,</block><block class=" token"> f</block><block class="punctuation token">.</block><block class=" token">rand</block><block class="punctuation token">(</block><block class="punctuation token">)</block><block class=" token"> </block><block class="operator token">*</block><block class=" token"> </block><block class="number token">1</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">      </block><block class="punctuation token">.</block><block class=" token">withColumn</block><block class="punctuation token">(</block><block class="string token">"feature_2"</block><block class="punctuation token">,</block><block class=" token"> f</block><block class="punctuation token">.</block><block class=" token">rand</block><block class="punctuation token">(</block><block class="punctuation token">)</block><block class=" token"> </block><block class="operator token">*</block><block class=" token"> </block><block class="number token">2</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">      </block><block class="punctuation token">.</block><block class=" token">withColumn</block><block class="punctuation token">(</block><block class="string token">"feature_3"</block><block class="punctuation token">,</block><block class=" token"> f</block><block class="punctuation token">.</block><block class=" token">rand</block><block class="punctuation token">(</block><block class="punctuation token">)</block><block class=" token"> </block><block class="operator token">*</block><block class=" token"> </block><block class="number token">3</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">      </block><block class="punctuation token">.</block><block class=" token">withColumn</block><block class="punctuation token">(</block><block class="string token">"label"</block><block class="punctuation token">,</block><block class=" token"> </block><block class="punctuation token">(</block><block class=" token">f</block><block class="punctuation token">.</block><block class=" token">col</block><block class="punctuation token">(</block><block class="string token">"feature_1"</block><block class="punctuation token">)</block><block class=" token"> </block><block class="operator token">+</block><block class=" token"> f</block><block class="punctuation token">.</block><block class=" token">col</block><block class="punctuation token">(</block><block class="string token">"feature_2"</block><block class="punctuation token">)</block><block class=" token"> </block><block class="operator token">+</block><block class=" token"> f</block><block class="punctuation token">.</block><block class=" token">col</block><block class="punctuation token">(</block><block class="string token">"feature_3"</block><block class="punctuation token">)</block><block class="punctuation token">)</block><block class=" token"> </block><block class="operator token">+</block><block class=" token"> f</block><block class="punctuation token">.</block><block class=" token">rand</block><block class="punctuation token">(</block><block class="punctuation token">)</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">     </block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Define the return schema (ddl method)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">train_return_schema </block><block class="operator token">=</block><block class=" token"> </block><block class="string token">"device_id integer, n_used integer, model_path string, mse float"</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">[</block><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><compositeblock dir="ltr" class="anchor-tag-ref inline" style="font-family: &quot;Computer Modern Serif&quot;, serif;"><a href="#n0.3295185310066928" style="color: inherit; text-decoration: inherit;">Back To Top</a></compositeblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">]</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode section sindent-1" data-line-id="n0.6101866036306911" style="font-size: 1.1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.6101866036306911" role="heading" aria-level="2"><prefix style="text-align: left; padding-right: 0.25em;">11.1. </prefix><blocks><baselineblock class="inline"></baselineblock><block>Define a Pandas Function</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Define a pandas function that takes all the data for a given device, train a model, saves it as a nested run, and returns a spark object with the above schema.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">import</block><block class=" token"> mlflow</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">import</block><block class=" token"> mlflow</block><block class="punctuation token">.</block><block class=" token">sklearn</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">import</block><block class=" token"> pandas </block><block class="keyword token">as</block><block class=" token"> pd</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> sklearn</block><block class="punctuation token">.</block><block class=" token">ensemble </block><block class="keyword token">import</block><block class=" token"> RandomForestRegressor</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> sklearn</block><block class="punctuation token">.</block><block class=" token">metrics </block><block class="keyword token">import</block><block class=" token"> mean_squared_error</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">def</block><block class=" token"> </block><block class="function token">train_model</block><block class="punctuation token">(</block><block class=" token">df_pandas</block><block class="punctuation token">:</block><block class=" token"> pd</block><block class="punctuation token">.</block><block class=" token">DataFrame</block><block class="punctuation token">)</block><block class=" token"> </block><block class="operator token">-</block><block class="operator token">&gt;</block><block class=" token"> pd</block><block class="punctuation token">.</block><block class=" token">DataFrame</block><block class="punctuation token">:</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block><block class="triple-quoted-string string token">"""</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="triple-quoted-string string token">    Trains an sklearn model on grouped instances</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="triple-quoted-string string token">    """</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block><block class="comment token"># Pull metadata</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    device_id </block><block class="operator token">=</block><block class=" token"> df_pandas</block><block class="punctuation token">[</block><block class="string token">"device_id"</block><block class="punctuation token">]</block><block class="punctuation token">.</block><block class=" token">iloc</block><block class="punctuation token">[</block><block class="number token">0</block><block class="punctuation token">]</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    n_used </block><block class="operator token">=</block><block class=" token"> df_pandas</block><block class="punctuation token">.</block><block class=" token">shape</block><block class="punctuation token">[</block><block class="number token">0</block><block class="punctuation token">]</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    run_id </block><block class="operator token">=</block><block class=" token"> df_pandas</block><block class="punctuation token">[</block><block class="string token">"run_id"</block><block class="punctuation token">]</block><block class="punctuation token">.</block><block class=" token">iloc</block><block class="punctuation token">[</block><block class="number token">0</block><block class="punctuation token">]</block><block class=" token"> </block><block class="comment token"># Pulls run ID to do a nested run</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block><block class="comment token"># Train the model</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    X </block><block class="operator token">=</block><block class=" token"> df_pandas</block><block class="punctuation token">[</block><block class="punctuation token">[</block><block class="string token">"feature_1"</block><block class="punctuation token">,</block><block class=" token"> </block><block class="string token">"feature_2"</block><block class="punctuation token">,</block><block class=" token"> </block><block class="string token">"feature_3"</block><block class="punctuation token">]</block><block class="punctuation token">]</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    y </block><block class="operator token">=</block><block class=" token"> df_pandas</block><block class="punctuation token">[</block><block class="string token">"label"</block><block class="punctuation token">]</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    rf </block><block class="operator token">=</block><block class=" token"> RandomForestRegressor</block><block class="punctuation token">(</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    rf</block><block class="punctuation token">.</block><block class=" token">fit</block><block class="punctuation token">(</block><block class=" token">X</block><block class="punctuation token">,</block><block class=" token"> y</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block><block class="comment token"># Evaluate the model</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    predictions </block><block class="operator token">=</block><block class=" token"> rf</block><block class="punctuation token">.</block><block class=" token">predict</block><block class="punctuation token">(</block><block class=" token">X</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    mse </block><block class="operator token">=</block><block class=" token"> mean_squared_error</block><block class="punctuation token">(</block><block class=" token">y</block><block class="punctuation token">,</block><block class=" token"> predictions</block><block class="punctuation token">)</block><block class=" token"> </block><block class="comment token"># Note we could add a train/test split</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block><block class="comment token"># Resume the top-level training</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block><block class="keyword token">with</block><block class=" token"> mlflow</block><block class="punctuation token">.</block><block class=" token">start_run</block><block class="punctuation token">(</block><block class=" token">run_id</block><block class="operator token">=</block><block class=" token">run_id</block><block class="punctuation token">)</block><block class=" token"> </block><block class="keyword token">as</block><block class=" token"> outer_run</block><block class="punctuation token">:</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">        </block><block class="comment token"># Small hack for running as a job</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">        experiment_id </block><block class="operator token">=</block><block class=" token"> outer_run</block><block class="punctuation token">.</block><block class=" token">info</block><block class="punctuation token">.</block><block class=" token">experiment_id</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">        </block><block class="keyword token">print</block><block class="punctuation token">(</block><block class="string-interpolation string token">f"Current experiment_id = </block><block class="string-interpolation interpolation punctuation token">{</block><block class="string-interpolation interpolation token">experiment_id</block><block class="string-interpolation interpolation punctuation token">}</block><block class="string-interpolation string token">"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">        </block><block class="comment token"># Create a nested run for the specific device</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">        </block><block class="keyword token">with</block><block class=" token"> mlflow</block><block class="punctuation token">.</block><block class=" token">start_run</block><block class="punctuation token">(</block><block class=" token">run_name</block><block class="operator token">=</block><block class="builtin token">str</block><block class="punctuation token">(</block><block class=" token">device_id</block><block class="punctuation token">)</block><block class="punctuation token">,</block><block class=" token"> nested</block><block class="operator token">=</block><block class="boolean token">True</block><block class="punctuation token">,</block><block class=" token"> experiment_id</block><block class="operator token">=</block><block class=" token">experiment_id</block><block class="punctuation token">)</block><block class=" token"> </block><block class="keyword token">as</block><block class=" token"> run</block><block class="punctuation token">:</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">            mlflow</block><block class="punctuation token">.</block><block class=" token">sklearn</block><block class="punctuation token">.</block><block class=" token">log_model</block><block class="punctuation token">(</block><block class=" token">rf</block><block class="punctuation token">,</block><block class=" token"> </block><block class="builtin token">str</block><block class="punctuation token">(</block><block class=" token">device_id</block><block class="punctuation token">)</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">            mlflow</block><block class="punctuation token">.</block><block class=" token">log_metric</block><block class="punctuation token">(</block><block class="string token">"mse"</block><block class="punctuation token">,</block><block class=" token"> mse</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">            mlflow</block><block class="punctuation token">.</block><block class=" token">set_tag</block><block class="punctuation token">(</block><block class="string token">"device"</block><block class="punctuation token">,</block><block class=" token"> </block><block class="builtin token">str</block><block class="punctuation token">(</block><block class=" token">device_id</block><block class="punctuation token">)</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">            artifact_uri </block><block class="operator token">=</block><block class=" token"> </block><block class="string-interpolation string token">f"runs:/</block><block class="string-interpolation interpolation punctuation token">{</block><block class="string-interpolation interpolation token">run</block><block class="string-interpolation interpolation punctuation token">.</block><block class="string-interpolation interpolation token">info</block><block class="string-interpolation interpolation punctuation token">.</block><block class="string-interpolation interpolation token">run_id</block><block class="string-interpolation interpolation punctuation token">}</block><block class="string-interpolation string token">/</block><block class="string-interpolation interpolation punctuation token">{</block><block class="string-interpolation interpolation token">device_id</block><block class="string-interpolation interpolation punctuation token">}</block><block class="string-interpolation string token">"</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">            </block><block class="comment token"># Create a return pandas DataFrame that matches the schema above</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">            return_df </block><block class="operator token">=</block><block class=" token"> pd</block><block class="punctuation token">.</block><block class=" token">DataFrame</block><block class="punctuation token">(</block><block class="punctuation token">[</block><block class="punctuation token">[</block><block class=" token">device_id</block><block class="punctuation token">,</block><block class=" token"> n_used</block><block class="punctuation token">,</block><block class=" token"> artifact_uri</block><block class="punctuation token">,</block><block class=" token"> mse</block><block class="punctuation token">]</block><block class="punctuation token">]</block><block class="punctuation token">,</block><block class=" token"> </block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">                                    columns</block><block class="operator token">=</block><block class="punctuation token">[</block><block class="string token">"device_id"</block><block class="punctuation token">,</block><block class=" token"> </block><block class="string token">"n_used"</block><block class="punctuation token">,</block><block class=" token"> </block><block class="string token">"model_path"</block><block class="punctuation token">,</block><block class=" token"> </block><block class="string token">"mse"</block><block class="punctuation token">]</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block><block class="keyword token">return</block><block class=" token"> return_df </block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">[</block><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><compositeblock dir="ltr" class="anchor-tag-ref inline" style="font-family: &quot;Computer Modern Serif&quot;, serif;"><a href="#n0.3295185310066928" style="color: inherit; text-decoration: inherit;">Back To Top</a></compositeblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">]</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode section sindent-1" data-line-id="n0.4607309788794005" style="font-size: 1.1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.4607309788794005" role="heading" aria-level="2"><prefix style="text-align: left; padding-right: 0.25em;">11.2. </prefix><blocks><baselineblock class="inline"></baselineblock><block>Apply the Pandas Function</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; background-color: rgb(255, 254, 0);">Note:</block><block> The way you would apply this in practice depends largely on where the data for inference is located. In this example, we'll reuse the training data which contains our device and run id's.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">with</block><block class=" token"> mlflow</block><block class="punctuation token">.</block><block class=" token">start_run</block><block class="punctuation token">(</block><block class=" token">run_name</block><block class="operator token">=</block><block class="string token">"Training session for all devices"</block><block class="punctuation token">)</block><block class=" token"> </block><block class="keyword token">as</block><block class=" token"> run</block><block class="punctuation token">:</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    run_id </block><block class="operator token">=</block><block class=" token"> run</block><block class="punctuation token">.</block><block class=" token">info</block><block class="punctuation token">.</block><block class=" token">run_id</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    model_directories_df </block><block class="operator token">=</block><block class=" token"> </block><block class="punctuation token">(</block><block class=" token">df</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">        </block><block class="punctuation token">.</block><block class=" token">withColumn</block><block class="punctuation token">(</block><block class="string token">"run_id"</block><block class="punctuation token">,</block><block class=" token"> f</block><block class="punctuation token">.</block><block class=" token">lit</block><block class="punctuation token">(</block><block class=" token">run_id</block><block class="punctuation token">)</block><block class="punctuation token">)</block><block class=" token"> </block><block class="comment token"># Add run_id</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">        </block><block class="punctuation token">.</block><block class=" token">groupby</block><block class="punctuation token">(</block><block class="string token">"device_id"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">        </block><block class="punctuation token">.</block><block class=" token">applyInPandas</block><block class="punctuation token">(</block><block class=" token">train_model</block><block class="punctuation token">,</block><block class=" token"> schema</block><block class="operator token">=</block><block class=" token">train_return_schema</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">        </block><block class="punctuation token">.</block><block class=" token">cache</block><block class="punctuation token">(</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">combined_df </block><block class="operator token">=</block><block class=" token"> df</block><block class="punctuation token">.</block><block class=" token">join</block><block class="punctuation token">(</block><block class=" token">model_directories_df</block><block class="punctuation token">,</block><block class=" token"> on</block><block class="operator token">=</block><block class="string token">"device_id"</block><block class="punctuation token">,</block><block class=" token"> how</block><block class="operator token">=</block><block class="string token">"left"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">display</block><block class="punctuation token">(</block><block class=" token">combined_df</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># ------ </block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Define a pandas function and return schema to apply the model. This needs only one read from DBFS per device.</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">apply_return_schema </block><block class="operator token">=</block><block class=" token"> </block><block class="string token">"record_id integer, prediction float"</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">def</block><block class=" token"> </block><block class="function token">apply_model</block><block class="punctuation token">(</block><block class=" token">df_pandas</block><block class="punctuation token">:</block><block class=" token"> pd</block><block class="punctuation token">.</block><block class=" token">DataFrame</block><block class="punctuation token">)</block><block class=" token"> </block><block class="operator token">-</block><block class="operator token">&gt;</block><block class=" token"> pd</block><block class="punctuation token">.</block><block class=" token">DataFrame</block><block class="punctuation token">:</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block><block class="triple-quoted-string string token">"""</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="triple-quoted-string string token">    Applies model to data for a particular device, represented as a pandas DataFrame</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="triple-quoted-string string token">    """</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    model_path </block><block class="operator token">=</block><block class=" token"> df_pandas</block><block class="punctuation token">[</block><block class="string token">"model_path"</block><block class="punctuation token">]</block><block class="punctuation token">.</block><block class=" token">iloc</block><block class="punctuation token">[</block><block class="number token">0</block><block class="punctuation token">]</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    input_columns </block><block class="operator token">=</block><block class=" token"> </block><block class="punctuation token">[</block><block class="string token">"feature_1"</block><block class="punctuation token">,</block><block class=" token"> </block><block class="string token">"feature_2"</block><block class="punctuation token">,</block><block class=" token"> </block><block class="string token">"feature_3"</block><block class="punctuation token">]</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    X </block><block class="operator token">=</block><block class=" token"> df_pandas</block><block class="punctuation token">[</block><block class=" token">input_columns</block><block class="punctuation token">]</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    model </block><block class="operator token">=</block><block class=" token"> mlflow</block><block class="punctuation token">.</block><block class=" token">sklearn</block><block class="punctuation token">.</block><block class=" token">load_model</block><block class="punctuation token">(</block><block class=" token">model_path</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    prediction </block><block class="operator token">=</block><block class=" token"> model</block><block class="punctuation token">.</block><block class=" token">predict</block><block class="punctuation token">(</block><block class=" token">X</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    return_df </block><block class="operator token">=</block><block class=" token"> pd</block><block class="punctuation token">.</block><block class=" token">DataFrame</block><block class="punctuation token">(</block><block class="punctuation token">{</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">        </block><block class="string token">"record_id"</block><block class="punctuation token">:</block><block class=" token"> df_pandas</block><block class="punctuation token">[</block><block class="string token">"record_id"</block><block class="punctuation token">]</block><block class="punctuation token">,</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">        </block><block class="string token">"prediction"</block><block class="punctuation token">:</block><block class=" token"> prediction</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block><block class="punctuation token">}</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block><block class="keyword token">return</block><block class=" token"> return_df</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">prediction_df </block><block class="operator token">=</block><block class=" token"> combined_df</block><block class="punctuation token">.</block><block class=" token">groupby</block><block class="punctuation token">(</block><block class="string token">"device_id"</block><block class="punctuation token">)</block><block class="punctuation token">.</block><block class=" token">applyInPandas</block><block class="punctuation token">(</block><block class=" token">apply_model</block><block class="punctuation token">,</block><block class=" token"> schema</block><block class="operator token">=</block><block class=" token">apply_return_schema</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">display</block><block class="punctuation token">(</block><block class=" token">prediction_df</block><block class="punctuation token">)</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">[</block><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><compositeblock dir="ltr" class="anchor-tag-ref inline" style="font-family: &quot;Computer Modern Serif&quot;, serif;"><a href="#n0.3295185310066928" style="color: inherit; text-decoration: inherit;">Back To Top</a></compositeblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">]</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode section sindent-1" data-line-id="n0.3419847298048786" style="font-size: 1.1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.3419847298048786" role="heading" aria-level="2"><prefix style="text-align: left; padding-right: 0.25em;">11.3. </prefix><blocks><baselineblock class="inline"></baselineblock><block>Serving Multiple Models from a Registered Model</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="background-color: rgb(255, 254, 0);">MLflow allows models to deploy as real-time REST APIs</block><block>. </block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>At the moment, a single MLflow model serves from one instance (typically one VM). </block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>However, sometimes multiple models need to be served from a single endpoint. </block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Imagine 1000 similar models that need to be served with different inputs. Running 1000 endpoints could waste resources, especially if certain models are underutilized.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="background-color: rgb(255, 254, 0);">One way around this is to package many models into a single custom model, which internally routes to one of the models based on the input and deploys that </block><block style="font-weight: bold; background-color: rgb(255, 254, 0);">'bundle'</block><block style="background-color: rgb(255, 254, 0);"> of models as a single </block><block style="font-weight: bold; background-color: rgb(255, 254, 0);">'model.'</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Below we demonstrate creating such a custom model that bundles all of the models we trained for each device. </block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>For every row of data fed to this model, the model will determine the </block><block style="font-style: italic;">device id</block><block> and then use the appropriate model trained on that device id to make predictions for a given row.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>First, we need to access the models for each </block><block style="font-style: italic;">device id</block><block>.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">experiment_id </block><block class="operator token">=</block><block class=" token"> run</block><block class="punctuation token">.</block><block class=" token">info</block><block class="punctuation token">.</block><block class=" token">experiment_id</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">model_df </block><block class="operator token">=</block><block class=" token"> </block><block class="punctuation token">(</block><block class=" token">spark</block><block class="punctuation token">.</block><block class=" token">read</block><block class="punctuation token">.</block><block class="builtin token">format</block><block class="punctuation token">(</block><block class="string token">"mlflow-experiment"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">            </block><block class="punctuation token">.</block><block class=" token">load</block><block class="punctuation token">(</block><block class=" token">experiment_id</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">            </block><block class="punctuation token">.</block><block class="builtin token">filter</block><block class="punctuation token">(</block><block class="string token">"tags.device IS NOT NULL"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">            </block><block class="punctuation token">.</block><block class=" token">orderBy</block><block class="punctuation token">(</block><block class="string token">"end_time"</block><block class="punctuation token">,</block><block class=" token"> ascending</block><block class="operator token">=</block><block class="boolean token">False</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">            </block><block class="punctuation token">.</block><block class=" token">select</block><block class="punctuation token">(</block><block class="string token">"tags.device"</block><block class="punctuation token">,</block><block class=" token"> </block><block class="string token">"run_id"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">            </block><block class="punctuation token">.</block><block class=" token">limit</block><block class="punctuation token">(</block><block class="number token">10</block><block class="punctuation token">)</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">display</block><block class="punctuation token">(</block><block class=" token">model_df</block><block class="punctuation token">)</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 383.2px; height: 295.75px; position: relative;"><img src="image-resources/a8e285b2-f93d-4076-9c3c-b7bfb7466b9f.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold;">We create a dictionary mapping device ids to the model trained on that</block><block> </block><block style="font-style: italic;">device id</block><block>.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">device_to_model </block><block class="operator token">=</block><block class=" token"> </block><block class="punctuation token">{</block><block class=" token">row</block><block class="punctuation token">[</block><block class="string token">"device"</block><block class="punctuation token">]</block><block class="punctuation token">:</block><block class=" token"> mlflow</block><block class="punctuation token">.</block><block class=" token">sklearn</block><block class="punctuation token">.</block><block class=" token">load_model</block><block class="punctuation token">(</block><block class="string-interpolation string token">f"runs:/</block><block class="string-interpolation interpolation punctuation token">{</block><block class="string-interpolation interpolation token">row</block><block class="string-interpolation interpolation punctuation token">[</block><block class="string-interpolation interpolation string token">'run_id'</block><block class="string-interpolation interpolation punctuation token">]</block><block class="string-interpolation interpolation punctuation token">}</block><block class="string-interpolation string token">/</block><block class="string-interpolation interpolation punctuation token">{</block><block class="string-interpolation interpolation token">row</block><block class="string-interpolation interpolation punctuation token">[</block><block class="string-interpolation interpolation string token">'device'</block><block class="string-interpolation interpolation punctuation token">]</block><block class="string-interpolation interpolation punctuation token">}</block><block class="string-interpolation string token">"</block><block class="punctuation token">)</block><block class=" token"> </block><block class="keyword token">for</block><block class=" token"> row </block><block class="keyword token">in</block><block class=" token"> model_df</block><block class="punctuation token">.</block><block class=" token">collect</block><block class="punctuation token">(</block><block class="punctuation token">)</block><block class="punctuation token">}</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># {'4': RandomForestRegressor(),</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token">#  '2': RandomForestRegressor(),</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token">#  '8': RandomForestRegressor(),</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token">#  '1': RandomForestRegressor(),</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token">#  '3': RandomForestRegressor(),</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token">#  '5': RandomForestRegressor(),</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token">#  '6': RandomForestRegressor(),</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token">#  '7': RandomForestRegressor(),</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token">#  '9': RandomForestRegressor(),</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token">#  '0': RandomForestRegressor()}</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold;">We create a custom model that takes the device id to model mappings as an attribute and delegates input to the appropriate model based on the</block><block> </block><block style="font-style: italic;">device id</block><block>.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> mlflow</block><block class="punctuation token">.</block><block class=" token">pyfunc </block><block class="keyword token">import</block><block class=" token"> PythonModel</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">class</block><block class=" token"> </block><block class="class-name token">OriginDelegatingModel</block><block class="punctuation token">(</block><block class=" token">PythonModel</block><block class="punctuation token">)</block><block class="punctuation token">:</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block><block class="keyword token">def</block><block class=" token"> </block><block class="function token">__init__</block><block class="punctuation token">(</block><block class=" token">self</block><block class="punctuation token">,</block><block class=" token"> device_to_model_map</block><block class="punctuation token">)</block><block class="punctuation token">:</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">        self</block><block class="punctuation token">.</block><block class=" token">device_to_model_map </block><block class="operator token">=</block><block class=" token"> device_to_model_map</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">        </block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block><block class="keyword token">def</block><block class=" token"> </block><block class="function token">predict_for_device</block><block class="punctuation token">(</block><block class=" token">self</block><block class="punctuation token">,</block><block class=" token"> row</block><block class="punctuation token">)</block><block class="punctuation token">:</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">        </block><block class="triple-quoted-string string token">'''</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="triple-quoted-string string token">        This method applies to a single row of data by</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="triple-quoted-string string token">        fetching the appropriate model and generating predictions</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="triple-quoted-string string token">        '''</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">        model </block><block class="operator token">=</block><block class=" token"> self</block><block class="punctuation token">.</block><block class=" token">device_to_model_map</block><block class="punctuation token">.</block><block class=" token">get</block><block class="punctuation token">(</block><block class="builtin token">str</block><block class="punctuation token">(</block><block class=" token">row</block><block class="punctuation token">[</block><block class="string token">"device_id"</block><block class="punctuation token">]</block><block class="punctuation token">)</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">        data </block><block class="operator token">=</block><block class=" token"> row</block><block class="punctuation token">[</block><block class="punctuation token">[</block><block class="string token">"feature_1"</block><block class="punctuation token">,</block><block class=" token"> </block><block class="string token">"feature_2"</block><block class="punctuation token">,</block><block class=" token"> </block><block class="string token">"feature_3"</block><block class="punctuation token">]</block><block class="punctuation token">]</block><block class="punctuation token">.</block><block class=" token">to_frame</block><block class="punctuation token">(</block><block class="punctuation token">)</block><block class="punctuation token">.</block><block class=" token">T</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">        </block><block class="keyword token">return</block><block class=" token"> model</block><block class="punctuation token">.</block><block class=" token">predict</block><block class="punctuation token">(</block><block class=" token">data</block><block class="punctuation token">)</block><block class="punctuation token">[</block><block class="number token">0</block><block class="punctuation token">]</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block><block class="keyword token">def</block><block class=" token"> </block><block class="function token">predict</block><block class="punctuation token">(</block><block class=" token">self</block><block class="punctuation token">,</block><block class=" token"> model_input</block><block class="punctuation token">)</block><block class="punctuation token">:</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">        </block><block class="keyword token">return</block><block class=" token"> model_input</block><block class="punctuation token">.</block><block class="builtin token">apply</block><block class="punctuation token">(</block><block class=" token">self</block><block class="punctuation token">.</block><block class=" token">predict_for_device</block><block class="punctuation token">,</block><block class=" token"> axis</block><block class="operator token">=</block><block class="number token">1</block><block class="punctuation token">)</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="font-weight: bold; flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold;">Here we demonstrate the use of this model.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="font-weight: bold; flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">example_model </block><block class="operator token">=</block><block class=" token"> OriginDelegatingModel</block><block class="punctuation token">(</block><block class=" token">device_to_model</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">example_model</block><block class="punctuation token">.</block><block class=" token">predict</block><block class="punctuation token">(</block><block class=" token">combined_df</block><block class="punctuation token">.</block><block class=" token">toPandas</block><block class="punctuation token">(</block><block class="punctuation token">)</block><block class="punctuation token">.</block><block class=" token">head</block><block class="punctuation token">(</block><block class="number token">20</block><block class="punctuation token">)</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># 0     3.077797</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># 1     2.912993</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># 2     4.241675</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># 3     5.148067</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># 4     5.532963</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># 5     5.480921</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># 6     3.453346</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># 7     4.614054</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># 8     4.107916</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># 9     1.072057</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># 10    1.847115</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># 11    2.952885</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># 12    3.790272</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># 13    1.221893</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># 14    3.684741</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># 15    5.344534</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># 16    4.463732</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># 17    3.562638</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># 18    4.556413</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># 19    4.522927</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># dtype: float64</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="font-weight: bold; flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold;">From here we can log and then register the model to be used for serving models for all the device ids from one instance.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="font-weight: bold; flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">with</block><block class=" token"> mlflow</block><block class="punctuation token">.</block><block class=" token">start_run</block><block class="punctuation token">(</block><block class="punctuation token">)</block><block class="punctuation token">:</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    model </block><block class="operator token">=</block><block class=" token"> OriginDelegatingModel</block><block class="punctuation token">(</block><block class=" token">device_to_model</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    mlflow</block><block class="punctuation token">.</block><block class=" token">pyfunc</block><block class="punctuation token">.</block><block class=" token">log_model</block><block class="punctuation token">(</block><block class="string token">"model"</block><block class="punctuation token">,</block><block class=" token"> python_model</block><block class="operator token">=</block><block class=" token">model</block><block class="punctuation token">)</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">[</block><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><compositeblock dir="ltr" class="anchor-tag-ref inline" style="font-family: &quot;Computer Modern Serif&quot;, serif;"><a href="#n0.3295185310066928" style="color: inherit; text-decoration: inherit;">Back To Top</a></compositeblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">]</block></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="inline" style="display: block;"><div style="vertical-align: baseline;"><div style="display: inline-block; height: 0px; border-bottom: 1px solid; width: 100%;"></div></div></compositeblock></blocks></line><line class="root text-mode section sindent-0" data-line-id="n0.12932700338377678" style="font-size: 1.2em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.12932700338377678" role="heading" aria-level="1"><prefix style="text-align: left; padding-right: 0.5em;">12. </prefix><blocks><baselineblock class="inline"></baselineblock><block>Pandas API on Spark</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>The </block><block style="font-weight: bold; color: rgb(255, 64, 0);">Pandas API on Spark</block><block> project makes data scientists more productive when interacting with big data, by implementing the pandas DataFrame API on top of Apache Spark. </block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>By unifying the two ecosystems with a familiar API, pandas API on Spark offers a seamless transition between small and large data.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>You might be familiar with the </block><block class="role-hyper-link" data-hyper-link-url="https://github.com/databricks/koalas" style="text-decoration: underline; color: rgb(17, 85, 204);"><a href="https://github.com/databricks/koalas" target="_blank" style="color: inherit; text-decoration: inherit;">Koalas</a></block><block> project, which has been </block><block style="text-decoration: underline;">merged into PySpark in 3.2</block><block>. </block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; background-color: rgb(255, 254, 0);">Note:</block><block> For Apache Spark 3.2 and above, please use PySpark directly as the standalone Koalas project is now in maintenance mode. See this </block><block class="role-hyper-link" data-hyper-link-url="https://databricks.com/blog/2021/10/04/pandas-api-on-upcoming-apache-spark-3-2.html" style="text-decoration: underline; color: rgb(17, 85, 204);"><a href="https://databricks.com/blog/2021/10/04/pandas-api-on-upcoming-apache-spark-3-2.html" target="_blank" style="color: inherit; text-decoration: inherit;">blog post</a></block><block>.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 653.595px; height: 405.71px; position: relative;"><img src="image-resources/562fa0f6-a25c-410e-851c-745941872e75.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 624px; height: 414.56px; position: relative;"><img src="image-resources/c13a088c-e80e-4aed-81d2-8d27772a46d0.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold;">Pandas DataFrames</block><block> are mutable, eagerly evaluated, and maintain row order. They are restricted to a single machine, and are very performant when the data sets are small, as shown in a).</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold;">Spark DataFrames</block><block> are distributed, lazily evaluated, immutable, and do not maintain row order. They are very performant when working at scale, as shown in b) and c).</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold;">Pandas API on Spark</block><block> provides the </block><block style="text-decoration: underline;">best of both worlds</block><block>: pandas API with the performance benefits of Spark. However, it is not as fast as implementing your solution natively in Spark, and let's see why below.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">[</block><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><compositeblock dir="ltr" class="anchor-tag-ref inline" style="font-family: &quot;Computer Modern Serif&quot;, serif;"><a href="#n0.3295185310066928" style="color: inherit; text-decoration: inherit;">Back To Top</a></compositeblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">]</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode section sindent-1" data-line-id="n0.1503399325895336" style="font-size: 1.1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.1503399325895336" role="heading" aria-level="2"><prefix style="text-align: left; padding-right: 0.25em;">12.1. </prefix><blocks><baselineblock class="inline"></baselineblock><block>InternalFrame</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>The </block><block style="font-weight: bold; color: rgb(255, 64, 0);">InternalFrame</block><block> holds the current Spark DataFrame and internal immutable metadata.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>It </block><block style="text-decoration: underline;">manages mappings from pandas API on Spark column names to Spark column names</block><block>, as well as from pandas API on Spark index names to Spark column names.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>If a user calls some API, the pandas API on Spark DataFrame updates the Spark DataFrame and metadata in </block><block style="font-style: italic;">InternalFrame</block><block>. </block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>It creates or copies the current </block><block style="font-style: italic;">InternalFrame</block><block> with the new states, and returns a new pandas API on Spark DataFrame.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 694.395px; height: 294.77px; position: relative;"><img src="image-resources/b67427f8-a80d-4c45-838b-26c4bd1549ee.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="font-weight: bold; flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; background-color: rgb(255, 254, 0);">InternalFrame Metadata Updates Only</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Sometimes the update of Spark DataFrame is not needed but of metadata only, then new structure will be like this.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 685.397px; height: 276.49px; position: relative;"><img src="image-resources/5ad6b4df-1d66-4069-bc72-2916b15cd48b.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="font-weight: bold; flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; background-color: rgb(255, 254, 0);">InternalFrame Inplace Updates</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>On the other hand, sometimes pandas API on Spark DataFrame updates internal state instead of returning a new DataFrame, for example, the argument inplace=True is provided, then new structure will be like this.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 698.789px; height: 256.71px; position: relative;"><img src="image-resources/9cf231f4-50d1-4559-ae6b-c9e5e3344871.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Read more on </block><block class="role-hyper-link" data-hyper-link-url="https://koalas.readthedocs.io/en/latest/user_guide/options.html#default-index-type" style="text-decoration: underline; color: rgb(17, 85, 204);"><a href="https://koalas.readthedocs.io/en/latest/user_guide/options.html#default-index-type" target="_blank" style="color: inherit; text-decoration: inherit;">Index Types Documentation</a></block><block>.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 717.591px; height: 372.7px; position: relative;"><img src="image-resources/e0a6590c-ace8-4dbd-b3cd-e0a5cca7cc5f.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">[</block><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><compositeblock dir="ltr" class="anchor-tag-ref inline" style="font-family: &quot;Computer Modern Serif&quot;, serif;"><a href="#n0.3295185310066928" style="color: inherit; text-decoration: inherit;">Back To Top</a></compositeblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">]</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode section sindent-1" data-line-id="n0.8935380965465236" style="font-size: 1.1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.8935380965465236" role="heading" aria-level="2"><prefix style="text-align: left; padding-right: 0.25em;">12.2. </prefix><blocks><baselineblock class="inline"></baselineblock><block>Implementation</block></blocks></line><line class="root text-mode section sindent-2" data-line-id="n0.626673019207862" style="font-size: 1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.626673019207862" role="heading" aria-level="3"><prefix style="text-align: left; padding-right: 0em;">12.2.1. </prefix><blocks><baselineblock class="inline"></baselineblock><block>Read in the Dataset</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Read in the dataset using:</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>PySpark</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Pandas</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Pandas API on Spark</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># PySpark</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">spark_df </block><block class="operator token">=</block><block class=" token"> spark</block><block class="punctuation token">.</block><block class=" token">read</block><block class="punctuation token">.</block><block class=" token">parquet</block><block class="punctuation token">(</block><block class="string-interpolation string token">f"</block><block class="string-interpolation interpolation punctuation token">{</block><block class="string-interpolation interpolation token">DA</block><block class="string-interpolation interpolation punctuation token">.</block><block class="string-interpolation interpolation token">paths</block><block class="string-interpolation interpolation punctuation token">.</block><block class="string-interpolation interpolation token">datasets</block><block class="string-interpolation interpolation punctuation token">}</block><block class="string-interpolation string token">/airbnb/sf-listings/sf-listings-2019-03-06-clean.parquet/"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Pandas</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">import</block><block class=" token"> pandas </block><block class="keyword token">as</block><block class=" token"> pd</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Note: Replacing dbfs:/ with /dbfs/ is done so that Pandas can read the path. /dbfs/ is essentially a mount pointing to dbfs:/</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">pandas_df </block><block class="operator token">=</block><block class=" token"> pd</block><block class="punctuation token">.</block><block class=" token">read_parquet</block><block class="punctuation token">(</block><block class="string-interpolation string token">f"</block><block class="string-interpolation interpolation punctuation token">{</block><block class="string-interpolation interpolation token">DA</block><block class="string-interpolation interpolation punctuation token">.</block><block class="string-interpolation interpolation token">paths</block><block class="string-interpolation interpolation punctuation token">.</block><block class="string-interpolation interpolation token">datasets</block><block class="string-interpolation interpolation punctuation token">.</block><block class="string-interpolation interpolation token">replace</block><block class="string-interpolation interpolation punctuation token">(</block><block class="string-interpolation interpolation string token">'dbfs:/'</block><block class="string-interpolation interpolation punctuation token">,</block><block class="string-interpolation interpolation token"> </block><block class="string-interpolation interpolation string token">'/dbfs/'</block><block class="string-interpolation interpolation punctuation token">)</block><block class="string-interpolation interpolation punctuation token">}</block><block class="string-interpolation string token">/airbnb/sf-listings/sf-listings-2019-03-06-clean.parquet/"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Pandas API on Spark</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Note: You'll notice pandas API on Spark generates an index column for you, like in pandas.</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Note: Pandas API on Spark also supports reading from Delta (`read_delta`), but pandas does not support that yet.</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">import</block><block class=" token"> pyspark</block><block class="punctuation token">.</block><block class=" token">pandas </block><block class="keyword token">as</block><block class=" token"> ps</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">df </block><block class="operator token">=</block><block class=" token"> ps</block><block class="punctuation token">.</block><block class=" token">read_parquet</block><block class="punctuation token">(</block><block class="string-interpolation string token">f"</block><block class="string-interpolation interpolation punctuation token">{</block><block class="string-interpolation interpolation token">DA</block><block class="string-interpolation interpolation punctuation token">.</block><block class="string-interpolation interpolation token">paths</block><block class="string-interpolation interpolation punctuation token">.</block><block class="string-interpolation interpolation token">datasets</block><block class="string-interpolation interpolation punctuation token">}</block><block class="string-interpolation string token">/airbnb/sf-listings/sf-listings-2019-03-06-clean.parquet/"</block><block class="punctuation token">)</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode section sindent-2" data-line-id="n0.5477364769986266" style="font-size: 1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.5477364769986266" role="heading" aria-level="3"><prefix style="text-align: left; padding-right: 0em;">12.2.2. </prefix><blocks><baselineblock class="inline"></baselineblock><block>Define Index Type</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">ps</block><block class="punctuation token">.</block><block class=" token">set_option</block><block class="punctuation token">(</block><block class="string token">"compute.default_index_type"</block><block class="punctuation token">,</block><block class=" token"> </block><block class="string token">"distributed-sequence"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">df_dist_sequence </block><block class="operator token">=</block><block class=" token"> ps</block><block class="punctuation token">.</block><block class=" token">read_parquet</block><block class="punctuation token">(</block><block class="string-interpolation string token">f"</block><block class="string-interpolation interpolation punctuation token">{</block><block class="string-interpolation interpolation token">DA</block><block class="string-interpolation interpolation punctuation token">.</block><block class="string-interpolation interpolation token">paths</block><block class="string-interpolation interpolation punctuation token">.</block><block class="string-interpolation interpolation token">datasets</block><block class="string-interpolation interpolation punctuation token">}</block><block class="string-interpolation string token">/airbnb/sf-listings/sf-listings-2019-03-06-clean.parquet/"</block><block class="punctuation token">)</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode section sindent-2" data-line-id="n0.1647361214812031" style="font-size: 1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.1647361214812031" role="heading" aria-level="3"><prefix style="text-align: left; padding-right: 0em;">12.2.3. </prefix><blocks><baselineblock class="inline"></baselineblock><block>Converting to Pandas API on Spark</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Creating a pandas API on Spark DataFrame from PySpark DataFrame</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">df </block><block class="operator token">=</block><block class=" token"> ps</block><block class="punctuation token">.</block><block class=" token">DataFrame</block><block class="punctuation token">(</block><block class=" token">spark_df</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Alternative way of creating a pandas API on Spark DataFrame from PySpark DataFrame</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">df </block><block class="operator token">=</block><block class=" token"> spark_df</block><block class="punctuation token">.</block><block class=" token">to_pandas_on_spark</block><block class="punctuation token">(</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Go from a pandas API on Spark DataFrame to a Spark DataFrame</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">df</block><block class="punctuation token">.</block><block class=" token">to_spark</block><block class="punctuation token">(</block><block class="punctuation token">)</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode section sindent-2" data-line-id="n0.734074228269088" style="font-size: 1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.734074228269088" role="heading" aria-level="3"><prefix style="text-align: left; padding-right: 0em;">12.2.4. </prefix><blocks><baselineblock class="inline"></baselineblock><block>Value Counts</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Get value counts of the different property types with PySpark</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">display</block><block class="punctuation token">(</block><block class=" token">spark_df</block><block class="punctuation token">.</block><block class=" token">groupby</block><block class="punctuation token">(</block><block class="string token">"property_type"</block><block class="punctuation token">)</block><block class="punctuation token">.</block><block class=" token">count</block><block class="punctuation token">(</block><block class="punctuation token">)</block><block class="punctuation token">.</block><block class=" token">orderBy</block><block class="punctuation token">(</block><block class="string token">"count"</block><block class="punctuation token">,</block><block class=" token"> ascending</block><block class="operator token">=</block><block class="boolean token">False</block><block class="punctuation token">)</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Get value counts of the different property types with pandas API on Spark</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">df</block><block class="punctuation token">[</block><block class="string token">"property_type"</block><block class="punctuation token">]</block><block class="punctuation token">.</block><block class=" token">value_counts</block><block class="punctuation token">(</block><block class="punctuation token">)</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">[</block><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><compositeblock dir="ltr" class="anchor-tag-ref inline" style="font-family: &quot;Computer Modern Serif&quot;, serif;"><a href="#n0.3295185310066928" style="color: inherit; text-decoration: inherit;">Back To Top</a></compositeblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">]</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode section sindent-1" data-line-id="n0.47869481636335265" style="font-size: 1.1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.47869481636335265" role="heading" aria-level="2"><prefix style="text-align: left; padding-right: 0.25em;">12.3. </prefix><blocks><baselineblock class="inline"></baselineblock><block>Visualization</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Based on the type of visualization, the pandas API on Spark has optimized ways to execute the plotting.</block></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 657.991px; height: 310.89px; position: relative;"><img src="image-resources/5b76d5d6-9e6c-4d74-a638-48ad66205aba.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">df</block><block class="punctuation token">.</block><block class=" token">plot</block><block class="punctuation token">(</block><block class=" token">kind</block><block class="operator token">=</block><block class="string token">"hist"</block><block class="punctuation token">,</block><block class=" token"> x</block><block class="operator token">=</block><block class="string token">"bedrooms"</block><block class="punctuation token">,</block><block class=" token"> y</block><block class="operator token">=</block><block class="string token">"price"</block><block class="punctuation token">,</block><block class=" token"> bins</block><block class="operator token">=</block><block class="number token">200</block><block class="punctuation token">)</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 653.592px; height: 206.69px; position: relative;"><img src="image-resources/6133b202-f324-45d2-8cbd-949e129a1e75.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">[</block><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><compositeblock dir="ltr" class="anchor-tag-ref inline" style="font-family: &quot;Computer Modern Serif&quot;, serif;"><a href="#n0.3295185310066928" style="color: inherit; text-decoration: inherit;">Back To Top</a></compositeblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">]</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode section sindent-1" data-line-id="n0.5017897271583482" style="font-size: 1.1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.5017897271583482" role="heading" aria-level="2"><prefix style="text-align: left; padding-right: 0.25em;">12.4. </prefix><blocks><baselineblock class="inline"></baselineblock><block>SQL on pandas API on Spark DataFrames</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">ps</block><block class="punctuation token">.</block><block class=" token">sql</block><block class="punctuation token">(</block><block class="string token">"SELECT distinct(property_type) FROM {df}"</block><block class="punctuation token">,</block><block class=" token"> df</block><block class="operator token">=</block><block class=" token">df</block><block class="punctuation token">)</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 179.2px; height: 421.95px; position: relative;"><img src="image-resources/2fce2e6d-d144-4df0-afc0-198c90434e54.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode section sindent-1" data-line-id="n0.31813733043989934" style="font-size: 1.1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.31813733043989934" role="heading" aria-level="2"><prefix style="text-align: left; padding-right: 0.25em;">12.5. </prefix><blocks><baselineblock class="inline"></baselineblock><block>Interesting Facts</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>With </block><block style="font-weight: bold;">Pandas API on Spark</block><block> </block><block style="text-decoration: underline;">you can read from Delta Tables and read in a directory of files.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>If you use apply on a pandas API on Spark DF and that DF is &lt;1000 (by default), pandas API on Spark will use pandas as a shortcut - this can be adjusted using </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">compute.shortcut_limit</block><block>.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>When you create bar plots, the top </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">n</block><block> rows are only used - this can be adjusted using </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">plotting.max_rows</block><block>.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>How to utilize </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">.apply</block><block> </block><block class="role-hyper-link" data-hyper-link-url="https://koalas.readthedocs.io/en/latest/reference/api/databricks.koalas.DataFrame.apply.html#databricks.koalas.DataFrame.apply" style="text-decoration: underline; color: rgb(17, 85, 204);"><a href="https://koalas.readthedocs.io/en/latest/reference/api/databricks.koalas.DataFrame.apply.html#databricks.koalas.DataFrame.apply" target="_blank" style="color: inherit; text-decoration: inherit;">docs</a></block><block> with its use of return type hints similar to pandas UDFs</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>How to check the execution plan, as well as caching a pandas API on Spark DF (which aren't immediately intuitive)</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Koalas are marsupials whose max speed is 30 kph (20 mph)</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">[</block><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><compositeblock dir="ltr" class="anchor-tag-ref inline" style="font-family: &quot;Computer Modern Serif&quot;, serif;"><a href="#n0.3295185310066928" style="color: inherit; text-decoration: inherit;">Back To Top</a></compositeblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">]</block></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="inline" style="display: block;"><div style="vertical-align: baseline;"><div style="display: inline-block; height: 0px; border-bottom: 1px solid; width: 100%;"></div></div></compositeblock></blocks></line><line class="root text-mode section sindent-0" data-line-id="n0.6021845524409584" style="font-size: 1.2em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.6021845524409584" role="heading" aria-level="1"><prefix style="text-align: left; padding-right: 0.5em;">13. </prefix><blocks><baselineblock class="inline"></baselineblock><block>Extras</block></blocks></line><line class="root text-mode section sindent-1" data-line-id="n0.7677651259876315" style="font-size: 1.1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.7677651259876315" role="heading" aria-level="2"><prefix style="text-align: left; padding-right: 0.25em;">13.1. </prefix><blocks><baselineblock class="inline"></baselineblock><block>MLlib Deployment Options</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>There are four main deployment options:</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; font-weight: bold; color: rgb(0, 0, 0);"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; color: rgb(255, 64, 0);">Batch per-compute</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; font-weight: bold; color: rgb(0, 0, 0);"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; color: rgb(255, 64, 0);">Structured streaming</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; font-weight: bold; color: rgb(0, 0, 0);"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; color: rgb(255, 64, 0);">Low-latency model serving</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; font-weight: bold; color: rgb(0, 0, 0);"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; color: rgb(255, 64, 0);">Mobile/embedded</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix style=""></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 689px; height: 320.8px; position: relative;"><img src="image-resources/8ae01097-6f3b-491a-87e2-39d611e66435.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix style=""></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 705.5px; height: 328.17px; position: relative;"><img src="image-resources/1fe84e92-0da2-462b-aaf5-cff4986c9393.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 660px; height: 239.82px; position: relative;"><img src="image-resources/110e1557-4620-4cad-97e2-b1d69219e476.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div data-caption-block-id="n0.939519050743719" class="role-image-caption-container role-caption-container" style="display: flex; align-items: center; justify-content: center; margin-top: 10px;" id="n0.939519050743719"><span class="no-print-outline" style="outline: none; position: relative; text-align: center;"><span class="role-image-caption-prefix" style="padding-right: 0.3em; font-weight: bold;"><span class="role-image-caption-name">Figure</span><span class="role-image-caption-number"><!-- react-text: 48400 --> <!-- /react-text --><!-- react-text: 48401 -->5<!-- /react-text --></span><span>:</span></span><editarea class="image-caption text-mode" style="min-width: 50px; display: inline;"><line class="text-mode align-center" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><block>CI/CD pipeline, </block><block class="role-hyper-link" data-hyper-link-url="https://github.com/databrickslabs/cicd-templates" style="text-decoration: underline; color: rgb(17, 85, 204); font-weight: bold; background-color: rgb(255, 254, 0);"><a href="https://github.com/databrickslabs/cicd-templates" target="_blank" style="color: inherit; text-decoration: inherit;">See CI/CD Templates for a starting point</a></block></blocks></line></editarea></span></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">[</block><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><compositeblock dir="ltr" class="anchor-tag-ref inline" style="font-family: &quot;Computer Modern Serif&quot;, serif;"><a href="#n0.3295185310066928" style="color: inherit; text-decoration: inherit;">Back To Top</a></compositeblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">]</block></blocks></line><line class="root text-mode selected" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode section sindent-2" style="line-height: 1.4; font-size: 1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold;" data-line-id="n0.8743328437366753" id="n0.8743328437366753" role="heading" aria-level="3"><prefix style="text-align: left; padding-right: 0em;">13.1.1. </prefix><blocks><baselineblock class="inline"></baselineblock><block>Implementation for Streaming </block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Here we simulate a streaming data to showcase a Streaming Deployment.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix style=""></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> pyspark</block><block class="punctuation token">.</block><block class=" token">ml</block><block class="punctuation token">.</block><block class=" token">pipeline </block><block class="keyword token">import</block><block class=" token"> PipelineModel</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">pipeline_path </block><block class="operator token">=</block><block class=" token"> </block><block class="string-interpolation string token">f"</block><block class="string-interpolation interpolation punctuation token">{</block><block class="string-interpolation interpolation token">DA</block><block class="string-interpolation interpolation punctuation token">.</block><block class="string-interpolation interpolation token">paths</block><block class="string-interpolation interpolation punctuation token">.</block><block class="string-interpolation interpolation token">datasets</block><block class="string-interpolation interpolation punctuation token">}</block><block class="string-interpolation string token">/airbnb/sf-listings/models/sf-listings-2019-03-06/pipeline_model"</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">pipeline_model </block><block class="operator token">=</block><block class=" token"> PipelineModel</block><block class="punctuation token">.</block><block class=" token">load</block><block class="punctuation token">(</block><block class=" token">pipeline_path</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">repartitioned_path </block><block class="operator token">=</block><block class=" token">  </block><block class="string-interpolation string token">f"</block><block class="string-interpolation interpolation punctuation token">{</block><block class="string-interpolation interpolation token">DA</block><block class="string-interpolation interpolation punctuation token">.</block><block class="string-interpolation interpolation token">paths</block><block class="string-interpolation interpolation punctuation token">.</block><block class="string-interpolation interpolation token">datasets</block><block class="string-interpolation interpolation punctuation token">}</block><block class="string-interpolation string token">/airbnb/sf-listings/sf-listings-2019-03-06-clean-100p.parquet/"</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">schema </block><block class="operator token">=</block><block class=" token"> spark</block><block class="punctuation token">.</block><block class=" token">read</block><block class="punctuation token">.</block><block class=" token">parquet</block><block class="punctuation token">(</block><block class=" token">repartitioned_path</block><block class="punctuation token">)</block><block class="punctuation token">.</block><block class=" token">schema</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Simulating streaming data</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Note: You must specify a schema when creating a streaming source DataFrame.</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">streaming_data </block><block class="operator token">=</block><block class=" token"> </block><block class="punctuation token">(</block><block class=" token">spark</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">                 </block><block class="punctuation token">.</block><block class=" token">readStream</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">                 </block><block class="punctuation token">.</block><block class=" token">schema</block><block class="punctuation token">(</block><block class=" token">schema</block><block class="punctuation token">)</block><block class=" token"> </block><block class="comment token"># Can set the schema this way</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">                 </block><block class="punctuation token">.</block><block class=" token">option</block><block class="punctuation token">(</block><block class="string token">"maxFilesPerTrigger"</block><block class="punctuation token">,</block><block class=" token"> </block><block class="number token">1</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">                 </block><block class="punctuation token">.</block><block class=" token">parquet</block><block class="punctuation token">(</block><block class=" token">repartitioned_path</block><block class="punctuation token">)</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Prediction</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">stream_pred </block><block class="operator token">=</block><block class=" token"> pipeline_model</block><block class="punctuation token">.</block><block class=" token">transform</block><block class="punctuation token">(</block><block class=" token">streaming_data</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Save results</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">import</block><block class=" token"> re</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">checkpoint_dir </block><block class="operator token">=</block><block class=" token"> </block><block class="string-interpolation string token">f"</block><block class="string-interpolation interpolation punctuation token">{</block><block class="string-interpolation interpolation token">DA</block><block class="string-interpolation interpolation punctuation token">.</block><block class="string-interpolation interpolation token">paths</block><block class="string-interpolation interpolation punctuation token">.</block><block class="string-interpolation interpolation token">working_dir</block><block class="string-interpolation interpolation punctuation token">}</block><block class="string-interpolation string token">/stream_checkpoint"</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Clear out the checkpointing directory</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">dbutils</block><block class="punctuation token">.</block><block class=" token">fs</block><block class="punctuation token">.</block><block class=" token">rm</block><block class="punctuation token">(</block><block class=" token">checkpoint_dir</block><block class="punctuation token">,</block><block class=" token"> </block><block class="boolean token">True</block><block class="punctuation token">)</block><block class=" token"> </block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">query </block><block class="operator token">=</block><block class=" token"> </block><block class="punctuation token">(</block><block class=" token">stream_pred</block><block class="punctuation token">.</block><block class=" token">writeStream</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">                    </block><block class="punctuation token">.</block><block class="builtin token">format</block><block class="punctuation token">(</block><block class="string token">"memory"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">                    </block><block class="punctuation token">.</block><block class=" token">option</block><block class="punctuation token">(</block><block class="string token">"checkpointLocation"</block><block class="punctuation token">,</block><block class=" token"> checkpoint_dir</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">                    </block><block class="punctuation token">.</block><block class=" token">outputMode</block><block class="punctuation token">(</block><block class="string token">"append"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">                    </block><block class="punctuation token">.</block><block class=" token">queryName</block><block class="punctuation token">(</block><block class="string token">"pred_stream"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">                    </block><block class="punctuation token">.</block><block class=" token">start</block><block class="punctuation token">(</block><block class="punctuation token">)</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># ------</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Let's checkout the streaming data</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Note: You can also look at the new "Structured Streaming" tab in Spark UI.</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="operator token">%</block><block class=" token">sql </block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">select </block><block class="operator token">*</block><block class=" token"> </block><block class="keyword token">from</block><block class=" token"> pred_stream</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="operator token">%</block><block class=" token">sql</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">select count</block><block class="punctuation token">(</block><block class="operator token">*</block><block class="punctuation token">)</block><block class=" token"> </block><block class="keyword token">from</block><block class=" token"> pred_stream</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># ------</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Stop the stream</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">for</block><block class=" token"> stream </block><block class="keyword token">in</block><block class=" token"> spark</block><block class="punctuation token">.</block><block class=" token">streams</block><block class="punctuation token">.</block><block class=" token">active</block><block class="punctuation token">:</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    </block><block class="keyword token">print</block><block class="punctuation token">(</block><block class="string-interpolation string token">f"Stopping </block><block class="string-interpolation interpolation punctuation token">{</block><block class="string-interpolation interpolation token">stream</block><block class="string-interpolation interpolation punctuation token">.</block><block class="string-interpolation interpolation token">name</block><block class="string-interpolation interpolation punctuation token">}</block><block class="string-interpolation string token">"</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    stream</block><block class="punctuation token">.</block><block class=" token">stop</block><block class="punctuation token">(</block><block class="punctuation token">)</block><block class=" token">             </block><block class="comment token"># Stop the active stream</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">    stream</block><block class="punctuation token">.</block><block class=" token">awaitTermination</block><block class="punctuation token">(</block><block class="punctuation token">)</block><block class=" token"> </block><block class="comment token"># Wait for it to actually stop</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 701px; height: 249.98px; position: relative;"><img src="image-resources/e0305ad4-418e-4542-bb65-0faa60a47f33.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px;"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">[</block><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><compositeblock dir="ltr" class="anchor-tag-ref inline" style="font-family: &quot;Computer Modern Serif&quot;, serif;"><a href="#n0.3295185310066928" style="color: inherit; text-decoration: inherit;">Back To Top</a></compositeblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">]</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode section sindent-2" style="line-height: 1.4; font-size: 1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold;" data-line-id="n0.7184364997892669" id="n0.7184364997892669" role="heading" aria-level="3"><prefix style="text-align: left; padding-right: 0em;">13.1.2. </prefix><blocks><baselineblock class="inline"></baselineblock><block>What About Model Export?</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; font-weight: bold;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; text-decoration: underline; color: rgb(17, 85, 204);" class="role-hyper-link" data-hyper-link-url="https://onnx.ai/"><a href="https://onnx.ai/" target="_blank" style="color: inherit; text-decoration: inherit;">ONNX</a></block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; color: rgb(255, 64, 0);">ONNX</block><block> is very popular in the deep learning community allowing developers to switch between libraries and languages, but only has experimental support for MLlib.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; font-weight: bold;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold;">DIY (Reimplement it yourself)</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Error-prone, fragile</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; font-weight: bold;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold;">3rd party libraries</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>See XGBoost notebook</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block class="role-hyper-link" data-hyper-link-url="https://www.h2o.ai/products/h2o-sparkling-water/" style="text-decoration: underline; color: rgb(17, 85, 204);"><a href="https://www.h2o.ai/products/h2o-sparkling-water/" target="_blank" style="color: inherit; text-decoration: inherit;">H2O</a></block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix style=""></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode section sindent-2" style="line-height: 1.4; font-size: 1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold;" data-line-id="n0.5817757556183147" id="n0.5817757556183147" role="heading" aria-level="3"><prefix style="text-align: left; padding-right: 0em;">13.1.3. </prefix><blocks><baselineblock class="inline"></baselineblock><block>Low-Latency Serving Solution</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Low-latency serving can operate as quickly as tens to hundreds of milliseconds. </block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Custom solutions are normally backed by Docker and/or Flask (though Flask generally isn't recommended in production unless significant precautions are taken). </block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Managed solutions also include:</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block class="role-hyper-link" data-hyper-link-url="https://docs.databricks.com/applications/mlflow/model-serving.html" style="text-decoration: underline; color: rgb(17, 85, 204);"><a href="https://docs.databricks.com/applications/mlflow/model-serving.html" target="_blank" style="color: inherit; text-decoration: inherit;">MLflow Model Serving</a></block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block class="role-hyper-link" data-hyper-link-url="https://azure.microsoft.com/en-us/services/machine-learning/" style="text-decoration: underline; color: rgb(17, 85, 204);"><a href="https://azure.microsoft.com/en-us/services/machine-learning/" target="_blank" style="color: inherit; text-decoration: inherit;">Azure Machine Learning</a></block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block class="role-hyper-link" data-hyper-link-url="https://aws.amazon.com/sagemaker/" style="text-decoration: underline; color: rgb(17, 85, 204);"><a href="https://aws.amazon.com/sagemaker/" target="_blank" style="color: inherit; text-decoration: inherit;">SageMaker</a></block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">[</block><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><compositeblock dir="ltr" class="anchor-tag-ref inline" style="font-family: &quot;Computer Modern Serif&quot;, serif;"><a href="#n0.3295185310066928" style="color: inherit; text-decoration: inherit;">Back To Top</a></compositeblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">]</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode section sindent-1" data-line-id="n0.36613668523710596" style="font-size: 1.1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.36613668523710596" role="heading" aria-level="2"><prefix style="text-align: left; padding-right: 0.25em;">13.2. </prefix><blocks><baselineblock class="inline"></baselineblock><block>Bamboolib</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block class="role-hyper-link" data-hyper-link-url="https://docs.databricks.com/notebooks/bamboolib.html" style="text-decoration: underline; color: rgb(17, 85, 204); font-weight: bold;"><a href="https://docs.databricks.com/notebooks/bamboolib.html" target="_blank" style="color: inherit; text-decoration: inherit;">Bamboolib</a></block><block> is a low-code tool that accelerates Exploratory Data Analysis (EDA) and exploration with visual tools, as well as the ability to output code needed to perform the analysis after completion.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>We need to install bamboolib before we can use it  </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">pip install bamboolib</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; font-weight: bold;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold;">Let's explore the AirBnB dataset with bamboolib:</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="font-weight: bold; flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Bamboolib works directly with pandas dataframes, so we'll load the San Francisco Airbnb dataset and pull it into pandas for exploration.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">file_path </block><block class="operator token">=</block><block class=" token"> </block><block class="string-interpolation string token">f"</block><block class="string-interpolation interpolation punctuation token">{</block><block class="string-interpolation interpolation token">DA</block><block class="string-interpolation interpolation punctuation token">.</block><block class="string-interpolation interpolation token">paths</block><block class="string-interpolation interpolation punctuation token">.</block><block class="string-interpolation interpolation token">datasets</block><block class="string-interpolation interpolation punctuation token">}</block><block class="string-interpolation string token">/airbnb/sf-listings/sf-listings-2019-03-06-clean.delta/"</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">airbnb_pd </block><block class="operator token">=</block><block class=" token"> spark</block><block class="punctuation token">.</block><block class=" token">read</block><block class="punctuation token">.</block><block class="builtin token">format</block><block class="punctuation token">(</block><block class="string token">"delta"</block><block class="punctuation token">)</block><block class="punctuation token">.</block><block class=" token">load</block><block class="punctuation token">(</block><block class=" token">file_path</block><block class="punctuation token">)</block><block class="punctuation token">.</block><block class=" token">toPandas</block><block class="punctuation token">(</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">import</block><block class=" token"> pandas </block><block class="keyword token">as</block><block class=" token"> pd</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">import</block><block class=" token"> bamboolib </block><block class="keyword token">as</block><block class=" token"> bam</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix style=""></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Suppose we want to fit a Linear Regression to the </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">price</block><block> column. </block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Let's use bamboolib to explore our dataset and find the right regressors to include in the model.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>There are </block><block style="text-decoration: underline;">two main ways to access the bamboolib interface</block><block>. </block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>The first is a button which appears above any printed Pandas DataFrame.</block></blocks></line><line class="root text-mode indent-2 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="3"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;">* </prefix><blocks><baselineblock class="inline"></baselineblock><block>Use the following cell to print </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">airbnb_pd</block><block> and click the green </block><block style="font-weight: bold; color: rgb(78, 166, 78);">"Show bamboolib UI"</block><block> button to access the bamboo GUI.</block></blocks></line><line class="root text-mode indent-2 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="3"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;">* </prefix><blocks><baselineblock class="inline"></baselineblock><block>Click the </block><block style="font-weight: bold; color: rgb(78, 166, 78);">"Explore DataFrame"</block><block> button. </block></blocks></line><line class="root text-mode indent-3 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Notice that we can see some summary values associated with each column of our DataFrame.</block></blocks></line><line class="root text-mode indent-2 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="3"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;">* </prefix><blocks><baselineblock class="inline"></baselineblock><block>We're interested in predicting the price column, so click on the row that corresponds to </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">price</block><block>.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>The </block><block style="font-weight: bold; color: rgb(78, 166, 78);">"Overview"</block><block> subtab for </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">price</block><block> will appear automatically with some summary statistics and a Histogram. You may notice the </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">price</block><block> values are heavily right skewed.</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Click on the </block><block style="font-weight: bold; color: rgb(78, 166, 78);">"Predictors"</block><block> tab to see the </block><block style="font-weight: bold; color: rgb(251, 111, 117);">Predictive Power Score (PPS)</block><block> for each variable regressed against price. </block></blocks></line><line class="root text-mode indent-2 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="3"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;">* </prefix><blocks><baselineblock class="inline"></baselineblock><block>The </block><block style="font-style: italic;">PPS</block><block> ranges from 0 (low predictive power) to 1 (high predictive power). </block></blocks></line><line class="root text-mode indent-2 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="3"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;">* </prefix><blocks><baselineblock class="inline"></baselineblock><block>The highest Predictor in the dataset is bedrooms though only has a score of 0.139. </block></blocks></line><line class="root text-mode indent-2 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="3"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;">* </prefix><blocks><baselineblock class="inline"></baselineblock><block>Let's take a closer look at the relationship between </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">price</block><block> and </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">bedrooms</block><block>.</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Click the </block><block style="font-weight: bold; color: rgb(78, 166, 78);">"Bivariate Plots"</block><block> subtab and select </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">price</block><block> and </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">bedrooms</block><block> as the plotting variables.</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Click on </block><block style="font-weight: bold; color: rgb(78, 166, 78);">"B predicts A"</block><block> and look at the Scatter plot. </block></blocks></line><line class="root text-mode indent-2 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="3"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;">* </prefix><blocks><baselineblock class="inline"></baselineblock><block>Here we can see a general linear trend that as the number of bedrooms increases the price of the Airbnb increases as well. </block></blocks></line><line class="root text-mode indent-2 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="3"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;">* </prefix><blocks><baselineblock class="inline"></baselineblock><block>However, we can also see there are some very expensive outliers!</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>We may be able to better fit the data by considering the log(price) rather than the price itself. </block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix style=""></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 722.75px; height: 390.58px; position: relative;"><img src="image-resources/66170bd5-aa86-4030-82c8-254bd037c9e8.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px; border: 1px solid rgb(0, 0, 0);"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 726.812px; height: 500.6px; position: relative;"><img src="image-resources/4bebbecd-6840-45bf-9356-a50765e9c090.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px; border: 1px solid rgb(0, 0, 0);"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 725.125px; height: 666.42px; position: relative;"><img src="image-resources/83d9e02f-77bb-4c89-b5b9-c2deebb6f24e.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px; border: 1px solid rgb(0, 0, 0);"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 725.5px; height: 550.63px; position: relative;"><img src="image-resources/aaa07557-9e20-45b2-85b4-9d64f409460f.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px; border: 1px solid rgb(0, 0, 0);"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 722.75px; height: 818.89px; position: relative;"><img src="image-resources/0ae96c02-e936-42ec-9573-cc48a43fc74d.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px; border: 1px solid rgb(0, 0, 0);"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 726.5px; height: 669.81px; position: relative;"><img src="image-resources/6936568e-f3d2-401e-9745-fb1c714f81be.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px; border: 1px solid rgb(0, 0, 0);"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">[</block><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><compositeblock dir="ltr" class="anchor-tag-ref inline" style="font-family: &quot;Computer Modern Serif&quot;, serif;"><a href="#n0.3295185310066928" style="color: inherit; text-decoration: inherit;">Back To Top</a></compositeblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">]</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode section sindent-2" style="line-height: 1.4; font-size: 1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold;" data-line-id="n0.5724343218086387" id="n0.5724343218086387" role="heading" aria-level="3"><prefix style="text-align: left; padding-right: 0em;">13.2.1. </prefix><blocks><baselineblock class="inline"></baselineblock><block>Create a New Variable with Bamboolib</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Let's look at how to add a new variable to our data as we start to clean and prepare our dataset for our machine learning model.</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>In the </block><block style="font-weight: bold; color: rgb(78, 166, 78);">"Search actions"</block><block> box type </block><block style="font-weight: bold; color: rgb(251, 111, 117);">"formula"</block><block> and click on the option </block><block style="font-weight: bold; color: rgb(251, 111, 117);">"New Column Formula"</block><block> which will open a side-box popup. </block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>For the column name type </block><block style="font-weight: bold; font-family: &quot;Courier New&quot;, Courier, monospace;">log_price</block><block> and for the column formula use </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">np.log(price)</block><block> and click the </block><block style="font-weight: bold; color: rgb(251, 111, 117);">"Execute"</block><block> button.</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Click on the </block><block style="font-weight: bold; color: rgb(78, 166, 78);">"Explore DataFrame"</block><block> button and select the row associated with </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">log_price</block><block>.</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Click the </block><block style="font-weight: bold; color: rgb(78, 166, 78);">"Predictors"</block><block> subtab. </block></blocks></line><line class="root text-mode indent-2 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="3"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;">* </prefix><blocks><baselineblock class="inline"></baselineblock><block>Notice that the variable accommodates now has a PPS of 0.243, a major improvement over our best previous score of 0.139! You should see that </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">price</block><block> has almost a perfect PPS for log_price, that's expected.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix style=""></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 723.75px; height: 499.56px; position: relative;"><img src="image-resources/e35362f8-067e-4b6b-820e-4e19cf3dc36d.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px; border: 1px solid rgb(0, 0, 0);"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 724px; height: 405.79px; position: relative;"><img src="image-resources/2d2b097b-9733-4de6-abe8-6acd9b779d43.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px; border: 1px solid rgb(0, 0, 0);"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">[</block><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><compositeblock dir="ltr" class="anchor-tag-ref inline" style="font-family: &quot;Computer Modern Serif&quot;, serif;"><a href="#n0.3295185310066928" style="color: inherit; text-decoration: inherit;">Back To Top</a></compositeblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">]</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode section sindent-2" style="line-height: 1.4; font-size: 1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold;" data-line-id="n0.5820873974912124" id="n0.5820873974912124" role="heading" aria-level="3"><prefix style="text-align: left; padding-right: 0em;">13.2.2. </prefix><blocks><baselineblock class="inline"></baselineblock><block>Inspect Correlation Matrix</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Other variables have better scores as well. There are high scores for </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">bedrooms</block><block>, </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">beds</block><block>, </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">room_type</block><block>, </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">host_total_listings_count</block><block>, and </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">bathrooms</block><block>, but might these variables be correlated with </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">accommodates</block><block>? </block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>If so, we shouldn't include all of them in our model because we would introduce </block><block style="text-decoration: underline;">multicollinearity</block><block>. Let's investigate!</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Go to the </block><block style="font-weight: bold; color: rgb(78, 166, 78);">"Exploration"</block><block> tab and select the </block><block style="font-weight: bold; color: rgb(251, 111, 117);">"Correlation Matrix"</block><block> subtab.</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>In the </block><block style="font-weight: bold; color: rgb(251, 111, 117);">"Show"</block><block> box select the variables </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">accommodates</block><block>, </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">bedrooms</block><block>, </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">beds</block><block>, </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">host_total_listings_count</block><block>, and </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">bathrooms</block><block> (we can't select </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">room_type</block><block> for correlation as it is categorical), and click the </block><block style="font-weight: bold; color: rgb(251, 111, 117);">Update</block><block> button.</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Use your cursor to hover over the heatmap and examine the Pearson correlation of accomodates with each of the other variables. </block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>If we include </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">accommodates</block><block> in our model we should leave out </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">bedrooms</block><block> and </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">beds</block><block> as they have high correlation values above 0.75. </block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>However, the correlations with </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">bathrooms</block><block> and </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">host_total_listings_count</block><block> are pretty weak at 0.35 and -0.03, so these are safe to include in our model.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix style=""></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 734px; height: 405.5px; position: relative;"><img src="image-resources/8f084d9d-fa1a-4c1d-8b38-31a10bf4bedc.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px; border: 1px solid rgb(0, 0, 0);"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">[</block><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><compositeblock dir="ltr" class="anchor-tag-ref inline" style="font-family: &quot;Computer Modern Serif&quot;, serif;"><a href="#n0.3295185310066928" style="color: inherit; text-decoration: inherit;">Back To Top</a></compositeblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">]</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode section sindent-2" style="line-height: 1.4; font-size: 1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold;" data-line-id="n0.9832233931808989" id="n0.9832233931808989" role="heading" aria-level="3"><prefix style="text-align: left; padding-right: 0em;">13.2.3. </prefix><blocks><baselineblock class="inline"></baselineblock><block>Prepare Data for Training</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; font-weight: bold;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold;">Drop and transform columns</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>One of the columns which was of interest in the last cell but was categorical was the </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">room_type</block><block> column. </block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Use the </block><block style="font-weight: bold; color: rgb(78, 166, 78);">"Explore DataFrame"</block><block> button and view the details of this column. </block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>There are 3 distinct values: </block></blocks></line><line class="root text-mode indent-2 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="3"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;">* </prefix><blocks><baselineblock class="inline"></baselineblock><block>Entire home/apt, Private room, and Shared room. </block></blocks></line><line class="root text-mode indent-2 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="3"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;">* </prefix><blocks><baselineblock class="inline"></baselineblock><block>The value of this categorical variable could be encoded as an </block><block style="font-weight: bold;">Ordinal Variable</block><block> since they </block><block style="text-decoration: underline;">have a natural order of preference</block><block>. </block></blocks></line><line class="root text-mode indent-2 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="3"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;">* </prefix><blocks><baselineblock class="inline"></baselineblock><block>Highest preference for most people would be to have additional privacy. </block></blocks></line><line class="root text-mode indent-2 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="3"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;">* </prefix><blocks><baselineblock class="inline"></baselineblock><block>Let's create a new column to represent this.</block></blocks></line><line class="root text-mode indent-3 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>In the search actions box type </block><block style="font-weight: bold; color: rgb(251, 111, 117);">"drop"</block><block> and click </block><block style="font-weight: bold; color: rgb(251, 111, 117);">"Select or drop columns"</block><block>.</block></blocks></line><line class="root text-mode indent-3 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Select </block><block style="font-weight: bold; color: rgb(251, 111, 117);">"Drop"</block><block> in the </block><block style="font-weight: bold; color: rgb(251, 111, 117);">"Choose"</block><block> pop up box and specify the following columns to drop: </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">bedrooms</block><block>, </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">beds</block><block>, and </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">price</block><block>.</block></blocks></line><line class="root text-mode indent-3 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Specify </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">airbnb_reduced</block><block> as the new dataframe name.</block></blocks></line><line class="root text-mode indent-3 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Click </block><block style="font-weight: bold; color: rgb(78, 166, 78);">"Explore DataFrame"</block><block>.</block></blocks></line><line class="root text-mode indent-3 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Under the </block><block style="font-weight: bold; color: rgb(251, 111, 117);">"Data"</block><block> tab select </block><block style="font-weight: bold; color: rgb(251, 111, 117);">"New Column Formula"</block><block> in the </block><block style="font-weight: bold; color: rgb(251, 111, 117);">"Search actions box"</block><block>. </block></blocks></line><line class="root text-mode indent-3 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Name your new variable </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">room_type_ord</block><block>.</block></blocks></line><line class="root text-mode indent-3 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>For the formula we'll map the strings to integer values of increasing order with this formula; </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">room_type.map({"Shared room" : 0, "Private room" : 1, "Entire home/apt" : 2})</block></blocks></line><line class="root text-mode indent-3 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Click </block><block style="font-weight: bold; color: rgb(251, 111, 117);">"Execute"</block><block>.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix style=""></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 729.5px; height: 322.2px; position: relative;"><img src="image-resources/afb1ca34-b765-481b-967b-eb3239d5ef69.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px; border: 1px solid rgb(0, 0, 0);"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 731.125px; height: 538.65px; position: relative;"><img src="image-resources/1886ac15-df7d-4c6f-9dce-5c90f7b2cfa4.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px; border: 1px solid rgb(0, 0, 0);"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 734px; height: 565.35px; position: relative;"><img src="image-resources/9aa30f41-2419-4aef-a048-8b10f4e8b92b.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px; border: 1px solid rgb(0, 0, 0);"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">[</block><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><compositeblock dir="ltr" class="anchor-tag-ref inline" style="font-family: &quot;Computer Modern Serif&quot;, serif;"><a href="#n0.3295185310066928" style="color: inherit; text-decoration: inherit;">Back To Top</a></compositeblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">]</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode section sindent-2" style="line-height: 1.4; font-size: 1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold;" data-line-id="n0.9820341424783694" id="n0.9820341424783694" role="heading" aria-level="3"><prefix style="text-align: left; padding-right: 0em;">13.2.4. </prefix><blocks><baselineblock class="inline"></baselineblock><block>Build Training Data</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>We'll use bamboolib to select the following columns for training: </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">accommodation</block><block>, </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">room_type_ord</block><block>, </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">host_total_listings_count</block><block>, and </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">bathrooms</block><block> to predict </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">log_price</block><block>.</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>To build our training dataset:</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Print again the </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">airbnb_pd</block><block> DataFrame to open the bamboolib GUI.</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>In the search actions box type </block><block style="font-weight: bold; color: rgb(251, 111, 117);">"drop"</block><block> and click </block><block style="font-weight: bold; color: rgb(251, 111, 117);">"Select or drop columns"</block><block>.</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Choose: </block><block style="font-weight: bold; color: rgb(251, 111, 117);">Select</block><block>.</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Select following columns; </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">accommodates</block><block>, </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">room_type_ord</block><block>, </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">host_total_listings_count</block><block>, </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">bathrooms</block><block>, </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">log_price</block><block>.</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Change the New dataframe name to </block><block style="font-family: &quot;Courier New&quot;, Courier, monospace; font-weight: bold;">airbnb_training</block><block>.</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Click </block><block style="font-weight: bold; color: rgb(251, 111, 117);">"Execute"</block><block> button.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode full-line-block-inside" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="image-container no-cursor-selected no-editor"><image-viewer class=""><image-container class="center"><div class="image-content" style="width: 702.062px; height: 505.29px; position: relative;"><img src="image-resources/390f088b-b1de-48a2-adf1-c00e04e53a3b.png" style="width: 100%; height: 100%; box-sizing: border-box; border-radius: 0px; border: 1px solid rgb(0, 0, 0);"></div></image-container></image-viewer><div style="display: none;"></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item full-line-block-inside" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><compositeblock dir="ltr" class="code-section-symbol inline" style="display: block;"><div class="code-section theme-default" style="display: block; border: 1px solid lightgray; background: rgb(238, 238, 237); padding: 10px; font-size: 12px;"><editarea class="text-mode code-section-edit-area" style="font-family: &quot;Fira code&quot;, &quot;Fira Mono&quot;, monospace;"><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> sklearn</block><block class="punctuation token">.</block><block class=" token">linear_model </block><block class="keyword token">import</block><block class=" token"> LinearRegression</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> sklearn</block><block class="punctuation token">.</block><block class=" token">metrics </block><block class="keyword token">import</block><block class=" token"> mean_squared_error</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">from</block><block class=" token"> sklearn</block><block class="punctuation token">.</block><block class=" token">model_selection </block><block class="keyword token">import</block><block class=" token"> train_test_split</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># We have our full dataset, let's split it into features and target</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">X </block><block class="operator token">=</block><block class=" token"> airbnb_training</block><block class="punctuation token">.</block><block class=" token">copy</block><block class="punctuation token">(</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">y </block><block class="operator token">=</block><block class=" token"> X</block><block class="punctuation token">.</block><block class=" token">pop</block><block class="punctuation token">(</block><block class="string token">'log_price'</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Let's split our data to training and testing</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">X_train</block><block class="punctuation token">,</block><block class=" token"> X_test</block><block class="punctuation token">,</block><block class=" token"> y_train</block><block class="punctuation token">,</block><block class=" token"> y_test </block><block class="operator token">=</block><block class=" token"> train_test_split</block><block class="punctuation token">(</block><block class=" token">X</block><block class="punctuation token">,</block><block class=" token"> y</block><block class="punctuation token">,</block><block class=" token"> test_size</block><block class="operator token">=</block><block class="number token">0.15</block><block class="punctuation token">,</block><block class=" token"> random_state</block><block class="operator token">=</block><block class="number token">42</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">model </block><block class="operator token">=</block><block class=" token"> LinearRegression</block><block class="punctuation token">(</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">model </block><block class="operator token">=</block><block class=" token"> model</block><block class="punctuation token">.</block><block class=" token">fit</block><block class="punctuation token">(</block><block class=" token">X_train</block><block class="punctuation token">,</block><block class=" token"> y_train</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># Now we can test on test data</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">y_pred </block><block class="operator token">=</block><block class=" token"> model</block><block class="punctuation token">.</block><block class=" token">predict</block><block class="punctuation token">(</block><block class=" token">X_test</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class=" token">mse </block><block class="operator token">=</block><block class=" token"> mean_squared_error</block><block class="punctuation token">(</block><block class=" token">y_test</block><block class="punctuation token">,</block><block class=" token"> y_pred</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="keyword token">print</block><block class="punctuation token">(</block><block class=" token">mse</block><block class="punctuation token">)</block></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="text-mode code-section-line"><prefix></prefix><blocks class="code-line-blocks-container"><baselineblock></baselineblock><block class="comment token"># 0.2396601660150462</block></blocks></line></editarea></div></compositeblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">[</block><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><compositeblock dir="ltr" class="anchor-tag-ref inline" style="font-family: &quot;Computer Modern Serif&quot;, serif;"><a href="#n0.3295185310066928" style="color: inherit; text-decoration: inherit;">Back To Top</a></compositeblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">]</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode section sindent-1" data-line-id="n0.027357693111814463" style="font-size: 1.1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold; line-height: 1.4;" id="n0.027357693111814463" role="heading" aria-level="2"><prefix style="text-align: left; padding-right: 0.25em;">13.3. </prefix><blocks><baselineblock class="inline"></baselineblock><block>Databricks Best Practices</block></blocks></line><line class="root text-mode section sindent-2" style="line-height: 1.4; font-size: 1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold;" data-line-id="n0.24378046449774127" id="n0.24378046449774127" role="heading" aria-level="3"><prefix style="text-align: left; padding-right: 0em;">13.3.1. </prefix><blocks><baselineblock class="inline"></baselineblock><block>Slow-Running Jobs</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; font-weight: bold;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold;">The most common issues with slow-running jobs are:</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; color: rgb(255, 64, 0);">Spill</block><block>  Data is exhausting the cluster's memory and is spilling onto the disk. </block></blocks></line><line class="root text-mode indent-2 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="3"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;">* </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; color: rgb(78, 166, 78);">Resolution</block><block>  a cluster with more memory resources</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; color: rgb(255, 64, 0);">Shuffle</block><block>: Large amounts of data are being transferred across the cluster. </block></blocks></line><line class="root text-mode indent-2 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="3"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;">* </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; color: rgb(78, 166, 78);">Resolution</block><block>: optimize joins or refactor code to avoid shuffles</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; color: rgb(255, 64, 0);">Skew/Stragglers</block><block>: Partitioned data (in files or in memory) is skewed causing the "curse of the last reducer" where some partitions take longer to run. </block></blocks></line><line class="root text-mode indent-2 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="3"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;">* </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; color: rgb(78, 166, 78);">Resolution</block><block>: repartition to a multiple of the available cores or use skew hints</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; color: rgb(255, 64, 0);">Small/Large Files</block><block>: Too many small files are exhausting cluster resources since each file read needs its own thread or a few large files are causing unused threads. </block></blocks></line><line class="root text-mode indent-2 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="3"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;">* </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; color: rgb(78, 166, 78);">Resolution</block><block>: rewrite data in a more optimized way or perform Delta file compaction</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; visibility: hidden;"> </prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; font-weight: bold;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold;">Your debugging toolkit:</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Ganglia for CPU, network, and memory resources at a cluster or node level</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Spark UI for most everything else (especially the storage and executor tabs)</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Driver or worker logs for errors (especially with background processes)</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Notebook tab of the clusters section to see if the intern is hogging your cluster again.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix style=""></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode section sindent-2" style="line-height: 1.4; font-size: 1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold;" data-line-id="n0.20107369954932652" id="n0.20107369954932652" role="heading" aria-level="3"><prefix style="text-align: left; padding-right: 0em;">13.3.2. </prefix><blocks><baselineblock class="inline"></baselineblock><block>Data Access and Security</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>A few notes on data access:</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block class="role-hyper-link" data-hyper-link-url="https://docs.databricks.com/data/databricks-file-system.html#mount-storage" style="text-decoration: underline; color: rgb(17, 85, 204);"><a href="https://docs.databricks.com/data/databricks-file-system.html#mount-storage" target="_blank" style="color: inherit; text-decoration: inherit;">Mount data for easy access</a></block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block class="role-hyper-link" data-hyper-link-url="https://docs.databricks.com/dev-tools/cli/secrets-cli.html#secrets-cli" style="text-decoration: underline; color: rgb(17, 85, 204);"><a href="https://docs.databricks.com/dev-tools/cli/secrets-cli.html#secrets-cli" target="_blank" style="color: inherit; text-decoration: inherit;">Use secrets to secure credentials</a></block><block> (this keeps credentials out of the code)</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Credentials pass-through works in </block><block class="role-hyper-link" data-hyper-link-url="https://docs.databricks.com/dev-tools/cli/secrets-cli.html#secrets-cli" style="text-decoration: underline; color: rgb(17, 85, 204);"><a href="https://docs.databricks.com/dev-tools/cli/secrets-cli.html#secrets-cli" target="_blank" style="color: inherit; text-decoration: inherit;">AWS</a></block><block> and </block><block class="role-hyper-link" data-hyper-link-url="https://docs.microsoft.com/en-us/azure/databricks/security/credential-passthrough/adls-passthrough" style="text-decoration: underline; color: rgb(17, 85, 204);"><a href="https://docs.microsoft.com/en-us/azure/databricks/security/credential-passthrough/adls-passthrough" target="_blank" style="color: inherit; text-decoration: inherit;">Azure</a></block><block>.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix style=""></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode section sindent-2" style="line-height: 1.4; font-size: 1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold;" data-line-id="n0.3837809059145951" id="n0.3837809059145951" role="heading" aria-level="3"><prefix style="text-align: left; padding-right: 0em;">13.3.3. </prefix><blocks><baselineblock class="inline"></baselineblock><block>Cluster Configuration, Libraries, and Jobs</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; font-weight: bold;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold;">Cluster types are:</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; color: rgb(0, 0, 0);"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; color: rgb(255, 64, 0);">Memory-optimized</block><block> (with or without </block><block class="role-hyper-link" data-hyper-link-url="https://docs.databricks.com/delta/optimizations/delta-cache.html" style="text-decoration: underline; color: rgb(17, 85, 204);"><a href="https://docs.databricks.com/delta/optimizations/delta-cache.html" target="_blank" style="color: inherit; text-decoration: inherit;">Delta Cache Acceleration</a></block><block>)</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; font-weight: bold; color: rgb(0, 0, 0);"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; color: rgb(255, 64, 0);">Compute-optimized</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; font-weight: bold; color: rgb(0, 0, 0);"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; color: rgb(255, 64, 0);">Storage optimized</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; font-weight: bold; color: rgb(0, 0, 0);"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; color: rgb(255, 64, 0);">GPU accelerated</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; font-weight: bold; color: rgb(0, 0, 0);"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; color: rgb(255, 64, 0);">General Purpose</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix style=""></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; font-weight: bold;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; background-color: rgb(255, 254, 0);">General rules of thumb:</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Smaller clusters of larger machine types for machine learning</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>One cluster per production workload</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Don't share clusters for ML training (even in dev)</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block class="role-hyper-link" data-hyper-link-url="https://docs.databricks.com/clusters/configure.html" style="text-decoration: underline; color: rgb(17, 85, 204);"><a href="https://docs.databricks.com/clusters/configure.html" target="_blank" style="color: inherit; text-decoration: inherit;">See the docs for more specifics</a></block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix style=""></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; font-weight: bold;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; background-color: rgb(255, 254, 0);">Library installation best practice:</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block class="role-hyper-link" data-hyper-link-url="https://docs.databricks.com/libraries/notebooks-python-libraries.html" style="text-decoration: underline; color: rgb(17, 85, 204);"><a href="https://docs.databricks.com/libraries/notebooks-python-libraries.html" target="_blank" style="color: inherit; text-decoration: inherit;">Notebook-scoped Python libraries</a></block><block> ensure users on the same cluster can have different libraries. Also good for saving notebooks with their library dependencies</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block class="role-hyper-link" data-hyper-link-url="https://docs.databricks.com/clusters/init-scripts.html" style="text-decoration: underline; color: rgb(17, 85, 204);"><a href="https://docs.databricks.com/clusters/init-scripts.html" target="_blank" style="color: inherit; text-decoration: inherit;">Init scripts</a></block><block> ensure that code is run before the JVM starts (good for certain libraries or environment configuration)</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Some configuration variables need to be set on the cluster start.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix style=""></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; font-weight: bold;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; background-color: rgb(255, 254, 0);">Jobs best practices:</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Use </block><block class="role-hyper-link" data-hyper-link-url="https://docs.databricks.com/notebooks/notebook-workflows.html" style="text-decoration: underline; color: rgb(17, 85, 204);"><a href="https://docs.databricks.com/notebooks/notebook-workflows.html" target="_blank" style="color: inherit; text-decoration: inherit;">notebook workflows</a></block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block class="role-hyper-link" data-hyper-link-url="https://docs.databricks.com/notebooks/widgets.html" style="text-decoration: underline; color: rgb(17, 85, 204);"><a href="https://docs.databricks.com/notebooks/widgets.html" target="_blank" style="color: inherit; text-decoration: inherit;">Widgets</a></block><block> work for parameter passing</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>You can also run jars and wheels</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Use the CLI for orchestration tools (e.g. Airflow)</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block class="role-hyper-link" data-hyper-link-url="https://docs.databricks.com/jobs.html" style="text-decoration: underline; color: rgb(17, 85, 204);"><a href="https://docs.databricks.com/jobs.html" target="_blank" style="color: inherit; text-decoration: inherit;">See the docs for more specifics</a></block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Always specify a timeout interval to prevent infinitely running jobs</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix style=""></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode section sindent-2" style="line-height: 1.4; font-size: 1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold;" data-line-id="n0.8724143373575128" id="n0.8724143373575128" role="heading" aria-level="3"><prefix style="text-align: left; padding-right: 0em;">13.3.4. </prefix><blocks><baselineblock class="inline"></baselineblock><block>CLI and Version Control</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>The </block><block class="role-hyper-link" data-hyper-link-url="https://github.com/databricks/databricks-cli" style="text-decoration: underline; color: rgb(17, 85, 204);"><a href="https://github.com/databricks/databricks-cli" target="_blank" style="color: inherit; text-decoration: inherit;">Databricks CLI</a></block><block>:</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Programmatically export out all your notebooks to check into GitHub</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Can also import/export data, execute jobs, create clusters, and perform most other Workspace tasks</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix style=""></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left; font-weight: bold;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-weight: bold; background-color: rgb(255, 254, 0);">Git integration can be accomplished in a few ways:</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Use the CLI to import/export notebooks and check into git manually</block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block class="role-hyper-link" data-hyper-link-url="https://docs.databricks.com/notebooks/github-version-control.html" style="text-decoration: underline; color: rgb(17, 85, 204);"><a href="https://docs.databricks.com/notebooks/github-version-control.html" target="_blank" style="color: inherit; text-decoration: inherit;">Use the built-in git integration</a></block></blocks></line><line class="root text-mode indent-1 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="2"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block class="role-hyper-link" data-hyper-link-url="https://www.youtube.com/watch?v=HsfMmBfQtvI" style="text-decoration: underline; color: rgb(17, 85, 204);"><a href="https://www.youtube.com/watch?v=HsfMmBfQtvI" target="_blank" style="color: inherit; text-decoration: inherit;">Use the next-generation workspace for alternative project integration</a></block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix style=""></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode section sindent-2" style="line-height: 1.4; font-size: 1em; padding-top: 0.5em; padding-bottom: 0.5em; font-weight: bold;" data-line-id="n0.5133687557745232" id="n0.5133687557745232" role="heading" aria-level="3"><prefix style="text-align: left; padding-right: 0em;">13.3.5. </prefix><blocks><baselineblock class="inline"></baselineblock><block>Databricks Admin Guide</block></blocks></line><line class="root text-mode indent-0 has-indent list-item" style="line-height: 1.4;" role="listitem" aria-level="1"><prefix style="flex-shrink: 0; min-width: 1em; text-align: left;"> </prefix><blocks><baselineblock class="inline"></baselineblock><block>Explore the </block><block class="role-hyper-link" data-hyper-link-url="https://docs.databricks.com/administration-guide/index.html" style="text-decoration: underline; color: rgb(17, 85, 204);"><a href="https://docs.databricks.com/administration-guide/index.html" target="_blank" style="color: inherit; text-decoration: inherit;">admin console</a></block><block>.</block></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><emptyblock aria-label="empty line"> </emptyblock></blocks></line><line class="root text-mode" style="line-height: 1.4;"><prefix></prefix><blocks><baselineblock class="inline"></baselineblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">[</block><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><compositeblock dir="ltr" class="anchor-tag-ref inline" style="font-family: &quot;Computer Modern Serif&quot;, serif;"><a href="#n0.3295185310066928" style="color: inherit; text-decoration: inherit;">Back To Top</a></compositeblock><block style="font-family: &quot;Computer Modern Serif&quot;, serif;"> </block><block style="font-family: &quot;Computer Modern Serif&quot;, serif; color: rgb(231, 55, 61);">]</block></blocks></line></area-container></editarea><div></div></math-edit-container></math-type></editor-container></body></html>
<!DOCTYPE html><html><head>
      <title>4_build_mcl_in_CPP</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="file:////Users/abakh005/.vscode/extensions/shd101wyy.markdown-preview-enhanced-0.6.3/node_modules/@shd101wyy/mume/dependencies/katex/katex.min.css">
      
      
      
      
      
      
      
      
      
      <style>
      /**
 * prism.js Github theme based on GitHub's theme.
 * @author Sam Clarke
 */
code[class*="language-"],
pre[class*="language-"] {
  color: #333;
  background: none;
  font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.4;

  -moz-tab-size: 8;
  -o-tab-size: 8;
  tab-size: 8;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

/* Code blocks */
pre[class*="language-"] {
  padding: .8em;
  overflow: auto;
  /* border: 1px solid #ddd; */
  border-radius: 3px;
  /* background: #fff; */
  background: #f5f5f5;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
  padding: .1em;
  border-radius: .3em;
  white-space: normal;
  background: #f5f5f5;
}

.token.comment,
.token.blockquote {
  color: #969896;
}

.token.cdata {
  color: #183691;
}

.token.doctype,
.token.punctuation,
.token.variable,
.token.macro.property {
  color: #333;
}

.token.operator,
.token.important,
.token.keyword,
.token.rule,
.token.builtin {
  color: #a71d5d;
}

.token.string,
.token.url,
.token.regex,
.token.attr-value {
  color: #183691;
}

.token.property,
.token.number,
.token.boolean,
.token.entity,
.token.atrule,
.token.constant,
.token.symbol,
.token.command,
.token.code {
  color: #0086b3;
}

.token.tag,
.token.selector,
.token.prolog {
  color: #63a35c;
}

.token.function,
.token.namespace,
.token.pseudo-element,
.token.class,
.token.class-name,
.token.pseudo-class,
.token.id,
.token.url-reference .token.variable,
.token.attr-name {
  color: #795da3;
}

.token.entity {
  cursor: help;
}

.token.title,
.token.title .token.punctuation {
  font-weight: bold;
  color: #1d3e81;
}

.token.list {
  color: #ed6a43;
}

.token.inserted {
  background-color: #eaffea;
  color: #55a532;
}

.token.deleted {
  background-color: #ffecec;
  color: #bd2c00;
}

.token.bold {
  font-weight: bold;
}

.token.italic {
  font-style: italic;
}


/* JSON */
.language-json .token.property {
  color: #183691;
}

.language-markup .token.tag .token.punctuation {
  color: #333;
}

/* CSS */
code.language-css,
.language-css .token.function {
  color: #0086b3;
}

/* YAML */
.language-yaml .token.atrule {
  color: #63a35c;
}

code.language-yaml {
  color: #183691;
}

/* Ruby */
.language-ruby .token.function {
  color: #333;
}

/* Markdown */
.language-markdown .token.url {
  color: #795da3;
}

/* Makefile */
.language-makefile .token.symbol {
  color: #795da3;
}

.language-makefile .token.variable {
  color: #183691;
}

.language-makefile .token.builtin {
  color: #0086b3;
}

/* Bash */
.language-bash .token.keyword {
  color: #0086b3;
}

/* highlight */
pre[data-line] {
  position: relative;
  padding: 1em 0 1em 3em;
}
pre[data-line] .line-highlight-wrapper {
  position: absolute;
  top: 0;
  left: 0;
  background-color: transparent;
  display: block;
  width: 100%;
}

pre[data-line] .line-highlight {
  position: absolute;
  left: 0;
  right: 0;
  padding: inherit 0;
  margin-top: 1em;
  background: hsla(24, 20%, 50%,.08);
  background: linear-gradient(to right, hsla(24, 20%, 50%,.1) 70%, hsla(24, 20%, 50%,0));
  pointer-events: none;
  line-height: inherit;
  white-space: pre;
}

pre[data-line] .line-highlight:before, 
pre[data-line] .line-highlight[data-end]:after {
  content: attr(data-start);
  position: absolute;
  top: .4em;
  left: .6em;
  min-width: 1em;
  padding: 0 .5em;
  background-color: hsla(24, 20%, 50%,.4);
  color: hsl(24, 20%, 95%);
  font: bold 65%/1.5 sans-serif;
  text-align: center;
  vertical-align: .3em;
  border-radius: 999px;
  text-shadow: none;
  box-shadow: 0 1px white;
}

pre[data-line] .line-highlight[data-end]:after {
  content: attr(data-end);
  top: auto;
  bottom: .4em;
}html body{font-family:"Helvetica Neue",Helvetica,"Segoe UI",Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ul,html body>ol{margin-bottom:16px}html body ul,html body ol{padding-left:2em}html body ul.no-list,html body ol.no-list{padding:0;list-style-type:none}html body ul ul,html body ul ol,html body ol ol,html body ol ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:bold;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:bold}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em !important;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::before,html body code::after{letter-spacing:-0.2em;content:"\00a0"}html body pre>code{padding:0;margin:0;font-size:.85em !important;word-break:normal;white-space:pre;background:transparent;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;font-size:.85em !important;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:before,html body pre tt:before,html body pre code:after,html body pre tt:after{content:normal}html body p,html body blockquote,html body ul,html body ol,html body dl,html body pre{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body pre,html body code{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview .pagebreak,.markdown-preview .newpage{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center !important}.markdown-preview:not([for="preview"]) .code-chunk .btn-group{display:none}.markdown-preview:not([for="preview"]) .code-chunk .status{display:none}.markdown-preview:not([for="preview"]) .code-chunk .output-div{margin-bottom:16px}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0}@media screen and (min-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{font-size:14px !important;padding:1em}}@media print{html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,0.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul{padding:0 1.6em;margin-top:.8em}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc li{margin-bottom:.8em}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul{list-style-type:none}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% -  300px);padding:2em calc(50% - 457px -  150px);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */

      </style>
    </head>
    <body for="html-export">
      <div class="mume markdown-preview  ">
      <h1 class="mume-header" id="introduction">Introduction</h1>

<p>In this lesson, you will code the MCL algorithm in C++. Before we start, let&apos;s take a look at the problem in hand.</p>
<p>Inside the below two-dimensional map, a mobile robot represented by a blue color, lives in a world of size 100x100. This robot can rotate left or right and move forward. The robot can also measure its distance to the eight landmarks, represented in red using RangeFinder sensor. It&apos;s important to note that this is a <em>cyclic</em> world which means that the robot can cross the walls and re-appear from the other side.</p>
<p align="center">
<img src="img/mcl-lab1.png" alt="drawing" width="400">
</p>
<p>Now, we aim to estimate the robot&apos;s pose using particle filtering as it moves and senses the environment. We&apos;ll be spreading virtual particles randomly and uniformly throughout the map. In this lesson, you will code the MCL algorithm in sections.</p>
<ul>
<li>First, you will move the robot and measure its distance to the landmarks.</li>
<li>Then, you will simulate noise and add it to the measurements.</li>
<li>Next, you will randomly and uniformly spread particles throughout the map.</li>
<li>You will also evaluate the importance weight of each particle.</li>
<li>Following, you will resample the particles.</li>
<li>Then, you will generate an error value to check the overall quality of the solution.</li>
<li>This will enable you to identify how close the particles are to the robot.</li>
<li>By the end, you&apos;ll plot the position of the robot and the particles at each iteration of the MCL algorithm.</li>
</ul>
<p>See the video <a href="https://youtu.be/Z7tgQBESh7A">here</a>.</p>
<h1 class="mume-header" id="robot-class">Robot Class</h1>

<p>Below is the robot class with supporting and global functions. You need to instantiate a robot object from this class. The instantiated robot object will have a random position and orientation based on a Gaussian distribution. Also, the forward, turn, and sensing noise parameters will initially be set to zero. To update the position and orientation of the robot, you use the <code>set</code> function (line 42).</p>
<p>To simulate noise, use the <code>set_noise</code> function and add random noise values to the robot&apos;s pose and measurement. Now, if you want to measure the distance between the robot and each of the eight landmarks, use the <code>sense</code> function. With the <code>move</code> function, you can rotate the robot and move it forward. Finally, you can request the robot to show you its current pose or the distances toward the eight landmarks (&apos;read_sensors`). There are still some other functions that we&apos;ll cover later.</p>
<p>See the video <a href="https://youtu.be/BBEVf9csMOo">here</a>.</p>
<p><strong>NOTE:</strong> While scrolling through the C++ code, you&apos;ll notice some statements and functions commented out. These statements and functions are part of the <code>matplotlib</code> python library and are later used to graph and visualize the results. After you finish coding the MCL algorithm, you&apos;ll be asked to interface with this function on the Workspace and generate images to visualize the process of the MCL algorithm.</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp"><span class="token comment">//#include &quot;src/matplotlibcpp.h&quot;//Graph Library</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;math.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;vector&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdexcept&gt;</span> <span class="token comment">// throw errors</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;random&gt;</span> <span class="token comment">//C++ 11 Random Numbers</span></span>

<span class="token comment">//namespace plt = matplotlibcpp;</span>
<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>

<span class="token comment">// Landmarks</span>
<span class="token keyword keyword-double">double</span> landmarks<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">{</span> <span class="token number">20.0</span><span class="token punctuation">,</span> <span class="token number">20.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token number">20.0</span><span class="token punctuation">,</span> <span class="token number">80.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token number">20.0</span><span class="token punctuation">,</span> <span class="token number">50.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token number">50.0</span><span class="token punctuation">,</span> <span class="token number">20.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token number">50.0</span><span class="token punctuation">,</span> <span class="token number">80.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token number">80.0</span><span class="token punctuation">,</span> <span class="token number">80.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token number">80.0</span><span class="token punctuation">,</span> <span class="token number">20.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token number">80.0</span><span class="token punctuation">,</span> <span class="token number">50.0</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Map size in meters</span>
<span class="token keyword keyword-double">double</span> world_size <span class="token operator">=</span> <span class="token number">100.0</span><span class="token punctuation">;</span>
 
<span class="token comment">// Random Generators</span>
random_device rd<span class="token punctuation">;</span>
mt19937 <span class="token function">gen</span><span class="token punctuation">(</span><span class="token function">rd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Global Functions</span>
<span class="token keyword keyword-double">double</span> <span class="token function">mod</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> first_term<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> second_term<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-double">double</span> <span class="token function">gen_real_random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-class">class</span> <span class="token class-name">Robot</span> <span class="token punctuation">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
    <span class="token function">Robot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Constructor</span>
        x <span class="token operator">=</span> <span class="token function">gen_real_random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> world_size<span class="token punctuation">;</span> <span class="token comment">// robot&apos;s x coordinate</span>
        y <span class="token operator">=</span> <span class="token function">gen_real_random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> world_size<span class="token punctuation">;</span> <span class="token comment">// robot&apos;s y coordinate</span>
        orient <span class="token operator">=</span> <span class="token function">gen_real_random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2.0</span> <span class="token operator">*</span> M_PI<span class="token punctuation">;</span> <span class="token comment">// robot&apos;s orientation</span>

        forward_noise <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span> <span class="token comment">//noise of the forward movement</span>
        turn_noise <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span> <span class="token comment">//noise of the turn</span>
        sense_noise <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span> <span class="token comment">//noise of the sensing</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-void">void</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> new_x<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> new_y<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> new_orient<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Set robot new position and orientation</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>new_x <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> new_x <span class="token operator">&gt;=</span> world_size<span class="token punctuation">)</span>
            <span class="token keyword keyword-throw">throw</span> std<span class="token double-colon punctuation">::</span><span class="token function">invalid_argument</span><span class="token punctuation">(</span><span class="token string">&quot;X coordinate out of bound&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>new_y <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> new_y <span class="token operator">&gt;=</span> world_size<span class="token punctuation">)</span>
            <span class="token keyword keyword-throw">throw</span> std<span class="token double-colon punctuation">::</span><span class="token function">invalid_argument</span><span class="token punctuation">(</span><span class="token string">&quot;Y coordinate out of bound&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>new_orient <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> new_orient <span class="token operator">&gt;=</span> <span class="token number">2</span> <span class="token operator">*</span> M_PI<span class="token punctuation">)</span>
            <span class="token keyword keyword-throw">throw</span> std<span class="token double-colon punctuation">::</span><span class="token function">invalid_argument</span><span class="token punctuation">(</span><span class="token string">&quot;Orientation must be in [0..2pi]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        x <span class="token operator">=</span> new_x<span class="token punctuation">;</span>
        y <span class="token operator">=</span> new_y<span class="token punctuation">;</span>
        orient <span class="token operator">=</span> new_orient<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-void">void</span> <span class="token function">set_noise</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> new_forward_noise<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> new_turn_noise<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> new_sense_noise<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Simulate noise, often useful in particle filters</span>
        forward_noise <span class="token operator">=</span> new_forward_noise<span class="token punctuation">;</span>
        turn_noise <span class="token operator">=</span> new_turn_noise<span class="token punctuation">;</span>
        sense_noise <span class="token operator">=</span> new_sense_noise<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    vector<span class="token operator">&lt;</span><span class="token keyword keyword-double">double</span><span class="token operator">&gt;</span> <span class="token function">sense</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Measure the distances from the robot toward the landmarks</span>
        vector<span class="token operator">&lt;</span><span class="token keyword keyword-double">double</span><span class="token operator">&gt;</span> <span class="token function">z</span><span class="token punctuation">(</span><span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>landmarks<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>landmarks<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-double">double</span> dist<span class="token punctuation">;</span>

        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>landmarks<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>landmarks<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            dist <span class="token operator">=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token punctuation">(</span>x <span class="token operator">-</span> landmarks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token punctuation">(</span>y <span class="token operator">-</span> landmarks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            dist <span class="token operator">+=</span> <span class="token function">gen_gauss_random</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> sense_noise<span class="token punctuation">)</span><span class="token punctuation">;</span>
            z<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> dist<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-return">return</span> z<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    Robot <span class="token function">move</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> turn<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> forward<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>forward <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token keyword keyword-throw">throw</span> std<span class="token double-colon punctuation">::</span><span class="token function">invalid_argument</span><span class="token punctuation">(</span><span class="token string">&quot;Robot cannot move backward&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// turn, and add randomness to the turning command</span>
        orient <span class="token operator">=</span> orient <span class="token operator">+</span> turn <span class="token operator">+</span> <span class="token function">gen_gauss_random</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> turn_noise<span class="token punctuation">)</span><span class="token punctuation">;</span>
        orient <span class="token operator">=</span> <span class="token function">mod</span><span class="token punctuation">(</span>orient<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> M_PI<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// move, and add randomness to the motion command</span>
        <span class="token keyword keyword-double">double</span> dist <span class="token operator">=</span> forward <span class="token operator">+</span> <span class="token function">gen_gauss_random</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> forward_noise<span class="token punctuation">)</span><span class="token punctuation">;</span>
        x <span class="token operator">=</span> x <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token function">cos</span><span class="token punctuation">(</span>orient<span class="token punctuation">)</span> <span class="token operator">*</span> dist<span class="token punctuation">)</span><span class="token punctuation">;</span>
        y <span class="token operator">=</span> y <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token function">sin</span><span class="token punctuation">(</span>orient<span class="token punctuation">)</span> <span class="token operator">*</span> dist<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// cyclic truncate</span>
        x <span class="token operator">=</span> <span class="token function">mod</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> world_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
        y <span class="token operator">=</span> <span class="token function">mod</span><span class="token punctuation">(</span>y<span class="token punctuation">,</span> world_size<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// set particle</span>
        Robot res<span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> orient<span class="token punctuation">)</span><span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">set_noise</span><span class="token punctuation">(</span>forward_noise<span class="token punctuation">,</span> turn_noise<span class="token punctuation">,</span> sense_noise<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword keyword-return">return</span> res<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    string <span class="token function">show_pose</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Returns the robot current position and orientation in a string format</span>
        <span class="token keyword keyword-return">return</span> <span class="token string">&quot;[x=&quot;</span> <span class="token operator">+</span> <span class="token function">to_string</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; y=&quot;</span> <span class="token operator">+</span> <span class="token function">to_string</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; orient=&quot;</span> <span class="token operator">+</span> <span class="token function">to_string</span><span class="token punctuation">(</span>orient<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    string <span class="token function">read_sensors</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Returns all the distances from the robot toward the landmarks</span>
        vector<span class="token operator">&lt;</span><span class="token keyword keyword-double">double</span><span class="token operator">&gt;</span> z <span class="token operator">=</span> <span class="token function">sense</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        string readings <span class="token operator">=</span> <span class="token string">&quot;[&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> z<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            readings <span class="token operator">+=</span> <span class="token function">to_string</span><span class="token punctuation">(</span>z<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        readings<span class="token punctuation">[</span>readings<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&apos;]&apos;</span><span class="token punctuation">;</span>

        <span class="token keyword keyword-return">return</span> readings<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-double">double</span> <span class="token function">measurement_prob</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span><span class="token keyword keyword-double">double</span><span class="token operator">&gt;</span> measurement<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Calculates how likely a measurement should be</span>
        <span class="token keyword keyword-double">double</span> prob <span class="token operator">=</span> <span class="token number">1.0</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-double">double</span> dist<span class="token punctuation">;</span>

        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>landmarks<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>landmarks<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            dist <span class="token operator">=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token punctuation">(</span>x <span class="token operator">-</span> landmarks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token punctuation">(</span>y <span class="token operator">-</span> landmarks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            prob <span class="token operator">*=</span> <span class="token function">gaussian</span><span class="token punctuation">(</span>dist<span class="token punctuation">,</span> sense_noise<span class="token punctuation">,</span> measurement<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword keyword-return">return</span> prob<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-double">double</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> orient<span class="token punctuation">;</span> <span class="token comment">//robot poses</span>
    <span class="token keyword keyword-double">double</span> forward_noise<span class="token punctuation">,</span> turn_noise<span class="token punctuation">,</span> sense_noise<span class="token punctuation">;</span> <span class="token comment">//robot noises</span>

<span class="token keyword keyword-private">private</span><span class="token operator">:</span>
    <span class="token keyword keyword-double">double</span> <span class="token function">gen_gauss_random</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> mean<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> variance<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Gaussian random</span>
        normal_distribution<span class="token operator">&lt;</span><span class="token keyword keyword-double">double</span><span class="token operator">&gt;</span> <span class="token function">gauss_dist</span><span class="token punctuation">(</span>mean<span class="token punctuation">,</span> variance<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> <span class="token function">gauss_dist</span><span class="token punctuation">(</span>gen<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-double">double</span> <span class="token function">gaussian</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> mu<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> sigma<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> x<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Probability of x for 1-dim Gaussian with mean mu and var. sigma</span>
        <span class="token keyword keyword-return">return</span> <span class="token function">exp</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token punctuation">(</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token punctuation">(</span>mu <span class="token operator">-</span> x<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token function">pow</span><span class="token punctuation">(</span>sigma<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token number">2.0</span> <span class="token operator">*</span> M_PI <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token function">pow</span><span class="token punctuation">(</span>sigma<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Functions</span>
<span class="token keyword keyword-double">double</span> <span class="token function">gen_real_random</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Generate real random between 0 and 1</span>
    uniform_real_distribution<span class="token operator">&lt;</span><span class="token keyword keyword-double">double</span><span class="token operator">&gt;</span> <span class="token function">real_dist</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//Real</span>
    <span class="token keyword keyword-return">return</span> <span class="token function">real_dist</span><span class="token punctuation">(</span>gen<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-double">double</span> <span class="token function">mod</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> first_term<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> second_term<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Compute the modulus</span>
    <span class="token keyword keyword-return">return</span> first_term <span class="token operator">-</span> <span class="token punctuation">(</span>second_term<span class="token punctuation">)</span><span class="token operator">*</span><span class="token function">floor</span><span class="token punctuation">(</span>first_term <span class="token operator">/</span> <span class="token punctuation">(</span>second_term<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-double">double</span> <span class="token function">evaluation</span><span class="token punctuation">(</span>Robot r<span class="token punctuation">,</span> Robot p<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> n<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">//Calculate the mean error of the system</span>
    <span class="token keyword keyword-double">double</span> sum <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//the second part is because of world&apos;s cyclicity</span>
        <span class="token keyword keyword-double">double</span> dx <span class="token operator">=</span> <span class="token function">mod</span><span class="token punctuation">(</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>x <span class="token operator">-</span> r<span class="token punctuation">.</span>x <span class="token operator">+</span> <span class="token punctuation">(</span>world_size <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> world_size<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span>world_size <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-double">double</span> dy <span class="token operator">=</span> <span class="token function">mod</span><span class="token punctuation">(</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">-</span> r<span class="token punctuation">.</span>y <span class="token operator">+</span> <span class="token punctuation">(</span>world_size <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> world_size<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span>world_size <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-double">double</span> err <span class="token operator">=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token function">pow</span><span class="token punctuation">(</span>dx<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">pow</span><span class="token punctuation">(</span>dy<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sum <span class="token operator">+=</span> err<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-return">return</span> sum <span class="token operator">/</span> n<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword keyword-double">double</span> <span class="token function">max</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> arr<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> n<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Identify the max element in an array</span>
    <span class="token keyword keyword-double">double</span> max <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&gt;</span> max<span class="token punctuation">)</span>
            max <span class="token operator">=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-return">return</span> max<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">/*
void visualization(int n, Robot robot, int step, Robot p[], Robot pr[])
{
	//Draw the robot, landmarks, particles and resampled particles on a graph
	
    //Graph Format
    plt::title(&quot;MCL, step &quot; + to_string(step));
    plt::xlim(0, 100);
    plt::ylim(0, 100);

    //Draw particles in green
    for (int i = 0; i &lt; n; i++) {
        plt::plot({ p[i].x }, { p[i].y }, &quot;go&quot;);
    }

    //Draw resampled particles in yellow
    for (int i = 0; i &lt; n; i++) {
        plt::plot({ pr[i].x }, { pr[i].y }, &quot;yo&quot;);
    }

    //Draw landmarks in red
    for (int i = 0; i &lt; sizeof(landmarks) / sizeof(landmarks[0]); i++) {
        plt::plot({ landmarks[i][0] }, { landmarks[i][1] }, &quot;ro&quot;);
    }
    
    //Draw robot position in blue
    plt::plot({ robot.x }, { robot.y }, &quot;bo&quot;);

	//Save the image and close the plot
    plt::save(&quot;./Images/Step&quot; + to_string(step) + &quot;.png&quot;);
    plt::clf();
}
*/</span>

<span class="token comment">//####   DON&apos;T MODIFY ANYTHING ABOVE HERE! ENTER CODE BELOW ####</span>
<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// TODO: Print &quot;I am ready for coding the MCL!&quot;</span>

    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</pre><h1 class="mume-header" id="first-interaction">First Interaction</h1>

<p>Now that you have reviewed the Robot class, it&apos;s time to interact with it. In this section you&apos;ll learn how to instantiate a robot object from the Robot class.</p>
<ul>
<li>This robot will be initialized with random position and orientation.</li>
<li>Then, you&apos;ll learn how to change the robot initial position and orientation.</li>
<li>You maybe curious to know where the robot is located, so you&apos;ll learn how to print its pose.</li>
<li>Following, you&apos;ll learn how to rotate the robot and move it forward into 2D map.</li>
<li>Finally, you&apos;ll learn how to print the distances from the robot toward each of the eight landmarks.</li>
</ul>
<p align="center">
<img src="img/first-interaction.png" alt="drawing" width="400">
</p>
<p>See the instructions in the C++ code below.</p>
<p><a href="https://youtu.be/-GxyQuh5LJ8">video</a></p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp"><span class="token comment">//#include &quot;src/matplotlibcpp.h&quot;//Graph Library</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;math.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;vector&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdexcept&gt;</span> <span class="token comment">// throw errors</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;random&gt;</span> <span class="token comment">//C++ 11 Random Numbers</span></span>

<span class="token comment">//namespace plt = matplotlibcpp;</span>
<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>

<span class="token comment">// Landmarks</span>
<span class="token keyword keyword-double">double</span> landmarks<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">{</span> <span class="token number">20.0</span><span class="token punctuation">,</span> <span class="token number">20.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token number">20.0</span><span class="token punctuation">,</span> <span class="token number">80.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token number">20.0</span><span class="token punctuation">,</span> <span class="token number">50.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token number">50.0</span><span class="token punctuation">,</span> <span class="token number">20.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token number">50.0</span><span class="token punctuation">,</span> <span class="token number">80.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token number">80.0</span><span class="token punctuation">,</span> <span class="token number">80.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token number">80.0</span><span class="token punctuation">,</span> <span class="token number">20.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token number">80.0</span><span class="token punctuation">,</span> <span class="token number">50.0</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Map size in meters</span>
<span class="token keyword keyword-double">double</span> world_size <span class="token operator">=</span> <span class="token number">100.0</span><span class="token punctuation">;</span>

<span class="token comment">// Random Generators</span>
random_device rd<span class="token punctuation">;</span>
mt19937 <span class="token function">gen</span><span class="token punctuation">(</span><span class="token function">rd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Global Functions</span>
<span class="token keyword keyword-double">double</span> <span class="token function">mod</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> first_term<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> second_term<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-double">double</span> <span class="token function">gen_real_random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-class">class</span> <span class="token class-name">Robot</span> <span class="token punctuation">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
    <span class="token function">Robot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Constructor</span>
        x <span class="token operator">=</span> <span class="token function">gen_real_random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> world_size<span class="token punctuation">;</span> <span class="token comment">// robot&apos;s x coordinate</span>
        y <span class="token operator">=</span> <span class="token function">gen_real_random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> world_size<span class="token punctuation">;</span> <span class="token comment">// robot&apos;s y coordinate</span>
        orient <span class="token operator">=</span> <span class="token function">gen_real_random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2.0</span> <span class="token operator">*</span> M_PI<span class="token punctuation">;</span> <span class="token comment">// robot&apos;s orientation</span>

        forward_noise <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span> <span class="token comment">//noise of the forward movement</span>
        turn_noise <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span> <span class="token comment">//noise of the turn</span>
        sense_noise <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span> <span class="token comment">//noise of the sensing</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-void">void</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> new_x<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> new_y<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> new_orient<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Set robot new position and orientation</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>new_x <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> new_x <span class="token operator">&gt;=</span> world_size<span class="token punctuation">)</span>
            <span class="token keyword keyword-throw">throw</span> std<span class="token double-colon punctuation">::</span><span class="token function">invalid_argument</span><span class="token punctuation">(</span><span class="token string">&quot;X coordinate out of bound&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>new_y <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> new_y <span class="token operator">&gt;=</span> world_size<span class="token punctuation">)</span>
            <span class="token keyword keyword-throw">throw</span> std<span class="token double-colon punctuation">::</span><span class="token function">invalid_argument</span><span class="token punctuation">(</span><span class="token string">&quot;Y coordinate out of bound&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>new_orient <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> new_orient <span class="token operator">&gt;=</span> <span class="token number">2</span> <span class="token operator">*</span> M_PI<span class="token punctuation">)</span>
            <span class="token keyword keyword-throw">throw</span> std<span class="token double-colon punctuation">::</span><span class="token function">invalid_argument</span><span class="token punctuation">(</span><span class="token string">&quot;Orientation must be in [0..2pi]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        x <span class="token operator">=</span> new_x<span class="token punctuation">;</span>
        y <span class="token operator">=</span> new_y<span class="token punctuation">;</span>
        orient <span class="token operator">=</span> new_orient<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-void">void</span> <span class="token function">set_noise</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> new_forward_noise<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> new_turn_noise<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> new_sense_noise<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Simulate noise, often useful in particle filters</span>
        forward_noise <span class="token operator">=</span> new_forward_noise<span class="token punctuation">;</span>
        turn_noise <span class="token operator">=</span> new_turn_noise<span class="token punctuation">;</span>
        sense_noise <span class="token operator">=</span> new_sense_noise<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    vector<span class="token operator">&lt;</span><span class="token keyword keyword-double">double</span><span class="token operator">&gt;</span> <span class="token function">sense</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Measure the distances from the robot toward the landmarks</span>
        vector<span class="token operator">&lt;</span><span class="token keyword keyword-double">double</span><span class="token operator">&gt;</span> <span class="token function">z</span><span class="token punctuation">(</span><span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>landmarks<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>landmarks<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-double">double</span> dist<span class="token punctuation">;</span>

        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>landmarks<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>landmarks<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            dist <span class="token operator">=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token punctuation">(</span>x <span class="token operator">-</span> landmarks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token punctuation">(</span>y <span class="token operator">-</span> landmarks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            dist <span class="token operator">+=</span> <span class="token function">gen_gauss_random</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> sense_noise<span class="token punctuation">)</span><span class="token punctuation">;</span>
            z<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> dist<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-return">return</span> z<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    Robot <span class="token function">move</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> turn<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> forward<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>forward <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token keyword keyword-throw">throw</span> std<span class="token double-colon punctuation">::</span><span class="token function">invalid_argument</span><span class="token punctuation">(</span><span class="token string">&quot;Robot cannot move backward&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// turn, and add randomness to the turning command</span>
        orient <span class="token operator">=</span> orient <span class="token operator">+</span> turn <span class="token operator">+</span> <span class="token function">gen_gauss_random</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> turn_noise<span class="token punctuation">)</span><span class="token punctuation">;</span>
        orient <span class="token operator">=</span> <span class="token function">mod</span><span class="token punctuation">(</span>orient<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> M_PI<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// move, and add randomness to the motion command</span>
        <span class="token keyword keyword-double">double</span> dist <span class="token operator">=</span> forward <span class="token operator">+</span> <span class="token function">gen_gauss_random</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> forward_noise<span class="token punctuation">)</span><span class="token punctuation">;</span>
        x <span class="token operator">=</span> x <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token function">cos</span><span class="token punctuation">(</span>orient<span class="token punctuation">)</span> <span class="token operator">*</span> dist<span class="token punctuation">)</span><span class="token punctuation">;</span>
        y <span class="token operator">=</span> y <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token function">sin</span><span class="token punctuation">(</span>orient<span class="token punctuation">)</span> <span class="token operator">*</span> dist<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// cyclic truncate</span>
        x <span class="token operator">=</span> <span class="token function">mod</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> world_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
        y <span class="token operator">=</span> <span class="token function">mod</span><span class="token punctuation">(</span>y<span class="token punctuation">,</span> world_size<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// set particle</span>
        Robot res<span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> orient<span class="token punctuation">)</span><span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">set_noise</span><span class="token punctuation">(</span>forward_noise<span class="token punctuation">,</span> turn_noise<span class="token punctuation">,</span> sense_noise<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword keyword-return">return</span> res<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    string <span class="token function">show_pose</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Returns the robot current position and orientation in a string format</span>
        <span class="token keyword keyword-return">return</span> <span class="token string">&quot;[x=&quot;</span> <span class="token operator">+</span> <span class="token function">to_string</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; y=&quot;</span> <span class="token operator">+</span> <span class="token function">to_string</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; orient=&quot;</span> <span class="token operator">+</span> <span class="token function">to_string</span><span class="token punctuation">(</span>orient<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    string <span class="token function">read_sensors</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Returns all the distances from the robot toward the landmarks</span>
        vector<span class="token operator">&lt;</span><span class="token keyword keyword-double">double</span><span class="token operator">&gt;</span> z <span class="token operator">=</span> <span class="token function">sense</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        string readings <span class="token operator">=</span> <span class="token string">&quot;[&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> z<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            readings <span class="token operator">+=</span> <span class="token function">to_string</span><span class="token punctuation">(</span>z<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        readings<span class="token punctuation">[</span>readings<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&apos;]&apos;</span><span class="token punctuation">;</span>

        <span class="token keyword keyword-return">return</span> readings<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-double">double</span> <span class="token function">measurement_prob</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span><span class="token keyword keyword-double">double</span><span class="token operator">&gt;</span> measurement<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Calculates how likely a measurement should be</span>
        <span class="token keyword keyword-double">double</span> prob <span class="token operator">=</span> <span class="token number">1.0</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-double">double</span> dist<span class="token punctuation">;</span>

        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>landmarks<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>landmarks<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            dist <span class="token operator">=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token punctuation">(</span>x <span class="token operator">-</span> landmarks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token punctuation">(</span>y <span class="token operator">-</span> landmarks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            prob <span class="token operator">*=</span> <span class="token function">gaussian</span><span class="token punctuation">(</span>dist<span class="token punctuation">,</span> sense_noise<span class="token punctuation">,</span> measurement<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword keyword-return">return</span> prob<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-double">double</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> orient<span class="token punctuation">;</span> <span class="token comment">//robot poses</span>
    <span class="token keyword keyword-double">double</span> forward_noise<span class="token punctuation">,</span> turn_noise<span class="token punctuation">,</span> sense_noise<span class="token punctuation">;</span> <span class="token comment">//robot noises</span>

<span class="token keyword keyword-private">private</span><span class="token operator">:</span>
    <span class="token keyword keyword-double">double</span> <span class="token function">gen_gauss_random</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> mean<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> variance<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Gaussian random</span>
        normal_distribution<span class="token operator">&lt;</span><span class="token keyword keyword-double">double</span><span class="token operator">&gt;</span> <span class="token function">gauss_dist</span><span class="token punctuation">(</span>mean<span class="token punctuation">,</span> variance<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> <span class="token function">gauss_dist</span><span class="token punctuation">(</span>gen<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-double">double</span> <span class="token function">gaussian</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> mu<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> sigma<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> x<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Probability of x for 1-dim Gaussian with mean mu and var. sigma</span>
        <span class="token keyword keyword-return">return</span> <span class="token function">exp</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token punctuation">(</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token punctuation">(</span>mu <span class="token operator">-</span> x<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token function">pow</span><span class="token punctuation">(</span>sigma<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token number">2.0</span> <span class="token operator">*</span> M_PI <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token function">pow</span><span class="token punctuation">(</span>sigma<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Functions</span>
<span class="token keyword keyword-double">double</span> <span class="token function">gen_real_random</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Generate real random between 0 and 1</span>
    uniform_real_distribution<span class="token operator">&lt;</span><span class="token keyword keyword-double">double</span><span class="token operator">&gt;</span> <span class="token function">real_dist</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//Real</span>
    <span class="token keyword keyword-return">return</span> <span class="token function">real_dist</span><span class="token punctuation">(</span>gen<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-double">double</span> <span class="token function">mod</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> first_term<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> second_term<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Compute the modulus</span>
    <span class="token keyword keyword-return">return</span> first_term <span class="token operator">-</span> <span class="token punctuation">(</span>second_term<span class="token punctuation">)</span><span class="token operator">*</span><span class="token function">floor</span><span class="token punctuation">(</span>first_term <span class="token operator">/</span> <span class="token punctuation">(</span>second_term<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-double">double</span> <span class="token function">evaluation</span><span class="token punctuation">(</span>Robot r<span class="token punctuation">,</span> Robot p<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> n<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">//Calculate the mean error of the system</span>
    <span class="token keyword keyword-double">double</span> sum <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//the second part is because of world&apos;s cyclicity</span>
        <span class="token keyword keyword-double">double</span> dx <span class="token operator">=</span> <span class="token function">mod</span><span class="token punctuation">(</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>x <span class="token operator">-</span> r<span class="token punctuation">.</span>x <span class="token operator">+</span> <span class="token punctuation">(</span>world_size <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> world_size<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span>world_size <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-double">double</span> dy <span class="token operator">=</span> <span class="token function">mod</span><span class="token punctuation">(</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">-</span> r<span class="token punctuation">.</span>y <span class="token operator">+</span> <span class="token punctuation">(</span>world_size <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> world_size<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span>world_size <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-double">double</span> err <span class="token operator">=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token function">pow</span><span class="token punctuation">(</span>dx<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">pow</span><span class="token punctuation">(</span>dy<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sum <span class="token operator">+=</span> err<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-return">return</span> sum <span class="token operator">/</span> n<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword keyword-double">double</span> <span class="token function">max</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> arr<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> n<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Identify the max element in an array</span>
    <span class="token keyword keyword-double">double</span> max <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&gt;</span> max<span class="token punctuation">)</span>
            max <span class="token operator">=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-return">return</span> max<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">/*
void visualization(int n, Robot robot, int step, Robot p[], Robot pr[])
{
	//Draw the robot, landmarks, particles and resampled particles on a graph
	
    //Graph Format
    plt::title(&quot;MCL, step &quot; + to_string(step));
    plt::xlim(0, 100);
    plt::ylim(0, 100);

    //Draw particles in green
    for (int i = 0; i &lt; n; i++) {
        plt::plot({ p[i].x }, { p[i].y }, &quot;go&quot;);
    }

    //Draw resampled particles in yellow
    for (int i = 0; i &lt; n; i++) {
        plt::plot({ pr[i].x }, { pr[i].y }, &quot;yo&quot;);
    }

    //Draw landmarks in red
    for (int i = 0; i &lt; sizeof(landmarks) / sizeof(landmarks[0]); i++) {
        plt::plot({ landmarks[i][0] }, { landmarks[i][1] }, &quot;ro&quot;);
    }
    
    //Draw robot position in blue
    plt::plot({ robot.x }, { robot.y }, &quot;bo&quot;);

	//Save the image and close the plot
    plt::save(&quot;./Images/Step&quot; + to_string(step) + &quot;.png&quot;);
    plt::clf();
}
*/</span>

<span class="token comment">//####   DON&apos;T MODIFY ANYTHING ABOVE HERE! ENTER CODE BELOW ####</span>
<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Instantiating a robot object from the Robot class</span>
    Robot myrobot<span class="token punctuation">;</span>

    <span class="token comment">// Set robot new position to x=10.0, y=10.0 and orientation=0</span>
    <span class="token comment">// Fill in the position and orientation values in myrobot.set() function</span>
    myrobot<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">10.0</span><span class="token punctuation">,</span> <span class="token number">10.0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Printing out the new robot position and orientation</span>
    cout <span class="token operator">&lt;&lt;</span> myrobot<span class="token punctuation">.</span><span class="token function">show_pose</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>

    <span class="token comment">// Rotate the robot by PI/2.0 and then move him forward by 10.0</span>
    <span class="token comment">// Use M_PI for the pi value</span>
    myrobot<span class="token punctuation">.</span><span class="token function">move</span><span class="token punctuation">(</span>M_PI <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">10.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Print out the new robot position and orientation</span>
    cout <span class="token operator">&lt;&lt;</span> myrobot<span class="token punctuation">.</span><span class="token function">show_pose</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>

    <span class="token comment">// Printing the distance from the robot toward the eight landmarks</span>
    cout <span class="token operator">&lt;&lt;</span> myrobot<span class="token punctuation">.</span><span class="token function">read_sensors</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>

    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</pre><h1 class="mume-header" id="motion-and-sensoring">Motion and Sensoring</h1>

<p>In the previous lesson, you&#x2019;ve learned how to interact with the Robot class. Now, you&#x2019;ll be asked to  <strong>instantiate</strong>  a robot object, simulate  <strong>motion</strong>  update and  <strong>sensor</strong>  update similar to what you&#x2019;ve learned in the first quiz.</p>
<p>Scroll down to the  <code>main</code>  function and complete the following tasks:</p>
<ul>
<li>Instantiate a robot object from the Robot class</li>
<li>Set robot new position to <code>x=30.0</code> and <code>y=50.0</code> and orietation <code>pi/2</code>.</li>
<li>Turn clockwise by <code>pi/2</code> and move by 15 meters</li>
<li>Print the distance from the robot toward the eight landmarks</li>
<li>Turn clockwise by <code>pi/2</code> and move by 10 meters</li>
<li>Print the distance from the robot toward the eight landmarks</li>
</ul>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp"><span class="token comment">//#include &quot;src/matplotlibcpp.h&quot;//Graph Library</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;math.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;vector&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdexcept&gt;</span> <span class="token comment">// throw errors</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;random&gt;</span> <span class="token comment">//C++ 11 Random Numbers</span></span>

<span class="token comment">//namespace plt = matplotlibcpp;</span>
<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>

<span class="token comment">// Landmarks</span>
<span class="token keyword keyword-double">double</span> landmarks<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">{</span> <span class="token number">20.0</span><span class="token punctuation">,</span> <span class="token number">20.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token number">20.0</span><span class="token punctuation">,</span> <span class="token number">80.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token number">20.0</span><span class="token punctuation">,</span> <span class="token number">50.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token number">50.0</span><span class="token punctuation">,</span> <span class="token number">20.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token number">50.0</span><span class="token punctuation">,</span> <span class="token number">80.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token number">80.0</span><span class="token punctuation">,</span> <span class="token number">80.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token number">80.0</span><span class="token punctuation">,</span> <span class="token number">20.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token number">80.0</span><span class="token punctuation">,</span> <span class="token number">50.0</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Map size in meters</span>
<span class="token keyword keyword-double">double</span> world_size <span class="token operator">=</span> <span class="token number">100.0</span><span class="token punctuation">;</span>

<span class="token comment">// Random Generators</span>
random_device rd<span class="token punctuation">;</span>
mt19937 <span class="token function">gen</span><span class="token punctuation">(</span><span class="token function">rd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Global Functions</span>
<span class="token keyword keyword-double">double</span> <span class="token function">mod</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> first_term<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> second_term<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-double">double</span> <span class="token function">gen_real_random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-class">class</span> <span class="token class-name">Robot</span> <span class="token punctuation">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
    <span class="token function">Robot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Constructor</span>
        x <span class="token operator">=</span> <span class="token function">gen_real_random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> world_size<span class="token punctuation">;</span> <span class="token comment">// robot&apos;s x coordinate</span>
        y <span class="token operator">=</span> <span class="token function">gen_real_random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> world_size<span class="token punctuation">;</span> <span class="token comment">// robot&apos;s y coordinate</span>
        orient <span class="token operator">=</span> <span class="token function">gen_real_random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2.0</span> <span class="token operator">*</span> M_PI<span class="token punctuation">;</span> <span class="token comment">// robot&apos;s orientation</span>

        forward_noise <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span> <span class="token comment">//noise of the forward movement</span>
        turn_noise <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span> <span class="token comment">//noise of the turn</span>
        sense_noise <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span> <span class="token comment">//noise of the sensing</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-void">void</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> new_x<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> new_y<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> new_orient<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Set robot new position and orientation</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>new_x <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> new_x <span class="token operator">&gt;=</span> world_size<span class="token punctuation">)</span>
            <span class="token keyword keyword-throw">throw</span> std<span class="token double-colon punctuation">::</span><span class="token function">invalid_argument</span><span class="token punctuation">(</span><span class="token string">&quot;X coordinate out of bound&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>new_y <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> new_y <span class="token operator">&gt;=</span> world_size<span class="token punctuation">)</span>
            <span class="token keyword keyword-throw">throw</span> std<span class="token double-colon punctuation">::</span><span class="token function">invalid_argument</span><span class="token punctuation">(</span><span class="token string">&quot;Y coordinate out of bound&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>new_orient <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> new_orient <span class="token operator">&gt;=</span> <span class="token number">2</span> <span class="token operator">*</span> M_PI<span class="token punctuation">)</span>
            <span class="token keyword keyword-throw">throw</span> std<span class="token double-colon punctuation">::</span><span class="token function">invalid_argument</span><span class="token punctuation">(</span><span class="token string">&quot;Orientation must be in [0..2pi]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        x <span class="token operator">=</span> new_x<span class="token punctuation">;</span>
        y <span class="token operator">=</span> new_y<span class="token punctuation">;</span>
        orient <span class="token operator">=</span> new_orient<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-void">void</span> <span class="token function">set_noise</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> new_forward_noise<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> new_turn_noise<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> new_sense_noise<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Simulate noise, often useful in particle filters</span>
        forward_noise <span class="token operator">=</span> new_forward_noise<span class="token punctuation">;</span>
        turn_noise <span class="token operator">=</span> new_turn_noise<span class="token punctuation">;</span>
        sense_noise <span class="token operator">=</span> new_sense_noise<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    vector<span class="token operator">&lt;</span><span class="token keyword keyword-double">double</span><span class="token operator">&gt;</span> <span class="token function">sense</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Measure the distances from the robot toward the landmarks</span>
        vector<span class="token operator">&lt;</span><span class="token keyword keyword-double">double</span><span class="token operator">&gt;</span> <span class="token function">z</span><span class="token punctuation">(</span><span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>landmarks<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>landmarks<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-double">double</span> dist<span class="token punctuation">;</span>

        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>landmarks<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>landmarks<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            dist <span class="token operator">=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token punctuation">(</span>x <span class="token operator">-</span> landmarks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token punctuation">(</span>y <span class="token operator">-</span> landmarks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            dist <span class="token operator">+=</span> <span class="token function">gen_gauss_random</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> sense_noise<span class="token punctuation">)</span><span class="token punctuation">;</span>
            z<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> dist<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-return">return</span> z<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    Robot <span class="token function">move</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> turn<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> forward<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>forward <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token keyword keyword-throw">throw</span> std<span class="token double-colon punctuation">::</span><span class="token function">invalid_argument</span><span class="token punctuation">(</span><span class="token string">&quot;Robot cannot move backward&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// turn, and add randomness to the turning command</span>
        orient <span class="token operator">=</span> orient <span class="token operator">+</span> turn <span class="token operator">+</span> <span class="token function">gen_gauss_random</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> turn_noise<span class="token punctuation">)</span><span class="token punctuation">;</span>
        orient <span class="token operator">=</span> <span class="token function">mod</span><span class="token punctuation">(</span>orient<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> M_PI<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// move, and add randomness to the motion command</span>
        <span class="token keyword keyword-double">double</span> dist <span class="token operator">=</span> forward <span class="token operator">+</span> <span class="token function">gen_gauss_random</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> forward_noise<span class="token punctuation">)</span><span class="token punctuation">;</span>
        x <span class="token operator">=</span> x <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token function">cos</span><span class="token punctuation">(</span>orient<span class="token punctuation">)</span> <span class="token operator">*</span> dist<span class="token punctuation">)</span><span class="token punctuation">;</span>
        y <span class="token operator">=</span> y <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token function">sin</span><span class="token punctuation">(</span>orient<span class="token punctuation">)</span> <span class="token operator">*</span> dist<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// cyclic truncate</span>
        x <span class="token operator">=</span> <span class="token function">mod</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> world_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
        y <span class="token operator">=</span> <span class="token function">mod</span><span class="token punctuation">(</span>y<span class="token punctuation">,</span> world_size<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// set particle</span>
        Robot res<span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> orient<span class="token punctuation">)</span><span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">set_noise</span><span class="token punctuation">(</span>forward_noise<span class="token punctuation">,</span> turn_noise<span class="token punctuation">,</span> sense_noise<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword keyword-return">return</span> res<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    string <span class="token function">show_pose</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Returns the robot current position and orientation in a string format</span>
        <span class="token keyword keyword-return">return</span> <span class="token string">&quot;[x=&quot;</span> <span class="token operator">+</span> <span class="token function">to_string</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; y=&quot;</span> <span class="token operator">+</span> <span class="token function">to_string</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; orient=&quot;</span> <span class="token operator">+</span> <span class="token function">to_string</span><span class="token punctuation">(</span>orient<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    string <span class="token function">read_sensors</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Returns all the distances from the robot toward the landmarks</span>
        vector<span class="token operator">&lt;</span><span class="token keyword keyword-double">double</span><span class="token operator">&gt;</span> z <span class="token operator">=</span> <span class="token function">sense</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        string readings <span class="token operator">=</span> <span class="token string">&quot;[&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> z<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            readings <span class="token operator">+=</span> <span class="token function">to_string</span><span class="token punctuation">(</span>z<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        readings<span class="token punctuation">[</span>readings<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&apos;]&apos;</span><span class="token punctuation">;</span>

        <span class="token keyword keyword-return">return</span> readings<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-double">double</span> <span class="token function">measurement_prob</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span><span class="token keyword keyword-double">double</span><span class="token operator">&gt;</span> measurement<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Calculates how likely a measurement should be</span>
        <span class="token keyword keyword-double">double</span> prob <span class="token operator">=</span> <span class="token number">1.0</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-double">double</span> dist<span class="token punctuation">;</span>

        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>landmarks<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>landmarks<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            dist <span class="token operator">=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token punctuation">(</span>x <span class="token operator">-</span> landmarks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token punctuation">(</span>y <span class="token operator">-</span> landmarks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            prob <span class="token operator">*=</span> <span class="token function">gaussian</span><span class="token punctuation">(</span>dist<span class="token punctuation">,</span> sense_noise<span class="token punctuation">,</span> measurement<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword keyword-return">return</span> prob<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-double">double</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> orient<span class="token punctuation">;</span> <span class="token comment">//robot poses</span>
    <span class="token keyword keyword-double">double</span> forward_noise<span class="token punctuation">,</span> turn_noise<span class="token punctuation">,</span> sense_noise<span class="token punctuation">;</span> <span class="token comment">//robot noises</span>

<span class="token keyword keyword-private">private</span><span class="token operator">:</span>
    <span class="token keyword keyword-double">double</span> <span class="token function">gen_gauss_random</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> mean<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> variance<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Gaussian random</span>
        normal_distribution<span class="token operator">&lt;</span><span class="token keyword keyword-double">double</span><span class="token operator">&gt;</span> <span class="token function">gauss_dist</span><span class="token punctuation">(</span>mean<span class="token punctuation">,</span> variance<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> <span class="token function">gauss_dist</span><span class="token punctuation">(</span>gen<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-double">double</span> <span class="token function">gaussian</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> mu<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> sigma<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> x<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Probability of x for 1-dim Gaussian with mean mu and var. sigma</span>
        <span class="token keyword keyword-return">return</span> <span class="token function">exp</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token punctuation">(</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token punctuation">(</span>mu <span class="token operator">-</span> x<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token function">pow</span><span class="token punctuation">(</span>sigma<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token number">2.0</span> <span class="token operator">*</span> M_PI <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token function">pow</span><span class="token punctuation">(</span>sigma<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Functions</span>
<span class="token keyword keyword-double">double</span> <span class="token function">gen_real_random</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Generate real random between 0 and 1</span>
    uniform_real_distribution<span class="token operator">&lt;</span><span class="token keyword keyword-double">double</span><span class="token operator">&gt;</span> <span class="token function">real_dist</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//Real</span>
    <span class="token keyword keyword-return">return</span> <span class="token function">real_dist</span><span class="token punctuation">(</span>gen<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-double">double</span> <span class="token function">mod</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> first_term<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> second_term<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Compute the modulus</span>
    <span class="token keyword keyword-return">return</span> first_term <span class="token operator">-</span> <span class="token punctuation">(</span>second_term<span class="token punctuation">)</span><span class="token operator">*</span><span class="token function">floor</span><span class="token punctuation">(</span>first_term <span class="token operator">/</span> <span class="token punctuation">(</span>second_term<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-double">double</span> <span class="token function">evaluation</span><span class="token punctuation">(</span>Robot r<span class="token punctuation">,</span> Robot p<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> n<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">//Calculate the mean error of the system</span>
    <span class="token keyword keyword-double">double</span> sum <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//the second part is because of world&apos;s cyclicity</span>
        <span class="token keyword keyword-double">double</span> dx <span class="token operator">=</span> <span class="token function">mod</span><span class="token punctuation">(</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>x <span class="token operator">-</span> r<span class="token punctuation">.</span>x <span class="token operator">+</span> <span class="token punctuation">(</span>world_size <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> world_size<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span>world_size <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-double">double</span> dy <span class="token operator">=</span> <span class="token function">mod</span><span class="token punctuation">(</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">-</span> r<span class="token punctuation">.</span>y <span class="token operator">+</span> <span class="token punctuation">(</span>world_size <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> world_size<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span>world_size <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-double">double</span> err <span class="token operator">=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token function">pow</span><span class="token punctuation">(</span>dx<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">pow</span><span class="token punctuation">(</span>dy<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sum <span class="token operator">+=</span> err<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-return">return</span> sum <span class="token operator">/</span> n<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword keyword-double">double</span> <span class="token function">max</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> arr<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> n<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Identify the max element in an array</span>
    <span class="token keyword keyword-double">double</span> max <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&gt;</span> max<span class="token punctuation">)</span>
            max <span class="token operator">=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-return">return</span> max<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">/*
void visualization(int n, Robot robot, int step, Robot p[], Robot pr[])
{
	//Draw the robot, landmarks, particles and resampled particles on a graph
	
    //Graph Format
    plt::title(&quot;MCL, step &quot; + to_string(step));
    plt::xlim(0, 100);
    plt::ylim(0, 100);

    //Draw particles in green
    for (int i = 0; i &lt; n; i++) {
        plt::plot({ p[i].x }, { p[i].y }, &quot;go&quot;);
    }

    //Draw resampled particles in yellow
    for (int i = 0; i &lt; n; i++) {
        plt::plot({ pr[i].x }, { pr[i].y }, &quot;yo&quot;);
    }

    //Draw landmarks in red
    for (int i = 0; i &lt; sizeof(landmarks) / sizeof(landmarks[0]); i++) {
        plt::plot({ landmarks[i][0] }, { landmarks[i][1] }, &quot;ro&quot;);
    }
    
    //Draw robot position in blue
    plt::plot({ robot.x }, { robot.y }, &quot;bo&quot;);

	//Save the image and close the plot
    plt::save(&quot;./Images/Step&quot; + to_string(step) + &quot;.png&quot;);
    plt::clf();
}
*/</span>

<span class="token comment">//####   DON&apos;T MODIFY ANYTHING ABOVE HERE! ENTER CODE BELOW ####</span>
<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Instantiate a robot object from the Robot class</span>
    Robot myrobot<span class="token punctuation">;</span>

    <span class="token comment">// Set robot new position to x=30.0, y=50.0 and orientation=PI/2.0</span>
    myrobot<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">30.0</span><span class="token punctuation">,</span> <span class="token number">50.0</span><span class="token punctuation">,</span> M_PI <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Turn clockwise by PI/2.0 and move by 15.0 meters</span>
    myrobot<span class="token punctuation">.</span><span class="token function">move</span><span class="token punctuation">(</span><span class="token operator">-</span>M_PI <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">15.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Print the distance from the robot toward the eight landmarks</span>
    cout <span class="token operator">&lt;&lt;</span> myrobot<span class="token punctuation">.</span><span class="token function">read_sensors</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>

    <span class="token comment">// Turn clockwise by PI/2.0 and move by 10.0 meters</span>
    myrobot<span class="token punctuation">.</span><span class="token function">move</span><span class="token punctuation">(</span><span class="token operator">-</span>M_PI <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">10.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Print the distance from the robot toward the eight landmarks</span>
    cout <span class="token operator">&lt;&lt;</span> myrobot<span class="token punctuation">.</span><span class="token function">read_sensors</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>

    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</pre><h1 class="mume-header" id="noise">Noise</h1>

<p>Almost all real-world sensors are noisy and require filtering. Here, we&apos;ll alter the robot&apos;s pose and measurement values to noisy ones.</p>
<p>You&#x2019;ll now alter the robot&#x2019;s  <strong>pose</strong>  and  <strong>measurement</strong>  values to  <strong>noisy</strong>  ones. Add the following noise values:</p>
<ul>
<li><code>Forward Noise</code>=5.0</li>
<li><code>Turn Noise</code>=0.1</li>
<li><code>Sense Noise</code>=5.0.</li>
</ul>
<p>Scroll down to the main function and follow the instructions.</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp"><span class="token comment">//#include &quot;src/matplotlibcpp.h&quot;//Graph Library</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;math.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;vector&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdexcept&gt;</span> <span class="token comment">// throw errors</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;random&gt;</span> <span class="token comment">//C++ 11 Random Numbers</span></span>

<span class="token comment">//namespace plt = matplotlibcpp;</span>
<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>

<span class="token comment">// Landmarks</span>
<span class="token keyword keyword-double">double</span> landmarks<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">{</span> <span class="token number">20.0</span><span class="token punctuation">,</span> <span class="token number">20.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token number">20.0</span><span class="token punctuation">,</span> <span class="token number">80.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token number">20.0</span><span class="token punctuation">,</span> <span class="token number">50.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token number">50.0</span><span class="token punctuation">,</span> <span class="token number">20.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token number">50.0</span><span class="token punctuation">,</span> <span class="token number">80.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token number">80.0</span><span class="token punctuation">,</span> <span class="token number">80.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token number">80.0</span><span class="token punctuation">,</span> <span class="token number">20.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token number">80.0</span><span class="token punctuation">,</span> <span class="token number">50.0</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Map size in meters</span>
<span class="token keyword keyword-double">double</span> world_size <span class="token operator">=</span> <span class="token number">100.0</span><span class="token punctuation">;</span>

<span class="token comment">// Random Generators</span>
random_device rd<span class="token punctuation">;</span>
mt19937 <span class="token function">gen</span><span class="token punctuation">(</span><span class="token function">rd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Global Functions</span>
<span class="token keyword keyword-double">double</span> <span class="token function">mod</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> first_term<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> second_term<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-double">double</span> <span class="token function">gen_real_random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-class">class</span> <span class="token class-name">Robot</span> <span class="token punctuation">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
    <span class="token function">Robot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Constructor</span>
        x <span class="token operator">=</span> <span class="token function">gen_real_random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> world_size<span class="token punctuation">;</span> <span class="token comment">// robot&apos;s x coordinate</span>
        y <span class="token operator">=</span> <span class="token function">gen_real_random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> world_size<span class="token punctuation">;</span> <span class="token comment">// robot&apos;s y coordinate</span>
        orient <span class="token operator">=</span> <span class="token function">gen_real_random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2.0</span> <span class="token operator">*</span> M_PI<span class="token punctuation">;</span> <span class="token comment">// robot&apos;s orientation</span>

        forward_noise <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span> <span class="token comment">//noise of the forward movement</span>
        turn_noise <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span> <span class="token comment">//noise of the turn</span>
        sense_noise <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span> <span class="token comment">//noise of the sensing</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-void">void</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> new_x<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> new_y<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> new_orient<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Set robot new position and orientation</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>new_x <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> new_x <span class="token operator">&gt;=</span> world_size<span class="token punctuation">)</span>
            <span class="token keyword keyword-throw">throw</span> std<span class="token double-colon punctuation">::</span><span class="token function">invalid_argument</span><span class="token punctuation">(</span><span class="token string">&quot;X coordinate out of bound&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>new_y <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> new_y <span class="token operator">&gt;=</span> world_size<span class="token punctuation">)</span>
            <span class="token keyword keyword-throw">throw</span> std<span class="token double-colon punctuation">::</span><span class="token function">invalid_argument</span><span class="token punctuation">(</span><span class="token string">&quot;Y coordinate out of bound&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>new_orient <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> new_orient <span class="token operator">&gt;=</span> <span class="token number">2</span> <span class="token operator">*</span> M_PI<span class="token punctuation">)</span>
            <span class="token keyword keyword-throw">throw</span> std<span class="token double-colon punctuation">::</span><span class="token function">invalid_argument</span><span class="token punctuation">(</span><span class="token string">&quot;Orientation must be in [0..2pi]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        x <span class="token operator">=</span> new_x<span class="token punctuation">;</span>
        y <span class="token operator">=</span> new_y<span class="token punctuation">;</span>
        orient <span class="token operator">=</span> new_orient<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-void">void</span> <span class="token function">set_noise</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> new_forward_noise<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> new_turn_noise<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> new_sense_noise<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Simulate noise, often useful in particle filters</span>
        forward_noise <span class="token operator">=</span> new_forward_noise<span class="token punctuation">;</span>
        turn_noise <span class="token operator">=</span> new_turn_noise<span class="token punctuation">;</span>
        sense_noise <span class="token operator">=</span> new_sense_noise<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    vector<span class="token operator">&lt;</span><span class="token keyword keyword-double">double</span><span class="token operator">&gt;</span> <span class="token function">sense</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Measure the distances from the robot toward the landmarks</span>
        vector<span class="token operator">&lt;</span><span class="token keyword keyword-double">double</span><span class="token operator">&gt;</span> <span class="token function">z</span><span class="token punctuation">(</span><span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>landmarks<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>landmarks<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-double">double</span> dist<span class="token punctuation">;</span>

        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>landmarks<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>landmarks<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            dist <span class="token operator">=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token punctuation">(</span>x <span class="token operator">-</span> landmarks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token punctuation">(</span>y <span class="token operator">-</span> landmarks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            dist <span class="token operator">+=</span> <span class="token function">gen_gauss_random</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> sense_noise<span class="token punctuation">)</span><span class="token punctuation">;</span>
            z<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> dist<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-return">return</span> z<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    Robot <span class="token function">move</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> turn<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> forward<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>forward <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token keyword keyword-throw">throw</span> std<span class="token double-colon punctuation">::</span><span class="token function">invalid_argument</span><span class="token punctuation">(</span><span class="token string">&quot;Robot cannot move backward&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// turn, and add randomness to the turning command</span>
        orient <span class="token operator">=</span> orient <span class="token operator">+</span> turn <span class="token operator">+</span> <span class="token function">gen_gauss_random</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> turn_noise<span class="token punctuation">)</span><span class="token punctuation">;</span>
        orient <span class="token operator">=</span> <span class="token function">mod</span><span class="token punctuation">(</span>orient<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> M_PI<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// move, and add randomness to the motion command</span>
        <span class="token keyword keyword-double">double</span> dist <span class="token operator">=</span> forward <span class="token operator">+</span> <span class="token function">gen_gauss_random</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> forward_noise<span class="token punctuation">)</span><span class="token punctuation">;</span>
        x <span class="token operator">=</span> x <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token function">cos</span><span class="token punctuation">(</span>orient<span class="token punctuation">)</span> <span class="token operator">*</span> dist<span class="token punctuation">)</span><span class="token punctuation">;</span>
        y <span class="token operator">=</span> y <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token function">sin</span><span class="token punctuation">(</span>orient<span class="token punctuation">)</span> <span class="token operator">*</span> dist<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// cyclic truncate</span>
        x <span class="token operator">=</span> <span class="token function">mod</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> world_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
        y <span class="token operator">=</span> <span class="token function">mod</span><span class="token punctuation">(</span>y<span class="token punctuation">,</span> world_size<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// set particle</span>
        Robot res<span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> orient<span class="token punctuation">)</span><span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">set_noise</span><span class="token punctuation">(</span>forward_noise<span class="token punctuation">,</span> turn_noise<span class="token punctuation">,</span> sense_noise<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword keyword-return">return</span> res<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    string <span class="token function">show_pose</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Returns the robot current position and orientation in a string format</span>
        <span class="token keyword keyword-return">return</span> <span class="token string">&quot;[x=&quot;</span> <span class="token operator">+</span> <span class="token function">to_string</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; y=&quot;</span> <span class="token operator">+</span> <span class="token function">to_string</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; orient=&quot;</span> <span class="token operator">+</span> <span class="token function">to_string</span><span class="token punctuation">(</span>orient<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    string <span class="token function">read_sensors</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Returns all the distances from the robot toward the landmarks</span>
        vector<span class="token operator">&lt;</span><span class="token keyword keyword-double">double</span><span class="token operator">&gt;</span> z <span class="token operator">=</span> <span class="token function">sense</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        string readings <span class="token operator">=</span> <span class="token string">&quot;[&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> z<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            readings <span class="token operator">+=</span> <span class="token function">to_string</span><span class="token punctuation">(</span>z<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        readings<span class="token punctuation">[</span>readings<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&apos;]&apos;</span><span class="token punctuation">;</span>

        <span class="token keyword keyword-return">return</span> readings<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-double">double</span> <span class="token function">measurement_prob</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span><span class="token keyword keyword-double">double</span><span class="token operator">&gt;</span> measurement<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Calculates how likely a measurement should be</span>
        <span class="token keyword keyword-double">double</span> prob <span class="token operator">=</span> <span class="token number">1.0</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-double">double</span> dist<span class="token punctuation">;</span>

        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>landmarks<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>landmarks<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            dist <span class="token operator">=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token punctuation">(</span>x <span class="token operator">-</span> landmarks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token punctuation">(</span>y <span class="token operator">-</span> landmarks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            prob <span class="token operator">*=</span> <span class="token function">gaussian</span><span class="token punctuation">(</span>dist<span class="token punctuation">,</span> sense_noise<span class="token punctuation">,</span> measurement<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword keyword-return">return</span> prob<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-double">double</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> orient<span class="token punctuation">;</span> <span class="token comment">//robot poses</span>
    <span class="token keyword keyword-double">double</span> forward_noise<span class="token punctuation">,</span> turn_noise<span class="token punctuation">,</span> sense_noise<span class="token punctuation">;</span> <span class="token comment">//robot noises</span>

<span class="token keyword keyword-private">private</span><span class="token operator">:</span>
    <span class="token keyword keyword-double">double</span> <span class="token function">gen_gauss_random</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> mean<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> variance<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Gaussian random</span>
        normal_distribution<span class="token operator">&lt;</span><span class="token keyword keyword-double">double</span><span class="token operator">&gt;</span> <span class="token function">gauss_dist</span><span class="token punctuation">(</span>mean<span class="token punctuation">,</span> variance<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> <span class="token function">gauss_dist</span><span class="token punctuation">(</span>gen<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-double">double</span> <span class="token function">gaussian</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> mu<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> sigma<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> x<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Probability of x for 1-dim Gaussian with mean mu and var. sigma</span>
        <span class="token keyword keyword-return">return</span> <span class="token function">exp</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token punctuation">(</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token punctuation">(</span>mu <span class="token operator">-</span> x<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token function">pow</span><span class="token punctuation">(</span>sigma<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token number">2.0</span> <span class="token operator">*</span> M_PI <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token function">pow</span><span class="token punctuation">(</span>sigma<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Functions</span>
<span class="token keyword keyword-double">double</span> <span class="token function">gen_real_random</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Generate real random between 0 and 1</span>
    uniform_real_distribution<span class="token operator">&lt;</span><span class="token keyword keyword-double">double</span><span class="token operator">&gt;</span> <span class="token function">real_dist</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//Real</span>
    <span class="token keyword keyword-return">return</span> <span class="token function">real_dist</span><span class="token punctuation">(</span>gen<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-double">double</span> <span class="token function">mod</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> first_term<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> second_term<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Compute the modulus</span>
    <span class="token keyword keyword-return">return</span> first_term <span class="token operator">-</span> <span class="token punctuation">(</span>second_term<span class="token punctuation">)</span><span class="token operator">*</span><span class="token function">floor</span><span class="token punctuation">(</span>first_term <span class="token operator">/</span> <span class="token punctuation">(</span>second_term<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-double">double</span> <span class="token function">evaluation</span><span class="token punctuation">(</span>Robot r<span class="token punctuation">,</span> Robot p<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> n<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">//Calculate the mean error of the system</span>
    <span class="token keyword keyword-double">double</span> sum <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//the second part is because of world&apos;s cyclicity</span>
        <span class="token keyword keyword-double">double</span> dx <span class="token operator">=</span> <span class="token function">mod</span><span class="token punctuation">(</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>x <span class="token operator">-</span> r<span class="token punctuation">.</span>x <span class="token operator">+</span> <span class="token punctuation">(</span>world_size <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> world_size<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span>world_size <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-double">double</span> dy <span class="token operator">=</span> <span class="token function">mod</span><span class="token punctuation">(</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">-</span> r<span class="token punctuation">.</span>y <span class="token operator">+</span> <span class="token punctuation">(</span>world_size <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> world_size<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span>world_size <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-double">double</span> err <span class="token operator">=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token function">pow</span><span class="token punctuation">(</span>dx<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">pow</span><span class="token punctuation">(</span>dy<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sum <span class="token operator">+=</span> err<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-return">return</span> sum <span class="token operator">/</span> n<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword keyword-double">double</span> <span class="token function">max</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> arr<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> n<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Identify the max element in an array</span>
    <span class="token keyword keyword-double">double</span> max <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&gt;</span> max<span class="token punctuation">)</span>
            max <span class="token operator">=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-return">return</span> max<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">/*
void visualization(int n, Robot robot, int step, Robot p[], Robot pr[])
{
	//Draw the robot, landmarks, particles and resampled particles on a graph
	
    //Graph Format
    plt::title(&quot;MCL, step &quot; + to_string(step));
    plt::xlim(0, 100);
    plt::ylim(0, 100);

    //Draw particles in green
    for (int i = 0; i &lt; n; i++) {
        plt::plot({ p[i].x }, { p[i].y }, &quot;go&quot;);
    }

    //Draw resampled particles in yellow
    for (int i = 0; i &lt; n; i++) {
        plt::plot({ pr[i].x }, { pr[i].y }, &quot;yo&quot;);
    }

    //Draw landmarks in red
    for (int i = 0; i &lt; sizeof(landmarks) / sizeof(landmarks[0]); i++) {
        plt::plot({ landmarks[i][0] }, { landmarks[i][1] }, &quot;ro&quot;);
    }
    
    //Draw robot position in blue
    plt::plot({ robot.x }, { robot.y }, &quot;bo&quot;);

	//Save the image and close the plot
    plt::save(&quot;./Images/Step&quot; + to_string(step) + &quot;.png&quot;);
    plt::clf();
}
*/</span>

<span class="token comment">//####   DON&apos;T MODIFY ANYTHING ABOVE HERE! ENTER CODE BELOW ####</span>
<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    Robot myrobot<span class="token punctuation">;</span>
    <span class="token comment">// Simulate Noise</span>
    <span class="token comment">// Forward Noise=5.0, Turn Noise=0.1,Sense Noise=5.0</span>
    myrobot<span class="token punctuation">.</span><span class="token function">set_noise</span><span class="token punctuation">(</span><span class="token number">5.0</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">5.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    myrobot<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">30.0</span><span class="token punctuation">,</span> <span class="token number">50.0</span><span class="token punctuation">,</span> M_PI <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    myrobot<span class="token punctuation">.</span><span class="token function">move</span><span class="token punctuation">(</span><span class="token operator">-</span>M_PI <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">15.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cout <span class="token operator">&lt;&lt;</span> myrobot<span class="token punctuation">.</span><span class="token function">read_sensors</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    myrobot<span class="token punctuation">.</span><span class="token function">move</span><span class="token punctuation">(</span><span class="token operator">-</span>M_PI <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">10.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cout <span class="token operator">&lt;&lt;</span> myrobot<span class="token punctuation">.</span><span class="token function">read_sensors</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>

    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</pre><h1 class="mume-header" id="particle-filters">Particle Filters</h1>

<p>Now, it&apos;s time to code the particle filter, which is the most essential step in the MCL algorithm. As we saw previously, the MCL algorithm consists of two main sections.</p>
<p>In the first part of the first section, particles are generated and motion is assigned to each of them. In this section, we&apos;ll be coding this part by generating the particles and simulating motion to each one of them.</p>
<p>First, we generate the particles. Inside the 2D map of size 100x100 meters, we randomly and uniformly spread 1000 particles. To replicate real-world conditions, we&apos;d simulate noise and add random Gaussian digits to the particle forward turn, and sensing values. Remember that each particle represents a guess of where the robot might be. Then, we&apos;d simulate motion for each of these particles by rotating them and moving them forward.</p>
<p>See the <a href="https://youtu.be/UN9e0li6W38">video here</a>.</p>
<h3 class="mume-header" id="1-generating-particles">1- Generating Particles</h3>

<p>You&apos;ll first  <strong>generate</strong>  1000 particles by uniformly and randomly spreading them in the 2D map. To replicate real world conditions, you&#x2019;ll  <strong>simulate noise</strong>  and add random Gaussian digits to the particle forward, turn and sensing values.</p>
<ul>
<li>Loop over the set of particles</li>
<li>For each particle add <code>Forward_Noise=0.05</code>, <code>Turn_Noise=0.05</code>, and <code>Sense_Noise=5.0</code></li>
<li>Print the pose of each particle on a single line</li>
</ul>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp"><span class="token comment">//#include &quot;src/matplotlibcpp.h&quot;//Graph Library</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;math.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;vector&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdexcept&gt;</span> <span class="token comment">// throw errors</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;random&gt;</span> <span class="token comment">//C++ 11 Random Numbers</span></span>

<span class="token comment">//namespace plt = matplotlibcpp;</span>
<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>

<span class="token comment">// Landmarks</span>
<span class="token keyword keyword-double">double</span> landmarks<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">{</span> <span class="token number">20.0</span><span class="token punctuation">,</span> <span class="token number">20.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token number">20.0</span><span class="token punctuation">,</span> <span class="token number">80.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token number">20.0</span><span class="token punctuation">,</span> <span class="token number">50.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token number">50.0</span><span class="token punctuation">,</span> <span class="token number">20.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token number">50.0</span><span class="token punctuation">,</span> <span class="token number">80.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token number">80.0</span><span class="token punctuation">,</span> <span class="token number">80.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token number">80.0</span><span class="token punctuation">,</span> <span class="token number">20.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token number">80.0</span><span class="token punctuation">,</span> <span class="token number">50.0</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Map size in meters</span>
<span class="token keyword keyword-double">double</span> world_size <span class="token operator">=</span> <span class="token number">100.0</span><span class="token punctuation">;</span>

<span class="token comment">// Random Generators</span>
random_device rd<span class="token punctuation">;</span>
mt19937 <span class="token function">gen</span><span class="token punctuation">(</span><span class="token function">rd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Global Functions</span>
<span class="token keyword keyword-double">double</span> <span class="token function">mod</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> first_term<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> second_term<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-double">double</span> <span class="token function">gen_real_random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-class">class</span> <span class="token class-name">Robot</span> <span class="token punctuation">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
    <span class="token function">Robot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Constructor</span>
        x <span class="token operator">=</span> <span class="token function">gen_real_random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> world_size<span class="token punctuation">;</span> <span class="token comment">// robot&apos;s x coordinate</span>
        y <span class="token operator">=</span> <span class="token function">gen_real_random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> world_size<span class="token punctuation">;</span> <span class="token comment">// robot&apos;s y coordinate</span>
        orient <span class="token operator">=</span> <span class="token function">gen_real_random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2.0</span> <span class="token operator">*</span> M_PI<span class="token punctuation">;</span> <span class="token comment">// robot&apos;s orientation</span>

        forward_noise <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span> <span class="token comment">//noise of the forward movement</span>
        turn_noise <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span> <span class="token comment">//noise of the turn</span>
        sense_noise <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span> <span class="token comment">//noise of the sensing</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-void">void</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> new_x<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> new_y<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> new_orient<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Set robot new position and orientation</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>new_x <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> new_x <span class="token operator">&gt;=</span> world_size<span class="token punctuation">)</span>
            <span class="token keyword keyword-throw">throw</span> std<span class="token double-colon punctuation">::</span><span class="token function">invalid_argument</span><span class="token punctuation">(</span><span class="token string">&quot;X coordinate out of bound&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>new_y <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> new_y <span class="token operator">&gt;=</span> world_size<span class="token punctuation">)</span>
            <span class="token keyword keyword-throw">throw</span> std<span class="token double-colon punctuation">::</span><span class="token function">invalid_argument</span><span class="token punctuation">(</span><span class="token string">&quot;Y coordinate out of bound&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>new_orient <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> new_orient <span class="token operator">&gt;=</span> <span class="token number">2</span> <span class="token operator">*</span> M_PI<span class="token punctuation">)</span>
            <span class="token keyword keyword-throw">throw</span> std<span class="token double-colon punctuation">::</span><span class="token function">invalid_argument</span><span class="token punctuation">(</span><span class="token string">&quot;Orientation must be in [0..2pi]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        x <span class="token operator">=</span> new_x<span class="token punctuation">;</span>
        y <span class="token operator">=</span> new_y<span class="token punctuation">;</span>
        orient <span class="token operator">=</span> new_orient<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-void">void</span> <span class="token function">set_noise</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> new_forward_noise<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> new_turn_noise<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> new_sense_noise<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Simulate noise, often useful in particle filters</span>
        forward_noise <span class="token operator">=</span> new_forward_noise<span class="token punctuation">;</span>
        turn_noise <span class="token operator">=</span> new_turn_noise<span class="token punctuation">;</span>
        sense_noise <span class="token operator">=</span> new_sense_noise<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    vector<span class="token operator">&lt;</span><span class="token keyword keyword-double">double</span><span class="token operator">&gt;</span> <span class="token function">sense</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Measure the distances from the robot toward the landmarks</span>
        vector<span class="token operator">&lt;</span><span class="token keyword keyword-double">double</span><span class="token operator">&gt;</span> <span class="token function">z</span><span class="token punctuation">(</span><span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>landmarks<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>landmarks<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-double">double</span> dist<span class="token punctuation">;</span>

        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>landmarks<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>landmarks<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            dist <span class="token operator">=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token punctuation">(</span>x <span class="token operator">-</span> landmarks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token punctuation">(</span>y <span class="token operator">-</span> landmarks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            dist <span class="token operator">+=</span> <span class="token function">gen_gauss_random</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> sense_noise<span class="token punctuation">)</span><span class="token punctuation">;</span>
            z<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> dist<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-return">return</span> z<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    Robot <span class="token function">move</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> turn<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> forward<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>forward <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token keyword keyword-throw">throw</span> std<span class="token double-colon punctuation">::</span><span class="token function">invalid_argument</span><span class="token punctuation">(</span><span class="token string">&quot;Robot cannot move backward&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// turn, and add randomness to the turning command</span>
        orient <span class="token operator">=</span> orient <span class="token operator">+</span> turn <span class="token operator">+</span> <span class="token function">gen_gauss_random</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> turn_noise<span class="token punctuation">)</span><span class="token punctuation">;</span>
        orient <span class="token operator">=</span> <span class="token function">mod</span><span class="token punctuation">(</span>orient<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> M_PI<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// move, and add randomness to the motion command</span>
        <span class="token keyword keyword-double">double</span> dist <span class="token operator">=</span> forward <span class="token operator">+</span> <span class="token function">gen_gauss_random</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> forward_noise<span class="token punctuation">)</span><span class="token punctuation">;</span>
        x <span class="token operator">=</span> x <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token function">cos</span><span class="token punctuation">(</span>orient<span class="token punctuation">)</span> <span class="token operator">*</span> dist<span class="token punctuation">)</span><span class="token punctuation">;</span>
        y <span class="token operator">=</span> y <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token function">sin</span><span class="token punctuation">(</span>orient<span class="token punctuation">)</span> <span class="token operator">*</span> dist<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// cyclic truncate</span>
        x <span class="token operator">=</span> <span class="token function">mod</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> world_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
        y <span class="token operator">=</span> <span class="token function">mod</span><span class="token punctuation">(</span>y<span class="token punctuation">,</span> world_size<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// set particle</span>
        Robot res<span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> orient<span class="token punctuation">)</span><span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">set_noise</span><span class="token punctuation">(</span>forward_noise<span class="token punctuation">,</span> turn_noise<span class="token punctuation">,</span> sense_noise<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword keyword-return">return</span> res<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    string <span class="token function">show_pose</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Returns the robot current position and orientation in a string format</span>
        <span class="token keyword keyword-return">return</span> <span class="token string">&quot;[x=&quot;</span> <span class="token operator">+</span> <span class="token function">to_string</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; y=&quot;</span> <span class="token operator">+</span> <span class="token function">to_string</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; orient=&quot;</span> <span class="token operator">+</span> <span class="token function">to_string</span><span class="token punctuation">(</span>orient<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    string <span class="token function">read_sensors</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Returns all the distances from the robot toward the landmarks</span>
        vector<span class="token operator">&lt;</span><span class="token keyword keyword-double">double</span><span class="token operator">&gt;</span> z <span class="token operator">=</span> <span class="token function">sense</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        string readings <span class="token operator">=</span> <span class="token string">&quot;[&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> z<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            readings <span class="token operator">+=</span> <span class="token function">to_string</span><span class="token punctuation">(</span>z<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        readings<span class="token punctuation">[</span>readings<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&apos;]&apos;</span><span class="token punctuation">;</span>

        <span class="token keyword keyword-return">return</span> readings<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-double">double</span> <span class="token function">measurement_prob</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span><span class="token keyword keyword-double">double</span><span class="token operator">&gt;</span> measurement<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Calculates how likely a measurement should be</span>
        <span class="token keyword keyword-double">double</span> prob <span class="token operator">=</span> <span class="token number">1.0</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-double">double</span> dist<span class="token punctuation">;</span>

        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>landmarks<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>landmarks<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            dist <span class="token operator">=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token punctuation">(</span>x <span class="token operator">-</span> landmarks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token punctuation">(</span>y <span class="token operator">-</span> landmarks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            prob <span class="token operator">*=</span> <span class="token function">gaussian</span><span class="token punctuation">(</span>dist<span class="token punctuation">,</span> sense_noise<span class="token punctuation">,</span> measurement<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword keyword-return">return</span> prob<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-double">double</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> orient<span class="token punctuation">;</span> <span class="token comment">//robot poses</span>
    <span class="token keyword keyword-double">double</span> forward_noise<span class="token punctuation">,</span> turn_noise<span class="token punctuation">,</span> sense_noise<span class="token punctuation">;</span> <span class="token comment">//robot noises</span>

<span class="token keyword keyword-private">private</span><span class="token operator">:</span>
    <span class="token keyword keyword-double">double</span> <span class="token function">gen_gauss_random</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> mean<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> variance<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Gaussian random</span>
        normal_distribution<span class="token operator">&lt;</span><span class="token keyword keyword-double">double</span><span class="token operator">&gt;</span> <span class="token function">gauss_dist</span><span class="token punctuation">(</span>mean<span class="token punctuation">,</span> variance<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> <span class="token function">gauss_dist</span><span class="token punctuation">(</span>gen<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-double">double</span> <span class="token function">gaussian</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> mu<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> sigma<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> x<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Probability of x for 1-dim Gaussian with mean mu and var. sigma</span>
        <span class="token keyword keyword-return">return</span> <span class="token function">exp</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token punctuation">(</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token punctuation">(</span>mu <span class="token operator">-</span> x<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token function">pow</span><span class="token punctuation">(</span>sigma<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token number">2.0</span> <span class="token operator">*</span> M_PI <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token function">pow</span><span class="token punctuation">(</span>sigma<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Functions</span>
<span class="token keyword keyword-double">double</span> <span class="token function">gen_real_random</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Generate real random between 0 and 1</span>
    uniform_real_distribution<span class="token operator">&lt;</span><span class="token keyword keyword-double">double</span><span class="token operator">&gt;</span> <span class="token function">real_dist</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//Real</span>
    <span class="token keyword keyword-return">return</span> <span class="token function">real_dist</span><span class="token punctuation">(</span>gen<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-double">double</span> <span class="token function">mod</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> first_term<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> second_term<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Compute the modulus</span>
    <span class="token keyword keyword-return">return</span> first_term <span class="token operator">-</span> <span class="token punctuation">(</span>second_term<span class="token punctuation">)</span><span class="token operator">*</span><span class="token function">floor</span><span class="token punctuation">(</span>first_term <span class="token operator">/</span> <span class="token punctuation">(</span>second_term<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-double">double</span> <span class="token function">evaluation</span><span class="token punctuation">(</span>Robot r<span class="token punctuation">,</span> Robot p<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> n<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">//Calculate the mean error of the system</span>
    <span class="token keyword keyword-double">double</span> sum <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//the second part is because of world&apos;s cyclicity</span>
        <span class="token keyword keyword-double">double</span> dx <span class="token operator">=</span> <span class="token function">mod</span><span class="token punctuation">(</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>x <span class="token operator">-</span> r<span class="token punctuation">.</span>x <span class="token operator">+</span> <span class="token punctuation">(</span>world_size <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> world_size<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span>world_size <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-double">double</span> dy <span class="token operator">=</span> <span class="token function">mod</span><span class="token punctuation">(</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">-</span> r<span class="token punctuation">.</span>y <span class="token operator">+</span> <span class="token punctuation">(</span>world_size <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> world_size<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span>world_size <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-double">double</span> err <span class="token operator">=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token function">pow</span><span class="token punctuation">(</span>dx<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">pow</span><span class="token punctuation">(</span>dy<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sum <span class="token operator">+=</span> err<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-return">return</span> sum <span class="token operator">/</span> n<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword keyword-double">double</span> <span class="token function">max</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> arr<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> n<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Identify the max element in an array</span>
    <span class="token keyword keyword-double">double</span> max <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&gt;</span> max<span class="token punctuation">)</span>
            max <span class="token operator">=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-return">return</span> max<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">/*
void visualization(int n, Robot robot, int step, Robot p[], Robot pr[])
{
	//Draw the robot, landmarks, particles and resampled particles on a graph
	
    //Graph Format
    plt::title(&quot;MCL, step &quot; + to_string(step));
    plt::xlim(0, 100);
    plt::ylim(0, 100);

    //Draw particles in green
    for (int i = 0; i &lt; n; i++) {
        plt::plot({ p[i].x }, { p[i].y }, &quot;go&quot;);
    }

    //Draw resampled particles in yellow
    for (int i = 0; i &lt; n; i++) {
        plt::plot({ pr[i].x }, { pr[i].y }, &quot;yo&quot;);
    }

    //Draw landmarks in red
    for (int i = 0; i &lt; sizeof(landmarks) / sizeof(landmarks[0]); i++) {
        plt::plot({ landmarks[i][0] }, { landmarks[i][1] }, &quot;ro&quot;);
    }
    
    //Draw robot position in blue
    plt::plot({ robot.x }, { robot.y }, &quot;bo&quot;);

	//Save the image and close the plot
    plt::save(&quot;./Images/Step&quot; + to_string(step) + &quot;.png&quot;);
    plt::clf();
}
*/</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">//Practice Interfacing with Robot Class</span>
    Robot myrobot<span class="token punctuation">;</span>
    myrobot<span class="token punctuation">.</span><span class="token function">set_noise</span><span class="token punctuation">(</span><span class="token number">5.0</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">5.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    myrobot<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">30.0</span><span class="token punctuation">,</span> <span class="token number">50.0</span><span class="token punctuation">,</span> M_PI <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    myrobot<span class="token punctuation">.</span><span class="token function">move</span><span class="token punctuation">(</span><span class="token operator">-</span>M_PI <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">15.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//cout &lt;&lt; myrobot.read_sensors() &lt;&lt; endl;</span>
    myrobot<span class="token punctuation">.</span><span class="token function">move</span><span class="token punctuation">(</span><span class="token operator">-</span>M_PI <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">10.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//cout &lt;&lt; myrobot.read_sensors() &lt;&lt; endl;</span>

    <span class="token comment">//####   DON&apos;T MODIFY ANYTHING ABOVE HERE! ENTER CODE BELOW ####</span>
    
    <span class="token comment">// Instantiating 1000 Particles each with a random position and orientation</span>
    <span class="token keyword keyword-int">int</span> n <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span>
    Robot p<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">;</span> 
    <span class="token comment">//Your job is to loop over the set of particles</span>
    <span class="token comment">//For each particle add noise: Forward_Noise=0.05, Turn_Noise=0.05, and Sense_Noise=5.0</span>
    <span class="token comment">//And print its pose on a single line</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">set_noise</span><span class="token punctuation">(</span><span class="token number">0.05</span><span class="token punctuation">,</span> <span class="token number">0.05</span><span class="token punctuation">,</span> <span class="token number">5.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cout <span class="token operator">&lt;&lt;</span> p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">show_pose</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</pre><h3 class="mume-header" id="2-simulating-motion">2- Simulating Motion</h3>

<p>Now that you&apos;ve generated the particles, you&#x2019;ll  <strong>simulate</strong>  motion for each one of them by  <strong>rotating</strong>  them and  <strong>moving</strong>  them forward.</p>
<ul>
<li>Create a new particle set p2</li>
<li>Rotate each particle by 0.1 and move it forward by 5.0</li>
<li>Assign p2 to p and print the particle poses, each on single line</li>
</ul>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp"><span class="token comment">//#include &quot;src/matplotlibcpp.h&quot;//Graph Library</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;math.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;vector&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdexcept&gt;</span> <span class="token comment">// throw errors</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;random&gt;</span> <span class="token comment">//C++ 11 Random Numbers</span></span>

<span class="token comment">//namespace plt = matplotlibcpp;</span>
<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>

<span class="token comment">// Landmarks</span>
<span class="token keyword keyword-double">double</span> landmarks<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">{</span> <span class="token number">20.0</span><span class="token punctuation">,</span> <span class="token number">20.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token number">20.0</span><span class="token punctuation">,</span> <span class="token number">80.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token number">20.0</span><span class="token punctuation">,</span> <span class="token number">50.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token number">50.0</span><span class="token punctuation">,</span> <span class="token number">20.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token number">50.0</span><span class="token punctuation">,</span> <span class="token number">80.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token number">80.0</span><span class="token punctuation">,</span> <span class="token number">80.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token number">80.0</span><span class="token punctuation">,</span> <span class="token number">20.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token number">80.0</span><span class="token punctuation">,</span> <span class="token number">50.0</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Map size in meters</span>
<span class="token keyword keyword-double">double</span> world_size <span class="token operator">=</span> <span class="token number">100.0</span><span class="token punctuation">;</span>

<span class="token comment">// Random Generators</span>
random_device rd<span class="token punctuation">;</span>
mt19937 <span class="token function">gen</span><span class="token punctuation">(</span><span class="token function">rd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Global Functions</span>
<span class="token keyword keyword-double">double</span> <span class="token function">mod</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> first_term<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> second_term<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-double">double</span> <span class="token function">gen_real_random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-class">class</span> <span class="token class-name">Robot</span> <span class="token punctuation">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
    <span class="token function">Robot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Constructor</span>
        x <span class="token operator">=</span> <span class="token function">gen_real_random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> world_size<span class="token punctuation">;</span> <span class="token comment">// robot&apos;s x coordinate</span>
        y <span class="token operator">=</span> <span class="token function">gen_real_random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> world_size<span class="token punctuation">;</span> <span class="token comment">// robot&apos;s y coordinate</span>
        orient <span class="token operator">=</span> <span class="token function">gen_real_random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2.0</span> <span class="token operator">*</span> M_PI<span class="token punctuation">;</span> <span class="token comment">// robot&apos;s orientation</span>

        forward_noise <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span> <span class="token comment">//noise of the forward movement</span>
        turn_noise <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span> <span class="token comment">//noise of the turn</span>
        sense_noise <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span> <span class="token comment">//noise of the sensing</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-void">void</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> new_x<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> new_y<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> new_orient<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Set robot new position and orientation</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>new_x <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> new_x <span class="token operator">&gt;=</span> world_size<span class="token punctuation">)</span>
            <span class="token keyword keyword-throw">throw</span> std<span class="token double-colon punctuation">::</span><span class="token function">invalid_argument</span><span class="token punctuation">(</span><span class="token string">&quot;X coordinate out of bound&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>new_y <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> new_y <span class="token operator">&gt;=</span> world_size<span class="token punctuation">)</span>
            <span class="token keyword keyword-throw">throw</span> std<span class="token double-colon punctuation">::</span><span class="token function">invalid_argument</span><span class="token punctuation">(</span><span class="token string">&quot;Y coordinate out of bound&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>new_orient <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> new_orient <span class="token operator">&gt;=</span> <span class="token number">2</span> <span class="token operator">*</span> M_PI<span class="token punctuation">)</span>
            <span class="token keyword keyword-throw">throw</span> std<span class="token double-colon punctuation">::</span><span class="token function">invalid_argument</span><span class="token punctuation">(</span><span class="token string">&quot;Orientation must be in [0..2pi]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        x <span class="token operator">=</span> new_x<span class="token punctuation">;</span>
        y <span class="token operator">=</span> new_y<span class="token punctuation">;</span>
        orient <span class="token operator">=</span> new_orient<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-void">void</span> <span class="token function">set_noise</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> new_forward_noise<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> new_turn_noise<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> new_sense_noise<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Simulate noise, often useful in particle filters</span>
        forward_noise <span class="token operator">=</span> new_forward_noise<span class="token punctuation">;</span>
        turn_noise <span class="token operator">=</span> new_turn_noise<span class="token punctuation">;</span>
        sense_noise <span class="token operator">=</span> new_sense_noise<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    vector<span class="token operator">&lt;</span><span class="token keyword keyword-double">double</span><span class="token operator">&gt;</span> <span class="token function">sense</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Measure the distances from the robot toward the landmarks</span>
        vector<span class="token operator">&lt;</span><span class="token keyword keyword-double">double</span><span class="token operator">&gt;</span> <span class="token function">z</span><span class="token punctuation">(</span><span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>landmarks<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>landmarks<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-double">double</span> dist<span class="token punctuation">;</span>

        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>landmarks<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>landmarks<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            dist <span class="token operator">=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token punctuation">(</span>x <span class="token operator">-</span> landmarks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token punctuation">(</span>y <span class="token operator">-</span> landmarks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            dist <span class="token operator">+=</span> <span class="token function">gen_gauss_random</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> sense_noise<span class="token punctuation">)</span><span class="token punctuation">;</span>
            z<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> dist<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-return">return</span> z<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    Robot <span class="token function">move</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> turn<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> forward<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>forward <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token keyword keyword-throw">throw</span> std<span class="token double-colon punctuation">::</span><span class="token function">invalid_argument</span><span class="token punctuation">(</span><span class="token string">&quot;Robot cannot move backward&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// turn, and add randomness to the turning command</span>
        orient <span class="token operator">=</span> orient <span class="token operator">+</span> turn <span class="token operator">+</span> <span class="token function">gen_gauss_random</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> turn_noise<span class="token punctuation">)</span><span class="token punctuation">;</span>
        orient <span class="token operator">=</span> <span class="token function">mod</span><span class="token punctuation">(</span>orient<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> M_PI<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// move, and add randomness to the motion command</span>
        <span class="token keyword keyword-double">double</span> dist <span class="token operator">=</span> forward <span class="token operator">+</span> <span class="token function">gen_gauss_random</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> forward_noise<span class="token punctuation">)</span><span class="token punctuation">;</span>
        x <span class="token operator">=</span> x <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token function">cos</span><span class="token punctuation">(</span>orient<span class="token punctuation">)</span> <span class="token operator">*</span> dist<span class="token punctuation">)</span><span class="token punctuation">;</span>
        y <span class="token operator">=</span> y <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token function">sin</span><span class="token punctuation">(</span>orient<span class="token punctuation">)</span> <span class="token operator">*</span> dist<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// cyclic truncate</span>
        x <span class="token operator">=</span> <span class="token function">mod</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> world_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
        y <span class="token operator">=</span> <span class="token function">mod</span><span class="token punctuation">(</span>y<span class="token punctuation">,</span> world_size<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// set particle</span>
        Robot res<span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> orient<span class="token punctuation">)</span><span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">set_noise</span><span class="token punctuation">(</span>forward_noise<span class="token punctuation">,</span> turn_noise<span class="token punctuation">,</span> sense_noise<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword keyword-return">return</span> res<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    string <span class="token function">show_pose</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Returns the robot current position and orientation in a string format</span>
        <span class="token keyword keyword-return">return</span> <span class="token string">&quot;[x=&quot;</span> <span class="token operator">+</span> <span class="token function">to_string</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; y=&quot;</span> <span class="token operator">+</span> <span class="token function">to_string</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; orient=&quot;</span> <span class="token operator">+</span> <span class="token function">to_string</span><span class="token punctuation">(</span>orient<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    string <span class="token function">read_sensors</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Returns all the distances from the robot toward the landmarks</span>
        vector<span class="token operator">&lt;</span><span class="token keyword keyword-double">double</span><span class="token operator">&gt;</span> z <span class="token operator">=</span> <span class="token function">sense</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        string readings <span class="token operator">=</span> <span class="token string">&quot;[&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> z<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            readings <span class="token operator">+=</span> <span class="token function">to_string</span><span class="token punctuation">(</span>z<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        readings<span class="token punctuation">[</span>readings<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&apos;]&apos;</span><span class="token punctuation">;</span>

        <span class="token keyword keyword-return">return</span> readings<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-double">double</span> <span class="token function">measurement_prob</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span><span class="token keyword keyword-double">double</span><span class="token operator">&gt;</span> measurement<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Calculates how likely a measurement should be</span>
        <span class="token keyword keyword-double">double</span> prob <span class="token operator">=</span> <span class="token number">1.0</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-double">double</span> dist<span class="token punctuation">;</span>

        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>landmarks<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>landmarks<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            dist <span class="token operator">=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token punctuation">(</span>x <span class="token operator">-</span> landmarks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token punctuation">(</span>y <span class="token operator">-</span> landmarks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            prob <span class="token operator">*=</span> <span class="token function">gaussian</span><span class="token punctuation">(</span>dist<span class="token punctuation">,</span> sense_noise<span class="token punctuation">,</span> measurement<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword keyword-return">return</span> prob<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-double">double</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> orient<span class="token punctuation">;</span> <span class="token comment">//robot poses</span>
    <span class="token keyword keyword-double">double</span> forward_noise<span class="token punctuation">,</span> turn_noise<span class="token punctuation">,</span> sense_noise<span class="token punctuation">;</span> <span class="token comment">//robot noises</span>

<span class="token keyword keyword-private">private</span><span class="token operator">:</span>
    <span class="token keyword keyword-double">double</span> <span class="token function">gen_gauss_random</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> mean<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> variance<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Gaussian random</span>
        normal_distribution<span class="token operator">&lt;</span><span class="token keyword keyword-double">double</span><span class="token operator">&gt;</span> <span class="token function">gauss_dist</span><span class="token punctuation">(</span>mean<span class="token punctuation">,</span> variance<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> <span class="token function">gauss_dist</span><span class="token punctuation">(</span>gen<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-double">double</span> <span class="token function">gaussian</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> mu<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> sigma<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> x<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Probability of x for 1-dim Gaussian with mean mu and var. sigma</span>
        <span class="token keyword keyword-return">return</span> <span class="token function">exp</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token punctuation">(</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token punctuation">(</span>mu <span class="token operator">-</span> x<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token function">pow</span><span class="token punctuation">(</span>sigma<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token number">2.0</span> <span class="token operator">*</span> M_PI <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token function">pow</span><span class="token punctuation">(</span>sigma<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Functions</span>
<span class="token keyword keyword-double">double</span> <span class="token function">gen_real_random</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Generate real random between 0 and 1</span>
    uniform_real_distribution<span class="token operator">&lt;</span><span class="token keyword keyword-double">double</span><span class="token operator">&gt;</span> <span class="token function">real_dist</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//Real</span>
    <span class="token keyword keyword-return">return</span> <span class="token function">real_dist</span><span class="token punctuation">(</span>gen<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-double">double</span> <span class="token function">mod</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> first_term<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> second_term<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Compute the modulus</span>
    <span class="token keyword keyword-return">return</span> first_term <span class="token operator">-</span> <span class="token punctuation">(</span>second_term<span class="token punctuation">)</span><span class="token operator">*</span><span class="token function">floor</span><span class="token punctuation">(</span>first_term <span class="token operator">/</span> <span class="token punctuation">(</span>second_term<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-double">double</span> <span class="token function">evaluation</span><span class="token punctuation">(</span>Robot r<span class="token punctuation">,</span> Robot p<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> n<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">//Calculate the mean error of the system</span>
    <span class="token keyword keyword-double">double</span> sum <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//the second part is because of world&apos;s cyclicity</span>
        <span class="token keyword keyword-double">double</span> dx <span class="token operator">=</span> <span class="token function">mod</span><span class="token punctuation">(</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>x <span class="token operator">-</span> r<span class="token punctuation">.</span>x <span class="token operator">+</span> <span class="token punctuation">(</span>world_size <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> world_size<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span>world_size <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-double">double</span> dy <span class="token operator">=</span> <span class="token function">mod</span><span class="token punctuation">(</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">-</span> r<span class="token punctuation">.</span>y <span class="token operator">+</span> <span class="token punctuation">(</span>world_size <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> world_size<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span>world_size <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-double">double</span> err <span class="token operator">=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token function">pow</span><span class="token punctuation">(</span>dx<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">pow</span><span class="token punctuation">(</span>dy<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sum <span class="token operator">+=</span> err<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-return">return</span> sum <span class="token operator">/</span> n<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword keyword-double">double</span> <span class="token function">max</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> arr<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> n<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Identify the max element in an array</span>
    <span class="token keyword keyword-double">double</span> max <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&gt;</span> max<span class="token punctuation">)</span>
            max <span class="token operator">=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-return">return</span> max<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">/*
void visualization(int n, Robot robot, int step, Robot p[], Robot pr[])
{
	//Draw the robot, landmarks, particles and resampled particles on a graph
	
    //Graph Format
    plt::title(&quot;MCL, step &quot; + to_string(step));
    plt::xlim(0, 100);
    plt::ylim(0, 100);

    //Draw particles in green
    for (int i = 0; i &lt; n; i++) {
        plt::plot({ p[i].x }, { p[i].y }, &quot;go&quot;);
    }

    //Draw resampled particles in yellow
    for (int i = 0; i &lt; n; i++) {
        plt::plot({ pr[i].x }, { pr[i].y }, &quot;yo&quot;);
    }

    //Draw landmarks in red
    for (int i = 0; i &lt; sizeof(landmarks) / sizeof(landmarks[0]); i++) {
        plt::plot({ landmarks[i][0] }, { landmarks[i][1] }, &quot;ro&quot;);
    }
    
    //Draw robot position in blue
    plt::plot({ robot.x }, { robot.y }, &quot;bo&quot;);

	//Save the image and close the plot
    plt::save(&quot;./Images/Step&quot; + to_string(step) + &quot;.png&quot;);
    plt::clf();
}
*/</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">//Practice Interfacing with Robot Class</span>
    Robot myrobot<span class="token punctuation">;</span>
    myrobot<span class="token punctuation">.</span><span class="token function">set_noise</span><span class="token punctuation">(</span><span class="token number">5.0</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">5.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    myrobot<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">30.0</span><span class="token punctuation">,</span> <span class="token number">50.0</span><span class="token punctuation">,</span> M_PI <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    myrobot<span class="token punctuation">.</span><span class="token function">move</span><span class="token punctuation">(</span><span class="token operator">-</span>M_PI <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">15.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//cout &lt;&lt; myrobot.read_sensors() &lt;&lt; endl;</span>
    myrobot<span class="token punctuation">.</span><span class="token function">move</span><span class="token punctuation">(</span><span class="token operator">-</span>M_PI <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">10.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//cout &lt;&lt; myrobot.read_sensors() &lt;&lt; endl;</span>

    <span class="token comment">// Create a set of particles</span>
    <span class="token keyword keyword-int">int</span> n <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span>
    Robot p<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">set_noise</span><span class="token punctuation">(</span><span class="token number">0.05</span><span class="token punctuation">,</span> <span class="token number">0.05</span><span class="token punctuation">,</span> <span class="token number">5.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//cout &lt;&lt; p[i].show_pose() &lt;&lt; endl;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//####   DON&apos;T MODIFY ANYTHING ABOVE HERE! ENTER CODE BELOW ####</span>

    <span class="token comment">//Now, simulate motion for each particle</span>
    <span class="token comment">//Create a new particle set &apos;p2&apos;</span>
    <span class="token comment">//Rotate each particle by 0.1 and move it forward by 5.0</span>
    <span class="token comment">//Assign p2 to p and print the particle poses, each on a single line</span>
    Robot p2<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        p2<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">move</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">5.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        p<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> p2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        cout <span class="token operator">&lt;&lt;</span> p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">show_pose</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</pre><h1 class="mume-header" id="importance-weight">Importance Weight</h1>

<p>So far, we&apos;ve generated the particles and simulated motion. Now, we should assign an importance weight to each one of the generated particles.</p>
<p>At each time step, the robot is rotating and moving forward into the map and sensing the landmarks position. These are the actual measurements denoted by <code>Z</code>. In order to assign weight to each particle, you need to compare the measurements of each particle also known as <strong>predicted measurement</strong>, to the actual robot measurement. The mismatch between the actual and predicted measurements of each particle is known as the <strong>particle importance weight</strong>. _The larger the weight the more important the particle is and the more likely it is to represent the robot&apos;s actual position.</p>
<p>In this section, we&apos;ll generate a weight vector which holds the weight values of 1000 particles.</p>
<p>See the <a href="https://youtu.be/MPJVPvjruZo">video here</a>.</p>
<p>So far, you&#x2019;ve generated the particles and simulated motion. Now, you should assign an <strong>importance weight</strong> to each one of the generated particles. Scroll down to the main function. follow the instructions and generate a weight vector which holds the weight values of the 1000 particles.</p>
<ul>
<li>Generate particle weights depending on robot&apos;s measurement</li>
<li>Print particle weights, each on a single line</li>
</ul>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp"><span class="token comment">//#include &quot;src/matplotlibcpp.h&quot;//Graph Library</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;math.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;vector&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdexcept&gt;</span> <span class="token comment">// throw errors</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;random&gt;</span> <span class="token comment">//C++ 11 Random Numbers</span></span>

<span class="token comment">//namespace plt = matplotlibcpp;</span>
<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>

<span class="token comment">// Landmarks</span>
<span class="token keyword keyword-double">double</span> landmarks<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">{</span> <span class="token number">20.0</span><span class="token punctuation">,</span> <span class="token number">20.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token number">20.0</span><span class="token punctuation">,</span> <span class="token number">80.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token number">20.0</span><span class="token punctuation">,</span> <span class="token number">50.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token number">50.0</span><span class="token punctuation">,</span> <span class="token number">20.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token number">50.0</span><span class="token punctuation">,</span> <span class="token number">80.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token number">80.0</span><span class="token punctuation">,</span> <span class="token number">80.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token number">80.0</span><span class="token punctuation">,</span> <span class="token number">20.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token number">80.0</span><span class="token punctuation">,</span> <span class="token number">50.0</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Map size in meters</span>
<span class="token keyword keyword-double">double</span> world_size <span class="token operator">=</span> <span class="token number">100.0</span><span class="token punctuation">;</span>

<span class="token comment">// Random Generators</span>
random_device rd<span class="token punctuation">;</span>
mt19937 <span class="token function">gen</span><span class="token punctuation">(</span><span class="token function">rd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Global Functions</span>
<span class="token keyword keyword-double">double</span> <span class="token function">mod</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> first_term<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> second_term<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-double">double</span> <span class="token function">gen_real_random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-class">class</span> <span class="token class-name">Robot</span> <span class="token punctuation">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
    <span class="token function">Robot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Constructor</span>
        x <span class="token operator">=</span> <span class="token function">gen_real_random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> world_size<span class="token punctuation">;</span> <span class="token comment">// robot&apos;s x coordinate</span>
        y <span class="token operator">=</span> <span class="token function">gen_real_random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> world_size<span class="token punctuation">;</span> <span class="token comment">// robot&apos;s y coordinate</span>
        orient <span class="token operator">=</span> <span class="token function">gen_real_random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2.0</span> <span class="token operator">*</span> M_PI<span class="token punctuation">;</span> <span class="token comment">// robot&apos;s orientation</span>

        forward_noise <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span> <span class="token comment">//noise of the forward movement</span>
        turn_noise <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span> <span class="token comment">//noise of the turn</span>
        sense_noise <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span> <span class="token comment">//noise of the sensing</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-void">void</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> new_x<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> new_y<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> new_orient<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Set robot new position and orientation</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>new_x <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> new_x <span class="token operator">&gt;=</span> world_size<span class="token punctuation">)</span>
            <span class="token keyword keyword-throw">throw</span> std<span class="token double-colon punctuation">::</span><span class="token function">invalid_argument</span><span class="token punctuation">(</span><span class="token string">&quot;X coordinate out of bound&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>new_y <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> new_y <span class="token operator">&gt;=</span> world_size<span class="token punctuation">)</span>
            <span class="token keyword keyword-throw">throw</span> std<span class="token double-colon punctuation">::</span><span class="token function">invalid_argument</span><span class="token punctuation">(</span><span class="token string">&quot;Y coordinate out of bound&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>new_orient <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> new_orient <span class="token operator">&gt;=</span> <span class="token number">2</span> <span class="token operator">*</span> M_PI<span class="token punctuation">)</span>
            <span class="token keyword keyword-throw">throw</span> std<span class="token double-colon punctuation">::</span><span class="token function">invalid_argument</span><span class="token punctuation">(</span><span class="token string">&quot;Orientation must be in [0..2pi]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        x <span class="token operator">=</span> new_x<span class="token punctuation">;</span>
        y <span class="token operator">=</span> new_y<span class="token punctuation">;</span>
        orient <span class="token operator">=</span> new_orient<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-void">void</span> <span class="token function">set_noise</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> new_forward_noise<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> new_turn_noise<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> new_sense_noise<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Simulate noise, often useful in particle filters</span>
        forward_noise <span class="token operator">=</span> new_forward_noise<span class="token punctuation">;</span>
        turn_noise <span class="token operator">=</span> new_turn_noise<span class="token punctuation">;</span>
        sense_noise <span class="token operator">=</span> new_sense_noise<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    vector<span class="token operator">&lt;</span><span class="token keyword keyword-double">double</span><span class="token operator">&gt;</span> <span class="token function">sense</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Measure the distances from the robot toward the landmarks</span>
        vector<span class="token operator">&lt;</span><span class="token keyword keyword-double">double</span><span class="token operator">&gt;</span> <span class="token function">z</span><span class="token punctuation">(</span><span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>landmarks<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>landmarks<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-double">double</span> dist<span class="token punctuation">;</span>

        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>landmarks<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>landmarks<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            dist <span class="token operator">=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token punctuation">(</span>x <span class="token operator">-</span> landmarks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token punctuation">(</span>y <span class="token operator">-</span> landmarks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            dist <span class="token operator">+=</span> <span class="token function">gen_gauss_random</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> sense_noise<span class="token punctuation">)</span><span class="token punctuation">;</span>
            z<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> dist<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-return">return</span> z<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    Robot <span class="token function">move</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> turn<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> forward<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>forward <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token keyword keyword-throw">throw</span> std<span class="token double-colon punctuation">::</span><span class="token function">invalid_argument</span><span class="token punctuation">(</span><span class="token string">&quot;Robot cannot move backward&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// turn, and add randomness to the turning command</span>
        orient <span class="token operator">=</span> orient <span class="token operator">+</span> turn <span class="token operator">+</span> <span class="token function">gen_gauss_random</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> turn_noise<span class="token punctuation">)</span><span class="token punctuation">;</span>
        orient <span class="token operator">=</span> <span class="token function">mod</span><span class="token punctuation">(</span>orient<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> M_PI<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// move, and add randomness to the motion command</span>
        <span class="token keyword keyword-double">double</span> dist <span class="token operator">=</span> forward <span class="token operator">+</span> <span class="token function">gen_gauss_random</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> forward_noise<span class="token punctuation">)</span><span class="token punctuation">;</span>
        x <span class="token operator">=</span> x <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token function">cos</span><span class="token punctuation">(</span>orient<span class="token punctuation">)</span> <span class="token operator">*</span> dist<span class="token punctuation">)</span><span class="token punctuation">;</span>
        y <span class="token operator">=</span> y <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token function">sin</span><span class="token punctuation">(</span>orient<span class="token punctuation">)</span> <span class="token operator">*</span> dist<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// cyclic truncate</span>
        x <span class="token operator">=</span> <span class="token function">mod</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> world_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
        y <span class="token operator">=</span> <span class="token function">mod</span><span class="token punctuation">(</span>y<span class="token punctuation">,</span> world_size<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// set particle</span>
        Robot res<span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> orient<span class="token punctuation">)</span><span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">set_noise</span><span class="token punctuation">(</span>forward_noise<span class="token punctuation">,</span> turn_noise<span class="token punctuation">,</span> sense_noise<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword keyword-return">return</span> res<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    string <span class="token function">show_pose</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Returns the robot current position and orientation in a string format</span>
        <span class="token keyword keyword-return">return</span> <span class="token string">&quot;[x=&quot;</span> <span class="token operator">+</span> <span class="token function">to_string</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; y=&quot;</span> <span class="token operator">+</span> <span class="token function">to_string</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; orient=&quot;</span> <span class="token operator">+</span> <span class="token function">to_string</span><span class="token punctuation">(</span>orient<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    string <span class="token function">read_sensors</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Returns all the distances from the robot toward the landmarks</span>
        vector<span class="token operator">&lt;</span><span class="token keyword keyword-double">double</span><span class="token operator">&gt;</span> z <span class="token operator">=</span> <span class="token function">sense</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        string readings <span class="token operator">=</span> <span class="token string">&quot;[&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> z<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            readings <span class="token operator">+=</span> <span class="token function">to_string</span><span class="token punctuation">(</span>z<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        readings<span class="token punctuation">[</span>readings<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&apos;]&apos;</span><span class="token punctuation">;</span>

        <span class="token keyword keyword-return">return</span> readings<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-double">double</span> <span class="token function">measurement_prob</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span><span class="token keyword keyword-double">double</span><span class="token operator">&gt;</span> measurement<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Calculates how likely a measurement should be</span>
        <span class="token keyword keyword-double">double</span> prob <span class="token operator">=</span> <span class="token number">1.0</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-double">double</span> dist<span class="token punctuation">;</span>

        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>landmarks<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>landmarks<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            dist <span class="token operator">=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token punctuation">(</span>x <span class="token operator">-</span> landmarks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token punctuation">(</span>y <span class="token operator">-</span> landmarks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            prob <span class="token operator">*=</span> <span class="token function">gaussian</span><span class="token punctuation">(</span>dist<span class="token punctuation">,</span> sense_noise<span class="token punctuation">,</span> measurement<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword keyword-return">return</span> prob<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-double">double</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> orient<span class="token punctuation">;</span> <span class="token comment">//robot poses</span>
    <span class="token keyword keyword-double">double</span> forward_noise<span class="token punctuation">,</span> turn_noise<span class="token punctuation">,</span> sense_noise<span class="token punctuation">;</span> <span class="token comment">//robot noises</span>

<span class="token keyword keyword-private">private</span><span class="token operator">:</span>
    <span class="token keyword keyword-double">double</span> <span class="token function">gen_gauss_random</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> mean<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> variance<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Gaussian random</span>
        normal_distribution<span class="token operator">&lt;</span><span class="token keyword keyword-double">double</span><span class="token operator">&gt;</span> <span class="token function">gauss_dist</span><span class="token punctuation">(</span>mean<span class="token punctuation">,</span> variance<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> <span class="token function">gauss_dist</span><span class="token punctuation">(</span>gen<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-double">double</span> <span class="token function">gaussian</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> mu<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> sigma<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> x<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Probability of x for 1-dim Gaussian with mean mu and var. sigma</span>
        <span class="token keyword keyword-return">return</span> <span class="token function">exp</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token punctuation">(</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token punctuation">(</span>mu <span class="token operator">-</span> x<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token function">pow</span><span class="token punctuation">(</span>sigma<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token number">2.0</span> <span class="token operator">*</span> M_PI <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token function">pow</span><span class="token punctuation">(</span>sigma<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Functions</span>
<span class="token keyword keyword-double">double</span> <span class="token function">gen_real_random</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Generate real random between 0 and 1</span>
    uniform_real_distribution<span class="token operator">&lt;</span><span class="token keyword keyword-double">double</span><span class="token operator">&gt;</span> <span class="token function">real_dist</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//Real</span>
    <span class="token keyword keyword-return">return</span> <span class="token function">real_dist</span><span class="token punctuation">(</span>gen<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-double">double</span> <span class="token function">mod</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> first_term<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> second_term<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Compute the modulus</span>
    <span class="token keyword keyword-return">return</span> first_term <span class="token operator">-</span> <span class="token punctuation">(</span>second_term<span class="token punctuation">)</span><span class="token operator">*</span><span class="token function">floor</span><span class="token punctuation">(</span>first_term <span class="token operator">/</span> <span class="token punctuation">(</span>second_term<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-double">double</span> <span class="token function">evaluation</span><span class="token punctuation">(</span>Robot r<span class="token punctuation">,</span> Robot p<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> n<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">//Calculate the mean error of the system</span>
    <span class="token keyword keyword-double">double</span> sum <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//the second part is because of world&apos;s cyclicity</span>
        <span class="token keyword keyword-double">double</span> dx <span class="token operator">=</span> <span class="token function">mod</span><span class="token punctuation">(</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>x <span class="token operator">-</span> r<span class="token punctuation">.</span>x <span class="token operator">+</span> <span class="token punctuation">(</span>world_size <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> world_size<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span>world_size <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-double">double</span> dy <span class="token operator">=</span> <span class="token function">mod</span><span class="token punctuation">(</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">-</span> r<span class="token punctuation">.</span>y <span class="token operator">+</span> <span class="token punctuation">(</span>world_size <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> world_size<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span>world_size <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-double">double</span> err <span class="token operator">=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token function">pow</span><span class="token punctuation">(</span>dx<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">pow</span><span class="token punctuation">(</span>dy<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sum <span class="token operator">+=</span> err<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-return">return</span> sum <span class="token operator">/</span> n<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword keyword-double">double</span> <span class="token function">max</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> arr<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> n<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Identify the max element in an array</span>
    <span class="token keyword keyword-double">double</span> max <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&gt;</span> max<span class="token punctuation">)</span>
            max <span class="token operator">=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-return">return</span> max<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">/*
void visualization(int n, Robot robot, int step, Robot p[], Robot pr[])
{
	//Draw the robot, landmarks, particles and resampled particles on a graph
	
    //Graph Format
    plt::title(&quot;MCL, step &quot; + to_string(step));
    plt::xlim(0, 100);
    plt::ylim(0, 100);

    //Draw particles in green
    for (int i = 0; i &lt; n; i++) {
        plt::plot({ p[i].x }, { p[i].y }, &quot;go&quot;);
    }

    //Draw resampled particles in yellow
    for (int i = 0; i &lt; n; i++) {
        plt::plot({ pr[i].x }, { pr[i].y }, &quot;yo&quot;);
    }

    //Draw landmarks in red
    for (int i = 0; i &lt; sizeof(landmarks) / sizeof(landmarks[0]); i++) {
        plt::plot({ landmarks[i][0] }, { landmarks[i][1] }, &quot;ro&quot;);
    }
    
    //Draw robot position in blue
    plt::plot({ robot.x }, { robot.y }, &quot;bo&quot;);

	//Save the image and close the plot
    plt::save(&quot;./Images/Step&quot; + to_string(step) + &quot;.png&quot;);
    plt::clf();
}
*/</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">//Practice Interfacing with Robot Class</span>
    Robot myrobot<span class="token punctuation">;</span>
    myrobot<span class="token punctuation">.</span><span class="token function">set_noise</span><span class="token punctuation">(</span><span class="token number">5.0</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">5.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    myrobot<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">30.0</span><span class="token punctuation">,</span> <span class="token number">50.0</span><span class="token punctuation">,</span> M_PI <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    myrobot<span class="token punctuation">.</span><span class="token function">move</span><span class="token punctuation">(</span><span class="token operator">-</span>M_PI <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">15.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//cout &lt;&lt; myrobot.read_sensors() &lt;&lt; endl;</span>
    myrobot<span class="token punctuation">.</span><span class="token function">move</span><span class="token punctuation">(</span><span class="token operator">-</span>M_PI <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">10.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//cout &lt;&lt; myrobot.read_sensors() &lt;&lt; endl;</span>

    <span class="token comment">// Create a set of particles</span>
    <span class="token keyword keyword-int">int</span> n <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span>
    Robot p<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">set_noise</span><span class="token punctuation">(</span><span class="token number">0.05</span><span class="token punctuation">,</span> <span class="token number">0.05</span><span class="token punctuation">,</span> <span class="token number">5.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//cout &lt;&lt; p[i].show_pose() &lt;&lt; endl;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//Re-initialize myrobot object and Initialize a measurment vector</span>
    myrobot <span class="token operator">=</span> <span class="token function">Robot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    vector<span class="token operator">&lt;</span><span class="token keyword keyword-double">double</span><span class="token operator">&gt;</span> z<span class="token punctuation">;</span>

    <span class="token comment">//Move the robot and sense the environment afterwards</span>
    myrobot <span class="token operator">=</span> myrobot<span class="token punctuation">.</span><span class="token function">move</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">5.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    z <span class="token operator">=</span> myrobot<span class="token punctuation">.</span><span class="token function">sense</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Simulate a robot motion for each of these particles</span>
    Robot p2<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        p2<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">move</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">5.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        p<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> p2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//####   DON&apos;T MODIFY ANYTHING ABOVE HERE! ENTER CODE BELOW ####</span>

    <span class="token comment">//Generate particle weights depending on robot&apos;s measurement</span>
    <span class="token comment">//Print particle weights, each on a single line</span>
    <span class="token keyword keyword-double">double</span> w<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        w<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">measurement_prob</span><span class="token punctuation">(</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span>
        cout <span class="token operator">&lt;&lt;</span> w<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</pre><h1 class="mume-header" id="resampling">Resampling</h1>

<p>By finishing up the previous section code, we&apos;ve essentially coded the first section of MCL algorithm, known as <strong>motion and sensor update</strong>.</p>
<p>Now, we move to the second section known by <strong>resampling</strong> and code it. Before we start on that, let&apos;s see how particles are resampled.</p>
<p>Given a set of <code>N</code> particles, each particle has a pose <code>(x,y,&#x3B8;)</code>. In addition to the pose, each particle has a weight denoting how close the particle is from the robot position. We sum all of these weights and denote it by <code>W</code>. With that we get the normalized weights, <code>&#x3B1;_i = w_i/W</code>. <code>&#x3B1;_i</code> is the probability of each particle being selected from the whole. The sum of all alphas should add up to 1.</p>
<p align="center">
<img src="img/resampling1.png" alt="drawing" width="700">
</p>
<p>The <em>resampler</em> will group all <code>N</code> normalized weights in a bag. The resampling process happens <code>N</code> times, picking a particle from the bag every time. By the end of the resampling process, there will be the same <code>N</code> number of particles as there were originally. <strong>But, which particles stays or go will change?</strong></p>
<p>At each iteration the resampling process is more likely to pick particles with large probabilities. This process happens randomly, but is always more likely to pick particles with higher probabilities.</p>
<p>See the <a href="https://youtu.be/WdW72nTVT8M">video here</a>.</p>
<p>Suppose that you have 5 particles, each with an importance weight. <strong>Compute</strong> the probability of drawing each particle in the new set. Use the C++ coding section and follow the instructions to <strong>print</strong>the results.</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp"><span class="token comment">//One out of many possible solutions</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>

<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>

<span class="token keyword keyword-double">double</span> w<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">0.6</span><span class="token punctuation">,</span> <span class="token number">1.2</span><span class="token punctuation">,</span> <span class="token number">2.4</span><span class="token punctuation">,</span> <span class="token number">0.6</span><span class="token punctuation">,</span> <span class="token number">1.2</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword keyword-double">double</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token keyword keyword-void">void</span> <span class="token function">ComputeProb</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> w<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> n<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        sum <span class="token operator">=</span> sum <span class="token operator">+</span> w<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        w<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> w<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">/</span> sum<span class="token punctuation">;</span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;P&quot;</span> <span class="token operator">&lt;&lt;</span> j <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;=&quot;</span> <span class="token operator">&lt;&lt;</span> w<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">ComputeProb</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>w<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</pre><h1 class="mume-header" id="resampling-wheel">Resampling Wheel</h1>

<p>Resampling wheel is just an simpler way of explaining why when picking particles randomly, those with higher probability are sample more often. In simple words, <em>resampling wheel</em> assumes a pie chart like shape with slices of different sizes (i.e. different area sizes). Now, if we want to randomly pick a point in the pie (circle), the larger slices (i.e. higher area size) will have higher chance of being sampled. See the <a href="https://youtu.be/tYuSA4I09O8">video here</a>.</p>
<p align="center">
<img src="img/resampling-wheel.png" alt="drawing" width="500">
</p>
<p>Now that you&#x2019;ve learned the resampling wheel pseudo code, you&apos;ll try to implement it in C++. In this quiz,  <strong>resample</strong>  the particles with a sample probability proportional to the importance weight.</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp"><span class="token comment">//#include &quot;src/matplotlibcpp.h&quot;//Graph Library</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;math.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;vector&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdexcept&gt;</span> <span class="token comment">// throw errors</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;random&gt;</span> <span class="token comment">//C++ 11 Random Numbers</span></span>

<span class="token comment">//namespace plt = matplotlibcpp;</span>
<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>

<span class="token comment">// Landmarks</span>
<span class="token keyword keyword-double">double</span> landmarks<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">{</span> <span class="token number">20.0</span><span class="token punctuation">,</span> <span class="token number">20.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token number">20.0</span><span class="token punctuation">,</span> <span class="token number">80.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token number">20.0</span><span class="token punctuation">,</span> <span class="token number">50.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token number">50.0</span><span class="token punctuation">,</span> <span class="token number">20.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token number">50.0</span><span class="token punctuation">,</span> <span class="token number">80.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token number">80.0</span><span class="token punctuation">,</span> <span class="token number">80.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token number">80.0</span><span class="token punctuation">,</span> <span class="token number">20.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token number">80.0</span><span class="token punctuation">,</span> <span class="token number">50.0</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Map size in meters</span>
<span class="token keyword keyword-double">double</span> world_size <span class="token operator">=</span> <span class="token number">100.0</span><span class="token punctuation">;</span>

<span class="token comment">// Random Generators</span>
random_device rd<span class="token punctuation">;</span>
mt19937 <span class="token function">gen</span><span class="token punctuation">(</span><span class="token function">rd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Global Functions</span>
<span class="token keyword keyword-double">double</span> <span class="token function">mod</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> first_term<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> second_term<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-double">double</span> <span class="token function">gen_real_random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-class">class</span> <span class="token class-name">Robot</span> <span class="token punctuation">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
    <span class="token function">Robot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Constructor</span>
        x <span class="token operator">=</span> <span class="token function">gen_real_random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> world_size<span class="token punctuation">;</span> <span class="token comment">// robot&apos;s x coordinate</span>
        y <span class="token operator">=</span> <span class="token function">gen_real_random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> world_size<span class="token punctuation">;</span> <span class="token comment">// robot&apos;s y coordinate</span>
        orient <span class="token operator">=</span> <span class="token function">gen_real_random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2.0</span> <span class="token operator">*</span> M_PI<span class="token punctuation">;</span> <span class="token comment">// robot&apos;s orientation</span>

        forward_noise <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span> <span class="token comment">//noise of the forward movement</span>
        turn_noise <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span> <span class="token comment">//noise of the turn</span>
        sense_noise <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span> <span class="token comment">//noise of the sensing</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-void">void</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> new_x<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> new_y<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> new_orient<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Set robot new position and orientation</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>new_x <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> new_x <span class="token operator">&gt;=</span> world_size<span class="token punctuation">)</span>
            <span class="token keyword keyword-throw">throw</span> std<span class="token double-colon punctuation">::</span><span class="token function">invalid_argument</span><span class="token punctuation">(</span><span class="token string">&quot;X coordinate out of bound&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>new_y <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> new_y <span class="token operator">&gt;=</span> world_size<span class="token punctuation">)</span>
            <span class="token keyword keyword-throw">throw</span> std<span class="token double-colon punctuation">::</span><span class="token function">invalid_argument</span><span class="token punctuation">(</span><span class="token string">&quot;Y coordinate out of bound&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>new_orient <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> new_orient <span class="token operator">&gt;=</span> <span class="token number">2</span> <span class="token operator">*</span> M_PI<span class="token punctuation">)</span>
            <span class="token keyword keyword-throw">throw</span> std<span class="token double-colon punctuation">::</span><span class="token function">invalid_argument</span><span class="token punctuation">(</span><span class="token string">&quot;Orientation must be in [0..2pi]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        x <span class="token operator">=</span> new_x<span class="token punctuation">;</span>
        y <span class="token operator">=</span> new_y<span class="token punctuation">;</span>
        orient <span class="token operator">=</span> new_orient<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-void">void</span> <span class="token function">set_noise</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> new_forward_noise<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> new_turn_noise<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> new_sense_noise<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Simulate noise, often useful in particle filters</span>
        forward_noise <span class="token operator">=</span> new_forward_noise<span class="token punctuation">;</span>
        turn_noise <span class="token operator">=</span> new_turn_noise<span class="token punctuation">;</span>
        sense_noise <span class="token operator">=</span> new_sense_noise<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    vector<span class="token operator">&lt;</span><span class="token keyword keyword-double">double</span><span class="token operator">&gt;</span> <span class="token function">sense</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Measure the distances from the robot toward the landmarks</span>
        vector<span class="token operator">&lt;</span><span class="token keyword keyword-double">double</span><span class="token operator">&gt;</span> <span class="token function">z</span><span class="token punctuation">(</span><span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>landmarks<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>landmarks<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-double">double</span> dist<span class="token punctuation">;</span>

        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>landmarks<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>landmarks<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            dist <span class="token operator">=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token punctuation">(</span>x <span class="token operator">-</span> landmarks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token punctuation">(</span>y <span class="token operator">-</span> landmarks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            dist <span class="token operator">+=</span> <span class="token function">gen_gauss_random</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> sense_noise<span class="token punctuation">)</span><span class="token punctuation">;</span>
            z<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> dist<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-return">return</span> z<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    Robot <span class="token function">move</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> turn<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> forward<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>forward <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token keyword keyword-throw">throw</span> std<span class="token double-colon punctuation">::</span><span class="token function">invalid_argument</span><span class="token punctuation">(</span><span class="token string">&quot;Robot cannot move backward&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// turn, and add randomness to the turning command</span>
        orient <span class="token operator">=</span> orient <span class="token operator">+</span> turn <span class="token operator">+</span> <span class="token function">gen_gauss_random</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> turn_noise<span class="token punctuation">)</span><span class="token punctuation">;</span>
        orient <span class="token operator">=</span> <span class="token function">mod</span><span class="token punctuation">(</span>orient<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> M_PI<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// move, and add randomness to the motion command</span>
        <span class="token keyword keyword-double">double</span> dist <span class="token operator">=</span> forward <span class="token operator">+</span> <span class="token function">gen_gauss_random</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> forward_noise<span class="token punctuation">)</span><span class="token punctuation">;</span>
        x <span class="token operator">=</span> x <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token function">cos</span><span class="token punctuation">(</span>orient<span class="token punctuation">)</span> <span class="token operator">*</span> dist<span class="token punctuation">)</span><span class="token punctuation">;</span>
        y <span class="token operator">=</span> y <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token function">sin</span><span class="token punctuation">(</span>orient<span class="token punctuation">)</span> <span class="token operator">*</span> dist<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// cyclic truncate</span>
        x <span class="token operator">=</span> <span class="token function">mod</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> world_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
        y <span class="token operator">=</span> <span class="token function">mod</span><span class="token punctuation">(</span>y<span class="token punctuation">,</span> world_size<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// set particle</span>
        Robot res<span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> orient<span class="token punctuation">)</span><span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">set_noise</span><span class="token punctuation">(</span>forward_noise<span class="token punctuation">,</span> turn_noise<span class="token punctuation">,</span> sense_noise<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword keyword-return">return</span> res<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    string <span class="token function">show_pose</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Returns the robot current position and orientation in a string format</span>
        <span class="token keyword keyword-return">return</span> <span class="token string">&quot;[x=&quot;</span> <span class="token operator">+</span> <span class="token function">to_string</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; y=&quot;</span> <span class="token operator">+</span> <span class="token function">to_string</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; orient=&quot;</span> <span class="token operator">+</span> <span class="token function">to_string</span><span class="token punctuation">(</span>orient<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    string <span class="token function">read_sensors</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Returns all the distances from the robot toward the landmarks</span>
        vector<span class="token operator">&lt;</span><span class="token keyword keyword-double">double</span><span class="token operator">&gt;</span> z <span class="token operator">=</span> <span class="token function">sense</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        string readings <span class="token operator">=</span> <span class="token string">&quot;[&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> z<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            readings <span class="token operator">+=</span> <span class="token function">to_string</span><span class="token punctuation">(</span>z<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        readings<span class="token punctuation">[</span>readings<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&apos;]&apos;</span><span class="token punctuation">;</span>

        <span class="token keyword keyword-return">return</span> readings<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-double">double</span> <span class="token function">measurement_prob</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span><span class="token keyword keyword-double">double</span><span class="token operator">&gt;</span> measurement<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Calculates how likely a measurement should be</span>
        <span class="token keyword keyword-double">double</span> prob <span class="token operator">=</span> <span class="token number">1.0</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-double">double</span> dist<span class="token punctuation">;</span>

        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>landmarks<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>landmarks<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            dist <span class="token operator">=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token punctuation">(</span>x <span class="token operator">-</span> landmarks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token punctuation">(</span>y <span class="token operator">-</span> landmarks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            prob <span class="token operator">*=</span> <span class="token function">gaussian</span><span class="token punctuation">(</span>dist<span class="token punctuation">,</span> sense_noise<span class="token punctuation">,</span> measurement<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword keyword-return">return</span> prob<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-double">double</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> orient<span class="token punctuation">;</span> <span class="token comment">//robot poses</span>
    <span class="token keyword keyword-double">double</span> forward_noise<span class="token punctuation">,</span> turn_noise<span class="token punctuation">,</span> sense_noise<span class="token punctuation">;</span> <span class="token comment">//robot noises</span>

<span class="token keyword keyword-private">private</span><span class="token operator">:</span>
    <span class="token keyword keyword-double">double</span> <span class="token function">gen_gauss_random</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> mean<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> variance<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Gaussian random</span>
        normal_distribution<span class="token operator">&lt;</span><span class="token keyword keyword-double">double</span><span class="token operator">&gt;</span> <span class="token function">gauss_dist</span><span class="token punctuation">(</span>mean<span class="token punctuation">,</span> variance<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> <span class="token function">gauss_dist</span><span class="token punctuation">(</span>gen<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-double">double</span> <span class="token function">gaussian</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> mu<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> sigma<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> x<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Probability of x for 1-dim Gaussian with mean mu and var. sigma</span>
        <span class="token keyword keyword-return">return</span> <span class="token function">exp</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token punctuation">(</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token punctuation">(</span>mu <span class="token operator">-</span> x<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token function">pow</span><span class="token punctuation">(</span>sigma<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token number">2.0</span> <span class="token operator">*</span> M_PI <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token function">pow</span><span class="token punctuation">(</span>sigma<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Functions</span>
<span class="token keyword keyword-double">double</span> <span class="token function">gen_real_random</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Generate real random between 0 and 1</span>
    uniform_real_distribution<span class="token operator">&lt;</span><span class="token keyword keyword-double">double</span><span class="token operator">&gt;</span> <span class="token function">real_dist</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//Real</span>
    <span class="token keyword keyword-return">return</span> <span class="token function">real_dist</span><span class="token punctuation">(</span>gen<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-double">double</span> <span class="token function">mod</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> first_term<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> second_term<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Compute the modulus</span>
    <span class="token keyword keyword-return">return</span> first_term <span class="token operator">-</span> <span class="token punctuation">(</span>second_term<span class="token punctuation">)</span><span class="token operator">*</span><span class="token function">floor</span><span class="token punctuation">(</span>first_term <span class="token operator">/</span> <span class="token punctuation">(</span>second_term<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-double">double</span> <span class="token function">evaluation</span><span class="token punctuation">(</span>Robot r<span class="token punctuation">,</span> Robot p<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> n<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">//Calculate the mean error of the system</span>
    <span class="token keyword keyword-double">double</span> sum <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//the second part is because of world&apos;s cyclicity</span>
        <span class="token keyword keyword-double">double</span> dx <span class="token operator">=</span> <span class="token function">mod</span><span class="token punctuation">(</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>x <span class="token operator">-</span> r<span class="token punctuation">.</span>x <span class="token operator">+</span> <span class="token punctuation">(</span>world_size <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> world_size<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span>world_size <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-double">double</span> dy <span class="token operator">=</span> <span class="token function">mod</span><span class="token punctuation">(</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">-</span> r<span class="token punctuation">.</span>y <span class="token operator">+</span> <span class="token punctuation">(</span>world_size <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> world_size<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span>world_size <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-double">double</span> err <span class="token operator">=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token function">pow</span><span class="token punctuation">(</span>dx<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">pow</span><span class="token punctuation">(</span>dy<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sum <span class="token operator">+=</span> err<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-return">return</span> sum <span class="token operator">/</span> n<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword keyword-double">double</span> <span class="token function">max</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> arr<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> n<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Identify the max element in an array</span>
    <span class="token keyword keyword-double">double</span> max <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&gt;</span> max<span class="token punctuation">)</span>
            max <span class="token operator">=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-return">return</span> max<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">/*
void visualization(int n, Robot robot, int step, Robot p[], Robot pr[])
{
	//Draw the robot, landmarks, particles and resampled particles on a graph
	
    //Graph Format
    plt::title(&quot;MCL, step &quot; + to_string(step));
    plt::xlim(0, 100);
    plt::ylim(0, 100);

    //Draw particles in green
    for (int i = 0; i &lt; n; i++) {
        plt::plot({ p[i].x }, { p[i].y }, &quot;go&quot;);
    }

    //Draw resampled particles in yellow
    for (int i = 0; i &lt; n; i++) {
        plt::plot({ pr[i].x }, { pr[i].y }, &quot;yo&quot;);
    }

    //Draw landmarks in red
    for (int i = 0; i &lt; sizeof(landmarks) / sizeof(landmarks[0]); i++) {
        plt::plot({ landmarks[i][0] }, { landmarks[i][1] }, &quot;ro&quot;);
    }
    
    //Draw robot position in blue
    plt::plot({ robot.x }, { robot.y }, &quot;bo&quot;);

	//Save the image and close the plot
    plt::save(&quot;./Images/Step&quot; + to_string(step) + &quot;.png&quot;);
    plt::clf();
}
*/</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">//Practice Interfacing with Robot Class</span>
    Robot myrobot<span class="token punctuation">;</span>
    myrobot<span class="token punctuation">.</span><span class="token function">set_noise</span><span class="token punctuation">(</span><span class="token number">5.0</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">5.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    myrobot<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">30.0</span><span class="token punctuation">,</span> <span class="token number">50.0</span><span class="token punctuation">,</span> M_PI <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    myrobot<span class="token punctuation">.</span><span class="token function">move</span><span class="token punctuation">(</span><span class="token operator">-</span>M_PI <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">15.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//cout &lt;&lt; myrobot.read_sensors() &lt;&lt; endl;</span>
    myrobot<span class="token punctuation">.</span><span class="token function">move</span><span class="token punctuation">(</span><span class="token operator">-</span>M_PI <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">10.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//cout &lt;&lt; myrobot.read_sensors() &lt;&lt; endl;</span>

    <span class="token comment">// Create a set of particles</span>
    <span class="token keyword keyword-int">int</span> n <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span>
    Robot p<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">set_noise</span><span class="token punctuation">(</span><span class="token number">0.05</span><span class="token punctuation">,</span> <span class="token number">0.05</span><span class="token punctuation">,</span> <span class="token number">5.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//cout &lt;&lt; p[i].show_pose() &lt;&lt; endl;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//Re-initialize myrobot object and Initialize a measurment vector</span>
    myrobot <span class="token operator">=</span> <span class="token function">Robot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    vector<span class="token operator">&lt;</span><span class="token keyword keyword-double">double</span><span class="token operator">&gt;</span> z<span class="token punctuation">;</span>

    <span class="token comment">//Move the robot and sense the environment afterwards</span>
    myrobot <span class="token operator">=</span> myrobot<span class="token punctuation">.</span><span class="token function">move</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">5.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    z <span class="token operator">=</span> myrobot<span class="token punctuation">.</span><span class="token function">sense</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Simulate a robot motion for each of these particles</span>
    Robot p2<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        p2<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">move</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">5.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        p<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> p2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//Generate particle weights depending on robot&apos;s measurement</span>
    <span class="token keyword keyword-double">double</span> w<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        w<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">measurement_prob</span><span class="token punctuation">(</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//cout &lt;&lt; w[i] &lt;&lt; endl;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//####   DON&apos;T MODIFY ANYTHING ABOVE HERE! ENTER CODE BELOW ####</span>

    <span class="token comment">//Resample the particles with a sample probability proportional to the importance weight</span>
    Robot p3<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-int">int</span> index <span class="token operator">=</span> <span class="token function">gen_real_random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> n<span class="token punctuation">;</span>
    <span class="token comment">//cout &lt;&lt; index &lt;&lt; endl;</span>
    <span class="token keyword keyword-double">double</span> beta <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-double">double</span> mw <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//cout &lt;&lt; mw;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        beta <span class="token operator">+=</span> <span class="token function">gen_real_random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2.0</span> <span class="token operator">*</span> mw<span class="token punctuation">;</span>
        <span class="token keyword keyword-while">while</span> <span class="token punctuation">(</span>beta <span class="token operator">&gt;</span> w<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            beta <span class="token operator">-=</span> w<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>
            index <span class="token operator">=</span> <span class="token function">mod</span><span class="token punctuation">(</span><span class="token punctuation">(</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        p3<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> p<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> k<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> k <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> k<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        p<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> p3<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">;</span>
        cout <span class="token operator">&lt;&lt;</span> p<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">show_pose</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</pre><h1 class="mume-header" id="error">Error</h1>

<p>Now, we should evaluate the overall quality of our MCL algorithm-based solution. To do so, we need to compute the average distance between particles and the robot.</p>
<p>A good solution will result in an average distance smaller than a meter. See <a href="https://youtu.be/z1pBWLzqqsc">this video</a> for further explanation.</p>
<pre data-role="codeBlock" data-info="cpp" class="language-cpp"><span class="token comment">//#include &quot;src/matplotlibcpp.h&quot;//Graph Library</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;math.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;vector&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdexcept&gt;</span> <span class="token comment">// throw errors</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;random&gt;</span> <span class="token comment">//C++ 11 Random Numbers</span></span>

<span class="token comment">//namespace plt = matplotlibcpp;</span>
<span class="token keyword keyword-using">using</span> <span class="token keyword keyword-namespace">namespace</span> std<span class="token punctuation">;</span>

<span class="token comment">// Landmarks</span>
<span class="token keyword keyword-double">double</span> landmarks<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">{</span> <span class="token number">20.0</span><span class="token punctuation">,</span> <span class="token number">20.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token number">20.0</span><span class="token punctuation">,</span> <span class="token number">80.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token number">20.0</span><span class="token punctuation">,</span> <span class="token number">50.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token number">50.0</span><span class="token punctuation">,</span> <span class="token number">20.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token number">50.0</span><span class="token punctuation">,</span> <span class="token number">80.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token number">80.0</span><span class="token punctuation">,</span> <span class="token number">80.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token number">80.0</span><span class="token punctuation">,</span> <span class="token number">20.0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token number">80.0</span><span class="token punctuation">,</span> <span class="token number">50.0</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Map size in meters</span>
<span class="token keyword keyword-double">double</span> world_size <span class="token operator">=</span> <span class="token number">100.0</span><span class="token punctuation">;</span>

<span class="token comment">// Random Generators</span>
random_device rd<span class="token punctuation">;</span>
mt19937 <span class="token function">gen</span><span class="token punctuation">(</span><span class="token function">rd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Global Functions</span>
<span class="token keyword keyword-double">double</span> <span class="token function">mod</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> first_term<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> second_term<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword keyword-double">double</span> <span class="token function">gen_real_random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword keyword-class">class</span> <span class="token class-name">Robot</span> <span class="token punctuation">{</span>
<span class="token keyword keyword-public">public</span><span class="token operator">:</span>
    <span class="token function">Robot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Constructor</span>
        x <span class="token operator">=</span> <span class="token function">gen_real_random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> world_size<span class="token punctuation">;</span> <span class="token comment">// robot&apos;s x coordinate</span>
        y <span class="token operator">=</span> <span class="token function">gen_real_random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> world_size<span class="token punctuation">;</span> <span class="token comment">// robot&apos;s y coordinate</span>
        orient <span class="token operator">=</span> <span class="token function">gen_real_random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2.0</span> <span class="token operator">*</span> M_PI<span class="token punctuation">;</span> <span class="token comment">// robot&apos;s orientation</span>

        forward_noise <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span> <span class="token comment">//noise of the forward movement</span>
        turn_noise <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span> <span class="token comment">//noise of the turn</span>
        sense_noise <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span> <span class="token comment">//noise of the sensing</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-void">void</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> new_x<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> new_y<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> new_orient<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Set robot new position and orientation</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>new_x <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> new_x <span class="token operator">&gt;=</span> world_size<span class="token punctuation">)</span>
            <span class="token keyword keyword-throw">throw</span> std<span class="token double-colon punctuation">::</span><span class="token function">invalid_argument</span><span class="token punctuation">(</span><span class="token string">&quot;X coordinate out of bound&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>new_y <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> new_y <span class="token operator">&gt;=</span> world_size<span class="token punctuation">)</span>
            <span class="token keyword keyword-throw">throw</span> std<span class="token double-colon punctuation">::</span><span class="token function">invalid_argument</span><span class="token punctuation">(</span><span class="token string">&quot;Y coordinate out of bound&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>new_orient <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">||</span> new_orient <span class="token operator">&gt;=</span> <span class="token number">2</span> <span class="token operator">*</span> M_PI<span class="token punctuation">)</span>
            <span class="token keyword keyword-throw">throw</span> std<span class="token double-colon punctuation">::</span><span class="token function">invalid_argument</span><span class="token punctuation">(</span><span class="token string">&quot;Orientation must be in [0..2pi]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        x <span class="token operator">=</span> new_x<span class="token punctuation">;</span>
        y <span class="token operator">=</span> new_y<span class="token punctuation">;</span>
        orient <span class="token operator">=</span> new_orient<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-void">void</span> <span class="token function">set_noise</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> new_forward_noise<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> new_turn_noise<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> new_sense_noise<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Simulate noise, often useful in particle filters</span>
        forward_noise <span class="token operator">=</span> new_forward_noise<span class="token punctuation">;</span>
        turn_noise <span class="token operator">=</span> new_turn_noise<span class="token punctuation">;</span>
        sense_noise <span class="token operator">=</span> new_sense_noise<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    vector<span class="token operator">&lt;</span><span class="token keyword keyword-double">double</span><span class="token operator">&gt;</span> <span class="token function">sense</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Measure the distances from the robot toward the landmarks</span>
        vector<span class="token operator">&lt;</span><span class="token keyword keyword-double">double</span><span class="token operator">&gt;</span> <span class="token function">z</span><span class="token punctuation">(</span><span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>landmarks<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>landmarks<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-double">double</span> dist<span class="token punctuation">;</span>

        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>landmarks<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>landmarks<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            dist <span class="token operator">=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token punctuation">(</span>x <span class="token operator">-</span> landmarks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token punctuation">(</span>y <span class="token operator">-</span> landmarks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            dist <span class="token operator">+=</span> <span class="token function">gen_gauss_random</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> sense_noise<span class="token punctuation">)</span><span class="token punctuation">;</span>
            z<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> dist<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-return">return</span> z<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    Robot <span class="token function">move</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> turn<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> forward<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>forward <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token keyword keyword-throw">throw</span> std<span class="token double-colon punctuation">::</span><span class="token function">invalid_argument</span><span class="token punctuation">(</span><span class="token string">&quot;Robot cannot move backward&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// turn, and add randomness to the turning command</span>
        orient <span class="token operator">=</span> orient <span class="token operator">+</span> turn <span class="token operator">+</span> <span class="token function">gen_gauss_random</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> turn_noise<span class="token punctuation">)</span><span class="token punctuation">;</span>
        orient <span class="token operator">=</span> <span class="token function">mod</span><span class="token punctuation">(</span>orient<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> M_PI<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// move, and add randomness to the motion command</span>
        <span class="token keyword keyword-double">double</span> dist <span class="token operator">=</span> forward <span class="token operator">+</span> <span class="token function">gen_gauss_random</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> forward_noise<span class="token punctuation">)</span><span class="token punctuation">;</span>
        x <span class="token operator">=</span> x <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token function">cos</span><span class="token punctuation">(</span>orient<span class="token punctuation">)</span> <span class="token operator">*</span> dist<span class="token punctuation">)</span><span class="token punctuation">;</span>
        y <span class="token operator">=</span> y <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token function">sin</span><span class="token punctuation">(</span>orient<span class="token punctuation">)</span> <span class="token operator">*</span> dist<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// cyclic truncate</span>
        x <span class="token operator">=</span> <span class="token function">mod</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> world_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
        y <span class="token operator">=</span> <span class="token function">mod</span><span class="token punctuation">(</span>y<span class="token punctuation">,</span> world_size<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// set particle</span>
        Robot res<span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> orient<span class="token punctuation">)</span><span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">set_noise</span><span class="token punctuation">(</span>forward_noise<span class="token punctuation">,</span> turn_noise<span class="token punctuation">,</span> sense_noise<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword keyword-return">return</span> res<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    string <span class="token function">show_pose</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Returns the robot current position and orientation in a string format</span>
        <span class="token keyword keyword-return">return</span> <span class="token string">&quot;[x=&quot;</span> <span class="token operator">+</span> <span class="token function">to_string</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; y=&quot;</span> <span class="token operator">+</span> <span class="token function">to_string</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; orient=&quot;</span> <span class="token operator">+</span> <span class="token function">to_string</span><span class="token punctuation">(</span>orient<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    string <span class="token function">read_sensors</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Returns all the distances from the robot toward the landmarks</span>
        vector<span class="token operator">&lt;</span><span class="token keyword keyword-double">double</span><span class="token operator">&gt;</span> z <span class="token operator">=</span> <span class="token function">sense</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        string readings <span class="token operator">=</span> <span class="token string">&quot;[&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> z<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            readings <span class="token operator">+=</span> <span class="token function">to_string</span><span class="token punctuation">(</span>z<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        readings<span class="token punctuation">[</span>readings<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&apos;]&apos;</span><span class="token punctuation">;</span>

        <span class="token keyword keyword-return">return</span> readings<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-double">double</span> <span class="token function">measurement_prob</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span><span class="token keyword keyword-double">double</span><span class="token operator">&gt;</span> measurement<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Calculates how likely a measurement should be</span>
        <span class="token keyword keyword-double">double</span> prob <span class="token operator">=</span> <span class="token number">1.0</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-double">double</span> dist<span class="token punctuation">;</span>

        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>landmarks<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword keyword-sizeof">sizeof</span><span class="token punctuation">(</span>landmarks<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            dist <span class="token operator">=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token punctuation">(</span>x <span class="token operator">-</span> landmarks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token punctuation">(</span>y <span class="token operator">-</span> landmarks<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            prob <span class="token operator">*=</span> <span class="token function">gaussian</span><span class="token punctuation">(</span>dist<span class="token punctuation">,</span> sense_noise<span class="token punctuation">,</span> measurement<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword keyword-return">return</span> prob<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-double">double</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> orient<span class="token punctuation">;</span> <span class="token comment">//robot poses</span>
    <span class="token keyword keyword-double">double</span> forward_noise<span class="token punctuation">,</span> turn_noise<span class="token punctuation">,</span> sense_noise<span class="token punctuation">;</span> <span class="token comment">//robot noises</span>

<span class="token keyword keyword-private">private</span><span class="token operator">:</span>
    <span class="token keyword keyword-double">double</span> <span class="token function">gen_gauss_random</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> mean<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> variance<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Gaussian random</span>
        normal_distribution<span class="token operator">&lt;</span><span class="token keyword keyword-double">double</span><span class="token operator">&gt;</span> <span class="token function">gauss_dist</span><span class="token punctuation">(</span>mean<span class="token punctuation">,</span> variance<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-return">return</span> <span class="token function">gauss_dist</span><span class="token punctuation">(</span>gen<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword keyword-double">double</span> <span class="token function">gaussian</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> mu<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> sigma<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> x<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Probability of x for 1-dim Gaussian with mean mu and var. sigma</span>
        <span class="token keyword keyword-return">return</span> <span class="token function">exp</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token punctuation">(</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token punctuation">(</span>mu <span class="token operator">-</span> x<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token function">pow</span><span class="token punctuation">(</span>sigma<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token number">2.0</span> <span class="token operator">*</span> M_PI <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token function">pow</span><span class="token punctuation">(</span>sigma<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// Functions</span>
<span class="token keyword keyword-double">double</span> <span class="token function">gen_real_random</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Generate real random between 0 and 1</span>
    uniform_real_distribution<span class="token operator">&lt;</span><span class="token keyword keyword-double">double</span><span class="token operator">&gt;</span> <span class="token function">real_dist</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//Real</span>
    <span class="token keyword keyword-return">return</span> <span class="token function">real_dist</span><span class="token punctuation">(</span>gen<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-double">double</span> <span class="token function">mod</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> first_term<span class="token punctuation">,</span> <span class="token keyword keyword-double">double</span> second_term<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Compute the modulus</span>
    <span class="token keyword keyword-return">return</span> first_term <span class="token operator">-</span> <span class="token punctuation">(</span>second_term<span class="token punctuation">)</span><span class="token operator">*</span><span class="token function">floor</span><span class="token punctuation">(</span>first_term <span class="token operator">/</span> <span class="token punctuation">(</span>second_term<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword keyword-double">double</span> <span class="token function">evaluation</span><span class="token punctuation">(</span>Robot r<span class="token punctuation">,</span> Robot p<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> n<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">//Calculate the mean error of the system</span>
    <span class="token keyword keyword-double">double</span> sum <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//the second part is because of world&apos;s cyclicity</span>
        <span class="token keyword keyword-double">double</span> dx <span class="token operator">=</span> <span class="token function">mod</span><span class="token punctuation">(</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>x <span class="token operator">-</span> r<span class="token punctuation">.</span>x <span class="token operator">+</span> <span class="token punctuation">(</span>world_size <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> world_size<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span>world_size <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-double">double</span> dy <span class="token operator">=</span> <span class="token function">mod</span><span class="token punctuation">(</span><span class="token punctuation">(</span>p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">-</span> r<span class="token punctuation">.</span>y <span class="token operator">+</span> <span class="token punctuation">(</span>world_size <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> world_size<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span>world_size <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-double">double</span> err <span class="token operator">=</span> <span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token function">pow</span><span class="token punctuation">(</span>dx<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">pow</span><span class="token punctuation">(</span>dy<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        sum <span class="token operator">+=</span> err<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-return">return</span> sum <span class="token operator">/</span> n<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword keyword-double">double</span> <span class="token function">max</span><span class="token punctuation">(</span><span class="token keyword keyword-double">double</span> arr<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword keyword-int">int</span> n<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Identify the max element in an array</span>
    <span class="token keyword keyword-double">double</span> max <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword keyword-if">if</span> <span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&gt;</span> max<span class="token punctuation">)</span>
            max <span class="token operator">=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword keyword-return">return</span> max<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">/*
void visualization(int n, Robot robot, int step, Robot p[], Robot pr[])
{
	//Draw the robot, landmarks, particles and resampled particles on a graph
	
    //Graph Format
    plt::title(&quot;MCL, step &quot; + to_string(step));
    plt::xlim(0, 100);
    plt::ylim(0, 100);

    //Draw particles in green
    for (int i = 0; i &lt; n; i++) {
        plt::plot({ p[i].x }, { p[i].y }, &quot;go&quot;);
    }

    //Draw resampled particles in yellow
    for (int i = 0; i &lt; n; i++) {
        plt::plot({ pr[i].x }, { pr[i].y }, &quot;yo&quot;);
    }

    //Draw landmarks in red
    for (int i = 0; i &lt; sizeof(landmarks) / sizeof(landmarks[0]); i++) {
        plt::plot({ landmarks[i][0] }, { landmarks[i][1] }, &quot;ro&quot;);
    }
    
    //Draw robot position in blue
    plt::plot({ robot.x }, { robot.y }, &quot;bo&quot;);

	//Save the image and close the plot
    plt::save(&quot;./Images/Step&quot; + to_string(step) + &quot;.png&quot;);
    plt::clf();
}
*/</span>

<span class="token keyword keyword-int">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">//Practice Interfacing with Robot Class</span>
    Robot myrobot<span class="token punctuation">;</span>
    myrobot<span class="token punctuation">.</span><span class="token function">set_noise</span><span class="token punctuation">(</span><span class="token number">5.0</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">5.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    myrobot<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">30.0</span><span class="token punctuation">,</span> <span class="token number">50.0</span><span class="token punctuation">,</span> M_PI <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    myrobot<span class="token punctuation">.</span><span class="token function">move</span><span class="token punctuation">(</span><span class="token operator">-</span>M_PI <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">15.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//cout &lt;&lt; myrobot.read_sensors() &lt;&lt; endl;</span>
    myrobot<span class="token punctuation">.</span><span class="token function">move</span><span class="token punctuation">(</span><span class="token operator">-</span>M_PI <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token number">10.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//cout &lt;&lt; myrobot.read_sensors() &lt;&lt; endl;</span>

    <span class="token comment">// Create a set of particles</span>
    <span class="token keyword keyword-int">int</span> n <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span>
    Robot p<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">set_noise</span><span class="token punctuation">(</span><span class="token number">0.05</span><span class="token punctuation">,</span> <span class="token number">0.05</span><span class="token punctuation">,</span> <span class="token number">5.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//cout &lt;&lt; p[i].show_pose() &lt;&lt; endl;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//Re-initialize myrobot object and Initialize a measurment vector</span>
    myrobot <span class="token operator">=</span> <span class="token function">Robot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     vector<span class="token operator">&lt;</span><span class="token keyword keyword-double">double</span><span class="token operator">&gt;</span> z<span class="token punctuation">;</span>

    <span class="token comment">//Iterating 50 times over the set of particles</span>
    <span class="token keyword keyword-int">int</span> steps <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">;</span>
    <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> t <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> t <span class="token operator">&lt;</span> steps<span class="token punctuation">;</span> t<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment">//Move the robot and sense the environment afterwards</span>
        myrobot <span class="token operator">=</span> myrobot<span class="token punctuation">.</span><span class="token function">move</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">5.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        z <span class="token operator">=</span> myrobot<span class="token punctuation">.</span><span class="token function">sense</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Simulate a robot motion for each of these particles</span>
        Robot p2<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            p2<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">move</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">5.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            p<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> p2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//Generate particle weights depending on robot&apos;s measurement</span>
        <span class="token keyword keyword-double">double</span> w<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            w<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> p<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">measurement_prob</span><span class="token punctuation">(</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//cout &lt;&lt; w[i] &lt;&lt; endl;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//Resample the particles with a sample probability proportional to the importance weight</span>
        Robot p3<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-int">int</span> index <span class="token operator">=</span> <span class="token function">gen_real_random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> n<span class="token punctuation">;</span>
        <span class="token comment">//cout &lt;&lt; index &lt;&lt; endl;</span>
        <span class="token keyword keyword-double">double</span> beta <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span>
        <span class="token keyword keyword-double">double</span> mw <span class="token operator">=</span> <span class="token function">max</span><span class="token punctuation">(</span>w<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//cout &lt;&lt; mw;</span>
        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            beta <span class="token operator">+=</span> <span class="token function">gen_real_random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2.0</span> <span class="token operator">*</span> mw<span class="token punctuation">;</span>
            <span class="token keyword keyword-while">while</span> <span class="token punctuation">(</span>beta <span class="token operator">&gt;</span> w<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                beta <span class="token operator">-=</span> w<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>
                index <span class="token operator">=</span> <span class="token function">mod</span><span class="token punctuation">(</span><span class="token punctuation">(</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            p3<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> p<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword keyword-for">for</span> <span class="token punctuation">(</span><span class="token keyword keyword-int">int</span> k<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> k <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> k<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            p<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> p3<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token comment">//cout &lt;&lt; p[k].show_pose() &lt;&lt; endl;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//####   DON&apos;T MODIFY ANYTHING ABOVE HERE! ENTER CODE BELOW ####</span>
        
        <span class="token comment">//Evaluate the error by priting it in this form:</span>
        <span class="token comment">// cout &lt;&lt; &quot;Step = &quot; &lt;&lt; t &lt;&lt; &quot;, Evaluation = &quot; &lt;&lt; ErrorValue &lt;&lt; endl;</span>
        cout <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;Step = &quot;</span> <span class="token operator">&lt;&lt;</span> t <span class="token operator">&lt;&lt;</span> <span class="token string">&quot;, Evaluation = &quot;</span> <span class="token operator">&lt;&lt;</span> <span class="token function">evaluation</span><span class="token punctuation">(</span>myrobot<span class="token punctuation">,</span> p<span class="token punctuation">,</span> n<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>

    <span class="token punctuation">}</span> <span class="token comment">//End of Steps loop</span>
    <span class="token keyword keyword-return">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</pre><p>Each number generated denotes the <strong>average distance</strong> between the particles and the robot in a world of 100mx100m. Notice how the number starts relatively high and converges to a smaller number after several iterations.</p>
<h1 class="mume-header" id="graphing">Graphing</h1>

<p>So far, you&#x2019;ve coded MCL and evaluated the overall quality of your solution. Now, you&#x2019;ll be able to visualize what you&#x2019;ve coded, or more precisely MCL in action.</p>
<h3 class="mume-header" id="clone-the-lab-from-github">Clone the Lab from GitHub:</h3>

<pre data-role="codeBlock" data-info class="language-"><code>$ cd /home/workspace/
$ git clone https://github.com/udacity/RoboND-MCL-Lab

</code></pre><h3 class="mume-header" id="next-edit-maincpp">Next, edit  <code>main.cpp</code>:</h3>

<p>Enter the code in the designated section:</p>
<pre data-role="codeBlock" data-info class="language-"><code>//####   DON&apos;T MODIFY ANYTHING ABOVE HERE! ENTER CODE BELOW ####

//TODO: Graph the position of the robot and the particles at each step 

</code></pre><h3 class="mume-header" id="then-compile-the-program">Then, compile the program:</h3>

<pre data-role="codeBlock" data-info class="language-"><code>$ cd RoboND-MCL-Lab/
$ rm -rf Images/*
$ g++ main.cpp -o app -std=c++11 -I/usr/include/python2.7 -lpython2.7

</code></pre><h3 class="mume-header" id="finally-run-the-program">Finally run the program:</h3>

<p>Before you run the program, make sure the  <code>Images</code>  folder is empty!</p>
<pre data-role="codeBlock" data-info class="language-"><code>./app

</code></pre><p>If you get a warning regarding the  <code>matplotlib</code>  library, just ignore it.</p>
<h3 class="mume-header" id="now-wait-for-the-program-to-iterate-50-times-this-should-take-at-least-a-minute">Now, wait for the program to iterate  <code>50</code>  times, this should take at least a minute!</h3>

<h3 class="mume-header" id="generated-images">Generated Images:</h3>

<p>After running the program,  <code>50</code>  images will be generated in the  <code>Images</code>  folder:</p>
<h4 class="mume-header" id="step-0">Step 0:</h4>

<p align="center">
<img src="img/step0.png" alt="drawing" width="600">
</p>
<h4 class="mume-header" id="step-49">Step 49:</h4>

<p align="center">
<img src="img/step49.png" alt="drawing" width="600">
</p>
<p>Watch <a href="https://youtu.be/_E96yrPxVrM">this video</a> for a wrap up.</p>

      </div>
      
      
    
    
    
    
    
    
    
    
  
    </body></html>
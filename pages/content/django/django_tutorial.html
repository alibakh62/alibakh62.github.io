<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>django_tutorial.md</title>
  <link rel="stylesheet" href="https://stackedit.io/style.css" />
</head>

<body class="stackedit">
  <div class="stackedit__left">
    <div class="stackedit__toc">
      
<ul>
<li><a href="#table-of-contents">Table of Contents</a></li>
<li><a href="#introduction">Introduction</a>
<ul>
<li><a href="#create-a-new-django-project">Create a new Django project</a></li>
<li><a href="#the-development-server">The development server</a></li>
<li><a href="#create-a-new-app">Create a new app</a></li>
</ul>
</li>
<li><a href="#database">Database</a>
<ul>
<li><a href="#create-a-new-model">Create a new model</a></li>
<li><a href="#activating-models">Activating models</a></li>
<li><a href="#meta--options">Meta  options</a></li>
<li><a href="#model-methods">Model methods</a></li>
<li><a href="#the-django_extensions-module">The django_extensions Module</a></li>
<li><a href="#djano-admin">Djano Admin</a></li>
</ul>
</li>
<li><a href="#views">Views</a>
<ul>
<li><a href="#what-is-a-view">What is a view?</a></li>
<li><a href="#write-views-that-acutally-do-something">Write views that acutally do something</a></li>
<li><a href="#raising-a-404-error">Raising a 404 error</a>
<ul>
<li></li>
</ul>
</li>
<li><a href="#namespacing-url-names">Namespacing URL names</a></li>
</ul>
</li>
<li><a href="#form-processing">Form Processing</a>
<ul>
<li></li>
</ul>
</li>
<li><a href="#customize-your-apps-look-and-feel">Customize your app’s look and feel</a>
<ul>
<li><a href="#adding-background-image">Adding background image</a></li>
</ul>
</li>
<li><a href="#customizing-admin-panel">Customizing admin panel</a>
<ul>
<li><a href="#adding--related-objects">Adding  related objects</a></li>
<li><a href="#customize-the-admin-change-list">Customize the admin change list</a></li>
<li><a href="#customize-the-admin-look-and-feel">Customize the admin look and feel</a></li>
<li><a href="#customizing-the-admin-index-page">Customizing the admin index page</a></li>
</ul>
</li>
<li><a href="#the-djoser-library">The djoser library</a></li>
<li><a href="#the-rest_framework-module">The rest_framework Module</a>
<ul>
<li><a href="#installation">Installation</a></li>
<li><a href="#serialization">Serialization</a></li>
<li><a href="#writing-regular-django-views-using-our-serializer">Writing regular Django views using our Serializer</a></li>
<li><a href="#requests-and-responses">Requests and Responses</a></li>
<li><a href="#class-based-views">Class-based Views</a></li>
<li><a href="#authentication-and-permissions">Authentication and Permissions</a></li>
<li><a href="#relationships--hyperlinked-apis">Relationships & Hyperlinked APIs</a></li>
<li><a href="#viewsets-and-routers">ViewSets and Routers</a></li>
</ul>
</li>
</ul>

    </div>
  </div>
  <div class="stackedit__right">
    <div class="stackedit__html">
      <h1 id="table-of-contents">Table of Contents</h1>
<ul>
<li><a href="#introduction">Introduction</a>
<ul>
<li><a href="#create-a-new-django-project">Create a new Django project</a></li>
<li><a href="#the-development-server">The development server</a></li>
<li><a href="#create-a-new-app">Create a new app</a></li>
</ul>
</li>
<li><a href="#database">Database</a>
<ul>
<li><a href="#create-a-new-model">Create a new model</a></li>
<li><a href="#activating-models">Activating models</a></li>
<li><a href="#-meta---options"><code>Meta</code>  options</a></li>
<li><a href="#model-methods">Model methods</a></li>
<li><a href="#the--django-extensions--module">The <code>django_extensions</code> Module</a></li>
<li><a href="#djano-admin">Djano Admin</a></li>
</ul>
</li>
<li><a href="#views">Views</a>
<ul>
<li><a href="#what-is-a-view-">What is a view?</a></li>
<li><a href="#write-views-that-acutally-do-something">Write views that acutally do something</a>
<ul>
<li><a href="#django-s-template-system">Django’s template system</a></li>
</ul>
</li>
<li><a href="#raising-a-404-error">Raising a 404 error</a>
<ul>
<li><a href="#removing-hardcoded-urls-in-templates">Removing hardcoded URLs in templates</a></li>
</ul>
</li>
<li><a href="#namespacing-url-names">Namespacing URL names</a></li>
</ul>
</li>
<li><a href="#form-processing">Form Processing</a>
<ul>
<li><a href="#use-generic-views--less-code-is-better">Use generic views: Less code is better</a></li>
<li><a href="#amend-urlconf">Amend URLconf</a></li>
<li><a href="#amend-views">Amend views</a></li>
</ul>
</li>
<li><a href="#customize-your-app-s-look-and-feel">Customize your app’s look and feel</a>
<ul>
<li><a href="#adding-background-image">Adding background image</a></li>
</ul>
</li>
<li><a href="#customizing-admin-panel">Customizing admin panel</a>
<ul>
<li><a href="#adding--related-objects">Adding  related objects</a></li>
<li><a href="#customize-the-admin-change-list">Customize the admin change list</a></li>
<li><a href="#customize-the-admin-look-and-feel">Customize the admin look and feel</a>
<ul>
<li><a href="#customizing-your-project-s-templates">Customizing your project’s templates</a></li>
</ul>
</li>
<li><a href="#customizing-the-admin-index-page">Customizing the admin index page</a></li>
</ul>
</li>
<li><a href="#the--djoser--library">The <code>djoser</code> library</a></li>
<li><a href="#the--rest-framework--module">The <code>rest_framework</code> Module</a>
<ul>
<li><a href="#installation">Installation</a></li>
<li><a href="#serialization">Serialization</a>
<ul>
<li><a href="#creating-a-model-to-work-with">Creating a model to work with</a></li>
<li><a href="#creating-a-serializer-class">Creating a Serializer class</a></li>
<li><a href="#using--modelserializers-">Using <code>ModelSerializers</code></a></li>
</ul>
</li>
<li><a href="#writing-regular-django-views-using-our-serializer">Writing regular Django views using our Serializer</a></li>
<li><a href="#requests-and-responses">Requests and Responses</a>
<ul>
<li><a href="#request-objects">Request Objects</a></li>
<li><a href="#response-objects">Response Objects</a></li>
<li><a href="#status-codes">Status codes</a></li>
<li><a href="#wrapping-api-views">Wrapping API views</a></li>
<li><a href="#pulling-it-all-together">Pulling it all together</a></li>
<li><a href="#adding-optional-format-suffixes-to-our-urls">Adding optional format suffixes to our URLs</a></li>
</ul>
</li>
<li><a href="#class-based-views">Class-based Views</a>
<ul>
<li><a href="#using--mixins-">Using <code>mixins</code></a></li>
<li><a href="#using-generic-class-based-views">Using generic class-based views</a></li>
</ul>
</li>
<li><a href="#authentication-and-permissions">Authentication and Permissions</a>
<ul>
<li><a href="#adding-information-to-our-model">Adding information to our model</a></li>
<li><a href="#adding-endpoints-for-our-user-models">Adding endpoints for our User models</a></li>
<li><a href="#associating-snippets-with-users">Associating Snippets with Users</a></li>
<li><a href="#updating-our-serializer">Updating our serializer</a></li>
<li><a href="#adding-required-permissions-to-views">Adding required permissions to views</a></li>
<li><a href="#adding-login-to-the-browsable-api">Adding login to the Browsable API</a></li>
<li><a href="#object-level-permissions">Object level permissions</a></li>
<li><a href="#authenticating-with-the-api">Authenticating with the API</a></li>
</ul>
</li>
<li><a href="#relationships---hyperlinked-apis">Relationships &amp; Hyperlinked APIs</a>
<ul>
<li><a href="#creating-an-endpoint-for-the-root-of-our-api">Creating an endpoint for the root of our API</a></li>
<li><a href="#creating-an-endpoint-for-the-highlighted-snippets">Creating an endpoint for the highlighted snippets</a></li>
<li><a href="#hyperlinking-our-api">Hyperlinking our API</a></li>
<li><a href="#making-sure-our-url-patterns-are-named">Making sure our URL patterns are named</a></li>
<li><a href="#adding-pagination">Adding pagination</a></li>
</ul>
</li>
<li><a href="#viewsets-and-routers">ViewSets and Routers</a>
<ul>
<li><a href="#refactoring-to-use-viewsets">Refactoring to use ViewSets</a></li>
<li><a href="#binding-viewsets-to-urls-explicitly">Binding ViewSets to URLs explicitly</a></li>
<li><a href="#using-routers">Using Routers</a></li>
<li><a href="#trade-offs-between-views-vs-viewsets">Trade-offs between views vs viewsets</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="introduction">Introduction</h1>
<ul>
<li>Check the Django version: <code>python -m django --version</code></li>
</ul>
<h2 id="create-a-new-django-project">Create a new Django project</h2>
<p>To create a new Django project, run the following command:</p>
<pre class=" language-bash"><code class="prism  language-bash">    django-admin startproject <span class="token operator">&lt;</span>project_name<span class="token operator">&gt;</span>
</code></pre>
<p>Here’s the project structure:</p>
<pre class=" language-txt"><code class="prism  language-txt">&lt;project name&gt;/
    manage.py
    &lt;project name&gt;/
        __init__.py
        settings.py
        urls.py
        asgi.py
        wsgi.py
</code></pre>
<p>These files are:</p>
<ul>
<li>The outer  <code>mysite/</code>  root directory is a container for your project. Its name doesn’t matter to Django; you can rename it to anything you like.</li>
<li><code>manage.py</code>: A command-line utility that lets you interact with this Django project in various ways. You can read all the details about  <code>manage.py</code>  in  <a href="https://docs.djangoproject.com/en/4.0/ref/django-admin/">django-admin and manage.py</a>.</li>
<li>The inner  <code>mysite/</code>  directory is the actual Python package for your project. Its name is the Python package name you’ll need to use to import anything inside it (e.g.  <code>mysite.urls</code>).</li>
<li><code>mysite/__init__.py</code>: An empty file that tells Python that this directory should be considered a Python package. If you’re a Python beginner, read  <a href="https://docs.python.org/3/tutorial/modules.html#tut-packages" title="(in Python v3.10)">more about packages</a>  in the official Python docs.</li>
<li><code>mysite/settings.py</code>: Settings/configuration for this Django project.  <a href="https://docs.djangoproject.com/en/4.0/topics/settings/">Django settings</a>  will tell you all about how settings work.</li>
<li><code>mysite/urls.py</code>: The URL declarations for this Django project; a “table of contents” of your Django-powered site. You can read more about URLs in  <a href="https://docs.djangoproject.com/en/4.0/topics/http/urls/">URL dispatcher</a>.</li>
<li><code>mysite/asgi.py</code>: An entry-point for ASGI-compatible web servers to serve your project. See  <a href="https://docs.djangoproject.com/en/4.0/howto/deployment/asgi/">How to deploy with ASGI</a>  for more details.</li>
<li><code>mysite/wsgi.py</code>: An entry-point for WSGI-compatible web servers to serve your project. See  <a href="https://docs.djangoproject.com/en/4.0/howto/deployment/wsgi/">How to deploy with WSGI</a>  for more details.</li>
</ul>
<h2 id="the-development-server">The development server</h2>
<p>To verufy if your project is working, you can run the following command:</p>
<pre class=" language-bash"><code class="prism  language-bash">    python manage.py runserver
</code></pre>
<p>A local server will be started on port 8000, and you can access it by visiting  <a href="http://127.0.0.1:8000/">http://127.0.0.1:8000/</a>  in your browser.</p>
<h2 id="create-a-new-app">Create a new app</h2>
<ul>
<li>So far, you’ve only created a Django project, but you can also create a new app.</li>
<li>Each application you write in Django consists of a Python package that follows a certain convention. Django comes with a utility that automatically generates the basic directory structure of an app, so you can focus on writing code rather than creating directories.</li>
</ul>
<p><strong>Projects vs. apps</strong></p>
<ul>
<li>What’s the difference between a project and an app? An app is a web application that does something – e.g., a blog system, a database of public records or a small poll app. A project is a collection of configuration and apps for a particular website. A project can contain multiple apps. An app can be in multiple projects.</li>
</ul>
<p>To create your app, make sure you’re in the same directory as <code>manage.py</code> and type this command:</p>
<pre class=" language-bash"><code class="prism  language-bash">    django-admin startapp <span class="token operator">&lt;</span>app_name<span class="token operator">&gt;</span>
</code></pre>
<p>Here’s the app structure:</p>
<pre class=" language-txt"><code class="prism  language-txt">&lt;project name&gt;/
    manage.py
    &lt;project name&gt;/
	__init__.py
	settings.py
	urls.py
	asgi.py
	wsgi.py
    &lt;app name&gt;/
	__init__.py
	admin.py
	apps.py
	migrations/
	    __init__.py
	models.py
	views.py
	urls.py
	tests.py
</code></pre>
<p>Simplest app in Django, write this in <code>&lt;app name&gt;/views.py</code>:</p>
<pre class=" language-python"><code class="prism  language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>http <span class="token keyword">import</span> HttpResponse


<span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span><span class="token string">"Hello, world. You're at the polls index."</span><span class="token punctuation">)</span>
</code></pre>
<p>In order to show this view, add it under <code>&lt;app name&gt;/urls.py</code>:</p>
<pre class=" language-python"><code class="prism  language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>urls <span class="token keyword">import</span> path

<span class="token keyword">from</span> <span class="token punctuation">.</span> <span class="token keyword">import</span> views

urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>
    path<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>index<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'index'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre>
<p>The next step is to point the root URLconf at the <code>&lt;app name&gt;/urls.py</code> module. In <code>&lt;project name&gt;/urls.py</code>, add an import for <code>django.urls.include</code> and insert an <code>include()</code> call in the <code>urlpatterns</code> list.</p>
<pre class=" language-python"><code class="prism  language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib <span class="token keyword">import</span> admin
<span class="token keyword">from</span> django<span class="token punctuation">.</span>urls <span class="token keyword">import</span> include<span class="token punctuation">,</span> path

urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>
    path<span class="token punctuation">(</span><span class="token string">'&lt;app name&gt;/'</span><span class="token punctuation">,</span> include<span class="token punctuation">(</span><span class="token string">'&lt;app name&gt;.urls'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    path<span class="token punctuation">(</span><span class="token string">'admin/'</span><span class="token punctuation">,</span> admin<span class="token punctuation">.</span>site<span class="token punctuation">.</span>urls<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre>
<h1 id="database">Database</h1>
<ul>
<li>Database setup is done in <code>&lt;project name&gt;/settings.py</code>.</li>
<li>By default, Django uses SQLite for its database.</li>
<li>If you wish to use another database, install the appropriate  <a href="https://docs.djangoproject.com/en/4.0/topics/install/#database-installation">database bindings</a>  and change the following keys in the  <a href="https://docs.djangoproject.com/en/4.0/ref/settings/#std:setting-DATABASES"><code>DATABASES</code></a>  <code>'default'</code>  item to match your database connection settings:
<ul>
<li><a href="https://docs.djangoproject.com/en/4.0/ref/settings/#std:setting-DATABASE-ENGINE"><code>ENGINE</code></a>  – Either  <code>'django.db.backends.sqlite3'</code>,  <code>'django.db.backends.postgresql'</code>,  <code>'django.db.backends.mysql'</code>, or  <code>'django.db.backends.oracle'</code>. Other backends are  <a href="https://docs.djangoproject.com/en/4.0/ref/databases/#third-party-notes">also available</a>.</li>
<li><a href="https://docs.djangoproject.com/en/4.0/ref/settings/#std:setting-NAME"><code>NAME</code></a>  – The name of your database. If you’re using SQLite, the database will be a file on your computer; in that case,  <a href="https://docs.djangoproject.com/en/4.0/ref/settings/#std:setting-NAME"><code>NAME</code></a>  should be the full absolute path, including filename, of that file. The default value,  <code>BASE_DIR / 'db.sqlite3'</code>, will store the file in your project directory.</li>
</ul>
</li>
<li>By default, INSTALLED_APPS contains some basic apps. These applications are included by default as a convenience for the common case.</li>
<li>Some of these applications make use of at least one database table, though, so we need to create the tables in the database before we can use them. To do that, run the following command:</li>
</ul>
<pre class=" language-bash"><code class="prism  language-bash">    python manage.py migrate
</code></pre>
<ul>
<li>The <a href="https://docs.djangoproject.com/en/4.0/ref/django-admin/#django-admin-migrate"><code>migrate</code></a> command looks at the <a href="https://docs.djangoproject.com/en/4.0/ref/settings/#std:setting-INSTALLED_APPS"><code>INSTALLED_APPS</code></a> setting and creates any necessary database tables according to the database settings in your <code>&lt;project name&gt;/settings.py</code> file and the database migrations shipped with the app.</li>
</ul>
<h2 id="create-a-new-model">Create a new model</h2>
<blockquote>
<p><strong>Note:</strong> <em>For a complete guide on Django models, check out <a href="https://docs.djangoproject.com/en/4.0/topics/db/models/">this page</a>.</em></p>
</blockquote>
<p>Now we’ll define your models – essentially, your database layout, with additional metadata.</p>
<p><strong>Philosophy</strong></p>
<p>A model is the single, definitive source of information about your data. It contains the essential fields and behaviors of the data you’re storing. Django follows the  <a href="https://docs.djangoproject.com/en/4.0/misc/design-philosophies/#dry">DRY Principle</a>. The goal is to define your data model in one place and automatically derive things from it.<br>
This includes the migrations - unlike in Ruby On Rails, for example, migrations are entirely derived from your models file, and are essentially a history that Django can roll through to update your database schema to match your current models.</p>
<ul>
<li>You create models in Python classes. They’re defined in the <code>&lt;app name&gt;/models.py</code> file.</li>
<li>The class name should be the same as the table name in the database.</li>
<li>The class name should be in CamelCase.</li>
<li>Model fields are defined in the class body, using the <a href="https://docs.djangoproject.com/en/4.0/ref/models/fields/#field-types"><code>Field</code></a> class.</li>
</ul>
<pre class=" language-python"><code class="prism  language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> models

<span class="token keyword">class</span> <span class="token class-name">Question</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    question_text <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">200</span><span class="token punctuation">)</span>
    pub_date <span class="token operator">=</span> models<span class="token punctuation">.</span>DateTimeField<span class="token punctuation">(</span><span class="token string">'date published'</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">Choice</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    question <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>Question<span class="token punctuation">,</span> on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>CASCADE<span class="token punctuation">)</span>
    choice_text <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">200</span><span class="token punctuation">)</span>
    votes <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>default<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
</code></pre>
<ul>
<li>Here, each model is represented by a class that subclasses  <a href="https://docs.djangoproject.com/en/4.0/ref/models/instances/#django.db.models.Model" title="django.db.models.Model"><code>django.db.models.Model</code></a>. Each model has a number of class variables, each of which represents a database field in the model.</li>
<li>Each field is represented by an instance of a  <a href="https://docs.djangoproject.com/en/4.0/ref/models/fields/#django.db.models.Field" title="django.db.models.Field"><code>Field</code></a>  class – e.g.,  <a href="https://docs.djangoproject.com/en/4.0/ref/models/fields/#django.db.models.CharField" title="django.db.models.CharField"><code>CharField</code></a>  for character fields and  <a href="https://docs.djangoproject.com/en/4.0/ref/models/fields/#django.db.models.DateTimeField" title="django.db.models.DateTimeField"><code>DateTimeField</code></a>  for datetimes. This tells Django what type of data each field holds.</li>
<li>The name of each  <a href="https://docs.djangoproject.com/en/4.0/ref/models/fields/#django.db.models.Field" title="django.db.models.Field"><code>Field</code></a>  instance (e.g.  <code>question_text</code>  or  <code>pub_date</code>) is the field’s name, in machine-friendly format. You’ll use this value in your Python code, and your database will use it as the column name.</li>
</ul>
<h2 id="activating-models">Activating models</h2>
<ul>
<li>First, you need to tell your Django project that your app is installed. You should list it under the  <a href="https://docs.djangoproject.com/en/4.0/ref/settings/#std:setting-INSTALLED_APPS"><code>INSTALLED_APPS</code></a> in <code>settings</code>.</li>
<li>You’d put your app config under <code>&lt;app name&gt;/apps.py</code>.</li>
<li>Now, Django knows to include your app.</li>
<li>Now, you bring (migrate) you app’s models with the following command:</li>
</ul>
<pre class=" language-bash"><code class="prism  language-bash">    python manage.py makemigrations <span class="token operator">&lt;</span>app name<span class="token operator">&gt;</span>
</code></pre>
<ul>
<li>By running <code>makemigrations</code>, you’re telling Django that you’ve made some changes to your models (in this case, you’ve made new ones) and that you’d like the changes to be stored as a <em>migration</em>.
<ul>
<li>Migrations are how Django stores changes to your models (and thus your database schema) - they’re files on disk. You can read the migration for your new model if you like; it’s the file <code>&lt;app name&gt;/migrations/0001_initial.py</code>. Don’t worry, you’re not expected to read them every time Django makes one, but they’re designed to be human-editable in case you want to manually tweak how Django changes things.</li>
</ul>
</li>
<li>Now, run <code>migrate</code> again to create those model tables in your database.
<ul>
<li>The <code>migrate</code> command takes all the migrations that haven’t been applied (Django tracks which ones are applied using a special table in your database called <code>django_migrations</code>) and runs them against your database - essentially, synchronizing the changes you made to your models with the schema in the database.</li>
</ul>
</li>
</ul>
<p>To <strong>summarize</strong>, here are the main steps to create a new model:</p>
<ul>
<li>Change your models (in  <code>models.py</code>).</li>
<li>Run  <a href="https://docs.djangoproject.com/en/4.0/ref/django-admin/#django-admin-makemigrations"><code>python manage.py makemigrations</code></a>  to create migrations for those changes</li>
<li>Run  <a href="https://docs.djangoproject.com/en/4.0/ref/django-admin/#django-admin-migrate"><code>python manage.py migrate</code></a>  to apply those changes to the database.</li>
</ul>
<p><strong>Note:</strong> You can use <code>$ python manage.py shell</code> to interact with your database and models.</p>
<p>Here’s a sample of a model:</p>
<pre class=" language-python"><code class="prism  language-python"><span class="token keyword">import</span> datetime

<span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> models
<span class="token keyword">from</span> django<span class="token punctuation">.</span>utils <span class="token keyword">import</span> timezone

<span class="token comment"># Create your models here.</span>
<span class="token keyword">class</span> <span class="token class-name">Question</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    question_text <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">200</span><span class="token punctuation">)</span>
    pub_date <span class="token operator">=</span> models<span class="token punctuation">.</span>DateTimeField<span class="token punctuation">(</span><span class="token string">'date published'</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>question_text

    <span class="token keyword">def</span> <span class="token function">was_published_recently</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>pub_date <span class="token operator">&gt;=</span> timezone<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> datetime<span class="token punctuation">.</span>timedelta<span class="token punctuation">(</span>days<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">Choice</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    question <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span>Question<span class="token punctuation">,</span> on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>CASCADE<span class="token punctuation">)</span>
    choice_text <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">200</span><span class="token punctuation">)</span>
    votes <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>default<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>choice_text
</code></pre>
<p><strong>Note</strong>: It’s important to add <code>__str__()</code> methods to your models, not only for your own convenience when dealing with the interactive prompt, but also because objects’ representations are used throughout Django’s automatically-generated admin.</p>
<h2 id="meta--options"><code>Meta</code>  options</h2>
<p>Give your model metadata by using an inner  <code>class Meta</code>, like so:</p>
<pre class=" language-python"><code class="prism  language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> models

<span class="token keyword">class</span> <span class="token class-name">Ox</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    horn_length <span class="token operator">=</span> models<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        ordering <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"horn_length"</span><span class="token punctuation">]</span>
        verbose_name_plural <span class="token operator">=</span> <span class="token string">"oxen"</span>
</code></pre>
<p>Model metadata is “anything that’s not a field”, such as ordering options (<a href="https://docs.djangoproject.com/en/4.0/ref/models/options/#django.db.models.Options.ordering" title="django.db.models.Options.ordering"><code>ordering</code></a>), database table name (<a href="https://docs.djangoproject.com/en/4.0/ref/models/options/#django.db.models.Options.db_table" title="django.db.models.Options.db_table"><code>db_table</code></a>), or human-readable singular and plural names (<a href="https://docs.djangoproject.com/en/4.0/ref/models/options/#django.db.models.Options.verbose_name" title="django.db.models.Options.verbose_name"><code>verbose_name</code></a>  and  <a href="https://docs.djangoproject.com/en/4.0/ref/models/options/#django.db.models.Options.verbose_name_plural" title="django.db.models.Options.verbose_name_plural"><code>verbose_name_plural</code></a>). None are required, and adding  <code>class Meta</code>  to a model is completely optional.</p>
<p>A complete list of all possible  <code>Meta</code>  options can be found in the  <a href="https://docs.djangoproject.com/en/4.0/ref/models/options/">model option reference</a>.</p>
<h2 id="model-methods">Model methods</h2>
<p>Define custom methods on a model to add custom “row-level” functionality to your objects. Whereas  <a href="https://docs.djangoproject.com/en/4.0/topics/db/managers/#django.db.models.Manager" title="django.db.models.Manager"><code>Manager</code></a>  methods are intended to do “table-wide” things, model methods should act on a particular model instance.</p>
<p>This is a valuable technique for keeping business logic in one place – the model.</p>
<p>For example, this model has a few custom methods:</p>
<pre class=" language-python"><code class="prism  language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> models

<span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    first_name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">)</span>
    last_name <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">)</span>
    birth_date <span class="token operator">=</span> models<span class="token punctuation">.</span>DateField<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">baby_boomer_status</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token string">"Returns the person's baby-boomer status."</span>
        <span class="token keyword">import</span> datetime
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>birth_date <span class="token operator">&lt;</span> datetime<span class="token punctuation">.</span>date<span class="token punctuation">(</span><span class="token number">1945</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token string">"Pre-boomer"</span>
        <span class="token keyword">elif</span> self<span class="token punctuation">.</span>birth_date <span class="token operator">&lt;</span> datetime<span class="token punctuation">.</span>date<span class="token punctuation">(</span><span class="token number">1965</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token string">"Baby boomer"</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token string">"Post-boomer"</span>

    @<span class="token builtin">property</span>
    <span class="token keyword">def</span> <span class="token function">full_name</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token string">"Returns the person's full name."</span>
        <span class="token keyword">return</span> <span class="token string">'%s  %s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>first_name<span class="token punctuation">,</span> self<span class="token punctuation">.</span>last_name<span class="token punctuation">)</span>
</code></pre>
<p>The last method in this example is a  <a href="https://docs.djangoproject.com/en/4.0/glossary/#term-property">property</a>.</p>
<h2 id="the-django_extensions-module">The <code>django_extensions</code> Module</h2>
<ul>
<li>With <code>django_extensions</code>, you can do more stuff on your models.</li>
<li>For example, you get visualize the database schema for an app with the following command:
<ul>
<li><code>python manage.py graph_models &lt;app name&gt; -o &lt;output name&gt;.png</code></li>
</ul>
</li>
<li><strong>Note</strong>: You can also use <code>python manage.py graph_models</code> to get a graph of all your models.</li>
<li><strong>Note</strong>: You should put <code>django_extensions</code> in your <code>INSTALLED_APPS</code> list.</li>
<li><strong>Note</strong>: For more information on model relations, see <a href="https://docs.djangoproject.com/en/4.0/ref/models/relations/">Accessing related objects</a>. For more on how to use double underscores to perform field lookups via the API, see <a href="https://docs.djangoproject.com/en/4.0/topics/db/queries/#field-lookups-intro">Field lookups</a>. For full details on the database API, see our <a href="https://docs.djangoproject.com/en/4.0/topics/db/queries/">Database API reference</a>.</li>
</ul>
<h2 id="djano-admin">Djano Admin</h2>
<p><strong>Philosophy</strong></p>
<blockquote>
<p>Generating admin sites for your staff or clients to add, change, and delete content is tedious work that doesn’t require much creativity. For that reason, Django entirely automates creation of admin interfaces for models.<br>
Django was written in a newsroom environment, with a very clear separation between “content publishers” and the “public” site. Site managers use the system to add news stories, events, sports scores, etc., and that content is displayed on the public site. Django solves the problem of creating a unified interface for site administrators to edit content.<br>
The admin isn’t intended to be used by site visitors. It’s for site managers.</p>
</blockquote>
<ul>
<li><strong>Creating an admin user</strong> <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>→</mo></mrow><annotation encoding="application/x-tex">\rightarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.36687em; vertical-align: 0em;"></span><span class="mrel">→</span></span></span></span></span> <code>python manage.py createsuperuser</code></li>
<li><strong>Start a development server</strong> <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>→</mo></mrow><annotation encoding="application/x-tex">\rightarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.36687em; vertical-align: 0em;"></span><span class="mrel">→</span></span></span></span></span> <code>python manage.py runserver</code>
<ul>
<li>Now, go to <code>http://127.0.0.1:8000/admin/</code> in your browser, and login with your admin user.</li>
</ul>
</li>
</ul>
<p>In order to use the admin interface for the models in your app, you need to tell <em>admin</em> about the model objects that you want to have an admin interface for.</p>
<p>Here’s an example of how to do that. You should do it in the <code>&lt;app name&gt;/admin.py</code> file:</p>
<pre class=" language-python"><code class="prism  language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib <span class="token keyword">import</span> admin

<span class="token keyword">from</span> <span class="token punctuation">.</span>models <span class="token keyword">import</span> Question

admin<span class="token punctuation">.</span>site<span class="token punctuation">.</span>register<span class="token punctuation">(</span>Question<span class="token punctuation">)</span>
</code></pre>
<h1 id="views">Views</h1>
<h2 id="what-is-a-view">What is a view?</h2>
<ul>
<li>Views are webpages in Django application.</li>
<li>Contents are delivered through Views in Django.</li>
<li>A URL pattern is a general form of a URL: <code>/newsarchive/&lt;year&gt;/&lt;month&gt;/</code></li>
<li>Django uses <strong><code>URLconfs</code></strong> to go from URL to views, it maps URL patterns to views.</li>
<li>The views are added in the <code>&lt;django app name&gt;/views.py</code> file.</li>
<li>Example of <code>urlpatterns</code> in the <code>&lt;django app name&gt;/urls.py</code> file:</li>
</ul>
<pre class=" language-python"><code class="prism  language-python">urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token comment"># ex: /polls/</span>
    path<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>index<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'index'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment"># ex: /polls/5/</span>
    path<span class="token punctuation">(</span><span class="token string">'&lt;int:question_id&gt;/'</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>detail<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'detail'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment"># ex: /polls/5/results/</span>
    path<span class="token punctuation">(</span><span class="token string">'&lt;int:question_id&gt;/results/'</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>results<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'results'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre>
<ul>
<li><strong>Note:</strong> <code>&lt;int:question_id&gt;</code> is a regular expression that matches an integer. Django sends it as a keyword argument to the view function.</li>
</ul>
<h2 id="write-views-that-acutally-do-something">Write views that acutally do something</h2>
<p>Each view is responsible for doing one of two things:</p>
<ul>
<li>Returning an <code>HttpResponse</code> object containing the content for the requested page, or</li>
<li>Raising an exception such as Http404. <strong>The rest is up to you</strong>.</li>
</ul>
<p>Your view can:</p>
<ul>
<li>Read records from a database, or not.</li>
<li>It can use a template system such as Django’s – or a third-party Python template system – or not.</li>
<li>It can generate a PDF file, output XML, create a ZIP file on the fly,</li>
<li>Or anything you want, using whatever Python libraries you want.</li>
</ul>
<p><strong>All Django wants is that <code>HttpResponse</code>, Or an exception.</strong></p>
<ul>
<li><strong>Note:</strong> <code>HttpResponse</code> is a Django class that is used to return a response to the client.</li>
<li><strong>Note:</strong> <code>Http404</code> is a Django exception that is raised when a page is not found.</li>
<li><strong>Note:</strong> <code>HttpResponseRedirect</code> is a Django class that is used to redirect the client to another page.</li>
<li><strong>Note:</strong> In order to NOT hard code the page’s desgin, we use Dajngo’s <strong>template</strong> system.</li>
<li><strong>Note:</strong> <code>render()</code> is a Django function that is used to render a template.</li>
</ul>
<h3 id="djangos-template-system">Django’s template system</h3>
<ul>
<li>First, you need to create a <strong><code>templates</code></strong> folder in the <code>&lt;django app name&gt;</code> folder.
<ul>
<li>By convention <code>DjangoTemplates</code> looks for a “templates” subdirectory in each of the <code>INSTALLED_APPS</code>.</li>
</ul>
</li>
<li>Default templates settings is like this:</li>
</ul>
<pre class=" language-python"><code class="prism  language-python">TEMPLATES <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token string">'BACKEND'</span><span class="token punctuation">:</span> <span class="token string">'django.template.backends.django.DjangoTemplates'</span><span class="token punctuation">,</span>
        <span class="token string">'APP_DIRS'</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre>
<ul>
<li>You need to create another directory in the <code>templates</code> folder called <code>&lt;django app name&gt;</code>.
<ul>
<li>Under that directory, create an <code>index.html</code> file. This is where you put your template code.</li>
<li>Check out below for an example of a template.</li>
</ul>
</li>
</ul>
<pre class=" language-python"><code class="prism  language-python"><span class="token punctuation">{</span><span class="token operator">%</span> <span class="token keyword">if</span> latest_question_list <span class="token operator">%</span><span class="token punctuation">}</span>
    <span class="token operator">&lt;</span>ul<span class="token operator">&gt;</span>
    <span class="token punctuation">{</span><span class="token operator">%</span> <span class="token keyword">for</span> question <span class="token keyword">in</span> latest_question_list <span class="token operator">%</span><span class="token punctuation">}</span>
        <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span><span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">"/polls/{{ question.id }}/"</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span> question<span class="token punctuation">.</span>question_text <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
    <span class="token punctuation">{</span><span class="token operator">%</span> endfor <span class="token operator">%</span><span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">&gt;</span>
<span class="token punctuation">{</span><span class="token operator">%</span> <span class="token keyword">else</span> <span class="token operator">%</span><span class="token punctuation">}</span>
    <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>No polls are available<span class="token punctuation">.</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
<span class="token punctuation">{</span><span class="token operator">%</span> endif <span class="token operator">%</span><span class="token punctuation">}</span>
</code></pre>
<ul>
<li>After creating the template, you need to update the <strong>index view</strong> in <code>&lt;django app name&gt;/views.py</code> file to use the template.</li>
</ul>
<h2 id="raising-a-404-error">Raising a 404 error</h2>
<ul>
<li>If the page doesn’t exist, you can raise a <code>Http404</code> exception. This will tell Django to display the 404 page.</li>
<li>There are two ways to raise a <code>Http404</code> exception:
<ul>
<li>By using the <code>raise Http404</code> statement in the view function.</li>
<li>By using the <code>get_object_or_404()</code> shortcut.</li>
</ul>
</li>
</ul>
<pre class=" language-python"><code class="prism  language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>http <span class="token keyword">import</span> Http404
<span class="token keyword">from</span> django<span class="token punctuation">.</span>shortcuts <span class="token keyword">import</span> render

<span class="token comment">#...</span>

<span class="token keyword">def</span> <span class="token function">detail</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> question_id<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        question <span class="token operator">=</span> Question<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>pk<span class="token operator">=</span>question_id<span class="token punctuation">)</span>
    <span class="token keyword">except</span> Question<span class="token punctuation">.</span>DoesNotExist<span class="token punctuation">:</span>
        <span class="token keyword">raise</span> Http404<span class="token punctuation">(</span><span class="token string">"Question does not exist"</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">'polls/detail.html'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'question'</span><span class="token punctuation">:</span> question<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<pre class=" language-python"><code class="prism  language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>shortcuts <span class="token keyword">import</span> get_object_or_404<span class="token punctuation">,</span> render

<span class="token keyword">from</span> <span class="token punctuation">.</span>models <span class="token keyword">import</span> Question
<span class="token comment"># ...</span>
<span class="token keyword">def</span> <span class="token function">detail</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> question_id<span class="token punctuation">)</span><span class="token punctuation">:</span>
    question <span class="token operator">=</span> get_object_or_404<span class="token punctuation">(</span>Question<span class="token punctuation">,</span> pk<span class="token operator">=</span>question_id<span class="token punctuation">)</span>
    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">'polls/detail.html'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'question'</span><span class="token punctuation">:</span> question<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<h4 id="removing-hardcoded-urls-in-templates">Removing hardcoded URLs in templates</h4>
<ul>
<li>Since you defined the name argument in the <code>&lt;django app name&gt;/urls.py</code> file, you can use it in the template.</li>
<li>You can remove a reliance on specific URL paths defined in your URL configurations by using the <code>{% url %}</code> template tag.</li>
</ul>
<p><strong>Example:</strong></p>
<p>This hardcoded URL:</p>
<pre class=" language-html"><code class="prism  language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/polls/{{ question.id }}/<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{{ question.question_text }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>gets converted to this:</p>
<pre class=" language-html"><code class="prism  language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{% url <span class="token punctuation">'</span>detail<span class="token punctuation">'</span> question.id %}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{{ question.question_text }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>Here, the <code>'detail'</code> argument is the name of the view function.</p>
<h2 id="namespacing-url-names">Namespacing URL names</h2>
<p>In real Django applications, there might be different apps which the same URL names? How does Django differentiate between them?</p>
<p>Django uses a <code>namespace</code> to separate your URLs. It adds namespaces to your URLconf, <code>&lt;django app name&gt;/urls.py</code></p>
<p>To point at the namespace in a template:</p>
<pre class=" language-python"><code class="prism  language-python">    <span class="token punctuation">{</span><span class="token operator">%</span> url <span class="token string">'polls:detail'</span> question<span class="token punctuation">.</span><span class="token builtin">id</span> <span class="token operator">%</span><span class="token punctuation">}</span>
</code></pre>
<h1 id="form-processing">Form Processing</h1>
<p>Let’s update our poll detail template (<code>polls/templates/polls/detail.html</code>) from the last tutorial, so that the template contains an HTML <code>&lt;form&gt;</code> element:</p>
<pre class=" language-python"><code class="prism  language-python"><span class="token operator">&lt;</span>form action<span class="token operator">=</span><span class="token string">"{% url 'polls:vote' question.id %}"</span> method<span class="token operator">=</span><span class="token string">"post"</span><span class="token operator">&gt;</span>
<span class="token punctuation">{</span><span class="token operator">%</span> csrf_token <span class="token operator">%</span><span class="token punctuation">}</span>
<span class="token operator">&lt;</span>fieldset<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>legend<span class="token operator">&gt;</span><span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span> question<span class="token punctuation">.</span>question_text <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>legend<span class="token operator">&gt;</span>
    <span class="token punctuation">{</span><span class="token operator">%</span> <span class="token keyword">if</span> error_message <span class="token operator">%</span><span class="token punctuation">}</span><span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token operator">&lt;</span>strong<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span> error_message <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>strong<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token operator">%</span> endif <span class="token operator">%</span><span class="token punctuation">}</span>
    <span class="token punctuation">{</span><span class="token operator">%</span> <span class="token keyword">for</span> choice <span class="token keyword">in</span> question<span class="token punctuation">.</span>choice_set<span class="token punctuation">.</span><span class="token builtin">all</span> <span class="token operator">%</span><span class="token punctuation">}</span>
        <span class="token operator">&lt;</span><span class="token builtin">input</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">"radio"</span> name<span class="token operator">=</span><span class="token string">"choice"</span> <span class="token builtin">id</span><span class="token operator">=</span><span class="token string">"choice{{ forloop.counter }}"</span> value<span class="token operator">=</span><span class="token string">"{{ choice.id }}"</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>label <span class="token keyword">for</span><span class="token operator">=</span><span class="token string">"choice{{ forloop.counter }}"</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span> choice<span class="token punctuation">.</span>choice_text <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">&gt;</span><span class="token operator">&lt;</span>br<span class="token operator">&gt;</span>
    <span class="token punctuation">{</span><span class="token operator">%</span> endfor <span class="token operator">%</span><span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>fieldset<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token builtin">input</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">"submit"</span> value<span class="token operator">=</span><span class="token string">"Vote"</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">&gt;</span>
</code></pre>
<p>A quick rundown:</p>
<ul>
<li>The above template displays a radio button for each question choice. The  <code>value</code>  of each radio button is the associated question choice’s ID. The  <code>name</code>  of each radio button is  <code>"choice"</code>. That means, when somebody selects one of the radio buttons and submits the form, it’ll send the POST data  <code>choice=#</code>  where # is the ID of the selected choice. This is the basic concept of HTML forms.</li>
<li>We set the form’s  <code>action</code>  to  <code>{% url 'polls:vote' question.id %}</code>, and we set  <code>method="post"</code>. Using  <code>method="post"</code>  (as opposed to  <code>method="get"</code>) is very important, because the act of submitting this form will alter data server-side. Whenever you create a form that alters data server-side, use  <code>method="post"</code>. This tip isn’t specific to Django; it’s good web development practice in general.</li>
<li><code>forloop.counter</code>  indicates how many times the  <a href="https://docs.djangoproject.com/en/4.0/ref/templates/builtins/#std:templatetag-for"><code>for</code></a>  tag has gone through its loop</li>
<li>Since we’re creating a POST form (which can have the effect of modifying data), we need to worry about Cross Site Request Forgeries. Thankfully, you don’t have to worry too hard, because Django comes with a helpful system for protecting against it. In short, all POST forms that are targeted at internal URLs should use the  <a href="https://docs.djangoproject.com/en/4.0/ref/templates/builtins/#std:templatetag-csrf_token"><code>{% csrf_token %}</code></a>  template tag.</li>
</ul>
<p>Now, let’s create a Django view that handles the submitted data and does something with it.</p>
<p><code>polls/urls.py</code></p>
<pre class=" language-python"><code class="prism  language-python">path<span class="token punctuation">(</span><span class="token string">'&lt;int:question_id&gt;/vote/'</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>vote<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'vote'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</code></pre>
<p>We also created a dummy implementation of the <code>vote()</code> function. Let’s create a real version. Add the following to <code>polls/views.py</code>:</p>
<pre class=" language-python"><code class="prism  language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>http <span class="token keyword">import</span> HttpResponse<span class="token punctuation">,</span> HttpResponseRedirect
<span class="token keyword">from</span> django<span class="token punctuation">.</span>shortcuts <span class="token keyword">import</span> get_object_or_404<span class="token punctuation">,</span> render
<span class="token keyword">from</span> django<span class="token punctuation">.</span>urls <span class="token keyword">import</span> reverse

<span class="token keyword">from</span> <span class="token punctuation">.</span>models <span class="token keyword">import</span> Choice<span class="token punctuation">,</span> Question
<span class="token comment"># ...</span>
<span class="token keyword">def</span> <span class="token function">vote</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> question_id<span class="token punctuation">)</span><span class="token punctuation">:</span>
    question <span class="token operator">=</span> get_object_or_404<span class="token punctuation">(</span>Question<span class="token punctuation">,</span> pk<span class="token operator">=</span>question_id<span class="token punctuation">)</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        selected_choice <span class="token operator">=</span> question<span class="token punctuation">.</span>choice_set<span class="token punctuation">.</span>get<span class="token punctuation">(</span>pk<span class="token operator">=</span>request<span class="token punctuation">.</span>POST<span class="token punctuation">[</span><span class="token string">'choice'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> <span class="token punctuation">(</span>KeyError<span class="token punctuation">,</span> Choice<span class="token punctuation">.</span>DoesNotExist<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># Redisplay the question voting form.</span>
        <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">'polls/detail.html'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            <span class="token string">'question'</span><span class="token punctuation">:</span> question<span class="token punctuation">,</span>
            <span class="token string">'error_message'</span><span class="token punctuation">:</span> <span class="token string">"You didn't select a choice."</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        selected_choice<span class="token punctuation">.</span>votes <span class="token operator">+=</span> <span class="token number">1</span>
        selected_choice<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment"># Always return an HttpResponseRedirect after successfully dealing</span>
        <span class="token comment"># with POST data. This prevents data from being posted twice if a</span>
        <span class="token comment"># user hits the Back button.</span>
        <span class="token keyword">return</span> HttpResponseRedirect<span class="token punctuation">(</span>reverse<span class="token punctuation">(</span><span class="token string">'polls:results'</span><span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>question<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<p>This code includes a few things we haven’t covered yet in this tutorial:</p>
<ul>
<li>
<p><a href="https://docs.djangoproject.com/en/4.0/ref/request-response/#django.http.HttpRequest.POST" title="django.http.HttpRequest.POST"><code>request.POST</code></a>  is a dictionary-like object that lets you access submitted data by key name. In this case,  <code>request.POST['choice']</code>  returns the ID of the selected choice, as a string.  <a href="https://docs.djangoproject.com/en/4.0/ref/request-response/#django.http.HttpRequest.POST" title="django.http.HttpRequest.POST"><code>request.POST</code></a>  values are always strings.</p>
<p>Note that Django also provides  <a href="https://docs.djangoproject.com/en/4.0/ref/request-response/#django.http.HttpRequest.GET" title="django.http.HttpRequest.GET"><code>request.GET</code></a>  for accessing GET data in the same way – but we’re explicitly using  <a href="https://docs.djangoproject.com/en/4.0/ref/request-response/#django.http.HttpRequest.POST" title="django.http.HttpRequest.POST"><code>request.POST</code></a>  in our code, to ensure that data is only altered via a POST call.</p>
</li>
<li>
<p><code>request.POST['choice']</code>  will raise  <a href="https://docs.python.org/3/library/exceptions.html#KeyError" title="(in Python v3.10)"><code>KeyError</code></a>  if  <code>choice</code>  wasn’t provided in POST data. The above code checks for  <a href="https://docs.python.org/3/library/exceptions.html#KeyError" title="(in Python v3.10)"><code>KeyError</code></a>  and redisplays the question form with an error message if  <code>choice</code>  isn’t given.</p>
</li>
<li>
<p>After incrementing the choice count, the code returns an  <a href="https://docs.djangoproject.com/en/4.0/ref/request-response/#django.http.HttpResponseRedirect" title="django.http.HttpResponseRedirect"><code>HttpResponseRedirect</code></a>  rather than a normal  <a href="https://docs.djangoproject.com/en/4.0/ref/request-response/#django.http.HttpResponse" title="django.http.HttpResponse"><code>HttpResponse</code></a>.  <a href="https://docs.djangoproject.com/en/4.0/ref/request-response/#django.http.HttpResponseRedirect" title="django.http.HttpResponseRedirect"><code>HttpResponseRedirect</code></a>  takes a single argument: the URL to which the user will be redirected (see the following point for how we construct the URL in this case).</p>
<p>As the Python comment above points out, you should always return an  <a href="https://docs.djangoproject.com/en/4.0/ref/request-response/#django.http.HttpResponseRedirect" title="django.http.HttpResponseRedirect"><code>HttpResponseRedirect</code></a>  after successfully dealing with POST data. This tip isn’t specific to Django; it’s good web development practice in general.</p>
</li>
<li>
<p>We are using the  <a href="https://docs.djangoproject.com/en/4.0/ref/urlresolvers/#django.urls.reverse" title="django.urls.reverse"><code>reverse()</code></a>  function in the  <a href="https://docs.djangoproject.com/en/4.0/ref/request-response/#django.http.HttpResponseRedirect" title="django.http.HttpResponseRedirect"><code>HttpResponseRedirect</code></a>  constructor in this example. This function helps avoid having to hardcode a URL in the view function. It is given the name of the view that we want to pass control to and the variable portion of the URL pattern that points to that view. In this case, using the URLconf we set up in  <a href="https://docs.djangoproject.com/en/4.0/intro/tutorial03/">Tutorial 3</a>, this  <a href="https://docs.djangoproject.com/en/4.0/ref/urlresolvers/#django.urls.reverse" title="django.urls.reverse"><code>reverse()</code></a>  call will return a string like</p>
</li>
</ul>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token string">'/polls/3/results/'</span>
</code></pre>
<ul>
<li>where the  <code>3</code>  is the value of  <code>question.id</code>. This redirected URL will then call the  <code>'results'</code>  view to display the final page.</li>
</ul>
<p>As mentioned in  <a href="https://docs.djangoproject.com/en/4.0/intro/tutorial03/">Tutorial 3</a>,  <code>request</code>  is an  <a href="https://docs.djangoproject.com/en/4.0/ref/request-response/#django.http.HttpRequest" title="django.http.HttpRequest"><code>HttpRequest</code></a>  object. For more on  <a href="https://docs.djangoproject.com/en/4.0/ref/request-response/#django.http.HttpRequest" title="django.http.HttpRequest"><code>HttpRequest</code></a>  objects, see the  <a href="https://docs.djangoproject.com/en/4.0/ref/request-response/">request and response documentation</a>.</p>
<p>After somebody votes in a question, the  <code>vote()</code>  view redirects to the results page for the question. Let’s write that view (<code>polls/views.py</code>):</p>
<pre class=" language-python"><code class="prism  language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>shortcuts <span class="token keyword">import</span> get_object_or_404<span class="token punctuation">,</span> render

<span class="token keyword">def</span> <span class="token function">results</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> question_id<span class="token punctuation">)</span><span class="token punctuation">:</span>
    question <span class="token operator">=</span> get_object_or_404<span class="token punctuation">(</span>Question<span class="token punctuation">,</span> pk<span class="token operator">=</span>question_id<span class="token punctuation">)</span>
    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token string">'polls/results.html'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'question'</span><span class="token punctuation">:</span> question<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>This is almost exactly the same as the  <code>detail()</code>  view from previous sections. The only difference is the template name. We’ll fix this redundancy later.</p>
<p>Now, create a  <code>polls/templates/polls/results.html</code>  template:</p>
<pre class=" language-python"><code class="prism  language-python"><span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span> question<span class="token punctuation">.</span>question_text <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>ul<span class="token operator">&gt;</span>
<span class="token punctuation">{</span><span class="token operator">%</span> <span class="token keyword">for</span> choice <span class="token keyword">in</span> question<span class="token punctuation">.</span>choice_set<span class="token punctuation">.</span><span class="token builtin">all</span> <span class="token operator">%</span><span class="token punctuation">}</span>
    <span class="token operator">&lt;</span>li<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span> choice<span class="token punctuation">.</span>choice_text <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">-</span><span class="token operator">-</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> choice<span class="token punctuation">.</span>votes <span class="token punctuation">}</span><span class="token punctuation">}</span> vote<span class="token punctuation">{</span><span class="token punctuation">{</span> choice<span class="token punctuation">.</span>votes<span class="token operator">|</span>pluralize <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">&gt;</span>
<span class="token punctuation">{</span><span class="token operator">%</span> endfor <span class="token operator">%</span><span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">"{% url 'polls:detail' question.id %}"</span><span class="token operator">&gt;</span>Vote again?<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
</code></pre>
<p>Now, go to <code>/polls/1/</code> in your browser and vote in the question. You should see a results page that gets updated each time you vote. If you submit the form without having chosen a choice, you should see the error message.</p>
<blockquote>
<p><strong>Note:</strong> The code for our  <code>vote()</code>  view does have a small problem. It first gets the  <code>selected_choice</code>  object from the database, then computes the new value of  <code>votes</code>, and then saves it back to the database. If two users of your website try to vote at  <em>exactly the same time</em>, this might go wrong: The same value, let’s say 42, will be retrieved for  <code>votes</code>. Then, for both users the new value of 43 is computed and saved, but 44 would be the expected value.<br>
This is called a  <em>race condition</em>. If you are interested, you can read  <a href="https://docs.djangoproject.com/en/4.0/ref/models/expressions/#avoiding-race-conditions-using-f">Avoiding race conditions using F()</a>  to learn how you can solve this issue.</p>
</blockquote>
<h3 id="use-generic-views-less-code-is-better">Use generic views: Less code is better</h3>
<p>The  <code>detail()</code>  (from previous sections) and  <code>results()</code>  views are very short – and, as mentioned above, redundant. The  <code>index()</code>  view, which displays a list of polls, is similar.</p>
<p>These views represent a common case of basic web development: getting data from the database according to a parameter passed in the URL, loading a template and returning the rendered template. Because this is so common, Django provides a shortcut, called the “generic views” system.</p>
<p>Generic views abstract common patterns to the point where you don’t even need to write Python code to write an app.</p>
<p>Let’s convert our poll app to use the generic views system, so we can delete a bunch of our own code. We’ll have to take a few steps to make the conversion. We will:</p>
<ol>
<li>Convert the URLconf.</li>
<li>Delete some of the old, unneeded views.</li>
<li>Introduce new views based on Django’s generic views.</li>
</ol>
<p>Read on for details.</p>
<blockquote>
<p><strong>Why the code-shuffle?</strong>  Generally, when writing a Django app, you’ll evaluate whether generic views are a good fit for your problem, and you’ll use them from the beginning, rather than refactoring your code halfway through. But this tutorial intentionally has focused on writing the views “the hard way” until now, to focus on core concepts. You should know basic math before you start using a calculator.</p>
</blockquote>
<h3 id="amend-urlconf">Amend URLconf</h3>
<p>First, open the <code>polls/urls.py</code> URLconf and change it like so:</p>
<pre class=" language-python"><code class="prism  language-python">polls<span class="token operator">/</span>urls<span class="token punctuation">.</span>py<span class="token punctuation">[</span>¶<span class="token punctuation">]</span><span class="token punctuation">(</span>https<span class="token punctuation">:</span><span class="token operator">//</span>docs<span class="token punctuation">.</span>djangoproject<span class="token punctuation">.</span>com<span class="token operator">/</span>en<span class="token operator">/</span><span class="token number">4.0</span><span class="token operator">/</span>intro<span class="token operator">/</span>tutorial04<span class="token operator">/</span><span class="token comment">#id6 "Permalink to this code")</span>

<span class="token keyword">from</span> django<span class="token punctuation">.</span>urls <span class="token keyword">import</span> path

<span class="token keyword">from</span> <span class="token punctuation">.</span> <span class="token keyword">import</span> views

app_name <span class="token operator">=</span> <span class="token string">'polls'</span>
urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>
    path<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>IndexView<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'index'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    path<span class="token punctuation">(</span><span class="token string">'&lt;int:pk&gt;/'</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>DetailView<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'detail'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    path<span class="token punctuation">(</span><span class="token string">'&lt;int:pk&gt;/results/'</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>ResultsView<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'results'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    path<span class="token punctuation">(</span><span class="token string">'&lt;int:question_id&gt;/vote/'</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>vote<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'vote'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre>
<p>Note that the name of the matched pattern in the path strings of the second and third patterns has changed from <code>&lt;question_id&gt;</code> to <code>&lt;pk&gt;</code>.</p>
<h3 id="amend-views">Amend views</h3>
<p>Next, we’re going to remove our old <code>index</code>, <code>detail</code>, and <code>results</code> views and use Django’s generic views instead. To do so, open the <code>polls/views.py</code> file and change it like so:</p>
<pre class=" language-python"><code class="prism  language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>http <span class="token keyword">import</span> HttpResponseRedirect
<span class="token keyword">from</span> django<span class="token punctuation">.</span>shortcuts <span class="token keyword">import</span> get_object_or_404<span class="token punctuation">,</span> render
<span class="token keyword">from</span> django<span class="token punctuation">.</span>urls <span class="token keyword">import</span> reverse
<span class="token keyword">from</span> django<span class="token punctuation">.</span>views <span class="token keyword">import</span> generic

<span class="token keyword">from</span> <span class="token punctuation">.</span>models <span class="token keyword">import</span> Choice<span class="token punctuation">,</span> Question

<span class="token keyword">class</span> <span class="token class-name">IndexView</span><span class="token punctuation">(</span>generic<span class="token punctuation">.</span>ListView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    template_name <span class="token operator">=</span> <span class="token string">'polls/index.html'</span>
    context_object_name <span class="token operator">=</span> <span class="token string">'latest_question_list'</span>

    <span class="token keyword">def</span> <span class="token function">get_queryset</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""Return the last five published questions."""</span>
        <span class="token keyword">return</span> Question<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>order_by<span class="token punctuation">(</span><span class="token string">'-pub_date'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span>

<span class="token keyword">class</span> <span class="token class-name">DetailView</span><span class="token punctuation">(</span>generic<span class="token punctuation">.</span>DetailView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    model <span class="token operator">=</span> Question
    template_name <span class="token operator">=</span> <span class="token string">'polls/detail.html'</span>

<span class="token keyword">class</span> <span class="token class-name">ResultsView</span><span class="token punctuation">(</span>generic<span class="token punctuation">.</span>DetailView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    model <span class="token operator">=</span> Question
    template_name <span class="token operator">=</span> <span class="token string">'polls/results.html'</span>

<span class="token keyword">def</span> <span class="token function">vote</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> question_id<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token comment"># same as above, no changes needed.</span>
</code></pre>
<p>We’re using two generic views here:  <a href="https://docs.djangoproject.com/en/4.0/ref/class-based-views/generic-display/#django.views.generic.list.ListView" title="django.views.generic.list.ListView"><code>ListView</code></a>  and  <a href="https://docs.djangoproject.com/en/4.0/ref/class-based-views/generic-display/#django.views.generic.detail.DetailView" title="django.views.generic.detail.DetailView"><code>DetailView</code></a>. Respectively, those two views abstract the concepts of “display a list of objects” and “display a detail page for a particular type of object.”</p>
<ul>
<li>Each generic view needs to know what model it will be acting upon. This is provided using the  <code>model</code>  attribute.</li>
<li>The  <a href="https://docs.djangoproject.com/en/4.0/ref/class-based-views/generic-display/#django.views.generic.detail.DetailView" title="django.views.generic.detail.DetailView"><code>DetailView</code></a>  generic view expects the primary key value captured from the URL to be called  <code>"pk"</code>, so we’ve changed  <code>question_id</code>  to  <code>pk</code>  for the generic views.</li>
</ul>
<p>By default, the  <a href="https://docs.djangoproject.com/en/4.0/ref/class-based-views/generic-display/#django.views.generic.detail.DetailView" title="django.views.generic.detail.DetailView"><code>DetailView</code></a>  generic view uses a template called  <code>&lt;app name&gt;/&lt;model name&gt;_detail.html</code>. In our case, it would use the template  <code>"polls/question_detail.html"</code>. The  <code>template_name</code>  attribute is used to tell Django to use a specific template name instead of the autogenerated default template name. We also specify the  <code>template_name</code>  for the  <code>results</code>  list view – this ensures that the results view and the detail view have a different appearance when rendered, even though they’re both a  <a href="https://docs.djangoproject.com/en/4.0/ref/class-based-views/generic-display/#django.views.generic.detail.DetailView" title="django.views.generic.detail.DetailView"><code>DetailView</code></a>  behind the scenes.</p>
<p>Similarly, the  <a href="https://docs.djangoproject.com/en/4.0/ref/class-based-views/generic-display/#django.views.generic.list.ListView" title="django.views.generic.list.ListView"><code>ListView</code></a>  generic view uses a default template called  <code>&lt;app name&gt;/&lt;model name&gt;_list.html</code>; we use  <code>template_name</code>  to tell  <a href="https://docs.djangoproject.com/en/4.0/ref/class-based-views/generic-display/#django.views.generic.list.ListView" title="django.views.generic.list.ListView"><code>ListView</code></a>  to use our existing  <code>"polls/index.html"</code>  template.</p>
<p>In previous parts of the tutorial, the templates have been provided with a context that contains the  <code>question</code>  and  <code>latest_question_list</code>  context variables. For  <code>DetailView</code>  the  <code>question</code>  variable is provided automatically – since we’re using a Django model (<code>Question</code>), Django is able to determine an appropriate name for the context variable. However, for ListView, the automatically generated context variable is  <code>question_list</code>. To override this we provide the  <code>context_object_name</code>  attribute, specifying that we want to use  <code>latest_question_list</code>  instead. As an alternative approach, you could change your templates to match the new default context variables – but it’s a lot easier to tell Django to use the variable you want.</p>
<p>Run the server, and use your new polling app based on generic views.</p>
<p>For full details on generic views, see the  <a href="https://docs.djangoproject.com/en/4.0/topics/class-based-views/">generic views documentation</a>.</p>
<h1 id="customize-your-apps-look-and-feel">Customize your app’s look and feel</h1>
<p>Aside from the HTML generated by the server, web applications generally need to serve additional files — such as images, JavaScript, or CSS — necessary to render the complete web page. In Django, we refer to these files as “static files”.</p>
<p>For small projects, this isn’t a big deal, because you can keep the static files somewhere your web server can find it. However, in bigger projects – especially those comprised of multiple apps – dealing with the multiple sets of static files provided by each application starts to get tricky.</p>
<p>That’s what  <code>django.contrib.staticfiles</code>  is for: it collects static files from each of your applications (and any other places you specify) into a single location that can easily be served in production.</p>
<p>First, create a directory called  <code>static</code>  in your  <code>polls</code>  directory. Django will look for static files there, similarly to how Django finds templates inside  <code>polls/templates/</code>.</p>
<p>Django’s  <a href="https://docs.djangoproject.com/en/4.0/ref/settings/#std:setting-STATICFILES_FINDERS"><code>STATICFILES_FINDERS</code></a>  setting contains a list of finders that know how to discover static files from various sources. One of the defaults is  <code>AppDirectoriesFinder</code>  which looks for a “static” subdirectory in each of the  <a href="https://docs.djangoproject.com/en/4.0/ref/settings/#std:setting-INSTALLED_APPS"><code>INSTALLED_APPS</code></a>, like the one in  <code>polls</code>  we just created. The admin site uses the same directory structure for its static files.</p>
<p>Within the  <code>static</code>  directory you have just created, create another directory called  <code>polls</code>  and within that create a file called  <code>style.css</code>. In other words, your stylesheet should be at  <code>polls/static/polls/style.css</code>. Because of how the  <code>AppDirectoriesFinder</code>  staticfile finder works, you can refer to this static file in Django as  <code>polls/style.css</code>, similar to how you reference the path for templates.</p>
<blockquote>
<p><strong>Static file namespacing:</strong> Just like templates, we <em>might</em> be able to get away with putting our static files directly in <code>polls/static</code> (rather than creating another <code>polls</code> subdirectory), but it would actually be a bad idea. Django will choose the first static file it finds whose name matches, and if you had a static file with the same name in a <em>different</em> application, Django would be unable to distinguish between them. We need to be able to point Django at the right one, and the best way to ensure this is by <em>namespacing</em> them. That is, by putting those static files inside <em>another</em> directory named for the application itself.</p>
</blockquote>
<p>Put the following code in that stylesheet (<code>polls/static/polls/style.css</code>):</p>
<pre class=" language-css"><code class="prism  language-css"><span class="token selector">li a </span><span class="token punctuation">{</span>
    <span class="token property">color</span><span class="token punctuation">:</span> green<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Next, add the following at the top of <code>polls/templates/polls/index.html</code>:</p>
<pre class=" language-html"><code class="prism  language-html">{% load static %}

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/css<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>{% static <span class="token punctuation">'</span>polls/style.css<span class="token punctuation">'</span> %}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
</code></pre>
<p>The  <code>{% static %}</code>  template tag generates the absolute URL of static files.</p>
<p>That’s all you need to do for development.</p>
<p>Start the server (or restart it if it’s already running):</p>
<pre class=" language-bash"><code class="prism  language-bash">$ python manage.py runserver
</code></pre>
<p>Reload <code>http://localhost:8000/polls/</code> and you should see that the question links are green (Django style!) which means that your stylesheet was properly loaded.</p>
<h2 id="adding-background-image">Adding background image</h2>
<p>Next, we’ll create a subdirectory for images. Create an  <code>images</code>  subdirectory in the  <code>polls/static/polls/</code>  directory. Inside this directory, put an image called  <code>background.gif</code>. In other words, put your image in  <code>polls/static/polls/images/background.gif</code>.</p>
<p>Then, add to your stylesheet (<code>polls/static/polls/style.css</code>):</p>
<pre class=" language-css"><code class="prism  language-css"><span class="token selector">body </span><span class="token punctuation">{</span>
    <span class="token property">background</span><span class="token punctuation">:</span> white <span class="token url">url("images/background.gif")</span> no-repeat<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Reload  <code>http://localhost:8000/polls/</code>  and you should see the background loaded in the top left of the screen.</p>
<blockquote>
<p><strong>Warning:</strong> The <code>{% static %}</code> template tag is not available for use in static files which aren’t generated by Django, like your stylesheet. You should always use <strong>relative paths</strong> to link your static files between each other, because then you can change <a href="https://docs.djangoproject.com/en/4.0/ref/settings/#std:setting-STATIC_URL"><code>STATIC_URL</code></a> (used by the <a href="https://docs.djangoproject.com/en/4.0/ref/templates/builtins/#std:templatetag-static"><code>static</code></a> template tag to generate its URLs) without having to modify a bunch of paths in your static files as well.</p>
</blockquote>
<p>These are the <strong>basics</strong>. For more details on settings and other bits included with the framework see <a href="https://docs.djangoproject.com/en/4.0/howto/static-files/">the static files howto</a> and <a href="https://docs.djangoproject.com/en/4.0/ref/contrib/staticfiles/">the staticfiles reference</a>. <a href="https://docs.djangoproject.com/en/4.0/howto/static-files/deployment/">Deploying static files</a> discusses how to use static files on a real server.</p>
<h1 id="customizing-admin-panel">Customizing admin panel</h1>
<p>By registering the  <code>Question</code>  model with  <code>admin.site.register(Question)</code>, Django was able to construct a default form representation. Often, you’ll want to customize how the admin form looks and works. You’ll do this by telling Django the options you want when you register the object.</p>
<p>Let’s see how this works by reordering the fields on the edit form. Replace the  <code>admin.site.register(Question)</code>  line with:</p>
<p><code>polls/admin.py</code>:</p>
<pre class=" language-python"><code class="prism  language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib <span class="token keyword">import</span> admin

<span class="token keyword">from</span> <span class="token punctuation">.</span>models <span class="token keyword">import</span> Question


<span class="token keyword">class</span> <span class="token class-name">QuestionAdmin</span><span class="token punctuation">(</span>admin<span class="token punctuation">.</span>ModelAdmin<span class="token punctuation">)</span><span class="token punctuation">:</span>
    fields <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'pub_date'</span><span class="token punctuation">,</span> <span class="token string">'question_text'</span><span class="token punctuation">]</span>

admin<span class="token punctuation">.</span>site<span class="token punctuation">.</span>register<span class="token punctuation">(</span>Question<span class="token punctuation">,</span> QuestionAdmin<span class="token punctuation">)</span>
</code></pre>
<p>You’ll follow this pattern – create a model admin class, then pass it as the second argument to  <code>admin.site.register()</code>  – any time you need to change the admin options for a model.</p>
<p>This particular change above makes the “Publication date” come before the “Question” field:</p>
<p><img src="https://docs.djangoproject.com/en/4.0/_images/admin07.png" alt="Fields have been reordered"></p>
<p>This isn’t impressive with only two fields, but for admin forms with dozens of fields, choosing an intuitive order is an important usability detail.</p>
<p>And speaking of forms with dozens of fields, you might want to split the form up into fieldsets:</p>
<pre class=" language-python"><code class="prism  language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib <span class="token keyword">import</span> admin

<span class="token keyword">from</span> <span class="token punctuation">.</span>models <span class="token keyword">import</span> Question


<span class="token keyword">class</span> <span class="token class-name">QuestionAdmin</span><span class="token punctuation">(</span>admin<span class="token punctuation">.</span>ModelAdmin<span class="token punctuation">)</span><span class="token punctuation">:</span>
    fieldsets <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span>               <span class="token punctuation">{</span><span class="token string">'fields'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'question_text'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token string">'Date information'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'fields'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'pub_date'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>

admin<span class="token punctuation">.</span>site<span class="token punctuation">.</span>register<span class="token punctuation">(</span>Question<span class="token punctuation">,</span> QuestionAdmin<span class="token punctuation">)</span>
</code></pre>
<p>The first element of each tuple in  <a href="https://docs.djangoproject.com/en/4.0/ref/contrib/admin/#django.contrib.admin.ModelAdmin.fieldsets" title="django.contrib.admin.ModelAdmin.fieldsets"><code>fieldsets</code></a>  is the title of the fieldset. Here’s what our form looks like now:</p>
<p><img src="https://docs.djangoproject.com/en/4.0/_images/admin08t.png" alt="Form has fieldsets now"></p>
<h2 id="adding--related-objects">Adding  related objects</h2>
<p>OK, we have our Question admin page, but a  <code>Question</code>  has multiple  <code>Choice</code>s, and the admin page doesn’t display choices.</p>
<p>Yet.</p>
<p>There are two ways to solve this problem. The first is to register  <code>Choice</code>  with the admin just as we did with  <code>Question</code>:</p>
<pre class=" language-python"><code class="prism  language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib <span class="token keyword">import</span> admin

<span class="token keyword">from</span> <span class="token punctuation">.</span>models <span class="token keyword">import</span> Choice<span class="token punctuation">,</span> Question
<span class="token comment"># ...</span>
admin<span class="token punctuation">.</span>site<span class="token punctuation">.</span>register<span class="token punctuation">(</span>Choice<span class="token punctuation">)</span>
</code></pre>
<p>Now “Choices” is an available option in the Django admin. The “Add choice” form looks like this:</p>
<p><img src="https://docs.djangoproject.com/en/4.0/_images/admin09.png" alt="Choice admin page"></p>
<p>In that form, the “Question” field is a select box containing every question in the database. Django knows that a  <a href="https://docs.djangoproject.com/en/4.0/ref/models/fields/#django.db.models.ForeignKey" title="django.db.models.ForeignKey"><code>ForeignKey</code></a>  should be represented in the admin as a  <code>&lt;select&gt;</code>  box. In our case, only one question exists at this point.</p>
<p>Also note the “Add Another” link next to “Question.” Every object with a  <code>ForeignKey</code>  relationship to another gets this for free. When you click “Add Another”, you’ll get a popup window with the “Add question” form. If you add a question in that window and click “Save”, Django will save the question to the database and dynamically add it as the selected choice on the “Add choice” form you’re looking at.</p>
<p>But, really, this is an inefficient way of adding  <code>Choice</code>  objects to the system. It’d be better if you could add a bunch of Choices directly when you create the  <code>Question</code>  object. Let’s make that happen.</p>
<p>Remove the  <code>register()</code>  call for the  <code>Choice</code>  model. Then, edit the  <code>Question</code>  registration code to read:</p>
<pre class=" language-python"><code class="prism  language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib <span class="token keyword">import</span> admin

<span class="token keyword">from</span> <span class="token punctuation">.</span>models <span class="token keyword">import</span> Choice<span class="token punctuation">,</span> Question


<span class="token keyword">class</span> <span class="token class-name">ChoiceInline</span><span class="token punctuation">(</span>admin<span class="token punctuation">.</span>StackedInline<span class="token punctuation">)</span><span class="token punctuation">:</span>
    model <span class="token operator">=</span> Choice
    extra <span class="token operator">=</span> <span class="token number">3</span>


<span class="token keyword">class</span> <span class="token class-name">QuestionAdmin</span><span class="token punctuation">(</span>admin<span class="token punctuation">.</span>ModelAdmin<span class="token punctuation">)</span><span class="token punctuation">:</span>
    fieldsets <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span>               <span class="token punctuation">{</span><span class="token string">'fields'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'question_text'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token string">'Date information'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'fields'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'pub_date'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'classes'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'collapse'</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
    inlines <span class="token operator">=</span> <span class="token punctuation">[</span>ChoiceInline<span class="token punctuation">]</span>

admin<span class="token punctuation">.</span>site<span class="token punctuation">.</span>register<span class="token punctuation">(</span>Question<span class="token punctuation">,</span> QuestionAdmin<span class="token punctuation">)</span>
</code></pre>
<p>This tells Django: “<code>Choice</code>  objects are edited on the  <code>Question</code>  admin page. By default, provide enough fields for 3 choices.”</p>
<p>Load the “Add question” page to see how that looks:</p>
<p><img src="https://docs.djangoproject.com/en/4.0/_images/admin10t.png" alt="Add question page now has choices on it"></p>
<p>It works like this: There are three slots for related Choices – as specified by  <code>extra</code>  – and each time you come back to the “Change” page for an already-created object, you get another three extra slots.</p>
<p>At the end of the three current slots you will find an “Add another Choice” link. If you click on it, a new slot will be added. If you want to remove the added slot, you can click on the X to the top right of the added slot. This image shows an added slot:</p>
<p><img src="https://docs.djangoproject.com/en/4.0/_images/admin14t.png" alt="Additional slot added dynamically"></p>
<p>One small problem, though. It takes a lot of screen space to display all the fields for entering related  <code>Choice</code>  objects. For that reason, Django offers a tabular way of displaying inline related objects. To use it, change the  <code>ChoiceInline</code>  declaration to read:</p>
<p><code>polls/admin.py</code>:</p>
<pre class=" language-python"><code class="prism  language-python"><span class="token keyword">class</span> <span class="token class-name">ChoiceInline</span><span class="token punctuation">(</span>admin<span class="token punctuation">.</span>TabularInline<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment">#...</span>
</code></pre>
<p>With that <code>TabularInline</code> (instead of <code>StackedInline</code>), the related objects are displayed in a more compact, table-based format:</p>
<p><img src="https://docs.djangoproject.com/en/4.0/_images/admin11t.png" alt="Add question page now has more compact choices"></p>
<p>Note that there is an extra “Delete?” column that allows removing rows added using the “Add Another Choice” button and rows that have already been saved.</p>
<h2 id="customize-the-admin-change-list">Customize the admin change list</h2>
<p>Now that the Question admin page is looking good, let’s make some tweaks to the “change list” page – the one that displays all the questions in the system.</p>
<p>Here’s what it looks like at this point:</p>
<p><img src="https://docs.djangoproject.com/en/4.0/_images/admin04t.png" alt="Polls change list page"></p>
<p>By default, Django displays the <code>str()</code> of each object. But sometimes it’d be more helpful if we could display individual fields. To do that, use the <a href="https://docs.djangoproject.com/en/4.0/ref/contrib/admin/#django.contrib.admin.ModelAdmin.list_display" title="django.contrib.admin.ModelAdmin.list_display"><code>list_display</code></a> admin option, which is a tuple of field names to display, as columns, on the change list page for the object:</p>
<pre class=" language-python"><code class="prism  language-python"><span class="token keyword">class</span> <span class="token class-name">QuestionAdmin</span><span class="token punctuation">(</span>admin<span class="token punctuation">.</span>ModelAdmin<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># ...</span>
    list_display <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'question_text'</span><span class="token punctuation">,</span> <span class="token string">'pub_date'</span><span class="token punctuation">)</span>
</code></pre>
<p>For good measure, let’s also include the <code>was_published_recently()</code> method from <a href="https://docs.djangoproject.com/en/4.0/intro/tutorial02/">Tutorial 2</a>:</p>
<pre class=" language-python"><code class="prism  language-python">  

<span class="token keyword">class</span> <span class="token class-name">QuestionAdmin</span><span class="token punctuation">(</span>admin<span class="token punctuation">.</span>ModelAdmin<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># ...</span>
    list_display <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'question_text'</span><span class="token punctuation">,</span> <span class="token string">'pub_date'</span><span class="token punctuation">,</span> <span class="token string">'was_published_recently'</span><span class="token punctuation">)</span>
</code></pre>
<p>Now the question change list page looks like this:</p>
<p><img src="https://docs.djangoproject.com/en/4.0/_images/admin12t.png" alt="Polls change list page, updated"></p>
<p>You can click on the column headers to sort by those values – except in the case of the  <code>was_published_recently</code>  header, because sorting by the output of an arbitrary method is not supported. Also note that the column header for  <code>was_published_recently</code>  is, by default, the name of the method (with underscores replaced with spaces), and that each line contains the string representation of the output.</p>
<p>You can improve that by using the  <a href="https://docs.djangoproject.com/en/4.0/ref/contrib/admin/#django.contrib.admin.display" title="django.contrib.admin.display"><code>display()</code></a>  decorator on that method (in  <code>polls/models.py</code>), as follows:</p>
<pre class=" language-python"><code class="prism  language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib <span class="token keyword">import</span> admin

<span class="token keyword">class</span> <span class="token class-name">Question</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># ...</span>
    @admin<span class="token punctuation">.</span>display<span class="token punctuation">(</span>
        boolean<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
        ordering<span class="token operator">=</span><span class="token string">'pub_date'</span><span class="token punctuation">,</span>
        description<span class="token operator">=</span><span class="token string">'Published recently?'</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">was_published_recently</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        now <span class="token operator">=</span> timezone<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> now <span class="token operator">-</span> datetime<span class="token punctuation">.</span>timedelta<span class="token punctuation">(</span>days<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> self<span class="token punctuation">.</span>pub_date <span class="token operator">&lt;=</span> now
</code></pre>
<p>For more information on the properties configurable via the decorator, see  <a href="https://docs.djangoproject.com/en/4.0/ref/contrib/admin/#django.contrib.admin.ModelAdmin.list_display" title="django.contrib.admin.ModelAdmin.list_display"><code>list_display</code></a>.</p>
<p>Edit your  <code>polls/admin.py</code>  file again and add an improvement to the  <code>Question</code>  change list page: filters using the  <a href="https://docs.djangoproject.com/en/4.0/ref/contrib/admin/#django.contrib.admin.ModelAdmin.list_filter" title="django.contrib.admin.ModelAdmin.list_filter"><code>list_filter</code></a>. Add the following line to  <code>QuestionAdmin</code>:</p>
<pre class=" language-python"><code class="prism  language-python">list_filter <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'pub_date'</span><span class="token punctuation">]</span>
</code></pre>
<p>That adds a “Filter” sidebar that lets people filter the change list by the <code>pub_date</code> field:</p>
<p><img src="https://docs.djangoproject.com/en/4.0/_images/admin13t.png" alt="Polls change list page, updated"></p>
<p>The type of filter displayed depends on the type of field you’re filtering on. Because  <code>pub_date</code>  is a  <a href="https://docs.djangoproject.com/en/4.0/ref/models/fields/#django.db.models.DateTimeField" title="django.db.models.DateTimeField"><code>DateTimeField</code></a>, Django knows to give appropriate filter options: “Any date”, “Today”, “Past 7 days”, “This month”, “This year”.</p>
<p>This is shaping up well. Let’s add some search capability:</p>
<pre class=" language-python"><code class="prism  language-python">search_fields <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'question_text'</span><span class="token punctuation">]</span>
</code></pre>
<p>That adds a search box at the top of the change list. When somebody enters search terms, Django will search the  <code>question_text</code>  field. You can use as many fields as you’d like – although because it uses a  <code>LIKE</code>  query behind the scenes, limiting the number of search fields to a reasonable number will make it easier for your database to do the search.</p>
<p>Now’s also a good time to note that change lists give you free pagination. The default is to display 100 items per page.  <a href="https://docs.djangoproject.com/en/4.0/ref/contrib/admin/#django.contrib.admin.ModelAdmin.list_per_page" title="django.contrib.admin.ModelAdmin.list_per_page"><code>Change list pagination</code></a>,  <a href="https://docs.djangoproject.com/en/4.0/ref/contrib/admin/#django.contrib.admin.ModelAdmin.search_fields" title="django.contrib.admin.ModelAdmin.search_fields"><code>search boxes</code></a>,  <a href="https://docs.djangoproject.com/en/4.0/ref/contrib/admin/#django.contrib.admin.ModelAdmin.list_filter" title="django.contrib.admin.ModelAdmin.list_filter"><code>filters</code></a>,  <a href="https://docs.djangoproject.com/en/4.0/ref/contrib/admin/#django.contrib.admin.ModelAdmin.date_hierarchy" title="django.contrib.admin.ModelAdmin.date_hierarchy"><code>date-hierarchies</code></a>, and  <a href="https://docs.djangoproject.com/en/4.0/ref/contrib/admin/#django.contrib.admin.ModelAdmin.list_display" title="django.contrib.admin.ModelAdmin.list_display"><code>column-header-ordering</code></a>  all work together like you think they should.</p>
<h2 id="customize-the-admin-look-and-feel">Customize the admin look and feel</h2>
<p>Clearly, having “Django administration” at the top of each admin page is ridiculous. It’s just placeholder text.</p>
<p>You can change it, though, using Django’s template system. The Django admin is powered by Django itself, and its interfaces use Django’s own template system.</p>
<h3 id="customizing-your-projects-templates">Customizing your project’s templates</h3>
<p>Create a  <code>templates</code>  directory in your project directory (the one that contains  <code>manage.py</code>). Templates can live anywhere on your filesystem that Django can access. (Django runs as whatever user your server runs.) However, keeping your templates within the project is a good convention to follow.</p>
<p>Open your settings file (<code>mysite/settings.py</code>, remember) and add a  <a href="https://docs.djangoproject.com/en/4.0/ref/settings/#std:setting-TEMPLATES-DIRS"><code>DIRS</code></a>  option in the  <a href="https://docs.djangoproject.com/en/4.0/ref/settings/#std:setting-TEMPLATES"><code>TEMPLATES</code></a>  setting:</p>
<p><code>mysite/settings.py</code>:</p>
<pre class=" language-python"><code class="prism  language-python">TEMPLATES <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token string">'BACKEND'</span><span class="token punctuation">:</span> <span class="token string">'django.template.backends.django.DjangoTemplates'</span><span class="token punctuation">,</span>
        <span class="token string">'DIRS'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>BASE_DIR <span class="token operator">/</span> <span class="token string">'templates'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">'APP_DIRS'</span><span class="token punctuation">:</span> <span class="token boolean">True</span><span class="token punctuation">,</span>
        <span class="token string">'OPTIONS'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
            <span class="token string">'context_processors'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
                <span class="token string">'django.template.context_processors.debug'</span><span class="token punctuation">,</span>
                <span class="token string">'django.template.context_processors.request'</span><span class="token punctuation">,</span>
                <span class="token string">'django.contrib.auth.context_processors.auth'</span><span class="token punctuation">,</span>
                <span class="token string">'django.contrib.messages.context_processors.messages'</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre>
<p><a href="https://docs.djangoproject.com/en/4.0/ref/settings/#std:setting-TEMPLATES-DIRS"><code>DIRS</code></a> is a list of filesystem directories to check when loading Django templates; it’s a search path.</p>
<blockquote>
<p><strong>Orgainizing templates:</strong> Just like the static files, we <em>could</em> have all our templates together, in one big templates directory, and it would work perfectly well. However, templates that belong to a particular application should be placed in that application’s template directory (e.g. <code>polls/templates</code>) rather than the project’s (<code>templates</code>). We’ll discuss in more detail in the <a href="https://docs.djangoproject.com/en/4.0/intro/reusable-apps/">reusable apps tutorial</a>  <em>why</em> we do this.</p>
</blockquote>
<p>Now create a directory called  <code>admin</code>  inside  <code>templates</code>, and copy the template  <code>admin/base_site.html</code>  from within the default Django admin template directory in the source code of Django itself (<code>django/contrib/admin/templates</code>) into that directory.</p>
<blockquote>
<p><strong>Where are the Django source files?</strong> If you have difficulty finding where the Django source files are located on your system, run the following command:</p>
<pre class=" language-bash"><code class="prism  language-bash">$ python -c <span class="token string">"import django; print(django.__path__)"</span>
</code></pre>
</blockquote>
<p>Then, edit the file and replace <code>{{ site_header|default:_('Django administration') }}</code> (including the curly braces) with your own site’s name as you see fit. You should end up with a section of code like:</p>
<pre class=" language-python"><code class="prism  language-python"><span class="token punctuation">{</span><span class="token operator">%</span> block branding <span class="token operator">%</span><span class="token punctuation">}</span>
<span class="token operator">&lt;</span>h1 <span class="token builtin">id</span><span class="token operator">=</span><span class="token string">"site-name"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">"{% url 'admin:index' %}"</span><span class="token operator">&gt;</span>Polls Administration<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
<span class="token punctuation">{</span><span class="token operator">%</span> endblock <span class="token operator">%</span><span class="token punctuation">}</span>
</code></pre>
<p>We use this approach to teach you how to override templates. In an actual project, you would probably use the  <a href="https://docs.djangoproject.com/en/4.0/ref/contrib/admin/#django.contrib.admin.AdminSite.site_header" title="django.contrib.admin.AdminSite.site_header"><code>django.contrib.admin.AdminSite.site_header</code></a>  attribute to more easily make this particular customization.</p>
<p>This template file contains lots of text like  <code>{% block branding %}</code>  and  <code>{{ title }}</code>. The  <code>{%</code>  and  <code>{{</code>  tags are part of Django’s template language. When Django renders  <code>admin/base_site.html</code>, this template language will be evaluated to produce the final HTML page, just like we saw in  <a href="https://docs.djangoproject.com/en/4.0/intro/tutorial03/">Tutorial 3</a>.</p>
<p>Note that any of Django’s default admin templates can be overridden. To override a template, do the same thing you did with  <code>base_site.html</code>  – copy it from the default directory into your custom directory, and make changes.</p>
<h2 id="customizing-the-admin-index-page">Customizing the admin index page</h2>
<p>On a similar note, you might want to customize the look and feel of the Django admin index page.</p>
<p>By default, it displays all the apps in  <a href="https://docs.djangoproject.com/en/4.0/ref/settings/#std:setting-INSTALLED_APPS"><code>INSTALLED_APPS</code></a>  that have been registered with the admin application, in alphabetical order. You may want to make significant changes to the layout. After all, the index is probably the most important page of the admin, and it should be easy to use.</p>
<p>The template to customize is  <code>admin/index.html</code>. (Do the same as with  <code>admin/base_site.html</code>  in the previous section – copy it from the default directory to your custom template directory). Edit the file, and you’ll see it uses a template variable called  <code>app_list</code>. That variable contains every installed Django app. Instead of using that, you can hard-code links to object-specific admin pages in whatever way you think is best.</p>
<h1 id="the-djoser-library">The <code>djoser</code> library</h1>
<p>REST implementation of  <a href="https://www.djangoproject.com/">Django</a>  authentication system.  <strong>djoser</strong>  library provides a set of  <a href="http://www.django-rest-framework.org/">Django Rest Framework</a>  views to handle basic actions such as registration, login, logout, password reset and account activation. It works with  <a href="https://docs.djangoproject.com/en/dev/topics/auth/customizing/">custom user model</a>.</p>
<p><strong>Note:</strong> Read the docs <a href="https://djoser.readthedocs.io/en/latest/introduction.html">here</a></p>
<h1 id="the-rest_framework-module">The <code>rest_framework</code> Module</h1>
<p>Django REST framework is a powerful and flexible toolkit for building Web APIs.</p>
<p>Some reasons you might want to use REST framework:</p>
<ul>
<li>The  <a href="https://restframework.herokuapp.com/">Web browsable API</a>  is a huge usability win for your developers.</li>
<li><a href="https://www.django-rest-framework.org/api-guide/authentication/">Authentication policies</a>  including packages for  <a href="https://www.django-rest-framework.org/api-guide/authentication/#django-rest-framework-oauth">OAuth1a</a>  and  <a href="https://www.django-rest-framework.org/api-guide/authentication/#django-oauth-toolkit">OAuth2</a>.</li>
<li><a href="https://www.django-rest-framework.org/api-guide/serializers/">Serialization</a>  that supports both  <a href="https://www.django-rest-framework.org/api-guide/serializers#modelserializer">ORM</a>  and  <a href="https://www.django-rest-framework.org/api-guide/serializers#serializers">non-ORM</a>  data sources.</li>
<li>Customizable all the way down - just use  <a href="https://www.django-rest-framework.org/api-guide/views#function-based-views">regular function-based views</a>  if you don’t need the  <a href="https://www.django-rest-framework.org/api-guide/generic-views/">more</a>  <a href="https://www.django-rest-framework.org/api-guide/viewsets/">powerful</a>  <a href="https://www.django-rest-framework.org/api-guide/routers/">features</a>.</li>
</ul>
<h2 id="installation">Installation</h2>
<p>Install using  <code>pip</code>, including any optional packages you want…</p>
<pre class=" language-bash"><code class="prism  language-bash">pip <span class="token function">install</span> djangorestframework
pip <span class="token function">install</span> markdown       <span class="token comment"># Markdown support for the browsable API.</span>
pip <span class="token function">install</span> django-filter  <span class="token comment"># Filtering support</span>
</code></pre>
<p>…or clone the project from github.</p>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token function">git</span> clone https://github.com/encode/django-rest-framework
</code></pre>
<p>Add  <code>'rest_framework'</code>  to your  <code>INSTALLED_APPS</code>  setting.</p>
<pre class=" language-python"><code class="prism  language-python">INSTALLED_APPS <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token string">'rest_framework'</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre>
<p>If you’re intending to use the browsable API you’ll probably also want to add REST framework’s login and logout views. Add the following to your root  <code>urls.py</code>  file.</p>
<pre class=" language-python"><code class="prism  language-python">urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    path<span class="token punctuation">(</span><span class="token string">'api-auth/'</span><span class="token punctuation">,</span> include<span class="token punctuation">(</span><span class="token string">'rest_framework.urls'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre>
<p>Note that the URL path can be whatever you want.</p>
<p>Any global settings for a REST framework API are kept in a single configuration dictionary named  <code>REST_FRAMEWORK</code>. Start off by adding the following to your  <code>settings.py</code>  module:</p>
<pre class=" language-python"><code class="prism  language-python">REST_FRAMEWORK <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment"># Use Django's standard `django.contrib.auth` permissions,</span>
    <span class="token comment"># or allow read-only access for unauthenticated users.</span>
    <span class="token string">'DEFAULT_PERMISSION_CLASSES'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token string">'rest_framework.permissions.DjangoModelPermissionsOrAnonReadOnly'</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Don’t forget to make sure you’ve also added  <code>rest_framework</code>  to your  <code>INSTALLED_APPS</code>.</p>
<p><strong>Example:</strong> Create a read-write API for accessing information on the users of our project.</p>
<p>Here’s our project’s root  <code>urls.py</code>  module:</p>
<pre class=" language-python"><code class="prism  language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>urls <span class="token keyword">import</span> path<span class="token punctuation">,</span> include
<span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>models <span class="token keyword">import</span> User
<span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> routers<span class="token punctuation">,</span> serializers<span class="token punctuation">,</span> viewsets

<span class="token comment"># Serializers define the API representation.</span>
<span class="token keyword">class</span> <span class="token class-name">UserSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>HyperlinkedModelSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        model <span class="token operator">=</span> User
        fields <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'url'</span><span class="token punctuation">,</span> <span class="token string">'username'</span><span class="token punctuation">,</span> <span class="token string">'email'</span><span class="token punctuation">,</span> <span class="token string">'is_staff'</span><span class="token punctuation">]</span>

<span class="token comment"># ViewSets define the view behavior.</span>
<span class="token keyword">class</span> <span class="token class-name">UserViewSet</span><span class="token punctuation">(</span>viewsets<span class="token punctuation">.</span>ModelViewSet<span class="token punctuation">)</span><span class="token punctuation">:</span>
    queryset <span class="token operator">=</span> User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    serializer_class <span class="token operator">=</span> UserSerializer

<span class="token comment"># Routers provide an easy way of automatically determining the URL conf.</span>
router <span class="token operator">=</span> routers<span class="token punctuation">.</span>DefaultRouter<span class="token punctuation">(</span><span class="token punctuation">)</span>
router<span class="token punctuation">.</span>register<span class="token punctuation">(</span>r<span class="token string">'users'</span><span class="token punctuation">,</span> UserViewSet<span class="token punctuation">)</span>

<span class="token comment"># Wire up our API using automatic URL routing.</span>
<span class="token comment"># Additionally, we include login URLs for the browsable API.</span>
urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>
    path<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> include<span class="token punctuation">(</span>router<span class="token punctuation">.</span>urls<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    path<span class="token punctuation">(</span><span class="token string">'api-auth/'</span><span class="token punctuation">,</span> include<span class="token punctuation">(</span><span class="token string">'rest_framework.urls'</span><span class="token punctuation">,</span> namespace<span class="token operator">=</span><span class="token string">'rest_framework'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre>
<p>You can now open the API in your browser at  <a href="http://127.0.0.1:8000/">http://127.0.0.1:8000/</a>, and view your new ‘users’ API. If you use the login control in the top right corner you’ll also be able to add, create and delete users from the system.</p>
<h2 id="serialization">Serialization</h2>
<blockquote>
<p><strong>Note:</strong> <em>Complete API guide is <a href="https://www.django-rest-framework.org/api-guide/serializers/">here</a>.</em></p>
</blockquote>
<h3 id="creating-a-model-to-work-with">Creating a model to work with</h3>
<p><strong>Note:</strong> For this section, we’re using a different example. We’re building an app called <code>snippets</code>. Here’s is the data model defined in <code>snippets/models.py</code>:</p>
<pre class=" language-python"><code class="prism  language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>db <span class="token keyword">import</span> models
<span class="token keyword">from</span> pygments<span class="token punctuation">.</span>lexers <span class="token keyword">import</span> get_all_lexers
<span class="token keyword">from</span> pygments<span class="token punctuation">.</span>styles <span class="token keyword">import</span> get_all_styles

LEXERS <span class="token operator">=</span> <span class="token punctuation">[</span>item <span class="token keyword">for</span> item <span class="token keyword">in</span> get_all_lexers<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">if</span> item<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
LANGUAGE_CHOICES <span class="token operator">=</span> <span class="token builtin">sorted</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span>item<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> item<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">for</span> item <span class="token keyword">in</span> LEXERS<span class="token punctuation">]</span><span class="token punctuation">)</span>
STYLE_CHOICES <span class="token operator">=</span> <span class="token builtin">sorted</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> item<span class="token punctuation">)</span> <span class="token keyword">for</span> item <span class="token keyword">in</span> get_all_styles<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">Snippet</span><span class="token punctuation">(</span>models<span class="token punctuation">.</span>Model<span class="token punctuation">)</span><span class="token punctuation">:</span>
    created <span class="token operator">=</span> models<span class="token punctuation">.</span>DateTimeField<span class="token punctuation">(</span>auto_now_add<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    title <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>max_length<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span> blank<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span>
    code <span class="token operator">=</span> models<span class="token punctuation">.</span>TextField<span class="token punctuation">(</span><span class="token punctuation">)</span>
    linenos <span class="token operator">=</span> models<span class="token punctuation">.</span>BooleanField<span class="token punctuation">(</span>default<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
    language <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>choices<span class="token operator">=</span>LANGUAGE_CHOICES<span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token string">'python'</span><span class="token punctuation">,</span> max_length<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span>
    style <span class="token operator">=</span> models<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>choices<span class="token operator">=</span>STYLE_CHOICES<span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token string">'friendly'</span><span class="token punctuation">,</span> max_length<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span>

    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        ordering <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'created'</span><span class="token punctuation">]</span>
</code></pre>
<p>We’ll also need to create an initial migration for our snippet model, and sync the database for the first time.</p>
<pre class=" language-bash"><code class="prism  language-bash">python manage.py makemigrations snippets
python manage.py migrate snippets
</code></pre>
<h3 id="creating-a-serializer-class">Creating a Serializer class</h3>
<p>The first thing we need to get started on our Web API is to provide a way of serializing and deserializing the snippet instances into representations such as <code>json</code>. We can do this by declaring serializers that work very similar to Django’s forms. Create a file in the <code>snippets</code> directory named <code>serializers.py</code> and add the following.</p>
<pre class=" language-python"><code class="prism  language-python"><span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> serializers
<span class="token keyword">from</span> snippets<span class="token punctuation">.</span>models <span class="token keyword">import</span> Snippet<span class="token punctuation">,</span> LANGUAGE_CHOICES<span class="token punctuation">,</span> STYLE_CHOICES


<span class="token keyword">class</span> <span class="token class-name">SnippetSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>Serializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token builtin">id</span> <span class="token operator">=</span> serializers<span class="token punctuation">.</span>IntegerField<span class="token punctuation">(</span>read_only<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    title <span class="token operator">=</span> serializers<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>required<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> allow_blank<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> max_length<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span>
    code <span class="token operator">=</span> serializers<span class="token punctuation">.</span>CharField<span class="token punctuation">(</span>style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'base_template'</span><span class="token punctuation">:</span> <span class="token string">'textarea.html'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    linenos <span class="token operator">=</span> serializers<span class="token punctuation">.</span>BooleanField<span class="token punctuation">(</span>required<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
    language <span class="token operator">=</span> serializers<span class="token punctuation">.</span>ChoiceField<span class="token punctuation">(</span>choices<span class="token operator">=</span>LANGUAGE_CHOICES<span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token string">'python'</span><span class="token punctuation">)</span>
    style <span class="token operator">=</span> serializers<span class="token punctuation">.</span>ChoiceField<span class="token punctuation">(</span>choices<span class="token operator">=</span>STYLE_CHOICES<span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token string">'friendly'</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">create</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> validated_data<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""
        Create and return a new `Snippet` instance, given the validated data.
        """</span>
        <span class="token keyword">return</span> Snippet<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>create<span class="token punctuation">(</span><span class="token operator">**</span>validated_data<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">update</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> instance<span class="token punctuation">,</span> validated_data<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""
        Update and return an existing `Snippet` instance, given the validated data.
        """</span>
        instance<span class="token punctuation">.</span>title <span class="token operator">=</span> validated_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">,</span> instance<span class="token punctuation">.</span>title<span class="token punctuation">)</span>
        instance<span class="token punctuation">.</span>code <span class="token operator">=</span> validated_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'code'</span><span class="token punctuation">,</span> instance<span class="token punctuation">.</span>code<span class="token punctuation">)</span>
        instance<span class="token punctuation">.</span>linenos <span class="token operator">=</span> validated_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'linenos'</span><span class="token punctuation">,</span> instance<span class="token punctuation">.</span>linenos<span class="token punctuation">)</span>
        instance<span class="token punctuation">.</span>language <span class="token operator">=</span> validated_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'language'</span><span class="token punctuation">,</span> instance<span class="token punctuation">.</span>language<span class="token punctuation">)</span>
        instance<span class="token punctuation">.</span>style <span class="token operator">=</span> validated_data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'style'</span><span class="token punctuation">,</span> instance<span class="token punctuation">.</span>style<span class="token punctuation">)</span>
        instance<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> instance
</code></pre>
<p>The first part of the serializer class defines the fields that get serialized/deserialized. The  <code>create()</code>  and  <code>update()</code>  methods define how fully fledged instances are created or modified when calling  <code>serializer.save()</code></p>
<p>A serializer class is very similar to a Django  <code>Form</code>  class, and includes similar validation flags on the various fields, such as  <code>required</code>,  <code>max_length</code>  and  <code>default</code>.</p>
<p>Now if we go into Django shell, we can see how serialization works:</p>
<pre class=" language-bash"><code class="prism  language-bash">$ python manage.py shell
</code></pre>
<p>We create some sample data like this:</p>
<pre class=" language-python"><code class="prism  language-python">snippet <span class="token operator">=</span> Snippet<span class="token punctuation">(</span>code<span class="token operator">=</span><span class="token string">'foo = "bar"\n'</span><span class="token punctuation">)</span>
snippet<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>

snippet <span class="token operator">=</span> Snippet<span class="token punctuation">(</span>code<span class="token operator">=</span><span class="token string">'print("hello, world")\n'</span><span class="token punctuation">)</span>
snippet<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<p>And, here’s how to get the serialized data:</p>
<pre class=" language-python"><code class="prism  language-python">serializer <span class="token operator">=</span> SnippetSerializer<span class="token punctuation">(</span>snippet<span class="token punctuation">)</span>
serializer<span class="token punctuation">.</span>data
<span class="token comment"># {'id': 2, 'title': '', 'code': 'print("hello, world")\n', 'linenos': False, 'language': 'python', 'style': 'friendly'}</span>
</code></pre>
<p>At this point we’ve translated the model instance into Python native datatypes. To finalize the serialization process we render the data into <code>json</code>.</p>
<pre class=" language-python"><code class="prism  language-python"><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>renderers <span class="token keyword">import</span> JSONRenderer
<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>parsers <span class="token keyword">import</span> JSONParser

content <span class="token operator">=</span> JSONRenderer<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>render<span class="token punctuation">(</span>serializer<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
content
<span class="token comment"># b'{"id": 2, "title": "", "code": "print(\\"hello, world\\")\\n", "linenos": false, "language": "python", "style": "friendly"}'</span>
</code></pre>
<p><strong>Deserialization</strong> is similar. First we parse a stream into Python native datatypes…</p>
<pre class=" language-python"><code class="prism  language-python"><span class="token keyword">import</span> io

stream <span class="token operator">=</span> io<span class="token punctuation">.</span>BytesIO<span class="token punctuation">(</span>content<span class="token punctuation">)</span>
data <span class="token operator">=</span> JSONParser<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>parse<span class="token punctuation">(</span>stream<span class="token punctuation">)</span>
</code></pre>
<p>…then we restore those native datatypes into a fully populated object instance.</p>
<pre class=" language-python"><code class="prism  language-python">serializer <span class="token operator">=</span> SnippetSerializer<span class="token punctuation">(</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span>
serializer<span class="token punctuation">.</span>is_valid<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># True</span>
serializer<span class="token punctuation">.</span>validated_data
<span class="token comment"># OrderedDict([('title', ''), ('code', 'print("hello, world")\n'), ('linenos', False), ('language', 'python'), ('style', 'friendly')])</span>
serializer<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># &lt;Snippet: Snippet object&gt;</span>
</code></pre>
<p>We can also serialize <strong>querysets</strong> instead of model instances. To do so we simply add a  <code>many=True</code>  flag to the serializer arguments.</p>
<pre class=" language-python"><code class="prism  language-python">serializer <span class="token operator">=</span> SnippetSerializer<span class="token punctuation">(</span>Snippet<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> many<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
serializer<span class="token punctuation">.</span>data
<span class="token comment"># [OrderedDict([('id', 1), ('title', ''), ('code', 'foo = "bar"\n'), ('linenos', False), ('language', 'python'), ('style', 'friendly')]), OrderedDict([('id', 2), ('title', ''), ('code', 'print("hello, world")\n'), ('linenos', False), ('language', 'python'), ('style', 'friendly')]), OrderedDict([('id', 3), ('title', ''), ('code', 'print("hello, world")'), ('linenos', False), ('language', 'python'), ('style', 'friendly')])]</span>
</code></pre>
<h3 id="using-modelserializers">Using <code>ModelSerializers</code></h3>
<p>Our  <code>SnippetSerializer</code>  class is replicating a lot of information that’s also contained in the  <code>Snippet</code>  model. It would be nice if we could keep our code a bit more concise.</p>
<p>In the same way that Django provides both  <code>Form</code>  classes and  <code>ModelForm</code>  classes, REST framework includes both  <code>Serializer</code>  classes, and  <code>ModelSerializer</code>  classes.</p>
<p>Let’s look at refactoring our serializer using the  <code>ModelSerializer</code>  class. Open the file  <code>snippets/serializers.py</code>  again, and replace the  <code>SnippetSerializer</code>  class with the following.</p>
<pre class=" language-python"><code class="prism  language-python"><span class="token keyword">class</span> <span class="token class-name">SnippetSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>ModelSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        model <span class="token operator">=</span> Snippet
        fields <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">,</span> <span class="token string">'title'</span><span class="token punctuation">,</span> <span class="token string">'code'</span><span class="token punctuation">,</span> <span class="token string">'linenos'</span><span class="token punctuation">,</span> <span class="token string">'language'</span><span class="token punctuation">,</span> <span class="token string">'style'</span><span class="token punctuation">]</span>
</code></pre>
<p><strong>Note:</strong> It’s important to remember that  <code>ModelSerializer</code>  classes don’t do anything particularly magical, they are simply a shortcut for creating serializer classes:</p>
<ul>
<li>An automatically determined set of fields.</li>
<li>Simple default implementations for the  <code>create()</code>  and  <code>update()</code>  methods.</li>
</ul>
<h2 id="writing-regular-django-views-using-our-serializer">Writing regular Django views using our Serializer</h2>
<p>Let’s see how we can write some API views using our new Serializer class. For the moment we won’t use any of REST framework’s other features, we’ll just write the views as regular Django views.</p>
<p>Edit the  <code>snippets/views.py</code>  file, and add the following.</p>
<p>The root of our API is going to be a view that supports listing all the existing snippets, or creating a new snippet.</p>
<pre class=" language-python"><code class="prism  language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>http <span class="token keyword">import</span> HttpResponse<span class="token punctuation">,</span> JsonResponse
<span class="token keyword">from</span> django<span class="token punctuation">.</span>views<span class="token punctuation">.</span>decorators<span class="token punctuation">.</span>csrf <span class="token keyword">import</span> csrf_exempt
<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>parsers <span class="token keyword">import</span> JSONParser
<span class="token keyword">from</span> snippets<span class="token punctuation">.</span>models <span class="token keyword">import</span> Snippet
<span class="token keyword">from</span> snippets<span class="token punctuation">.</span>serializers <span class="token keyword">import</span> SnippetSerializer


@csrf_exempt
<span class="token keyword">def</span> <span class="token function">snippet_list</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    List all code snippets, or create a new snippet.
    """</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'GET'</span><span class="token punctuation">:</span>
        snippets <span class="token operator">=</span> Snippet<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        serializer <span class="token operator">=</span> SnippetSerializer<span class="token punctuation">(</span>snippets<span class="token punctuation">,</span> many<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> JsonResponse<span class="token punctuation">(</span>serializer<span class="token punctuation">.</span>data<span class="token punctuation">,</span> safe<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>

    <span class="token keyword">elif</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>
        data <span class="token operator">=</span> JSONParser<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>parse<span class="token punctuation">(</span>request<span class="token punctuation">)</span>
        serializer <span class="token operator">=</span> SnippetSerializer<span class="token punctuation">(</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span>
        <span class="token keyword">if</span> serializer<span class="token punctuation">.</span>is_valid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            serializer<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> JsonResponse<span class="token punctuation">(</span>serializer<span class="token punctuation">.</span>data<span class="token punctuation">,</span> status<span class="token operator">=</span><span class="token number">201</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> JsonResponse<span class="token punctuation">(</span>serializer<span class="token punctuation">.</span>errors<span class="token punctuation">,</span> status<span class="token operator">=</span><span class="token number">400</span><span class="token punctuation">)</span>

</code></pre>
<p>Note that because we want to be able to POST to this view from clients that won’t have a CSRF token we need to mark the view as  <code>csrf_exempt</code>. This isn’t something that you’d normally want to do, and REST framework views actually use more sensible behavior than this, but it’ll do for our purposes right now.</p>
<p>We’ll also need a view which corresponds to an individual snippet, and can be used to retrieve, update or delete the snippet.</p>
<pre class=" language-python"><code class="prism  language-python">@csrf_exempt
<span class="token keyword">def</span> <span class="token function">snippet_detail</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> pk<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    Retrieve, update or delete a code snippet.
    """</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        snippet <span class="token operator">=</span> Snippet<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>pk<span class="token operator">=</span>pk<span class="token punctuation">)</span>
    <span class="token keyword">except</span> Snippet<span class="token punctuation">.</span>DoesNotExist<span class="token punctuation">:</span>
        <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span>status<span class="token operator">=</span><span class="token number">404</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'GET'</span><span class="token punctuation">:</span>
        serializer <span class="token operator">=</span> SnippetSerializer<span class="token punctuation">(</span>snippet<span class="token punctuation">)</span>
        <span class="token keyword">return</span> JsonResponse<span class="token punctuation">(</span>serializer<span class="token punctuation">.</span>data<span class="token punctuation">)</span>

    <span class="token keyword">elif</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'PUT'</span><span class="token punctuation">:</span>
        data <span class="token operator">=</span> JSONParser<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>parse<span class="token punctuation">(</span>request<span class="token punctuation">)</span>
        serializer <span class="token operator">=</span> SnippetSerializer<span class="token punctuation">(</span>snippet<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>
        <span class="token keyword">if</span> serializer<span class="token punctuation">.</span>is_valid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            serializer<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> JsonResponse<span class="token punctuation">(</span>serializer<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
        <span class="token keyword">return</span> JsonResponse<span class="token punctuation">(</span>serializer<span class="token punctuation">.</span>errors<span class="token punctuation">,</span> status<span class="token operator">=</span><span class="token number">400</span><span class="token punctuation">)</span>

    <span class="token keyword">elif</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'DELETE'</span><span class="token punctuation">:</span>
        snippet<span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span>status<span class="token operator">=</span><span class="token number">204</span><span class="token punctuation">)</span>
</code></pre>
<p>Finally we need to wire these views up. Create the  <code>snippets/urls.py</code>  file:</p>
<pre class=" language-python"><code class="prism  language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>urls <span class="token keyword">import</span> path
<span class="token keyword">from</span> snippets <span class="token keyword">import</span> views

urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>
    path<span class="token punctuation">(</span><span class="token string">'snippets/'</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>snippet_list<span class="token punctuation">)</span><span class="token punctuation">,</span>
    path<span class="token punctuation">(</span><span class="token string">'snippets/&lt;int:pk&gt;/'</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>snippet_detail<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre>
<p>We also need to wire up the root urlconf, in the  <code>tutorial/urls.py</code>  file, to include our snippet app’s URLs.</p>
<pre class=" language-python"><code class="prism  language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>urls <span class="token keyword">import</span> path<span class="token punctuation">,</span> include

urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>
    path<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> include<span class="token punctuation">(</span><span class="token string">'snippets.urls'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre>
<p>Once we run our server, our API should send response like this:</p>
<pre class=" language-bash"><code class="prism  language-bash">$ http http://127.0.0.1:8000/snippets/  <span class="token comment"># used httpie (instead of curl)</span>

HTTP/1.1 200 OK
<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token string">"id"</span><span class="token keyword">:</span> 1,
    <span class="token string">"title"</span><span class="token keyword">:</span> <span class="token string">""</span>,
    <span class="token string">"code"</span><span class="token keyword">:</span> <span class="token string">"foo = \"bar\"\n"</span>,
    <span class="token string">"linenos"</span><span class="token keyword">:</span> false,
    <span class="token string">"language"</span><span class="token keyword">:</span> <span class="token string">"python"</span>,
    <span class="token string">"style"</span><span class="token keyword">:</span> <span class="token string">"friendly"</span>
  <span class="token punctuation">}</span>,
  <span class="token punctuation">{</span>
    <span class="token string">"id"</span><span class="token keyword">:</span> 2,
    <span class="token string">"title"</span><span class="token keyword">:</span> <span class="token string">""</span>,
    <span class="token string">"code"</span><span class="token keyword">:</span> <span class="token string">"print(\"hello, world\")\n"</span>,
    <span class="token string">"linenos"</span><span class="token keyword">:</span> false,
    <span class="token string">"language"</span><span class="token keyword">:</span> <span class="token string">"python"</span>,
    <span class="token string">"style"</span><span class="token keyword">:</span> <span class="token string">"friendly"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>


$ http http://127.0.0.1:8000/snippets/2/

HTTP/1.1 200 OK
<span class="token punctuation">..</span>.
<span class="token punctuation">{</span>
  <span class="token string">"id"</span><span class="token keyword">:</span> 2,
  <span class="token string">"title"</span><span class="token keyword">:</span> <span class="token string">""</span>,
  <span class="token string">"code"</span><span class="token keyword">:</span> <span class="token string">"print(\"hello, world\")\n"</span>,
  <span class="token string">"linenos"</span><span class="token keyword">:</span> false,
  <span class="token string">"language"</span><span class="token keyword">:</span> <span class="token string">"python"</span>,
  <span class="token string">"style"</span><span class="token keyword">:</span> <span class="token string">"friendly"</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="requests-and-responses">Requests and Responses</h2>
<h3 id="request-objects">Request Objects</h3>
<p>REST framework introduces a  <code>Request</code>  object that extends the regular  <code>HttpRequest</code>, and provides more flexible request parsing. The core functionality of the  <code>Request</code>  object is the  <code>request.data</code>  attribute, which is similar to  <code>request.POST</code>, but more useful for working with Web APIs.</p>
<pre class=" language-python"><code class="prism  language-python">request<span class="token punctuation">.</span>POST  <span class="token comment"># Only handles form data.  Only works for 'POST' method.</span>
request<span class="token punctuation">.</span>data  <span class="token comment"># Handles arbitrary data.  Works for 'POST', 'PUT' and 'PATCH' methods.</span>
</code></pre>
<h3 id="response-objects">Response Objects</h3>
<p>REST framework also introduces a  <code>Response</code>  object, which is a type of  <code>TemplateResponse</code>  that takes unrendered content and uses content negotiation to determine the correct content type to return to the client.</p>
<pre class=" language-python"><code class="prism  language-python"><span class="token keyword">return</span> Response<span class="token punctuation">(</span>data<span class="token punctuation">)</span>  <span class="token comment"># Renders to content type as requested by the client.</span>
</code></pre>
<h3 id="status-codes">Status codes</h3>
<p>Using numeric HTTP status codes in your views doesn’t always make for obvious reading, and it’s easy to not notice if you get an error code wrong. REST framework provides more explicit identifiers for each status code, such as  <code>HTTP_400_BAD_REQUEST</code>  in the  <code>status</code>  module. It’s a good idea to use these throughout rather than using numeric identifiers.</p>
<h3 id="wrapping-api-views">Wrapping API views</h3>
<p>REST framework provides two wrappers you can use to write API views.</p>
<ol>
<li>The  <code>@api_view</code>  decorator for working with function based views.</li>
<li>The  <code>APIView</code>  class for working with class-based views.</li>
</ol>
<p>These wrappers provide a few bits of functionality such as making sure you receive  <code>Request</code>  instances in your view, and adding context to  <code>Response</code>  objects so that content negotiation can be performed.</p>
<p>The wrappers also provide behavior such as returning  <code>405 Method Not Allowed</code>  responses when appropriate, and handling any  <code>ParseError</code>  exceptions that occur when accessing  <code>request.data</code>  with malformed input.</p>
<h3 id="pulling-it-all-together">Pulling it all together</h3>
<p>Okay, let’s go ahead and start using these new components to refactor our views (<code>views.py</code>) slightly (using <code>Response</code> instead of <code>JsonResponse</code> and <code>HttpResponse</code>).</p>
<pre class=" language-python"><code class="prism  language-python"><span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> status
<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>decorators <span class="token keyword">import</span> api_view
<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>response <span class="token keyword">import</span> Response
<span class="token keyword">from</span> snippets<span class="token punctuation">.</span>models <span class="token keyword">import</span> Snippet
<span class="token keyword">from</span> snippets<span class="token punctuation">.</span>serializers <span class="token keyword">import</span> SnippetSerializer


@api_view<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">snippet_list</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    List all code snippets, or create a new snippet.
    """</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'GET'</span><span class="token punctuation">:</span>
        snippets <span class="token operator">=</span> Snippet<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        serializer <span class="token operator">=</span> SnippetSerializer<span class="token punctuation">(</span>snippets<span class="token punctuation">,</span> many<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> Response<span class="token punctuation">(</span>serializer<span class="token punctuation">.</span>data<span class="token punctuation">)</span>  <span class="token comment"># --&gt; this line has changed</span>

    <span class="token keyword">elif</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>
        serializer <span class="token operator">=</span> SnippetSerializer<span class="token punctuation">(</span>data<span class="token operator">=</span>request<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
        <span class="token keyword">if</span> serializer<span class="token punctuation">.</span>is_valid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            serializer<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> Response<span class="token punctuation">(</span>serializer<span class="token punctuation">.</span>data<span class="token punctuation">,</span> status<span class="token operator">=</span>status<span class="token punctuation">.</span>HTTP_201_CREATED<span class="token punctuation">)</span>  <span class="token comment"># --&gt; this line has changed</span>
        <span class="token keyword">return</span> Response<span class="token punctuation">(</span>serializer<span class="token punctuation">.</span>errors<span class="token punctuation">,</span> status<span class="token operator">=</span>status<span class="token punctuation">.</span>HTTP_400_BAD_REQUEST<span class="token punctuation">)</span>  <span class="token comment"># --&gt; this line has changed</span>

@api_view<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'PUT'</span><span class="token punctuation">,</span> <span class="token string">'DELETE'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">snippet_detail</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> pk<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    Retrieve, update or delete a code snippet.
    """</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        snippet <span class="token operator">=</span> Snippet<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>pk<span class="token operator">=</span>pk<span class="token punctuation">)</span>
    <span class="token keyword">except</span> Snippet<span class="token punctuation">.</span>DoesNotExist<span class="token punctuation">:</span>
        <span class="token keyword">return</span> Response<span class="token punctuation">(</span>status<span class="token operator">=</span>status<span class="token punctuation">.</span>HTTP_404_NOT_FOUND<span class="token punctuation">)</span>  <span class="token comment"># --&gt; This line has changed</span>

    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'GET'</span><span class="token punctuation">:</span>
        serializer <span class="token operator">=</span> SnippetSerializer<span class="token punctuation">(</span>snippet<span class="token punctuation">)</span>
        <span class="token keyword">return</span> Response<span class="token punctuation">(</span>serializer<span class="token punctuation">.</span>data<span class="token punctuation">)</span>  <span class="token comment"># --&gt; This line has changed</span>

    <span class="token keyword">elif</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'PUT'</span><span class="token punctuation">:</span>
        serializer <span class="token operator">=</span> SnippetSerializer<span class="token punctuation">(</span>snippet<span class="token punctuation">,</span> data<span class="token operator">=</span>request<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
        <span class="token keyword">if</span> serializer<span class="token punctuation">.</span>is_valid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            serializer<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> Response<span class="token punctuation">(</span>serializer<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
        <span class="token keyword">return</span> Response<span class="token punctuation">(</span>serializer<span class="token punctuation">.</span>errors<span class="token punctuation">,</span> status<span class="token operator">=</span>status<span class="token punctuation">.</span>HTTP_400_BAD_REQUEST<span class="token punctuation">)</span>  <span class="token comment"># --&gt; This line has changed</span>

    <span class="token keyword">elif</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'DELETE'</span><span class="token punctuation">:</span>
        snippet<span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> Response<span class="token punctuation">(</span>status<span class="token operator">=</span>status<span class="token punctuation">.</span>HTTP_204_NO_CONTENT<span class="token punctuation">)</span>  <span class="token comment"># --&gt; This line has changed</span>
</code></pre>
<p><strong>Note:</strong> Notice that we’re no longer explicitly tying our requests or responses to a given content type. <code>request.data</code> can handle incoming <code>json</code> requests, but it can also handle other formats.</p>
<h3 id="adding-optional-format-suffixes-to-our-urls">Adding optional format suffixes to our URLs</h3>
<p>To take advantage of the fact that our responses are no longer hardwired to a single content type let’s add support for format suffixes to our API endpoints. Using format suffixes gives us URLs that explicitly refer to a given format, and means our API will be able to handle URLs such as  <a href="http://example.com/api/items/4.json">http://example.com/api/items/4.json</a>.</p>
<p>Start by adding a  <code>format</code>  keyword argument to both of the views, like so.</p>
<pre class=" language-python"><code class="prism  language-python"><span class="token keyword">def</span> <span class="token function">snippet_list</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token builtin">format</span><span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</code></pre>
<p>and</p>
<pre class=" language-python"><code class="prism  language-python"><span class="token keyword">def</span> <span class="token function">snippet_detail</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> pk<span class="token punctuation">,</span> <span class="token builtin">format</span><span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
</code></pre>
<p>Now update the  <code>snippets/urls.py</code>  file slightly, to append a set of  <code>format_suffix_patterns</code>  in addition to the existing URLs.</p>
<pre class=" language-python"><code class="prism  language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>urls <span class="token keyword">import</span> path
<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>urlpatterns <span class="token keyword">import</span> format_suffix_patterns
<span class="token keyword">from</span> snippets <span class="token keyword">import</span> views

urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>
    path<span class="token punctuation">(</span><span class="token string">'snippets/'</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>snippet_list<span class="token punctuation">)</span><span class="token punctuation">,</span>
    path<span class="token punctuation">(</span><span class="token string">'snippets/&lt;int:pk&gt;'</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>snippet_detail<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>

urlpatterns <span class="token operator">=</span> format_suffix_patterns<span class="token punctuation">(</span>urlpatterns<span class="token punctuation">)</span>
</code></pre>
<p>We don’t necessarily need to add these extra url patterns in, but it gives us a simple, clean way of referring to a specific format.</p>
<p>We can control the format of the response that we get back, either by using the  <code>Accept</code>  header:</p>
<pre class=" language-bash"><code class="prism  language-bash">http http://127.0.0.1:8000/snippets/ Accept:application/json  <span class="token comment"># Request JSON</span>
http http://127.0.0.1:8000/snippets/ Accept:text/html         <span class="token comment"># Request HTML</span>
</code></pre>
<p>Similarly, we can control the format of the request that we send, using the  <code>Content-Type</code>  header.</p>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token comment"># POST using form data</span>
http --form POST http://127.0.0.1:8000/snippets/ code<span class="token operator">=</span><span class="token string">"print(123)"</span>

<span class="token punctuation">{</span>
  <span class="token string">"id"</span><span class="token keyword">:</span> 3,
  <span class="token string">"title"</span><span class="token keyword">:</span> <span class="token string">""</span>,
  <span class="token string">"code"</span><span class="token keyword">:</span> <span class="token string">"print(123)"</span>,
  <span class="token string">"linenos"</span><span class="token keyword">:</span> false,
  <span class="token string">"language"</span><span class="token keyword">:</span> <span class="token string">"python"</span>,
  <span class="token string">"style"</span><span class="token keyword">:</span> <span class="token string">"friendly"</span>
<span class="token punctuation">}</span>

<span class="token comment"># POST using JSON</span>
http --json POST http://127.0.0.1:8000/snippets/ code<span class="token operator">=</span><span class="token string">"print(456)"</span>

<span class="token punctuation">{</span>
    <span class="token string">"id"</span><span class="token keyword">:</span> 4,
    <span class="token string">"title"</span><span class="token keyword">:</span> <span class="token string">""</span>,
    <span class="token string">"code"</span><span class="token keyword">:</span> <span class="token string">"print(456)"</span>,
    <span class="token string">"linenos"</span><span class="token keyword">:</span> false,
    <span class="token string">"language"</span><span class="token keyword">:</span> <span class="token string">"python"</span>,
    <span class="token string">"style"</span><span class="token keyword">:</span> <span class="token string">"friendly"</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="class-based-views">Class-based Views</h2>
<p>We can also write our API views using class-based views, rather than function based views. As we’ll see this is a powerful pattern that allows us to reuse common functionality, and helps us keep our code <a href="https://en.wikipedia.org/wiki/Don't_repeat_yourself">DRY</a>.</p>
<p>We’ll start by rewriting the root view as a class-based view. All this involves is a little bit of refactoring of <code>views.py</code>.</p>
<pre class=" language-python"><code class="prism  language-python"><span class="token keyword">from</span> snippets<span class="token punctuation">.</span>models <span class="token keyword">import</span> Snippet
<span class="token keyword">from</span> snippets<span class="token punctuation">.</span>serializers <span class="token keyword">import</span> SnippetSerializer
<span class="token keyword">from</span> django<span class="token punctuation">.</span>http <span class="token keyword">import</span> Http404
<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>views <span class="token keyword">import</span> APIView
<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>response <span class="token keyword">import</span> Response
<span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> status


<span class="token keyword">class</span> <span class="token class-name">SnippetList</span><span class="token punctuation">(</span>APIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    List all snippets, or create a new snippet.
    """</span>
    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token builtin">format</span><span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        snippets <span class="token operator">=</span> Snippet<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        serializer <span class="token operator">=</span> SnippetSerializer<span class="token punctuation">(</span>snippets<span class="token punctuation">,</span> many<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> Response<span class="token punctuation">(</span>serializer<span class="token punctuation">.</span>data<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">post</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token builtin">format</span><span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        serializer <span class="token operator">=</span> SnippetSerializer<span class="token punctuation">(</span>data<span class="token operator">=</span>request<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
        <span class="token keyword">if</span> serializer<span class="token punctuation">.</span>is_valid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            serializer<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> Response<span class="token punctuation">(</span>serializer<span class="token punctuation">.</span>data<span class="token punctuation">,</span> status<span class="token operator">=</span>status<span class="token punctuation">.</span>HTTP_201_CREATED<span class="token punctuation">)</span>
        <span class="token keyword">return</span> Response<span class="token punctuation">(</span>serializer<span class="token punctuation">.</span>errors<span class="token punctuation">,</span> status<span class="token operator">=</span>status<span class="token punctuation">.</span>HTTP_400_BAD_REQUEST<span class="token punctuation">)</span>
</code></pre>
<p>So far, so good. It looks pretty similar to the previous case, but we’ve got better separation between the different HTTP methods. We’ll also need to update the instance view in <code>views.py</code>.</p>
<pre class=" language-python"><code class="prism  language-python"><span class="token keyword">class</span> <span class="token class-name">SnippetDetail</span><span class="token punctuation">(</span>APIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    Retrieve, update or delete a snippet instance.
    """</span>
    <span class="token keyword">def</span> <span class="token function">get_object</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> pk<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> Snippet<span class="token punctuation">.</span>objects<span class="token punctuation">.</span>get<span class="token punctuation">(</span>pk<span class="token operator">=</span>pk<span class="token punctuation">)</span>
        <span class="token keyword">except</span> Snippet<span class="token punctuation">.</span>DoesNotExist<span class="token punctuation">:</span>
            <span class="token keyword">raise</span> Http404

    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> pk<span class="token punctuation">,</span> <span class="token builtin">format</span><span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        snippet <span class="token operator">=</span> self<span class="token punctuation">.</span>get_object<span class="token punctuation">(</span>pk<span class="token punctuation">)</span>
        serializer <span class="token operator">=</span> SnippetSerializer<span class="token punctuation">(</span>snippet<span class="token punctuation">)</span>
        <span class="token keyword">return</span> Response<span class="token punctuation">(</span>serializer<span class="token punctuation">.</span>data<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">put</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> pk<span class="token punctuation">,</span> <span class="token builtin">format</span><span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        snippet <span class="token operator">=</span> self<span class="token punctuation">.</span>get_object<span class="token punctuation">(</span>pk<span class="token punctuation">)</span>
        serializer <span class="token operator">=</span> SnippetSerializer<span class="token punctuation">(</span>snippet<span class="token punctuation">,</span> data<span class="token operator">=</span>request<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
        <span class="token keyword">if</span> serializer<span class="token punctuation">.</span>is_valid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            serializer<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> Response<span class="token punctuation">(</span>serializer<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
        <span class="token keyword">return</span> Response<span class="token punctuation">(</span>serializer<span class="token punctuation">.</span>errors<span class="token punctuation">,</span> status<span class="token operator">=</span>status<span class="token punctuation">.</span>HTTP_400_BAD_REQUEST<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">delete</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> pk<span class="token punctuation">,</span> <span class="token builtin">format</span><span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        snippet <span class="token operator">=</span> self<span class="token punctuation">.</span>get_object<span class="token punctuation">(</span>pk<span class="token punctuation">)</span>
        snippet<span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> Response<span class="token punctuation">(</span>status<span class="token operator">=</span>status<span class="token punctuation">.</span>HTTP_204_NO_CONTENT<span class="token punctuation">)</span>
</code></pre>
<p>Again, it’s still pretty similar to the function based view right now.</p>
<p><strong>Note:</strong> We’ll also need to refactor our  <code>snippets/urls.py</code>  slightly now that we’re using class-based views.</p>
<pre class=" language-python"><code class="prism  language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>urls <span class="token keyword">import</span> path
<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>urlpatterns <span class="token keyword">import</span> format_suffix_patterns
<span class="token keyword">from</span> snippets <span class="token keyword">import</span> views

urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>
    path<span class="token punctuation">(</span><span class="token string">'snippets/'</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>SnippetList<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    path<span class="token punctuation">(</span><span class="token string">'snippets/&lt;int:pk&gt;/'</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>SnippetDetail<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>

urlpatterns <span class="token operator">=</span> format_suffix_patterns<span class="token punctuation">(</span>urlpatterns<span class="token punctuation">)</span>
</code></pre>
<h3 id="using-mixins">Using <code>mixins</code></h3>
<p>One of the big wins of using class-based views is that it allows us to easily compose reusable bits of behaviour.</p>
<p>The create/retrieve/update/delete operations that we’ve been using so far are going to be pretty similar for any model-backed API views we create. Those bits of common behaviour are implemented in REST framework’s mixin classes.</p>
<pre class=" language-python"><code class="prism  language-python"><span class="token keyword">from</span> snippets<span class="token punctuation">.</span>models <span class="token keyword">import</span> Snippet
<span class="token keyword">from</span> snippets<span class="token punctuation">.</span>serializers <span class="token keyword">import</span> SnippetSerializer
<span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> mixins
<span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> generics

<span class="token keyword">class</span> <span class="token class-name">SnippetList</span><span class="token punctuation">(</span>mixins<span class="token punctuation">.</span>ListModelMixin<span class="token punctuation">,</span>
                  mixins<span class="token punctuation">.</span>CreateModelMixin<span class="token punctuation">,</span>
                  generics<span class="token punctuation">.</span>GenericAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    queryset <span class="token operator">=</span> Snippet<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    serializer_class <span class="token operator">=</span> SnippetSerializer

    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span><span class="token builtin">list</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">post</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>create<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
</code></pre>
<p>We’re building our view using  <code>GenericAPIView</code>, and adding in  <code>ListModelMixin</code>  and  <code>CreateModelMixin</code>.</p>
<p>The base class provides the core functionality, and the mixin classes provide the  <code>.list()</code>  and  <code>.create()</code>  actions. We’re then explicitly binding the  <code>get</code>  and  <code>post</code>  methods to the appropriate actions.</p>
<pre class=" language-python"><code class="prism  language-python"><span class="token keyword">class</span> <span class="token class-name">SnippetDetail</span><span class="token punctuation">(</span>mixins<span class="token punctuation">.</span>RetrieveModelMixin<span class="token punctuation">,</span>
                    mixins<span class="token punctuation">.</span>UpdateModelMixin<span class="token punctuation">,</span>
                    mixins<span class="token punctuation">.</span>DestroyModelMixin<span class="token punctuation">,</span>
                    generics<span class="token punctuation">.</span>GenericAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    queryset <span class="token operator">=</span> Snippet<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    serializer_class <span class="token operator">=</span> SnippetSerializer

    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>retrieve<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">put</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>update<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">delete</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>destroy<span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
</code></pre>
<p>Again we’re using the <code>GenericAPIView</code> class to provide the core functionality, and adding in mixins to provide the <code>.retrieve()</code>, <code>.update()</code> and <code>.destroy()</code> actions.</p>
<h3 id="using-generic-class-based-views">Using generic class-based views</h3>
<p>Using the mixin classes we’ve rewritten the views to use slightly less code than before, but we can go one step further. REST framework provides a set of already mixed-in generic views that we can use to trim down our  <code>views.py</code>  module even more.</p>
<pre class=" language-python"><code class="prism  language-python"><span class="token keyword">from</span> snippets<span class="token punctuation">.</span>models <span class="token keyword">import</span> Snippet
<span class="token keyword">from</span> snippets<span class="token punctuation">.</span>serializers <span class="token keyword">import</span> SnippetSerializer
<span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> generics


<span class="token keyword">class</span> <span class="token class-name">SnippetList</span><span class="token punctuation">(</span>generics<span class="token punctuation">.</span>ListCreateAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    queryset <span class="token operator">=</span> Snippet<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    serializer_class <span class="token operator">=</span> SnippetSerializer


<span class="token keyword">class</span> <span class="token class-name">SnippetDetail</span><span class="token punctuation">(</span>generics<span class="token punctuation">.</span>RetrieveUpdateDestroyAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    queryset <span class="token operator">=</span> Snippet<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    serializer_class <span class="token operator">=</span> SnippetSerializer
</code></pre>
<h2 id="authentication-and-permissions">Authentication and Permissions</h2>
<p>Currently our API doesn’t have any restrictions on who can edit or delete code snippets. We’d like to have some more advanced behavior in order to make sure that:</p>
<ul>
<li>Code snippets are always associated with a creator.</li>
<li>Only authenticated users may create snippets.</li>
<li>Only the creator of a snippet may update or delete it.</li>
<li>Unauthenticated requests should have full read-only access.</li>
</ul>
<h3 id="adding-information-to-our-model">Adding information to our model</h3>
<p>We’re going to make a couple of changes to our  <code>Snippet</code>  model class. First, let’s add a couple of fields. One of those fields will be used to represent the user who created the code snippet. The other field will be used to store the highlighted HTML representation of the code.</p>
<p>Add the following two fields to the  <code>Snippet</code>  model in  <code>models.py</code>.</p>
<pre class=" language-python"><code class="prism  language-python">owner <span class="token operator">=</span> models<span class="token punctuation">.</span>ForeignKey<span class="token punctuation">(</span><span class="token string">'auth.User'</span><span class="token punctuation">,</span> related_name<span class="token operator">=</span><span class="token string">'snippets'</span><span class="token punctuation">,</span> on_delete<span class="token operator">=</span>models<span class="token punctuation">.</span>CASCADE<span class="token punctuation">)</span>
highlighted <span class="token operator">=</span> models<span class="token punctuation">.</span>TextField<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<p>We’d also need to make sure that when the model is saved, that we populate the highlighted field, using the  <code>pygments</code>  code highlighting library.</p>
<p>We’ll need some extra imports:</p>
<pre class=" language-python"><code class="prism  language-python"><span class="token keyword">from</span> pygments<span class="token punctuation">.</span>lexers <span class="token keyword">import</span> get_lexer_by_name
<span class="token keyword">from</span> pygments<span class="token punctuation">.</span>formatters<span class="token punctuation">.</span>html <span class="token keyword">import</span> HtmlFormatter
<span class="token keyword">from</span> pygments <span class="token keyword">import</span> highlight
</code></pre>
<p>And now we can add a  <code>.save()</code>  method to our model class:</p>
<pre class=" language-python"><code class="prism  language-python"><span class="token keyword">def</span> <span class="token function">save</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    Use the `pygments` library to create a highlighted HTML
    representation of the code snippet.
    """</span>
    lexer <span class="token operator">=</span> get_lexer_by_name<span class="token punctuation">(</span>self<span class="token punctuation">.</span>language<span class="token punctuation">)</span>
    linenos <span class="token operator">=</span> <span class="token string">'table'</span> <span class="token keyword">if</span> self<span class="token punctuation">.</span>linenos <span class="token keyword">else</span> <span class="token boolean">False</span>
    options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'title'</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>title<span class="token punctuation">}</span> <span class="token keyword">if</span> self<span class="token punctuation">.</span>title <span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    formatter <span class="token operator">=</span> HtmlFormatter<span class="token punctuation">(</span>style<span class="token operator">=</span>self<span class="token punctuation">.</span>style<span class="token punctuation">,</span> linenos<span class="token operator">=</span>linenos<span class="token punctuation">,</span>
                              full<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token operator">**</span>options<span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>highlighted <span class="token operator">=</span> highlight<span class="token punctuation">(</span>self<span class="token punctuation">.</span>code<span class="token punctuation">,</span> lexer<span class="token punctuation">,</span> formatter<span class="token punctuation">)</span>
    <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
</code></pre>
<p>When that’s all done we’ll need to update our database tables. Normally, we’d create a database migration in order to do that, but for the purposes of this tutorial, let’s just delete the database and start again.</p>
<pre class=" language-bash"><code class="prism  language-bash"><span class="token function">rm</span> -f db.sqlite3
<span class="token function">rm</span> -r snippets/migrations
python manage.py makemigrations snippets
python manage.py migrate
</code></pre>
<p>You might also want to create a few different users, to use for testing the API. The quickest way to do this will be with the  <code>createsuperuser</code>  command.</p>
<pre class=" language-bash"><code class="prism  language-bash">python manage.py createsuperuser
</code></pre>
<h3 id="adding-endpoints-for-our-user-models">Adding endpoints for our User models</h3>
<p>Now that we’ve got some users to work with, we’d better add representations of those users to our API. Creating a new serializer is easy. In  <code>serializers.py</code>  add:</p>
<pre class=" language-python"><code class="prism  language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>models <span class="token keyword">import</span> User

<span class="token keyword">class</span> <span class="token class-name">UserSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>ModelSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    snippets <span class="token operator">=</span> serializers<span class="token punctuation">.</span>PrimaryKeyRelatedField<span class="token punctuation">(</span>many<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> queryset<span class="token operator">=</span>Snippet<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        model <span class="token operator">=</span> User
        fields <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">,</span> <span class="token string">'username'</span><span class="token punctuation">,</span> <span class="token string">'snippets'</span><span class="token punctuation">]</span>
</code></pre>
<p>Because  <code>'snippets'</code>  is a  <em>reverse</em>  relationship on the User model, it will not be included by default when using the  <code>ModelSerializer</code>  class, so we needed to add an explicit field for it.</p>
<p>We’ll also add a couple of views to  <code>views.py</code>. We’d like to just use read-only views for the user representations, so we’ll use the  <code>ListAPIView</code>  and  <code>RetrieveAPIView</code>  generic class-based views.</p>
<pre class=" language-python"><code class="prism  language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>models <span class="token keyword">import</span> User


<span class="token keyword">class</span> <span class="token class-name">UserList</span><span class="token punctuation">(</span>generics<span class="token punctuation">.</span>ListAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    queryset <span class="token operator">=</span> User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    serializer_class <span class="token operator">=</span> UserSerializer


<span class="token keyword">class</span> <span class="token class-name">UserDetail</span><span class="token punctuation">(</span>generics<span class="token punctuation">.</span>RetrieveAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    queryset <span class="token operator">=</span> User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    serializer_class <span class="token operator">=</span> UserSerializer
</code></pre>
<p>Make sure to also import the  <code>UserSerializer</code>  class</p>
<pre class=" language-python"><code class="prism  language-python"><span class="token keyword">from</span> snippets<span class="token punctuation">.</span>serializers <span class="token keyword">import</span> UserSerializer
</code></pre>
<p>Finally we need to add those views into the API, by referencing them from the URL conf. Add the following to the patterns in  <code>snippets/urls.py</code>.</p>
<pre class=" language-python"><code class="prism  language-python">path<span class="token punctuation">(</span><span class="token string">'users/'</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>UserList<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
path<span class="token punctuation">(</span><span class="token string">'users/&lt;int:pk&gt;/'</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>UserDetail<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</code></pre>
<h3 id="associating-snippets-with-users">Associating Snippets with Users</h3>
<p>Right now, if we created a code snippet, there’d be no way of associating the user that created the snippet, with the snippet instance. The user isn’t sent as part of the serialized representation, but is instead a property of the incoming request.</p>
<p>The way we deal with that is by overriding a  <code>.perform_create()</code>  method on our snippet views, that allows us to modify how the instance save is managed, and handle any information that is implicit in the incoming request or requested URL.</p>
<p>On the  <code>SnippetList</code>  view class, add the following method:</p>
<pre class=" language-python"><code class="prism  language-python"><span class="token keyword">def</span> <span class="token function">perform_create</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> serializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    serializer<span class="token punctuation">.</span>save<span class="token punctuation">(</span>owner<span class="token operator">=</span>self<span class="token punctuation">.</span>request<span class="token punctuation">.</span>user<span class="token punctuation">)</span>
</code></pre>
<p>The  <code>create()</code>  method of our serializer will now be passed an additional  <code>'owner'</code>  field, along with the validated data from the request.</p>
<h3 id="updating-our-serializer">Updating our serializer</h3>
<p>Now that snippets are associated with the user that created them, let’s update our  <code>SnippetSerializer</code>  to reflect that. Add the following field to the serializer definition in  <code>serializers.py</code>:</p>
<pre class=" language-python"><code class="prism  language-python">owner <span class="token operator">=</span> serializers<span class="token punctuation">.</span>ReadOnlyField<span class="token punctuation">(</span>source<span class="token operator">=</span><span class="token string">'owner.username'</span><span class="token punctuation">)</span>
</code></pre>
<p><strong>Note</strong>: Make sure you also add  <code>'owner',</code>  to the list of fields in the inner  <code>Meta</code>  class.</p>
<p>This field is doing something quite interesting. The  <code>source</code>  argument controls which attribute is used to populate a field, and can point at any attribute on the serialized instance. It can also take the dotted notation shown above, in which case it will traverse the given attributes, in a similar way as it is used with Django’s template language.</p>
<p>The field we’ve added is the untyped  <code>ReadOnlyField</code>  class, in contrast to the other typed fields, such as  <code>CharField</code>,  <code>BooleanField</code>  etc… The untyped  <code>ReadOnlyField</code>  is always read-only, and will be used for serialized representations, but will not be used for updating model instances when they are deserialized. We could have also used  <code>CharField(read_only=True)</code>  here.</p>
<h3 id="adding-required-permissions-to-views">Adding required permissions to views</h3>
<p>Now that code snippets are associated with users, we want to make sure that only authenticated users are able to create, update and delete code snippets.</p>
<p>REST framework includes a number of permission classes that we can use to restrict who can access a given view. In this case the one we’re looking for is  <code>IsAuthenticatedOrReadOnly</code>, which will ensure that authenticated requests get read-write access, and unauthenticated requests get read-only access.</p>
<p>First add the following import in the views module</p>
<pre class=" language-python"><code class="prism  language-python"><span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> permissions
</code></pre>
<p>Then, add the following property to  <strong>both</strong>  the  <code>SnippetList</code>  and  <code>SnippetDetail</code>  view classes.</p>
<pre class=" language-python"><code class="prism  language-python">permission_classes <span class="token operator">=</span> <span class="token punctuation">[</span>permissions<span class="token punctuation">.</span>IsAuthenticatedOrReadOnly<span class="token punctuation">]</span>
</code></pre>
<h3 id="adding-login-to-the-browsable-api">Adding login to the Browsable API</h3>
<p>If you open a browser and navigate to the browsable API at the moment, you’ll find that you’re no longer able to create new code snippets. In order to do so we’d need to be able to login as a user.</p>
<p>We can add a login view for use with the browsable API, by editing the URLconf in our project-level  <code>urls.py</code>  file.</p>
<p>Add the following import at the top of the file:</p>
<pre class=" language-python"><code class="prism  language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>urls <span class="token keyword">import</span> path<span class="token punctuation">,</span> include
</code></pre>
<p>And, at the end of the file, add a pattern to include the login and logout views for the browsable API.</p>
<pre class=" language-python"><code class="prism  language-python">urlpatterns <span class="token operator">+=</span> <span class="token punctuation">[</span>
    path<span class="token punctuation">(</span><span class="token string">'api-auth/'</span><span class="token punctuation">,</span> include<span class="token punctuation">(</span><span class="token string">'rest_framework.urls'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre>
<p>The  <code>'api-auth/'</code>  part of pattern can actually be whatever URL you want to use.</p>
<p>Now if you open up the browser again and refresh the page you’ll see a ‘Login’ link in the top right of the page. If you log in as one of the users you created earlier, you’ll be able to create code snippets again.</p>
<p>Once you’ve created a few code snippets, navigate to the ‘/users/’ endpoint, and notice that the representation includes a list of the snippet ids that are associated with each user, in each user’s ‘snippets’ field.</p>
<h3 id="object-level-permissions">Object level permissions</h3>
<p>Really we’d like all code snippets to be visible to anyone, but also make sure that only the user that created a code snippet is able to update or delete it.</p>
<p>To do that we’re going to need to create a custom permission.</p>
<p>In the snippets app, create a new file,  <code>permissions.py</code></p>
<pre class=" language-python"><code class="prism  language-python"><span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> permissions


<span class="token keyword">class</span> <span class="token class-name">IsOwnerOrReadOnly</span><span class="token punctuation">(</span>permissions<span class="token punctuation">.</span>BasePermission<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    Custom permission to only allow owners of an object to edit it.
    """</span>

    <span class="token keyword">def</span> <span class="token function">has_object_permission</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> view<span class="token punctuation">,</span> obj<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># Read permissions are allowed to any request,</span>
        <span class="token comment"># so we'll always allow GET, HEAD or OPTIONS requests.</span>
        <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token keyword">in</span> permissions<span class="token punctuation">.</span>SAFE_METHODS<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">True</span>

        <span class="token comment"># Write permissions are only allowed to the owner of the snippet.</span>
        <span class="token keyword">return</span> obj<span class="token punctuation">.</span>owner <span class="token operator">==</span> request<span class="token punctuation">.</span>user
</code></pre>
<p>Now we can add that custom permission to our snippet instance endpoint, by editing the  <code>permission_classes</code>  property on the  <code>SnippetDetail</code>  view class:</p>
<pre class=" language-python"><code class="prism  language-python">permission_classes <span class="token operator">=</span> <span class="token punctuation">[</span>permissions<span class="token punctuation">.</span>IsAuthenticatedOrReadOnly<span class="token punctuation">,</span>
                      IsOwnerOrReadOnly<span class="token punctuation">]</span>
</code></pre>
<p>Make sure to also import the  <code>IsOwnerOrReadOnly</code>  class.</p>
<pre class=" language-python"><code class="prism  language-python"><span class="token keyword">from</span> snippets<span class="token punctuation">.</span>permissions <span class="token keyword">import</span> IsOwnerOrReadOnly
</code></pre>
<p>Now, if you open a browser again, you find that the ‘DELETE’ and ‘PUT’ actions only appear on a snippet instance endpoint if you’re logged in as the same user that created the code snippet.</p>
<h3 id="authenticating-with-the-api">Authenticating with the API</h3>
<p>Because we now have a set of permissions on the API, we need to authenticate our requests to it if we want to edit any snippets. We haven’t set up any  <a href="https://www.django-rest-framework.org/api-guide/authentication/">authentication classes</a>, so the defaults are currently applied, which are  <code>SessionAuthentication</code>  and  <code>BasicAuthentication</code>.</p>
<p>When we interact with the API through the web browser, we can login, and the browser session will then provide the required authentication for the requests.</p>
<p>If we’re interacting with the API programmatically we need to explicitly provide the authentication credentials on each request.</p>
<p>If we try to create a snippet without authenticating, we’ll get an error:</p>
<pre class=" language-bash"><code class="prism  language-bash">http POST http://127.0.0.1:8000/snippets/ code<span class="token operator">=</span><span class="token string">"print(123)"</span>

<span class="token punctuation">{</span>
    <span class="token string">"detail"</span><span class="token keyword">:</span> <span class="token string">"Authentication credentials were not provided."</span>
<span class="token punctuation">}</span>
</code></pre>
<p>We can make a successful request by including the username and password of one of the users we created earlier.</p>
<pre class=" language-bash"><code class="prism  language-bash">http -a admin:password123 POST http://127.0.0.1:8000/snippets/ code<span class="token operator">=</span><span class="token string">"print(789)"</span>

<span class="token punctuation">{</span>
    <span class="token string">"id"</span><span class="token keyword">:</span> 1,
    <span class="token string">"owner"</span><span class="token keyword">:</span> <span class="token string">"admin"</span>,
    <span class="token string">"title"</span><span class="token keyword">:</span> <span class="token string">"foo"</span>,
    <span class="token string">"code"</span><span class="token keyword">:</span> <span class="token string">"print(789)"</span>,
    <span class="token string">"linenos"</span><span class="token keyword">:</span> false,
    <span class="token string">"language"</span><span class="token keyword">:</span> <span class="token string">"python"</span>,
    <span class="token string">"style"</span><span class="token keyword">:</span> <span class="token string">"friendly"</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="relationships--hyperlinked-apis">Relationships &amp; Hyperlinked APIs</h2>
<p>At the moment relationships within our API are represented by using primary keys. In this part of the tutorial we’ll improve the cohesion and discoverability of our API, by instead using hyperlinking for relationships.</p>
<h3 id="creating-an-endpoint-for-the-root-of-our-api">Creating an endpoint for the root of our API</h3>
<p>Right now we have endpoints for ‘snippets’ and ‘users’, but we don’t have a single entry point to our API. To create one, we’ll use a regular function-based view and the  <code>@api_view</code>  decorator we introduced earlier. In your  <code>snippets/views.py</code>  add:</p>
<pre class=" language-python"><code class="prism  language-python"><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>decorators <span class="token keyword">import</span> api_view
<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>response <span class="token keyword">import</span> Response
<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>reverse <span class="token keyword">import</span> reverse


@api_view<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">api_root</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token builtin">format</span><span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> Response<span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token string">'users'</span><span class="token punctuation">:</span> reverse<span class="token punctuation">(</span><span class="token string">'user-list'</span><span class="token punctuation">,</span> request<span class="token operator">=</span>request<span class="token punctuation">,</span> <span class="token builtin">format</span><span class="token operator">=</span><span class="token builtin">format</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string">'snippets'</span><span class="token punctuation">:</span> reverse<span class="token punctuation">(</span><span class="token string">'snippet-list'</span><span class="token punctuation">,</span> request<span class="token operator">=</span>request<span class="token punctuation">,</span> <span class="token builtin">format</span><span class="token operator">=</span><span class="token builtin">format</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>Two things should be noticed here. First, we’re using REST framework’s  <code>reverse</code>  function in order to return fully-qualified URLs; second, URL patterns are identified by convenience names that we will declare later on in our  <code>snippets/urls.py</code>.</p>
<h3 id="creating-an-endpoint-for-the-highlighted-snippets">Creating an endpoint for the highlighted snippets</h3>
<p>The other obvious thing that’s still missing from our pastebin API is the code highlighting endpoints.</p>
<p>Unlike all our other API endpoints, we don’t want to use JSON, but instead just present an HTML representation. There are two styles of HTML renderer provided by REST framework, one for dealing with HTML rendered using templates, the other for dealing with pre-rendered HTML. The second renderer is the one we’d like to use for this endpoint.</p>
<p>The other thing we need to consider when creating the code highlight view is that there’s no existing concrete generic view that we can use. We’re not returning an object instance, but instead a property of an object instance.</p>
<p>Instead of using a concrete generic view, we’ll use the base class for representing instances, and create our own  <code>.get()</code>  method. In your  <code>snippets/views.py</code>  add:</p>
<pre class=" language-python"><code class="prism  language-python"><span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> renderers

<span class="token keyword">class</span> <span class="token class-name">SnippetHighlight</span><span class="token punctuation">(</span>generics<span class="token punctuation">.</span>GenericAPIView<span class="token punctuation">)</span><span class="token punctuation">:</span>
    queryset <span class="token operator">=</span> Snippet<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    renderer_classes <span class="token operator">=</span> <span class="token punctuation">[</span>renderers<span class="token punctuation">.</span>StaticHTMLRenderer<span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        snippet <span class="token operator">=</span> self<span class="token punctuation">.</span>get_object<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> Response<span class="token punctuation">(</span>snippet<span class="token punctuation">.</span>highlighted<span class="token punctuation">)</span>
</code></pre>
<p>As usual we need to add the new views that we’ve created in to our URLconf. We’ll add a url pattern for our new API root in  <code>snippets/urls.py</code>:</p>
<pre class=" language-python"><code class="prism  language-python">path<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>api_root<span class="token punctuation">)</span><span class="token punctuation">,</span>
</code></pre>
<p>And then add a url pattern for the snippet highlights:</p>
<pre><code>path('snippets/&lt;int:pk&gt;/highlight/', views.SnippetHighlight.as_view()),
</code></pre>
<h3 id="hyperlinking-our-api">Hyperlinking our API</h3>
<p>Dealing with relationships between entities is one of the more challenging aspects of Web API design. There are a number of different ways that we might choose to represent a relationship:</p>
<ul>
<li>Using primary keys.</li>
<li>Using hyperlinking between entities.</li>
<li>Using a unique identifying slug field on the related entity.</li>
<li>Using the default string representation of the related entity.</li>
<li>Nesting the related entity inside the parent representation.</li>
<li>Some other custom representation.</li>
</ul>
<p>REST framework supports all of these styles, and can apply them across forward or reverse relationships, or apply them across custom managers such as generic foreign keys.</p>
<p>In this case we’d like to use a hyperlinked style between entities. In order to do so, we’ll modify our serializers to extend  <code>HyperlinkedModelSerializer</code>  instead of the existing  <code>ModelSerializer</code>.</p>
<p>The  <code>HyperlinkedModelSerializer</code>  has the following differences from  <code>ModelSerializer</code>:</p>
<ul>
<li>It does not include the  <code>id</code>  field by default.</li>
<li>It includes a  <code>url</code>  field, using  <code>HyperlinkedIdentityField</code>.</li>
<li>Relationships use  <code>HyperlinkedRelatedField</code>, instead of  <code>PrimaryKeyRelatedField</code>.</li>
</ul>
<p>We can easily re-write our existing serializers to use hyperlinking. In your  <code>snippets/serializers.py</code>  add:</p>
<pre class=" language-python"><code class="prism  language-python"><span class="token keyword">class</span> <span class="token class-name">SnippetSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>HyperlinkedModelSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    owner <span class="token operator">=</span> serializers<span class="token punctuation">.</span>ReadOnlyField<span class="token punctuation">(</span>source<span class="token operator">=</span><span class="token string">'owner.username'</span><span class="token punctuation">)</span>
    highlight <span class="token operator">=</span> serializers<span class="token punctuation">.</span>HyperlinkedIdentityField<span class="token punctuation">(</span>view_name<span class="token operator">=</span><span class="token string">'snippet-highlight'</span><span class="token punctuation">,</span> <span class="token builtin">format</span><span class="token operator">=</span><span class="token string">'html'</span><span class="token punctuation">)</span>

    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        model <span class="token operator">=</span> Snippet
        fields <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'url'</span><span class="token punctuation">,</span> <span class="token string">'id'</span><span class="token punctuation">,</span> <span class="token string">'highlight'</span><span class="token punctuation">,</span> <span class="token string">'owner'</span><span class="token punctuation">,</span>
                  <span class="token string">'title'</span><span class="token punctuation">,</span> <span class="token string">'code'</span><span class="token punctuation">,</span> <span class="token string">'linenos'</span><span class="token punctuation">,</span> <span class="token string">'language'</span><span class="token punctuation">,</span> <span class="token string">'style'</span><span class="token punctuation">]</span>


<span class="token keyword">class</span> <span class="token class-name">UserSerializer</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span>HyperlinkedModelSerializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
    snippets <span class="token operator">=</span> serializers<span class="token punctuation">.</span>HyperlinkedRelatedField<span class="token punctuation">(</span>many<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> view_name<span class="token operator">=</span><span class="token string">'snippet-detail'</span><span class="token punctuation">,</span> read_only<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

    <span class="token keyword">class</span> <span class="token class-name">Meta</span><span class="token punctuation">:</span>
        model <span class="token operator">=</span> User
        fields <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'url'</span><span class="token punctuation">,</span> <span class="token string">'id'</span><span class="token punctuation">,</span> <span class="token string">'username'</span><span class="token punctuation">,</span> <span class="token string">'snippets'</span><span class="token punctuation">]</span>
</code></pre>
<p>Notice that we’ve also added a new  <code>'highlight'</code>  field. This field is of the same type as the  <code>url</code>  field, except that it points to the  <code>'snippet-highlight'</code>  url pattern, instead of the  <code>'snippet-detail'</code>  url pattern.</p>
<p>Because we’ve included format suffixed URLs such as  <code>'.json'</code>, we also need to indicate on the  <code>highlight</code>  field that any format suffixed hyperlinks it returns should use the  <code>'.html'</code>  suffix.</p>
<h3 id="making-sure-our-url-patterns-are-named">Making sure our URL patterns are named</h3>
<p>If we’re going to have a hyperlinked API, we need to make sure we name our URL patterns. Let’s take a look at which URL patterns we need to name.</p>
<ul>
<li>The root of our API refers to  <code>'user-list'</code>  and  <code>'snippet-list'</code>.</li>
<li>Our snippet serializer includes a field that refers to  <code>'snippet-highlight'</code>.</li>
<li>Our user serializer includes a field that refers to  <code>'snippet-detail'</code>.</li>
<li>Our snippet and user serializers include  <code>'url'</code>  fields that by default will refer to  <code>'{model_name}-detail'</code>, which in this case will be  <code>'snippet-detail'</code>  and  <code>'user-detail'</code>.</li>
</ul>
<p>After adding all those names into our URLconf, our final  <code>snippets/urls.py</code>  file should look like this:</p>
<pre class=" language-python"><code class="prism  language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>urls <span class="token keyword">import</span> path
<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>urlpatterns <span class="token keyword">import</span> format_suffix_patterns
<span class="token keyword">from</span> snippets <span class="token keyword">import</span> views

<span class="token comment"># API endpoints</span>
urlpatterns <span class="token operator">=</span> format_suffix_patterns<span class="token punctuation">(</span><span class="token punctuation">[</span>
    path<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>api_root<span class="token punctuation">)</span><span class="token punctuation">,</span>
    path<span class="token punctuation">(</span><span class="token string">'snippets/'</span><span class="token punctuation">,</span>
        views<span class="token punctuation">.</span>SnippetList<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        name<span class="token operator">=</span><span class="token string">'snippet-list'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    path<span class="token punctuation">(</span><span class="token string">'snippets/&lt;int:pk&gt;/'</span><span class="token punctuation">,</span>
        views<span class="token punctuation">.</span>SnippetDetail<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        name<span class="token operator">=</span><span class="token string">'snippet-detail'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    path<span class="token punctuation">(</span><span class="token string">'snippets/&lt;int:pk&gt;/highlight/'</span><span class="token punctuation">,</span>
        views<span class="token punctuation">.</span>SnippetHighlight<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        name<span class="token operator">=</span><span class="token string">'snippet-highlight'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    path<span class="token punctuation">(</span><span class="token string">'users/'</span><span class="token punctuation">,</span>
        views<span class="token punctuation">.</span>UserList<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        name<span class="token operator">=</span><span class="token string">'user-list'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    path<span class="token punctuation">(</span><span class="token string">'users/&lt;int:pk&gt;/'</span><span class="token punctuation">,</span>
        views<span class="token punctuation">.</span>UserDetail<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        name<span class="token operator">=</span><span class="token string">'user-detail'</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre>
<h3 id="adding-pagination">Adding pagination</h3>
<p>The list views for users and code snippets could end up returning quite a lot of instances, so really we’d like to make sure we paginate the results, and allow the API client to step through each of the individual pages.</p>
<p>We can change the default list style to use pagination, by modifying our  <code>tutorial/settings.py</code>  file slightly. Add the following setting:</p>
<pre class=" language-python"><code class="prism  language-python">REST_FRAMEWORK <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'DEFAULT_PAGINATION_CLASS'</span><span class="token punctuation">:</span> <span class="token string">'rest_framework.pagination.PageNumberPagination'</span><span class="token punctuation">,</span>
    <span class="token string">'PAGE_SIZE'</span><span class="token punctuation">:</span> <span class="token number">10</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Note that settings in REST framework are all namespaced into a single dictionary setting, named  <code>REST_FRAMEWORK</code>, which helps keep them well separated from your other project settings.</p>
<p>We could also customize the pagination style if we needed to, but in this case we’ll just stick with the default.</p>
<h2 id="viewsets-and-routers">ViewSets and Routers</h2>
<p>REST framework includes an abstraction for dealing with  <code>ViewSets</code>, that allows the developer to concentrate on modeling the state and interactions of the API, and leave the URL construction to be handled automatically, based on common conventions.</p>
<p><strong>Note:</strong> <code>ViewSet</code>  classes are almost the same thing as  <code>View</code>  classes, except that they provide operations such as  <code>retrieve</code>, or  <code>update</code>, and not method handlers such as  <code>get</code>  or  <code>put</code>.</p>
<p>A  <code>ViewSet</code>  class is only bound to a set of method handlers at the last moment, when it is instantiated into a set of views, typically by using a  <code>Router</code>  class which handles the complexities of defining the URL conf for you.</p>
<h3 id="refactoring-to-use-viewsets">Refactoring to use ViewSets</h3>
<p>Let’s take our current set of views, and refactor them into view sets.</p>
<p>First of all let’s refactor our  <code>UserList</code>  and  <code>UserDetail</code>  views into a single  <code>UserViewSet</code>. We can remove the two views, and replace them with a single class:</p>
<pre class=" language-python"><code class="prism  language-python"><span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> viewsets

<span class="token keyword">class</span> <span class="token class-name">UserViewSet</span><span class="token punctuation">(</span>viewsets<span class="token punctuation">.</span>ReadOnlyModelViewSet<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    This viewset automatically provides `list` and `retrieve` actions.
    """</span>
    queryset <span class="token operator">=</span> User<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    serializer_class <span class="token operator">=</span> UserSerializer
</code></pre>
<p><strong>Note:</strong> Here we’ve used the  <code>ReadOnlyModelViewSet</code>  class to automatically provide the default ‘read-only’ operations. We’re still setting the  <code>queryset</code>  and  <code>serializer_class</code>  attributes exactly as we did when we were using regular views, but <em><strong>we no longer need to provide the same information to two separate classes</strong></em>.</p>
<p>Next we’re going to replace the  <code>SnippetList</code>,  <code>SnippetDetail</code>  and  <code>SnippetHighlight</code>  view classes. We can remove the three views, and again replace them with a single class.</p>
<pre class=" language-python"><code class="prism  language-python"><span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>decorators <span class="token keyword">import</span> action
<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>response <span class="token keyword">import</span> Response
<span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> permissions

<span class="token keyword">class</span> <span class="token class-name">SnippetViewSet</span><span class="token punctuation">(</span>viewsets<span class="token punctuation">.</span>ModelViewSet<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    This viewset automatically provides `list`, `create`, `retrieve`,
    `update` and `destroy` actions.

    Additionally we also provide an extra `highlight` action.
    """</span>
    queryset <span class="token operator">=</span> Snippet<span class="token punctuation">.</span>objects<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    serializer_class <span class="token operator">=</span> SnippetSerializer
    permission_classes <span class="token operator">=</span> <span class="token punctuation">[</span>permissions<span class="token punctuation">.</span>IsAuthenticatedOrReadOnly<span class="token punctuation">,</span>
                          IsOwnerOrReadOnly<span class="token punctuation">]</span>

    @action<span class="token punctuation">(</span>detail<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> renderer_classes<span class="token operator">=</span><span class="token punctuation">[</span>renderers<span class="token punctuation">.</span>StaticHTMLRenderer<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">highlight</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
        snippet <span class="token operator">=</span> self<span class="token punctuation">.</span>get_object<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> Response<span class="token punctuation">(</span>snippet<span class="token punctuation">.</span>highlighted<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">perform_create</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> serializer<span class="token punctuation">)</span><span class="token punctuation">:</span>
        serializer<span class="token punctuation">.</span>save<span class="token punctuation">(</span>owner<span class="token operator">=</span>self<span class="token punctuation">.</span>request<span class="token punctuation">.</span>user<span class="token punctuation">)</span>
</code></pre>
<p><strong>Note:</strong> This time we’ve used the  <code>ModelViewSet</code>  class in order to get the complete set of default read and write operations.</p>
<p><strong>Note:</strong> Notice that we’ve also used the  <code>@action</code>  decorator to create a custom action, named  <code>highlight</code>. This decorator can be used to add any custom endpoints that don’t fit into the standard  <code>create</code>/<code>update</code>/<code>delete</code>  style.</p>
<p><strong>Note:</strong> Custom actions which use the  <code>@action</code>  decorator will respond to  <code>GET</code>  requests by default. We can use the  <code>methods</code>  argument if we wanted an action that responded to  <code>POST</code>  requests.</p>
<p><strong>Note:</strong> The URLs for custom actions by default depend on the method name itself. If you want to change the way url should be constructed, you can include  <code>url_path</code>  as a decorator keyword argument.</p>
<h3 id="binding-viewsets-to-urls-explicitly">Binding ViewSets to URLs explicitly</h3>
<p>The handler methods only get bound to the actions when we define the URLConf. To see what’s going on under the hood let’s first explicitly create a set of views from our ViewSets.</p>
<p>In the  <code>snippets/urls.py</code>  file we bind our  <code>ViewSet</code>  classes into a set of concrete views.</p>
<pre class=" language-python"><code class="prism  language-python"><span class="token keyword">from</span> snippets<span class="token punctuation">.</span>views <span class="token keyword">import</span> SnippetViewSet<span class="token punctuation">,</span> UserViewSet<span class="token punctuation">,</span> api_root
<span class="token keyword">from</span> rest_framework <span class="token keyword">import</span> renderers

snippet_list <span class="token operator">=</span> SnippetViewSet<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token string">'get'</span><span class="token punctuation">:</span> <span class="token string">'list'</span><span class="token punctuation">,</span>
    <span class="token string">'post'</span><span class="token punctuation">:</span> <span class="token string">'create'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
snippet_detail <span class="token operator">=</span> SnippetViewSet<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token string">'get'</span><span class="token punctuation">:</span> <span class="token string">'retrieve'</span><span class="token punctuation">,</span>
    <span class="token string">'put'</span><span class="token punctuation">:</span> <span class="token string">'update'</span><span class="token punctuation">,</span>
    <span class="token string">'patch'</span><span class="token punctuation">:</span> <span class="token string">'partial_update'</span><span class="token punctuation">,</span>
    <span class="token string">'delete'</span><span class="token punctuation">:</span> <span class="token string">'destroy'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
snippet_highlight <span class="token operator">=</span> SnippetViewSet<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token string">'get'</span><span class="token punctuation">:</span> <span class="token string">'highlight'</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> renderer_classes<span class="token operator">=</span><span class="token punctuation">[</span>renderers<span class="token punctuation">.</span>StaticHTMLRenderer<span class="token punctuation">]</span><span class="token punctuation">)</span>
user_list <span class="token operator">=</span> UserViewSet<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token string">'get'</span><span class="token punctuation">:</span> <span class="token string">'list'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
user_detail <span class="token operator">=</span> UserViewSet<span class="token punctuation">.</span>as_view<span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token string">'get'</span><span class="token punctuation">:</span> <span class="token string">'retrieve'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre>
<p>Notice how we’re creating multiple views from each  <code>ViewSet</code>  class, by binding the http methods to the required action for each view.</p>
<p>Now that we’ve bound our resources into concrete views, we can register the views with the URL conf as usual.</p>
<pre class=" language-python"><code class="prism  language-python">urlpatterns <span class="token operator">=</span> format_suffix_patterns<span class="token punctuation">(</span><span class="token punctuation">[</span>
    path<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> api_root<span class="token punctuation">)</span><span class="token punctuation">,</span>
    path<span class="token punctuation">(</span><span class="token string">'snippets/'</span><span class="token punctuation">,</span> snippet_list<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'snippet-list'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    path<span class="token punctuation">(</span><span class="token string">'snippets/&lt;int:pk&gt;/'</span><span class="token punctuation">,</span> snippet_detail<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'snippet-detail'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    path<span class="token punctuation">(</span><span class="token string">'snippets/&lt;int:pk&gt;/highlight/'</span><span class="token punctuation">,</span> snippet_highlight<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'snippet-highlight'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    path<span class="token punctuation">(</span><span class="token string">'users/'</span><span class="token punctuation">,</span> user_list<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'user-list'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    path<span class="token punctuation">(</span><span class="token string">'users/&lt;int:pk&gt;/'</span><span class="token punctuation">,</span> user_detail<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'user-detail'</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre>
<h3 id="using-routers">Using Routers</h3>
<p>Because we’re using  <code>ViewSet</code>  classes rather than  <code>View</code>  classes, we actually don’t need to design the URL conf ourselves. <em><strong>The conventions for wiring up resources into views and urls can be handled automatically, using a  <code>Router</code>  class. All we need to do is register the appropriate view sets with a router, and let it do the rest.</strong></em></p>
<p>Here’s our re-wired  <code>snippets/urls.py</code>  file.</p>
<pre class=" language-python"><code class="prism  language-python"><span class="token keyword">from</span> django<span class="token punctuation">.</span>urls <span class="token keyword">import</span> path<span class="token punctuation">,</span> include
<span class="token keyword">from</span> rest_framework<span class="token punctuation">.</span>routers <span class="token keyword">import</span> DefaultRouter
<span class="token keyword">from</span> snippets <span class="token keyword">import</span> views

<span class="token comment"># Create a router and register our viewsets with it.</span>
router <span class="token operator">=</span> DefaultRouter<span class="token punctuation">(</span><span class="token punctuation">)</span>
router<span class="token punctuation">.</span>register<span class="token punctuation">(</span>r<span class="token string">'snippets'</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>SnippetViewSet<span class="token punctuation">)</span>
router<span class="token punctuation">.</span>register<span class="token punctuation">(</span>r<span class="token string">'users'</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>UserViewSet<span class="token punctuation">)</span>

<span class="token comment"># The API URLs are now determined automatically by the router.</span>
urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>
    path<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> include<span class="token punctuation">(</span>router<span class="token punctuation">.</span>urls<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre>
<p>Registering the viewsets with the router is similar to providing a urlpattern. We include two arguments - the URL prefix for the views, and the viewset itself.</p>
<p><strong>Note:</strong> The  <code>DefaultRouter</code>  class we’re using also automatically creates the API root view for us, so we can now delete the  <code>api_root</code>  method from our  <code>views</code>  module.</p>
<h3 id="trade-offs-between-views-vs-viewsets">Trade-offs between views vs viewsets</h3>
<p><em><strong>Using viewsets can be a really useful abstraction. It helps ensure that URL conventions will be consistent across your API, minimizes the amount of code you need to write</strong></em>, and allows you to concentrate on the interactions and representations your API provides rather than the specifics of the URL conf.</p>
<p>That doesn’t mean it’s always the right approach to take. There’s a similar set of trade-offs to consider as when using class-based views instead of function based views. Using viewsets is less explicit than building your views individually.</p>
<blockquote>
<p>For a simple example refer to <a href="https://www.django-rest-framework.org/tutorial/quickstart/">this example</a>.</p>
</blockquote>

    </div>
  </div>
</body>

</html>
